import{jsxRuntimeExports as e,reactExports as t}from"./vendor-DFdPdMzy.es.js";import{useSduiExpression as i,useSduiStore as a,CROP_RATIOS as n,MediaImageEditor as r,filesWithEditDataToMediaList as o,MEDIA_EDITOR_VIEW as l,CropRatio as d,clientMediaFileStore as s,renderImageWithEdits as m,CROP_RATIOS$1 as c,useMediaImageEditor as g,getFileUrl as p,MediaEditData as u,MediaImageEditorCanvas as C,MediaEditorToolbar as f,MediaFileManager as E,MediaEditorViewWrapper as I,MediaImageFilters as R,MediaAltTextEditor as _,AddImage as y}from"./sdui-DfrfUkeI.es.js";import{useI18n as h,useTrackingContext as j}from"./como-CoE0HF5-.es.js";import{Box as x,Image as A,Column as F,Button as O}from"./ui-ffC1LXHV.es.js";import"./delux-sortable-Cqocqsq0.es.js";let b=Object.freeze(Object.defineProperty({__proto__:null,MediaEditor:function({input:t,editorConfig:l,outputMediaList:d,onComplete:s}={}){let m=i(t),c=i(l?.enableImageFilters),g=i(l?.enableImageAdjustmentSliders),{setValue:p}=a(),u=n[l?.supportedCropRatios?.[0]??"CropRatio_Original"]||n.CropRatio_Original;return e.jsx("div",{children:e.jsx(r,{input:m?.mediaFiles?.[0],onComplete:(e,t)=>{if(!m||!m.mediaFiles)return;let i=o([{file:e,editData:t}]);d?.key&&i&&p(d?.key,i),s?.()},enableImageFilters:c,enableImageAdjustmentSliders:g,cropRatio:u})})}},Symbol.toStringTag,{value:"Module"})),T=Object.freeze(Object.defineProperty({__proto__:null,MediaEditor:function({input:n,editorConfig:r,outputMediaList:b,onComplete:T,tagEditor:M}={}){let[v,w]=t.useState(l.FILE_MANAGER),k=i(n),[L,N]=t.useState(0),[S,D]=t.useState(k?.mediaFiles??[]),G=i(r?.enableImageFilters),P=i(r?.enableImageAdjustmentSliders),{setValue:U}=a(),{t:z}=h(),{jetCore:B}=j().getClients(),V=t.useRef(new Map),[W,q]=t.useState(()=>new Map),[X,H]=t.useState(r?.supportedCropRatios?.[0]??d.CropRatio_Original),K=c[X]||c[d.CropRatio_Original],Z=t.useCallback(async e=>{let t;if(!S.length)return;let i=S[L];if(!i)return;V.current.set(i.mediaFileId,e);let a=s.getItem(i.mediaFileId);if(a)try{let n=await m(a,e,K),r=W.get(i.mediaFileId);r&&URL.revokeObjectURL(r),t=URL.createObjectURL(n),q(e=>{let a=new Map(e);return a.set(i.mediaFileId,t),a})}catch(e){B.reportError(Error("Failed to generate image preview in MediaEditor",{cause:e}),["media-editor-v2"])}let n=[...S];return n[L]={...i,editData:e},D(n),t},[S,L,K,W,B]),$=S[L],Y=$?V.current.get($.mediaFileId):void 0;t.useEffect(()=>{if($&&v===l.IMAGE_EDITOR){let e=V.current.get($.mediaFileId);H(e?.cropRatio??r?.supportedCropRatios?.[0]??d.CropRatio_Original)}},[$,v,r?.supportedCropRatios]);let[J,Q]=g($,K,Y,t.useCallback(async e=>{let t=await Z(e);t&&"undefined"!=typeof document&&await new Promise(e=>{let i=document.createElement("img");i.onload=()=>e(),i.onerror=()=>e(),i.src=t}),w(l.FILE_MANAGER)},[Z])),ee=$?W.get($.mediaFileId)||p($):void 0,et=u.create(),ei=e=>{if(!e||0===e.length)return;let t=[...S,...e.map(e=>{let t=crypto.randomUUID(),i=e.webkitRelativePath||t;return s.setItem(t,e),i!==t&&s.setItem(i,e),{metadata:void 0,fileName:e.name,source:{$case:"localFile",localFile:{fileName:e.name,mimeType:e.type,filePointer:i}},size:e.size.toString(),mimeType:e.type,filePointer:i,mediaFileId:t,editData:et,captions:[],thumbnails:[]}})];D(t),N(t.length-1),b?.key&&U(b.key,{mediaFiles:t}),w(l.FILE_MANAGER)},ea=t.useRef(W);ea.current=W,t.useEffect(()=>()=>{ea.current.forEach(e=>{URL.revokeObjectURL(e)})},[]);let en=t.useCallback(async()=>{let e=await Promise.all(S.map(async e=>{let t=V.current.get(e.mediaFileId);if(!t)return e;let i=s.getItem(e.mediaFileId);if(!i)return e;try{let a=await m(i,t,K),n=o([{file:a,editData:t}]);return n?.mediaFiles?.[0]||e}catch(t){return B.reportError(Error("Failed to render image with edits during save",{cause:t}),["media-editor-v2"]),e}}));b?.key&&e.length>0&&U(b.key,{$type:"proto.sdui.media.MediaList",mediaFiles:e}),T?.()},[S,K,b?.key,U,T,B]);return e.jsxs(x,{display:"grid",style:{height:"100%",gridTemplateColumns:"4fr 2fr",gridTemplateRows:"1fr auto"},children:[e.jsxs(x,{display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:v===l.IMAGE_EDITOR?void 0:"tableBackgroundOffset",style:{gridColumn:"1",gridRow:"1",overflow:"hidden"},children:[e.jsx(x,{display:v===l.IMAGE_EDITOR?"none":"flex",justifyContent:"center",alignItems:"center",width:"fillAvailable",height:"fillAvailable",children:e.jsx(A,{src:ee,a11yText:z("media_editor_image_preview"),imageScalingType:"contain",width:"100%",height:"100%"})}),v===l.IMAGE_EDITOR&&e.jsx(C,{canvasKey:J.canvasKey,onReady:J.onReady,hasContentCredentials:J.hasContentCredentials,isImageEdited:J.isImageEdited,isContentCredentialsTooltipOpen:J.isContentCredentialsTooltipOpen,setIsContentCredentialsTooltipOpen:J.setIsContentCredentialsTooltipOpen,isContentCredentialsWarningOpen:J.isContentCredentialsWarningOpen,setIsContentCredentialsWarningOpen:J.setIsContentCredentialsWarningOpen})]}),v===l.FILE_MANAGER&&e.jsx(x,{display:"flex",justifyContent:"center",backgroundColor:"tableBackgroundOffset",style:{gridColumn:"1",gridRow:"2"},children:e.jsx(f,{activeView:v,onViewChange:w,selectedFile:$})}),e.jsx(x,{inset:"2x",display:"flex",flexDirection:"column",style:{gridColumn:"2",gridRow:"1 / 3",overflow:"auto"},children:e.jsxs(F,{gap:"2x",height:"100%",children:[v===l.FILE_MANAGER&&e.jsx(E,{files:S,selectedIndex:L,onSelectionChange:N,onFilesChange:D,onFilesAdded:ei,onViewChange:e=>w(e),previewUrlMap:W}),v===l.IMAGE_EDITOR&&e.jsx(I,{title:z("media_editor_edit"),onBack:()=>w(l.FILE_MANAGER),children:e.jsx(R,{imageRef:J.imageRef,editData:J.editData,initialZoom:J.initialZoom,initialStraightenAngle:J.initialStraightenAngle,initialRotate:J.initialRotate,onEdit:J.onImageEdit,onConstrainPosition:J.constrainImagePosition,enableImageFilters:G,enableImageAdjustmentSliders:P,onApplyEdits:Q,onCropRatioChange:H,supportedCropRatios:r?.supportedCropRatios,originalScale:J.originalScale})}),v===l.TAG_EDITOR&&e.jsx(I,{title:z("media_editor_add_tag"),onBack:()=>w(l.FILE_MANAGER),children:M}),v===l.ALT_TEXT_EDITOR&&e.jsx(I,{title:z("media_editor_add_alt_text"),onBack:()=>w(l.FILE_MANAGER),children:e.jsx(_,{initialAltText:$?.metadata?.altText,onSave:e=>{$&&(D(S.map(t=>t.mediaFileId===$.mediaFileId?{...t,metadata:{...t.metadata,altText:e}}:t)),w(l.FILE_MANAGER))}})}),v===l.ADD_IMAGE&&e.jsx(I,{onBack:()=>w(l.FILE_MANAGER),children:e.jsx(y,{onFilesAdded:ei,onViewChange:w})})]})}),e.jsx(x,{borderTop:"divider",insetX:"3x",insetY:"1.5x",tagName:"footer",justifyContent:"flexEnd",display:"flex",style:{gridColumn:"1 / 4",gridRow:"3"},children:e.jsx(O,{category:"primary",isEmphasized:!0,onClick:en,text:z("media_editor_save")})})]})}},Symbol.toStringTag,{value:"Module"}));export{b as CLIENT_COMPONENT_36610642f83d7097c7cf4dceb774deeb,T as CLIENT_COMPONENT_e66676ac1c1e334826be4ab8460d7536};