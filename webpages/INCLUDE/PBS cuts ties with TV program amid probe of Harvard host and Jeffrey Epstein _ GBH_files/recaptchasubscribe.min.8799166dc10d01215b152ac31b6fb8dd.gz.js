!function(){"use strict";class e extends window.HTMLElement{init(){return this.provider=this.getAttribute("data-provider"),!this.querySelector("iframe")&&(this.messages=this.querySelector(".messages"),this.subscribed=this.messages.querySelector(".subscribed"),this.formModule=this.querySelector(".GbhFormModule"),this.form=this.formModule.querySelector("form"),this.form&&(this.href=window.location.href,this.emailComponent=this.form.querySelector("gbh-email-input"),this.uniqueId=this.form.querySelector("input[name=uniqueId]").value,this.listIdField=this.form.querySelector("input[name=listId]").value,this.newsletterNameField=this.form.querySelector("input[name=newsletterName]").value,this.submitButton=this.querySelector("button"),this.serverDomain=window.location.protocol+"//"+window.location.host,this.endpoint="/_ajax/newsletter/subscribe-user",this.pagePosition="undefined",this.closest("main")?this.pagePosition="main":this.closest("aside")?this.pagePosition="sidebar":this.closest("footer")?this.pagePosition="footer":this.closest("header")&&(this.pagePosition="header")),!0)}connectedCallback(){this.init()&&document.addEventListener("RECAPTCHA_CLIENT_READY",e=>{this.form&&this.addSubmitEventListener()})}addSubmitEventListener(){this.submitButton.addEventListener("click",e=>{e.preventDefault();const t={email:this.emailComponent.getValue(),uniqueId:this.uniqueId,provider:this.provider};window.recaptchaClient.configureQuery("NewsletterSubscribeModule",t),window.recaptchaClient.success(e=>{this.processResponse(e)}),window.recaptchaClient.queryRecaptcha()})}processResponse(e){if(e){if(this.formModule.addEventListener("transitionend",e=>{e.target.style.display="none"},{once:!0}),this.formModule.classList.add("hide"),this.messages.style.display="block",this.messages.classList.remove("hide"),"pass"!==e.captchaStatus)return void this.handleError("Recaptcha thinks you're a bot");this.subscribed.innerHTML=e.data.message,200===e.status?this.sendSubscribeEvent():e.data.errorMessage&&this.handleError(e.data.errorMessage)}}handleError(e){const t=document.createElement("div");t.classList.add("error"),t?(t.innerHTML=e,this.messages.appendChild(t)):console.error("There was a problem creating the error message")}sendSubscribeEvent(){window.dataLayer.push({event:"email_subscribe",newsletterData:{page:this.href,pagePosition:this.pagePosition,listId:this.listIdField,newsletterName:this.newsletterNameField}})}}!function(e){function t(e){e.forEach(e=>{e.object&&(void 0!==e.button&&void 0===window.customElements.get(e.button)?(console.log("Registering",e.button,e.object),window.customElements.define(e.button,e.object,{extends:"button"})):void 0!==e.tag&&void 0===window.customElements.get(e.tag)&&window.customElements.define(e.tag,e.object))})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t(e)):t(e)}([{object:e,tag:"gbh-newsletter-recaptcha-subscribe"}])}();