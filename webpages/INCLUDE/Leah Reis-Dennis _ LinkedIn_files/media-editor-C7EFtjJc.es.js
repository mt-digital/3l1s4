import{jsxRuntimeExports as e,reactExports as t}from"./vendor-DnhT-zFH.es.js";import{useSduiExpression as i,useSduiStore as a,CROP_RATIOS as n,MediaImageEditor as r,filesWithEditDataToMediaList as o,MEDIA_EDITOR_VIEW as l,CropRatio as d,clientMediaFileStore as s,renderImageWithEdits as m,CROP_RATIOS$1 as c,useMediaImageEditor as p,getFileUrl as g,MediaEditData as u,MediaImageEditorCanvas as C,MediaEditorToolbar as f,MediaFileManager as E,MediaEditorViewWrapper as I,MediaImageFilters as R,MediaAltTextEditor as _,AddImage as y}from"./sdui-BVvmubex.es.js";import{useI18n as h,useTrackingContext as x}from"./como-DUpnsVmm.es.js";import{Box as j,Image as F,Column as A,Button as O}from"./ui-B4rX4FMv.es.js";import"./delux-sortable-BFTNYoGQ.es.js";let T=Object.freeze(Object.defineProperty({__proto__:null,MediaEditor:function({input:t,editorConfig:l,outputMediaList:d,onComplete:s}={}){let m=i(t),c=i(l?.enableImageFilters),p=i(l?.enableImageAdjustmentSliders),{setValue:g}=a(),u=n[l?.supportedCropRatios?.[0]??"CropRatio_Original"]||n.CropRatio_Original;return e.jsx("div",{children:e.jsx(r,{input:m?.mediaFiles?.[0],onComplete:(e,t)=>{if(!m||!m.mediaFiles)return;let i=o([{file:e,editData:t}]);d?.key&&i&&g(d?.key,i),s?.()},enableImageFilters:c,enableImageAdjustmentSliders:p,cropRatio:u})})}},Symbol.toStringTag,{value:"Module"})),b=Object.freeze(Object.defineProperty({__proto__:null,MediaEditor:function({input:n,editorConfig:r,outputMediaList:T,onComplete:b,tagEditor:M}={}){let[v,w]=t.useState(l.FILE_MANAGER),k=i(n),[L,N]=t.useState(0),[S,G]=t.useState(k?.mediaFiles??[]),D=i(r?.enableImageFilters),B=i(r?.enableImageAdjustmentSliders),{setValue:P}=a(),{t:U}=h(),{jetCore:z}=x().getClients(),V=t.useRef(new Map),[W,X]=t.useState(()=>new Map),[K,Y]=t.useState(r?.supportedCropRatios?.[0]??d.CropRatio_Original),Z=c[K]||c[d.CropRatio_Original],$=t.useCallback(async e=>{let t;if(!S.length)return;let i=S[L];if(!i)return;V.current.set(i.mediaFileId,e);let a=s.getItem(i.mediaFileId);if(a)try{let n=await m(a,e,Z),r=W.get(i.mediaFileId);r&&URL.revokeObjectURL(r),t=URL.createObjectURL(n),X(e=>{let a=new Map(e);return a.set(i.mediaFileId,t),a})}catch(e){z.reportError(Error("Failed to generate image preview in MediaEditor",{cause:e}),["media-editor-v2"])}let n=[...S];return n[L]={...i,editData:e},G(n),t},[S,L,Z,W,z]),H=S[L],Q=H?V.current.get(H.mediaFileId):void 0;t.useEffect(()=>{if(H&&v===l.IMAGE_EDITOR){let e=V.current.get(H.mediaFileId);Y(e?.cropRatio??r?.supportedCropRatios?.[0]??d.CropRatio_Original)}},[H,v,r?.supportedCropRatios]);let[q,J]=p(H,Z,Q,t.useCallback(async e=>{let t=await $(e);t&&"undefined"!=typeof document&&await new Promise(e=>{let i=document.createElement("img");i.onload=()=>e(),i.onerror=()=>e(),i.src=t}),w(l.FILE_MANAGER)},[$])),ee=H?W.get(H.mediaFileId)||g(H):void 0,et=u.create(),ei=e=>{if(!e||0===e.length)return;let t=[...S,...e.map(e=>{let t=crypto.randomUUID(),i=e.webkitRelativePath||t;return s.setItem(t,e),i!==t&&s.setItem(i,e),{metadata:void 0,fileName:e.name,source:{$case:"localFile",localFile:{fileName:e.name,mimeType:e.type,filePointer:i}},size:e.size.toString(),mimeType:e.type,filePointer:i,mediaFileId:t,editData:et,captions:[],thumbnails:[]}})];G(t),N(t.length-1),T?.key&&P(T.key,{mediaFiles:t}),w(l.FILE_MANAGER)},ea=t.useRef(W);ea.current=W,t.useEffect(()=>()=>{ea.current.forEach(e=>{URL.revokeObjectURL(e)})},[]);let en=t.useCallback(async()=>{let e=await Promise.all(S.map(async e=>{let t=V.current.get(e.mediaFileId);if(!t)return e;let i=s.getItem(e.mediaFileId);if(!i)return e;try{let a=await m(i,t,Z),n=o([{file:a,editData:t}]);return n?.mediaFiles?.[0]||e}catch(t){return z.reportError(Error("Failed to render image with edits during save",{cause:t}),["media-editor-v2"]),e}}));T?.key&&e.length>0&&P(T.key,{$type:"proto.sdui.media.MediaList",mediaFiles:e}),b?.()},[S,Z,T?.key,P,b,z]);return e.jsxs(j,{display:"grid",style:{height:"100%",gridTemplateColumns:"4fr 2fr",gridTemplateRows:"1fr auto"},children:[e.jsxs(j,{display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:v===l.IMAGE_EDITOR?void 0:"tableBackgroundOffset",style:{gridColumn:"1",gridRow:"1",overflow:"hidden"},children:[e.jsx(j,{display:v===l.IMAGE_EDITOR?"none":"flex",justifyContent:"center",alignItems:"center",width:"fillAvailable",height:"fillAvailable",children:e.jsx(F,{src:ee,a11yText:U("media_editor_image_preview"),imageScalingType:"contain",width:"100%",height:"100%"})}),v===l.IMAGE_EDITOR&&e.jsx(C,{canvasKey:q.canvasKey,onReady:q.onReady,hasContentCredentials:q.hasContentCredentials,isImageEdited:q.isImageEdited,isContentCredentialsTooltipOpen:q.isContentCredentialsTooltipOpen,setIsContentCredentialsTooltipOpen:q.setIsContentCredentialsTooltipOpen,isContentCredentialsWarningOpen:q.isContentCredentialsWarningOpen,setIsContentCredentialsWarningOpen:q.setIsContentCredentialsWarningOpen})]}),v===l.FILE_MANAGER&&e.jsx(j,{display:"flex",justifyContent:"center",backgroundColor:"tableBackgroundOffset",style:{gridColumn:"1",gridRow:"2"},children:e.jsx(f,{activeView:v,onViewChange:w,selectedFile:H})}),e.jsx(j,{inset:"2x",display:"flex",flexDirection:"column",style:{gridColumn:"2",gridRow:"1 / 3",overflow:"auto"},children:e.jsxs(A,{gap:"2x",height:"100%",children:[v===l.FILE_MANAGER&&e.jsx(E,{files:S,selectedIndex:L,onSelectionChange:N,onFilesChange:G,onFilesAdded:ei,onViewChange:e=>w(e),previewUrlMap:W}),v===l.IMAGE_EDITOR&&e.jsx(I,{title:U("media_editor_edit"),onBack:()=>w(l.FILE_MANAGER),children:e.jsx(R,{imageRef:q.imageRef,editData:q.editData,initialZoom:q.initialZoom,initialStraightenAngle:q.initialStraightenAngle,initialRotate:q.initialRotate,onEdit:q.onImageEdit,onConstrainPosition:q.constrainImagePosition,enableImageFilters:D,enableImageAdjustmentSliders:B,onApplyEdits:J,onCropRatioChange:Y,supportedCropRatios:r?.supportedCropRatios,originalScale:q.originalScale})}),v===l.TAG_EDITOR&&e.jsx(I,{title:U("media_editor_add_tag"),onBack:()=>w(l.FILE_MANAGER),children:M}),v===l.ALT_TEXT_EDITOR&&e.jsx(I,{title:U("media_editor_add_alt_text"),onBack:()=>w(l.FILE_MANAGER),children:e.jsx(_,{initialAltText:H?.metadata?.altText,onSave:e=>{H&&(G(S.map(t=>t.mediaFileId===H.mediaFileId?{...t,metadata:{...t.metadata,altText:e}}:t)),w(l.FILE_MANAGER))}})}),v===l.ADD_IMAGE&&e.jsx(I,{onBack:()=>w(l.FILE_MANAGER),children:e.jsx(y,{onFilesAdded:ei,onViewChange:w})})]})}),e.jsx(j,{borderTop:"divider",insetX:"3x",insetY:"1.5x",tagName:"footer",justifyContent:"flexEnd",display:"flex",style:{gridColumn:"1 / 4",gridRow:"3"},children:e.jsx(O,{category:"primary",isEmphasized:!0,onClick:en,text:U("media_editor_save")})})]})}},Symbol.toStringTag,{value:"Module"}));export{T as CLIENT_COMPONENT_36610642f83d7097c7cf4dceb774deeb,b as CLIENT_COMPONENT_e66676ac1c1e334826be4ab8460d7536};