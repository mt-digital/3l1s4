function html5ModeConfig(e){window.history&&history.pushState?e.html5Mode(!0):e.html5Mode(!1).hashPrefix("!")}Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){"use strict";if(null==e)throw new TypeError("Cannot convert first argument to object");for(var n=Object(e),r=1;r<arguments.length;r++){var o=arguments[r];if(null!=o)for(var a=Object.keys(Object(o)),i=0,s=a.length;i<s;i++){var c=a[i],l=Object.getOwnPropertyDescriptor(o,c);void 0!==l&&l.enumerable&&(n[c]=o[c])}}return n}}),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),function(){if("function"==typeof window.CustomEvent)return!1;function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}e.prototype=window.Event.prototype,window.CustomEvent=e}(),Array.prototype.find||(Array.prototype.find=function(e){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,n=Object(this),r=n.length>>>0,o=arguments[1],a=0;a<r;a++)if(t=n[a],e.call(o,t,a,n))return t}),Object.keys||(Object.keys=function(){"use strict";var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],r=n.length;return function(o){if("object"!=typeof o&&("function"!=typeof o||null===o))throw new TypeError("Object.keys called on non-object");var a,i,s=[];for(a in o)e.call(o,a)&&s.push(a);if(t)for(i=0;i<r;i++)e.call(o,n[i])&&s.push(n[i]);return s}}()),Array.prototype.reduce||(Array.prototype.reduce=function(e){"use strict";if(null==this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof e)throw new TypeError(e+" is not a function");var t,n=Object(this),r=n.length>>>0,o=0;if(arguments.length>=2)t=arguments[1];else{for(;o<r&&!(o in n);)o++;if(o>=r)throw new TypeError("Reduce of empty array with no initial value");t=n[o++]}for(;o<r;o++)o in n&&(t=e(t,n[o],o,n));return t}),Array.prototype.fill||(Array.prototype.fill=function(e){if(null==this)throw new TypeError("this is null or not defined");for(var t=Object(this),n=t.length>>>0,r=arguments[1]>>0,o=r<0?Math.max(n+r,0):Math.min(r,n),a=arguments[2],i=void 0===a?n:a>>0,s=i<0?Math.max(n+i,0):Math.min(i,n);o<s;)t[o]=e,o++;return t}),Object.freeze||(Object.freeze=function(e){if(Object(e)!==e)throw new TypeError("Object.freeze can only be called on Objects.");return e}),Object.values||(Object.values=function(e){return Object.keys(e).map(function(t){if(e.hasOwnProperty(t))return e[t]})}),function(e){var t,n,r,o,a=1,i=this,s="postMessage",c="addEventListener",l=i[s];e[s]=function(t,n,r){n&&(t="string"==typeof t?t:e.param(t),r=r||parent,l?r[s](t,n.replace(/([^:]+:\/\/[^\/]+).*/,"$1")):n&&(r.location=n.replace(/#.*$/,"")+"#"+ +new Date+a+++"&"+t))},e.receiveMessage=o=function(a,s,u){l?(a&&(r&&o(),r=function(t){if("string"==typeof s&&t.origin!==s||e.isFunction(s)&&!1===s(t.origin))return!1;a(t)}),i[c]?i[a?c:"removeEventListener"]("message",r,!1):i[a?"attachEvent":"detachEvent"]("onmessage",r)):(t&&clearInterval(t),t=null,a&&(u="number"==typeof s?s:"number"==typeof u?u:100,t=setInterval(function(){var e=document.location.hash,t=/^#?\d+&/;e!==n&&t.test(e)&&(n=e,a({data:e.replace(t,"")}))},u)))}}(jQuery),function(e){var t,n,r="error",o="warning";void 0===e.tinypass&&(e.tinypass={}),tinypass.uploadFile2=function(e,t){},tinypass.setMessageDashboard=function(e,t){return e===r||e===o?tinypass.__setErrorMessageDashboard(e,t):tinypass.__setMessage(t)},tinypass.__buildAlertPopupDashboard=function(e,t){if(t){var n=$('<div class="notification error"><span class="message">'+t+'</span><button type="button" class="close close-alert-dashboard">&times;</button></div>');$(document.body).append(n),n.css("marginLeft",-n.outerWidth()/2),n.addClass("in"),$(".close-alert-dashboard").unbind("click").click(function(){$(this).parent().remove(),tinypass.__buildAlertPopupDashboard()})}for(var r=$(".notification"),o=0,a=0;a<r.length;a++)$(r[a]),0!==a?$(r[a]).css({top:90+o+"px"}):$(r[a]).css({top:"90px"}),o+=$(r[a]).outerHeight()+10},tinypass.__setErrorMessageDashboard=function(e,t){if($(".modal-body").is(":visible"))$(".modal-body  .alert").remove(),$(".modal-body").prepend(tinypass.__buildAlertPopup(e,t));else if($("#popup").is(":visible"))$("#popup #popup-content .alert").remove(),$("#popup #popup-content").prepend(tinypass.__buildAlertPopup(e,t));else if($(".modal .modal-body").length>0){for(var n=$(".modal .modal-body"),r=!1,o=0;o<n.length;o++){var a=n[o];$(a).is(":visible")&&($(".alert",a).remove(),$(a).prepend($('<div class="row"></div>').append(tinypass.__buildAlertPopup(e,t))),r=!0)}r||($(".container .main").length>0?tinypass.__buildAlertPopupDashboard(e,t):tinypass.__setMessage(t))}else if($(".container .main").length>0)tinypass.__buildAlertPopupDashboard(e,t);else if($("#payscreen #alert").length>0){$("#payscreen #alert").html(t)}else tinypass.__setMessage(t)},tinypass.setMessage=function(e,t){return e===r||e===o?tinypass.__setErrorMessage(e,t):tinypass.__setMessage(t)},tinypass.hideMessage=function(){$(".alert-top").remove(),$(".tinypass-alert-messase").remove(),$(".notification.error").remove()},tinypass.__buildAlertPopup=function(e,t){return $('<div role="alert" aria-live="assertive" class="alert alert-block alert-'+e+' tinypass-alert-messase"></div>').append('<button type="button" class="close" data-dismiss="alert">&times;</button>').append($('<span class="message"></span>').text(t))},tinypass.__setErrorMessage=function(e,t){if($(".modal-body").is(":visible"))$(".modal-body  .alert").remove(),$(".modal-body").prepend(tinypass.__buildAlertPopup(e,t));else if($("#popup").is(":visible"))$("#popup #popup-content .alert").remove(),$("#popup #popup-content").prepend(tinypass.__buildAlertPopup(e,t));else if($(".modal .modal-body").length>0){for(var n=$(".modal .modal-body"),r=!1,o=0;o<n.length;o++){var a=n[o];$(a).is(":visible")&&($(".alert",a).remove(),$(a).prepend($('<div class="row"></div>').append(tinypass.__buildAlertPopup(e,t))),r=!0)}r||($(".container .main").length>0?($(".container .main .alert").remove(),$(".container .main").prepend($('<div class="row"></div>').append(tinypass.__buildAlertPopup(e,t)))):tinypass.__setMessage(t))}else if($(".container .main").length>0)$(".container .main .alert").remove(),$(".container .main").prepend($('<div class="row"></div>').append(tinypass.__buildAlertPopup(e,t))),setTimeout(function(){$(".container .main .alert").fadeOut(2e3)},1e3);else if($("#payscreen #alert").length>0){$("#payscreen #alert").html(t)}else tinypass.__setMessage(t)},tinypass.__setMessage=function(t,n){var r=$('<div role="alert" aria-live="assertive" class="notification"><i class="icon-check-white status"></i><span class="message">'+t+"</span></div>");$(document.body).append(r),e.innerWidth>648&&r.css("marginLeft",-r.outerWidth()/2),r.addClass("in"),setTimeout(function(){r.removeClass("in")},3e3),setTimeout(function(){r.remove()},5e3)},tinypass.setOpacity=function(e,t){$(e).css("filter","alpha(opacity="+100*t+")").css("-khtml-opacity",t).css("-moz-opacity",t).css("opacity",t)},tinypass.showWaitPanel=function(e){if(e||(e={}),tinypass.hideWaitPanel(),$("body").append($('<div id="waitPanel">'+(e.title?e.title:"Loading...")+"</div>").css("display","block")),e.modal){var t=$('<div id="tinypassModalWindow"/>');t.css("position","fixed").css("left","0").css("top","0").css("width","100%").css("height","100%").css("z-index","1000"),e.opacity?tinypass.setOpacity(t.css("background-color",e.background?e.background:"white"),e.opacity):t.css("background-color","transparent"),$("body").append(t)}},tinypass.hideWaitPanel=function(){$("#waitPanel").remove(),$("#tinypassModalWindow").remove()},tinypass.__buildPopup=function(){return $('<div id="popup" class="modal hide fade" tabindex="-1" role="dialog" aria-hidden="true" style="display: none;"><div id="popup-title" class="modal-header"></div><div id="popup-content" class="modal-body"></div><div id="popup-controls" class="modal-footer"></div></div>')},tinypass.updateMetaRefresh=function(e){e&&(n=e),n&&!isNaN(n)&&(clearTimeout(t),t=setTimeout("window.location.reload()",n))},tinypass.__initNewlyAddedContent=function(e){tinypass.__initToolTips(e)},$(document).ready(function(){var e=$("body");e.append(tinypass.__buildPopup()),e.ajaxStart(function(){tinypass.updateMetaRefresh(),tinypass.showWaitPanel()}),e.ajaxStop(function(){tinypass.hideWaitPanel()}),$("table.row-alternate").each(function(){$(this).find("tr:even").find("td").toggleClass("line-item-alt",!0),$(this).find("tr:odd").find("td").toggleClass("line-item-alt2",!0)}),tinypass.__initNewlyAddedContent(e),function(e){var t=new Array;e.Watermark={ShowAll:function(){for(var e=0;e<t.length;e++)""===t[e].obj.val()?(t[e].obj.val(t[e].text),t[e].obj.toggleClass("watermark",!0)):t[e].obj.toggleClass("watermark",!1)},HideAll:function(){for(var e=0;e<t.length;e++)t[e].obj.val()===t[e].text&&t[e].obj.val("")}},e.fn.Watermark=function(n){return this.each(function(){var r=e(this);function o(){0===r.val().length&&r.toggleClass("watermark",!0).val(n)}t[t.length]={text:n,obj:r},r.focus(function(){r.hasClass("watermark")&&r.toggleClass("watermark",!1).val("")}),r.blur(o),o()})}}(jQuery)}),tinypass.__initToolTips=function(e){$(e).find('*[data-toggle="tooltip"]').each(function(){var e=$(this);e.attr("title")||e.attr("title",e.html()),e.tooltip({html:!0})})},tinypass.hasFlash=function(){try{return ZeroClipboard.detectFlashSupport()}catch(e){}return!1},tinypass.copyToClipboard=function(e,t){var n,r,o;try{if(!tinypass.hasFlash())return null;for(var a in r=$(e),(o={}).moviePath="/js/ZeroClipboard.swf",t)o[a]=t[a];return(n=new ZeroClipboard(r,o)).glue(r),n}catch(e){}},tinypass.initImageCropper=function(e,t,n,r){},tinypass.cropImage=function(e,t,n,r,o,a,i,s,c,l){},tinypass.stripSpaces=function(e){return null==e?e:e.replace(/\s+/g,"")},tinypass.ccLuhnCheck=function(e){if(!e.match(/^\d+$/))return!1;for(var t=e.length,n=1&t,r=0,o=0;o<t;o++){var a=parseInt(e.charAt(o));1&o^n||(a*=2)>9&&(a-=9),r+=a}return r%10==0},tinypass.convertCurrencyAndFormat=function(e,t){try{if(!e||e.match(/.*[^0-9.].*/))return"?.??";if(!t||t.match(/.*[^0-9.].*/))return"?.??";var n=parseFloat(e)/parseFloat(t);return 0===n||isNaN(n)?"?.??":n=(Math.ceil(Math.round(1e4*n)/100)/100).toFixed(2).replace(/[.]00$/,"")}catch(e){return"?.??"}};try{$(document).ready(function(){$(e).on("resize",function(){$("#left-nav").find("#left-nav-panel").height($(e).height()-121)}),$(e).trigger("resize")})}catch(e){}}(window),function(){"use strict";var e="placeholder"in document.createElement("input"),t=angular.module("html5.placeholder",[]),n=function(e,t){var n=e.getAttributeNode(t);return n?n.nodeValue:n};t.factory("placeholder",function(){var t;if(e)t=function(e,t){t&&t({back:function(){}})};else{var r="placeholderTmp"+ +new Date,o={commit:function(e){angular.forEach(e,function(e){var t,o=angular.element(e);t=n(e,"placeholder"),o.val()==t&&(o.data(r,o.val()),o.val(""))})},doRollback:function(e){angular.forEach(e,function(e){var t,n=angular.element(e);(t=n.data(r))&&(n.val(t),n.data(r,null))})}};t=function(e,t){var n;e.length&&"form"==e[0].tagName.toLowerCase()?(n=e.find("input"),n=function(e,t){return angular.forEach(t,function(t){e.push(t)}),e}(e.find("textarea"),n)):n=e,o.commit(n),t&&t({back:function(){o.doRollback(n)}})}}return{ensure:t}}),e||t.directive("placeholder",[function(){var e,t,r,o,a="_placeholder_"+ +new Date,i="focus",s="blur",c=/msie 9/i.test(navigator.userAgent);return r=function(e){"password"==e.data(a).type&&e.attr("type","text")},o=function(e){"password"==e.data(a).type&&e.attr("type","password")},e=function(){var e=angular.element(this);e.val()==n(this,"placeholder")&&(e.val(""),o(e))},t=function(){var e=angular.element(this);""==e.val()&&(e.val(n(this,"placeholder")),r(e))},{link:function(n,l,u){n.$watch("ready",function(){return"password"!=l.attr("type")||c?(l.val(u.placeholder).data(a,{type:(l.attr("type")||"").toLowerCase()}).bind(i,e).bind(s,t),r(l),void n.$on("$destroy",function(){l.unbind(i,e).unbind(s,t),o(l)})):{}})}}}])}(),angular.module("tp.i18n",["ajaxServices","ngCookies","tmh.dynamicLocale","tinypassServices"]).config(["tmhDynamicLocaleProvider",function(e){e.localeLocationPattern("/libs/angular-1.2.22/i18n/angular-locale_{{locale | replaceUnderscoreToDash}}.js")}]).run(["lang",function(e){var t=TPParam.TRANSLATION_CONFIG&&TPParam.TRANSLATION_CONFIG.initialLocaleId||"en_US";e.update(t)}]).directive("autoFocus",["$timeout",function(e){return{restrict:"AC",link:function(t,n){var r=n[0];e(function(){var e=r.value;r.value="",r.focus(),r.value=e},100)}}}]).directive("t",["$compile","lang","getTextFromLocales",function(e,t,n){var r=/^arg(\d+)$/i;return{restrict:"AE",compile:function(o,a){var i=o.html(),s=[];return angular.forEach(a,function(e,t){var n=t.match(r);n&&n[1]&&(s[n[1]]=e)}),function(r,o,a){var c=t.getTemplateContext(),l=a.context?a.context:c;function u(a,c,u){if(a){var d=n(a,c,u);o.empty().append(t.formatString(d(l,i),s)),e(o.contents())(r)}}u(),t.on(u),r.$on("$destroy",function(){t.off(u)})}}}}]).directive("languageSelector",["lang","dropdownTabNavigationService",function(e,t){return{restrict:"E",scope:{},template:'<div ng-if="areLanguagesAvailable()" class="language-selector">   <button type="button" id="language-button" class="button-link language-selector__label" ng-init="buttonInit()" ng-click="toggleMenu()" aria-label="{{\'Current locale - \'}} {{locale | shortLocale}}">{{locale | shortLocale}}</button>   <div role="menu" aria-labelledby="dialog-title" aria-modal="true" id="languages-modal" tabindex="-1">      <h2 id="dialog-title" class="sr-only">{{"Select Language" | t}}</h2>      <ul id="language-list" class="language-selector__list" ng-class="{\'show\': opened === true, \'hide\': opened === false}">         <li class="language-selector__list-item" ng-repeat="(index, value) in languages | filter:showAvailableLanguage" ng-click="changeLanguage(value.locale)">            <button type="button" aria-pressed="{{value.locale === locale}}" class="language-selector__country" ng-class="{\'selected\': value.locale === locale}">{{value.localized}}              <span class="language-selector__country-image language-selector__country-image--{{value.locale | getCountryCode}}" aria-hidden="true"></span>            </button>         </li>      </ul>   </div></div>',link:function(e,n){let r;const o=n[0],a="#language-button",i="#languages-modal";function s(e){jQuery(e.target)[0]!==n.find(a)[0]&&c()}function c(){r.detachDropdownMenuEvents(),e.opened=!1,jQuery(window).off("click"),e.$apply()}e.toggleMenu=function(){e.opened=!e.opened,jQuery(window).off("click"),e.opened?r.attachDropdownMenuEvents():r.detachDropdownMenuEvents();jQuery(window).on("click",s)},e.buttonInit=function(){r=t(o,{toggleDropdownMenuButtonSelector:a,dropdownMenuContainerSelector:i,closeMenu:c,closeMenuOnClick:s,isMenuOpened:function(){return e.opened}})},e.opened=!1,e.$on("LANGUAGE_CHANGE",function(){o.querySelector(a).focus()})},controller:["$scope",function(t){function n(e){t.locale=e}function r(e){t.languages=e.sort(function(e,t){return e.localized.toLowerCase()===t.localized.toLowerCase()?0:e.localized.toLowerCase()>t.localized.toLowerCase()?1:-1})}t.languages=[],t.locale=null,t.showAvailableLanguage=function(e){return!!e.isEnabled&&e},t.changeLanguage=function(n){t.locale=n,e.update(t.locale),t.$broadcast("LANGUAGE_CHANGE")},t.isLanguagesEnabled=TPParam.TRANSLATION_CONFIG.isEnabled,e.on(n),t.$on("$destroy",function(){e.off(n)}),e.list().then(r),t.areLanguagesAvailable=function(){return t.isLanguagesEnabled&&t.languages.length>1}}]}}]).filter("shortLocale",function(){function e(e){var t=e.toUpperCase().split("_");return t[0]+"-"+t[1]}return e.$stateful=!0,e}).filter("t",["lang",function(e){function t(t,n){var r=e.getTemplateContext();return e.trc(r,t,n)}return t.$stateful=!0,t}]).filter("tc",["lang",function(e){function t(t,n,r){return e.trc(n,t,r)}return t.$stateful=!0,t}]).filter("replaceUnderscoreToDash",function(){function e(e){return e.toString().toLowerCase().replace("_","-")}return e.$stateful=!0,e}).filter("replaceDashToUnderscore",function(){function e(e){var t;return null===e.match(/\-/g)?e:((t=e.toUpperCase().split("-"))[0]=t[0].toLowerCase(),t.join("_"))}return e.$stateful=!0,e}).filter("getCountryCode",function(){function e(e){return e.match(/\w{2}$/)[0].toLowerCase()}return e.$stateful=!0,e}).factory("getTextFromLocales",[function(){return function(e,t,n){return function(r,o){var a,i=(r=r?r+"":"")+o,s=n&&n[t],c=n&&n[e],l=c&&(c[i]||c[o]);return void 0===l&&(a=s&&(s[i]||s[o])),l||a||o}}}]).factory("lang",["tpHTTP","$q","$locale","$cookies","tmhDynamicLocale","resolveLocale","cookieLang","$rootScope","$filter","getTextFromLocales",function(e,t,n,r,o,a,i,s,c,l){var u,d=a(),f=!1,p=["en_US","en_GB","pt_PT","es_CO","pt_BR","fr_CA","ja_JP","zz_ZZ"],m=[],g=null,h=null,v=TPParam.TRANSLATION_CONFIG&&TPParam.TRANSLATION_CONFIG.systemDefaultLocale||"en_US",y={translationMapStatic:{},translationMapDynamic:{}},w={},T={};return s.$on("CHECK_UPDATED_LANGUAGE",C),A(),L(),{update:M,on:function(e,t){m.push(e),t||e(d,v,w)},off:function(e){var t=m.indexOf(e);-1!==t&&m.splice(t,1)},tr:function(e){for(var t=new Array(arguments.length-1),n=0;n<t.length;++n)t[n]=arguments[n+1];return S(l(d,v,w)(null,e),t)},trc:function(e,t,n){var r;if(angular.isArray(n))r=n;else{r=new Array(arguments.length-2);for(var o=0;o<r.length;++o)r[o]=arguments[o+2]}return S(l(d,v,w)(e,t),r)},list:function(){if(!TPParam.TRANSLATION_CONFIG.isEnabled)return t.when([]);h||(h=t.when(TPParam.TRANSLATION_CONFIG.languages).then(function(e){return g=e,M(d),e}));return h},formatString:S,getLang:b,getLangLocale:function(){return _().split("-")[0]},getTemplateContext:function(){return window.TPParam.TRANSLATION_CONFIG&&window.TPParam.TRANSLATION_CONFIG.templateContext||""},getCorrectStartWeekDay:function(){var e=b()||d;return-1===p.indexOf(e)},getLanguageTag:_,getDefaultSystemLocale:function(){return TPParam.TRANSLATION_CONFIG&&TPParam.TRANSLATION_CONFIG.systemDefaultLocale||"en_US"}};function b(){return f&&d||""}function _(){return(b()||d).replace("_","-")}function A(){$(),u=setInterval(C,500)}function $(){u&&clearInterval(u)}function C(){var e=i.getCookie("LANG_CHANGED");e&&e!==d&&'""'!==e&&M(e)}function S(e,t){return angular.isUndefined(e)||null===e?e:e.replace(/<t([^>]+)?>|<\/t>/g,"").replace(/{(\d+)}/g,function(e,n){return void 0!==t[n]?t[n]:e})}function E(e){w[d]=e,m.forEach(function(e){e(d,v,w)})}function O(e,n){var r,o,a,i=t.defer();return e&&((r=document.querySelector('script[src*="'+e+'"]'))||(o=document.getElementsByTagName("head"))&&o.length&&(a=o[0])&&((r=document.createElement("script")).onload=function(){return window["translation"+n]?i.resolve(window["translation"+n]):i.reject("Unable to load")},r.setAttribute("src",e),r.setAttribute("type","text/javascript"),r.setAttribute("charset","utf-8"),a.appendChild(r))),i.promise}function N(e){var n="/ng/common/i18n/platform-translation-map_"+e+".js?version="+TPParam.TRANSLATION_CONFIG.version,r=TPParam.TRANSLATION_CONFIG.loadTranslationUrl+"&language="+e,o=window["translation_static_"+e];return TPParam.TRANSLATION_CONFIG.isStatic?o?t.when(o):O(n,"_static_"+e).then(function(){return t.when(window["translation_static_"+e])}):t.all([O(n,"_static_"+e).then(function(e){return e}),O(r,"_dynamic_"+e).then(function(e){return e})]).then(function(e){return y.translationMapStatic=e[0],y.translationMapDynamic=e[1],t.when(angular.extend({},e[0],e[1]))}).catch(function(t){w=function(e,t){var n=[],r={};"string"==typeof t&&(n=[t]);angular.isArray(t)&&(n=[].concat(t));angular.isArray(e)&&e.forEach(function(e,t){r[t]=e});angular.isObject(e)&&!angular.isArray(e)&&(r=angular.extend({},e));return n.forEach(function(e){delete r[e]}),r}(w,e)})}function M(e){if($(),!TPParam.TRANSLATION_CONFIG||!TPParam.TRANSLATION_CONFIG.isEnabled)return i.removeCookie("LANG"),void i.removeCookie("LANG_CHANGED");angular.isUndefined(e)&&(e=i.getCookie("LANG")||v);var r=g&&g.some(function(t){return t.locale===e});g&&!r||(!function(e){d=e,f=!0,i.setCookie("LANG",d,1500),i.setCookie("LANG_CHANGED",d,1);var t=c("replaceUnderscoreToDash")(e);T[t]||n.id!==t||(T[t]=angular.copy(n));T[t]&&function e(t,n){angular.forEach(t,function(e,r){n[r]?angular.isArray(n[r])&&(t[r].length=n[r].length):delete t[r]});angular.forEach(n,function(r,o){angular.isArray(n[o])||angular.isObject(n[o])?(t[o]||(t[o]=angular.isArray(n[o])?[]:{}),e(t[o],n[o])):t[o]=n[o]})}(n,T[t]);e!==TPParam.TRANSLATION_CONFIG.initialLocaleId&&(T[t]||o.set(t).then(function(e){T[e.id]=angular.copy(e)}),function(e){window.TPParam.TRANSLATION_CONFIG&&window.TPParam.TRANSLATION_CONFIG.initialLocaleId&&(window.TPParam.TRANSLATION_CONFIG.initialLocaleId=e)}(d))}(e),L(),function(e){if(void 0===w[v])return t.all([P(e),P(v)]).then(function(e){return angular.extend({},e[1],e[0])});return P(e)}(e).then(E).then(function(){s.$broadcast("EVENT_I18N_LOCALE_CHANGED")})),A()}function P(e){var n=window["translation_static_"+e],r=window["translation_dynamic_"+e];return w[e]?t.when(w[e]):n||r?(w[e]=angular.extend({},n,r),t.when(w[e])):N(e).then(function(t){return w[e]=t,t})}function L(){if("undefined"!=typeof moment)try{var e=_();switch(e){case"zz-ZZ":e="x-pseudo";break;case"sr-RS":e="sr-cyrl"}moment.locale?moment.locale(e):moment.lang(e)}catch(e){}}}]).factory("resolveLocale",["$cookies","$locale","tmhDynamicLocale","$filter","cookieLang",function(e,t,n,r,o){return function(){o.getCookie("LANG");return"en_US"}}]).factory("cookieLang",["TinypassService",function(e){return{getCookie:t,setCookie:function(t,n,r){var o,a=new Date;a.setTime(a.getTime()+24*r*60*60*1e3),o="expires="+a.toUTCString(),document.cookie=t+"="+n+"; "+o+"; domain="+e.getTopDomain()+"; path=/;"+e.getCookieSameSiteAndSecureAttrString()},removeCookie:function(t){var n="expires="+new Date("February 02, 1972 02:02:02").toUTCString();document.cookie=t+"=; "+n+"; domain="+e.getTopDomain()+"; path=/;"+e.getCookieSameSiteAndSecureAttrString()},getCountryCode:function(){if(null===t("LANG")||void 0===t("LANG")||""===t("LANG"))return"us";return t("LANG").split("_")[1].toLowerCase()},getLanguageCode:function(){if(null===t("LANG")||void 0===t("LANG")||""===t("LANG"))return"en";return t("LANG").split("_")[0]}};function t(e){var t=("; "+document.cookie).split("; "+e+"=");if(t.length>1)return t.pop().split(";").shift()}}]).factory("updateDirAttrOnLangChanges",["$document","lang","ngEventService",function(e,t,n){var r=["he_IL","ar_EG"],o="rtl",a="ltr";return n.subscribe("langChanged",function(e,n){n.lang&&t.update(n.lang)}),function(n){var i,s;t.on(function(t){if(t!==i){var c,l=-1!==r.indexOf(t)?o:a;l!==s&&(s=l,c=l,e[0].documentElement.setAttribute("dir",c)),function(t){if(t){var n=t.replace(/_/g,"-");e[0].documentElement.setAttribute("lang",n)}}(t),i=t,n&&n(t)}})}}]),function(){var dateServices=angular.module("dateServices",[]),withoutSpinnerHeaderName="Piano-request-without-spinner",withoutSpinnerHeaderNameLowerCase=withoutSpinnerHeaderName.toLowerCase();function isIncludesWithoutSpinnerHeader(e){return!!(e&&e.config&&e.config.headers||{})[withoutSpinnerHeaderName]}dateServices.factory("fromIsoToJsDate",function(){return function(e,t){if(t.length){for(var n=t.length-1;n>=0;n--)t[n][e]&&(t[n][e]=moment(t[n][e]).format());return t}return t[e]&&(t[e]=moment(t[e]).format()),t[e]}}),dateServices.factory("timeStampToDate",function(){return function(e){return e?e&&e<1e10?new Date(1e3*e):new Date(e):e}}),dateServices.factory("TimezoneService",function(){return{SEND_DATETIME_FORMAT:"YYYY-MM-DDTHH:mm:ssZZ",dateToTimezonedMoment:function(e){return moment.tz(e,TPParam.CLIENT_TIMEZONE)},dateToClientTimezoneMoment:function(e){return moment.tz({year:e.getFullYear(),month:e.getMonth(),date:e.getDate(),hour:e.getHours(),minute:e.getMinutes(),second:e.getSeconds(),millisecond:e.getMilliseconds()},TPParam.CLIENT_TIMEZONE)},datesToTimezonedStringsRange:function(e,t){return{from:this.dateToClientTimezoneMoment(e).startOf("day").format(this.SEND_DATETIME_FORMAT),to:this.dateToClientTimezoneMoment(t).endOf("day").format(this.SEND_DATETIME_FORMAT)}},momentToDate:function(e){return new Date(e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second())},dateInClientTimezoneToBrowserTimezone:function(e){var t=moment.tz(e,TPParam.CLIENT_TIMEZONE);return new Date(t.year(),t.month(),t.date(),t.hour(),t.minute(),t.second())}}}),dateServices.factory("ISODatetimeService",function(){return{ISO8601_DATE_FORMAT:"YYYY-MM-DD",ISO8601_DATETIME_FORMAT:"YYYY-MM-DD HH:MM",dateToString:function(e){return moment.tz?moment.tz(e,TPParam.CLIENT_TIMEZONE).format(this.ISO8601_DATE_FORMAT):moment(e).format(this.ISO8601_DATE_FORMAT)},datetimeToString:function(e){return moment.tz?moment.tz(e,TPParam.CLIENT_TIMEZONE).format(this.ISO8601_DATETIME_FORMAT):moment(e).format(this.ISO8601_DATETIME_FORMAT)}}});var ajaxServices=angular.module("ajaxServices",[]);ajaxServices.config(["$httpProvider",function(e){e.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",e.defaults.headers.common["Ng-Request"]="1",e.interceptors.push("tpHttpInterceptor");e.defaults.transformRequest.push(function(e,t){var n=t&&t();return n&&(n[withoutSpinnerHeaderNameLowerCase]||n[withoutSpinnerHeaderName])||tinypass.withoutWaitPanel?e:(tinypass.showWaitPanel(),e)})}]),ajaxServices.factory("tpHttpInterceptor",["$q",function(e){return{response:function(e){return e.data&&(e.data.models&&(e.models=e.data.models),e.data.errors&&(e.errors=e.data.errors)),tinypass.updateMetaRefresh(),isIncludesWithoutSpinnerHeader(e)||tinypass.hideWaitPanel(),e},responseError:function(t){return t.data&&(t.data.models&&(t.models=t.data.models),t.data.errors&&(t.errors=t.data.errors)),isIncludesWithoutSpinnerHeader(t)||tinypass.hideWaitPanel(),e.reject(t)}}}]),ajaxServices.factory("repeatHTTP",["$q",function(e){var t=function(n,r){var o=(r=r||{}).defer,a=r.attempt||0,i=r.times||1,s=r.cancelConfig||{};return o?(n().then(function(e){o.resolve(e)}).catch(function(e){s.cancel||(a>=i?o.reject(e):t(n,Object.assign({},r,{attempt:a+1})))}),o.promise):(Log.info("defer is required"),e.reject())};return t}]),ajaxServices.factory("tpHTTP",["$http","$window","$q","$rootScope",function($http,$window,$q,$rootScope){var f=function(e,t){!t&&(e.url=f.getUrl()+e.url);var n=$http(e);return n.then(f.processHeaders),n};return f.get=function(e,t){e=f.getUrl()+e;var n=$http.get(e,t);return n.then(f.processHeaders),n},f.post=function(e,t,n){e=f.getUrl()+e;var r=$http.post(e,t,n);return r.then(f.processHeaders),r},f.jsonp=function(e,t){return(t=t||{}).callback=t.callback||"JSON_CALLBACK",$http.jsonp(e,{params:t}).then(function(e){return e.data})},f.processResponse=function(e){return e.data&&e.data.models&&(e.models=e.data.models),e.data&&e.data.errors&&(e.errors=e.data.errors),e},f.processResponseCatch=function(e){return e.data&&e.data.models&&(e.models=e.data.models),e.data&&e.data.errors&&(e.errors=e.data.errors),$q.reject(e)},f.processHeaders=function(response){var headers=response.headers();if(headers.execute_js_after)try{eval(headers.execute_js_after)}catch(e){}return response},f.extractErrors=function(e,t,n){e&&(e.errors||e.modalErrors)&&(n.formErrors=e.errors&&e.errors.length?e.errors:e.modalErrors,angular.forEach(n.formErrors,function(e){var n=e.field,r=(e.key,e.msg);t&&t[n]&&(angular.element("#"+n).focus(),t[n].$setValidity("error",!1),t[n].$error.msg=r)}))},f.resetFormErrors=function(e,t,n){try{n&&(n.errors=[],n.modalErrors=[]),angular.forEach(t.formErrors,function(t){e[t.field].$setValidity("error",!0),e[t.field].$setPristine()}),delete t.formErrors,e.$setPristine(),t.$$phase||t.$apply()}catch(e){Log.info("Could not reset form errors!",e)}},f.setFieldsValid=function(e,t){try{angular.forEach(e,function(e,t){0!=t.indexOf("$")&&(e.$setValidity("error",!0),e.$setPristine())}),e.$setPristine(),t.$$phase||t.$apply()}catch(e){Log.info("Could not reset form errors!",e)}},f.extractModels=function(e,t){if(e&&e.models)for(var n in e.models)t[n]=e.models[n];if(e&&e.routes)for(var r in void 0===t.routes&&(t.routes={}),e.routes)t.routes[r]=e.routes[r]},f.promiseResponse=function(e,t){var n=$q.defer();return t.errors=[],e.then(function(e){if(e&&e.errors&&angular.copy(e.errors,t.errors),e&&e.models)for(var r in e.models)e.models.hasOwnProperty(r)&&(t[r]=e.models[r]);n.resolve()}).catch(function(e){e&&e.errors&&angular.copy(e.errors,t.errors),n.reject()}),n.promise},f.extractModelsTo=function(e){return function(t){f.extractModels(t.data,e)}},f.successHander=function(e){return function(t){e.resolve({data:t,ok:!0})}},f.errorHander=function(e){return function(t){e.resolve({data:t,ok:!1})}},f.promiser=function(e){var t=$q.defer();return e.then(f.successHander(t)).catch(f.errorHander(t)),t.promise},f.buildUrl=function(e,t){if(!t)return e;var n=[];return function(e,t,n){for(var r=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t.sort()}(e),o=0;o<r.length;o++)t.call(n,e[r[o]],r[o])}(t,function(e,t){null!=e&&null!=e&&(angular.isObject(e)&&(e=angular.toJson(e)),n.push(encodeURIComponent(t)+"="+encodeURIComponent(e)))}),e+(-1==e.indexOf("?")?"?":"&")+n.join("&")},f.getUrl=function(){return document.location.origin},f}]);var tinypassService=angular.module("tinypassServices",[]);function _setCookie(e,t,n,r,o,a,i){var s=new Date;s.setTime(s.getTime());var c=new Date(s.getTime()+n);document.cookie=e+"="+t+(n?";expires="+c.toGMTString():"")+(r?";path="+r:"")+(o?";domain="+o:"")+(a?";secure":"")+(i?";samesite="+i:"none")}function _getCookie(e){var t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0}tinypassService.factory("TinypassService",["$q",function(e){var t;function n(){return t||(t=function(){try{return window.self!==window.top}catch(e){return!0}}()?" samesite=none; ":" samesite=lax; ","https:"===window.location.protocol&&(t+=" secure;"),t)}function r(){var e,t,r="weird_get_top_level_domain=cookie",o=document.location.hostname.split(".");if(1===o.length)return o[0];if(4===o.length&&!isNaN(o[0])&&!isNaN(o[3]))return document.location.hostname;for(e=o.length-1;e>=0;e--){t="."+o.slice(e).join(".");var a=n();if(document.cookie=r+";domain="+t+";"+a,document.cookie.indexOf(r)>-1)return document.cookie=r.split("=")[0]+"=;domain="+t+";expires=Thu, 01 Jan 1970 00:00:01 GMT;"+a,t}}return{setMessage:function(e,t){tinypass.setMessageDashboard(e,t)},hideMessage:function(){tinypass.hideMessage()},cropImage:function(e,t,n,r,o,a,i,s,c){tinypass.cropImage(e,t,n,r,o,a,i,s,c)},getISODate:function(e,t){var n,r;return n=e?new Date(e.getFullYear(),e.getMonth(),e.getDate()):new Date,r=t?new Date(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59):new Date,{from:moment(n).format("YYYY-MM-DDTHH:mm:ssZZ"),to:moment(r).format("YYYY-MM-DDTHH:mm:ssZZ")}},reduceZeros:function(e){var t=(e=Math.round(e))/1e3+"";return 0!=e&&(t=(t=(t=(t+(t.indexOf(".")<0?".":"")+"000").replace(/(\..{3}).*$/,"$1")).substring(0,t.length-Math.min(3,(e+"").length-2)).replace(/[.]$/,"")).split("").reverse().join("").replace(/((\d{3})(?!($|-|.*[.])))/g,"$1,").split("").reverse().join("")),t},generateRandomString:function(e){e=e||10;for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*n.length));return t},generateSuccessMessage:function(e){return function(){tinypass.setMessage("success",e)}},generateErrorMessage:function(t){return function(){return tinypass.setMessage("error",t),e.reject()}},showRequestError:function(t){return tinypass.setMessage("error",t.data.errors[0].msg),e.reject(t)},showRequestErrorDashboard:function(t){return tinypass.setMessageDashboard("error",t.data.errors[0].msg),e.reject(t)},getInMinorUnits:function(e){return e?Math.round(100*e):0},getCurrencyByCode:function(e){if(""==e)return"$";var t;switch(e){case"USD":t="$";break;case"EUR":t="€";break;case"AUD":t="$";break;case"GBP":t="£";break;case"JPY":t="¥";break;default:t=e}return t},setCookie:function(e,t,o){var a=new Date;a.setTime(a.getTime()+24*o*60*60*1e3);var i="expires="+a.toUTCString();document.cookie=e+"="+t+"; "+i+"; domain= "+r()+"; path=/;"+n()},getCookie:function(e){var t=("; "+document.cookie).split("; "+e+"=");if(t.length>1)return t.pop().split(";").shift()},getTopDomain:r,getCookieSameSiteAndSecureAttrString:n}}]),tinypassService.factory("LangUtils",[function(){return{getPersonalName:function(e,t,n){var r=e.getLang();return!["zz_ZZ","ja_JP"].some(function(e){return e===r})?[t,n].filter(function(e){return!!e}).join(" "):[n,t].filter(function(e){return!!e}).join(" ")}}}]),tinypassService.factory("modalConfirm",["$rootScope","$modal",function(e,t){return function(n,r,o,a){var i=e.$new();i.title=n,i.msg=r;var s={scope:i,templateUrl:"/libs/tinypass/_confirm_popup.shtml"},c=t.open(s);function l(e){c.close(e)}return i.onOk=function(){a&&"function"==typeof a?a().then(l):l(o)},c.result}}]),tinypassService.factory("UpdatePerfectScrollbar",["UpdateSpecificScrollbar",function(e){return function(t){if(t&&t.target&&t.target.nodeName){var n,r,o=$(t.target);if("input"==t.target.nodeName.toLowerCase()){var a=o.parents(".tp-dropdown__container"),i=o.parents(".dropdown-menu");return void(i.length>0?i:a).find(".ps-container").each(function(){var e=$(this);e.is(":visible")&&e.scrollTop(0)})}n=o.parent().outerHeight(!0),r=o.parents(".ps-container"),e(r,n)}}}]),tinypassService.factory("UpdateSpecificScrollbar",function(){return function(e,t){var n=e.children().height(),r=e.height(),o=e.scrollTop();o+r+t>=n&&n>=r&&e.scrollTop(o-t)}}),tinypassService.factory("iframeService",["$rootElement",function(e){return{injectHiddenIframe:t,injectHiddenIframeWithTimeout:function(e,n,r,o){var a=t(e,n),i=window.setTimeout(function(){angular.element("#"+e).remove(),o&&o()},r||15e3);return{iframe:a,cancel:function(){window.clearTimeout(i)}}},injectIframe:function(e,t,r){var o=t?' src="'+t+'" ':"";return n(angular.element("<iframe "+o+"></iframe>"),e,r,{backgroundColor:"transparent",border:"0",width:"100%",height:"100%",position:"relative",zIndex:4})},injectRealIframe:function(e,t,r,o){var a={backgroundColor:"#ffffff",border:"0",width:"100%",height:"100%",position:"relative",zIndex:1};return Object.assign(a,o),n(angular.element(t),e,r,a)},injectHungTimeoutIframe:function(e,n){return window.setTimeout(function(){var r=t(e),o=r.contentWindow?r.contentWindow.document:r.contentDocument;o.open("text/html","replace"),o.write('<html>    <head>        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">        <script type="text/javascript">            function submitform() {                document.forms["page_return"].submit();            }        <\/script>    </head>    <body onload="submitform()">        <form name="page_return" method="post" action="'+n+'">            <input type="hidden" name="resultCode" value="999">            <input type="hidden" name="message" value="Request timeout">        </form>    </body></html>'),o.close()},15e3)},appendContentToIframe:function(e,t){var n=e.contentWindow?e.contentWindow.document:e.contentDocument;n.open("text/html","replace"),n.write(t),n.close()},getAncestorOrigins:function(){var e=document.location.ancestorOrigins;if(!e){var t=document.referrer,n=t.split("/");e={0:n[0]+"//"+n[2],length:1}}return e}};function t(t,n){var r=n?' src="'+n+'" ':"";angular.element("#"+t).remove();var o=angular.element('<iframe id="'+t+'"'+r+' style="display: none"></iframe>')[0];return e.append(o),o}function n(e,t,n,r){angular.element("#"+t).remove(),e.attr({allowtransparency:"true",id:t}).css(r);var o=e[0];return n.append(o),o}}]);var selectFactory=angular.module("selectFactory",["ajaxServices"]);selectFactory.factory("selectServiceFactory",["tpHTTP","$timeout",function(e,t){return function(n){var r={},o=!!n.invalidateUpdate,a={search:function(n){var i=r[n];i&&!a.instantUpdate||(i=function(n){r[n]=function(t){var n=a.buildParams(t);return e.post(a.endpoint,n).then(a.extractItems).catch(function(e){})}(n),a.instantUpdate=!1,o&&t(function(){delete r[n]},1e3);return r[n]}(n));return i}};return angular.extend(a,n),a}}]),selectFactory.factory("selectDirectiveFactory",["$timeout","UpdatePerfectScrollbar","$perfectScrollBarService",function(e,t,n){return function(r){return{restrict:"AE",replace:!0,transclude:!0,scope:{ngModel:"=",item:"=",clickFn:"=?",searchFn:"=?",clickOnClose:"=?"},require:"ngModel",templateUrl:r.templateUrl,link:function(o,a,i,s){var c,l={};if(o.disabled="true"==i.ngDisabled,o.disabled)return;o.closeOnSelect=void 0!==i.closeOnSelect,o.multiple=void 0!==i.multiple,o.excludeSelected=void 0!==i.excludeSelected,o.showCheckbox=o.multiple&&!o.excludeSelected,o.model={filter:"",list:[],selected:{}},o.onSearch=u,o.searchItems=p,o.updateScrollBar=f,o.cancelClick=function(e){e.stopPropagation(),e.preventDefault()},o.closeDropdown=function(){$(".dropdown.open",a).removeClass("open")},o.setItem=function(e,t){if(void 0===e.disabled||!e.disabled){if(o.multiple){var n=angular.copy(o.ngModel||[]),r=d(e,n);null===r?n.push(e):n.splice(r,1),o.ngModel=n,s.$setViewValue(o.ngModel)}else o.ngModel=e,s.$setViewValue(o.ngModel);o.closeOnSelect&&(o.closeDropdown(),o.clickOnClose&&o.clickOnClose(o.ngModel)),f(t)}},o.modelContains=function(e){return null!==d(e,o.ngModel||[])},o.setFocusAfterClick=function(){$("input:first",a).focus()},o.onOpen=function(e){o.clickFn&&o.clickFn(p),function(e){e&&!l[e]&&(l[e]=!0,n.notify("update-perfect-scrollbar"))}(e)},o.selectAll=function(){if(o.multiple){var e=o.ngModel||[],t=[];e.length||(t=angular.copy(o.model.list)),o.ngModel=t,s.$setViewValue(o.ngModel)}},u(),o.multiple&&o.$watch("ngModel",function(){!function(){var e={};if(!o.multiple)return;if(!o.ngModel||!Array.isArray(o.ngModel)||o.ngModel.length<=0)return void(o.model.selected=null);o.ngModel.forEach(function(t){e[t[r.idProperty]]=!0}),o.model.selected=e}()},!0);function u(t){c&&e.cancel(c);var n=o.model.filter?300:0;c=e(function(){p(t)},n)}function d(e,t){for(var n=t.length,o=0;o<n;o++)if(t[o][r.idProperty]===e[r.idProperty])return o;return null}function f(e){t(e)}function p(e){var t=o.searchFn||r.searchService.search;t&&t(o.model.filter).then(function(t){t.forEach(function(e){e.id=e[r.idProperty]}),o.model.list=t,e&&o.updateScrollBar(e)})}}}}}]);var loggingModule=angular.module("loggingModule",["ajaxServices"]);loggingModule.factory("loggingService",["tpHTTP",function(e){var t={logToServer:function(t){try{var n=new Error;e.post(TPParam.LOG_ERROR,{description:t,url:window.location.href,trace:n.stack})}catch(e){}}};return t}]),angular.module("paymentFormModule",[]).factory("loaderService",function(){return{showLoader:function(){var e=document.getElementById("pp-loader");e&&(e.style.display="block")},hideLoader:function(){var e=document.getElementById("pp-loader");e&&(e.style.display="none")}}})}(),window.html5ModeConfig=html5ModeConfig,String.prototype.format=function(){for(var e=this,t=0;t<arguments.length;t++){var n="{"+t+"}";e=e.replace(n,arguments[t])}return e};var pnErrorWatcher=function(){return new function(){var e=[];const t={OFFER:"offer",TEMPLATE:"template",MYACCOUNT:"myaccount"};function n(n){var r={userAgent:navigator.userAgent};if(n instanceof Error&&(r.stack=n.stack,r.message=n.message),n instanceof Event){var o=n,a="error"in o&&o.error;r.stack=a?o.error.stack:"n/a",r.message=a?o.error.message:"n/a"}r.parentUrl=encodeURIComponent(getParameterByName("url")),r.iframeSrc=encodeURIComponent(document.location.href),r.experienceId=getParameterByName("experienceId");var i,s=getParameterByName("widget");r.tags={widget_type:s||"unknown",src:"wgt_err",device:getDeviceType()},function(e,n){e===t.OFFER?function(e){e.activeState=getActiveState(),e.tags.selected_term_id=getSelectedTermId(),e.tags.offer_id=getParameterByName("offerId")}(n):e===t.MYACCOUNT?function(e){e.activeTab=TPParam.ACTIVE_TAB,e.tags.ma_active_tab=TPParam.ACTIVE_TAB}(n):e===t.TEMPLATE&&function(e){e.tags.template_id=getParameterByName("templateId"),e.tags.template_variant_id=getParameterByName("templateVariantId")}(n)}(s,r),i=r,-1===e.map(JSON.stringify).indexOf(JSON.stringify(i))&&e.push(r)}function r(e){try{n(e)}catch(e){console.warn("Can not log an error, something went wrong: ",e)}}this.manualLog=function(e){try{n(e)}catch(t){console.warn("Can not log an error, something went wrong: ",t,e)}},this.watchUnhandled=function(){window.addEventListener&&window.addEventListener("error",r)},this.reset=function(){window.removeEventListener("error",r)},this.getErrors=function(){return e.map(function(e){return Object.assign({},e)})}}}(),errorHandler=function(e){function t(){this.sender=null,this.event=null,this.params=null}var n=1e4;try{return new function(){var r={whitelistUrls:[]};function o(){try{var n=e.getErrors().filter(function(e){return r.whitelistUrls.some(function(t){return e.stack&&e.stack.match(t)})});if(0===n.length)return;!function(e){try{var n=window.opener||window.parent,r=Object.assign(new t,{sender:getParameterByName("iframeId"),event:"EVENT_TP_ERROR_HANDLER",params:e});n&&n.postMessage(JSON.stringify(r),"*")}catch(e){console.warn("Can not post message errors to parent: ",e)}}(n)}catch(e){console.warn("Errors can not be sent: ",e)}}function a(){e.watchUnhandled(),setTimeout(function(){o(),e.reset()},n)}this.setConfig=function(e){r=Object.assign(r,e)},this.start=function(){try{a()}catch(e){console.warn("Error logger can not be started: ",e)}}}}catch(e){console.warn("Can't initiate errorHandler: ",e)}}(pnErrorWatcher);!function(e){try{var t=[/\w*\.tinypass\.com/,/localhost/],n=localStorage.getItem("__tp-tinypassErrorHandlerTestMode"),r=location&&location.hostname;n&&r&&t.push(new RegExp(r)),e.setConfig({whitelistUrls:t}),e.start()}catch(e){console.warn("Can't configure errorHandler: ",e)}}(errorHandler);
function tpDatepickerService(){return{buildCalendarSkeleton:function(a,i,r,o){var s=[],l=null,c=null,d=new Date;d.setHours(0,0,0),r.innerFromDateStart&&r.innerFromDateStart.setHours(0,0,0,0);r.innerFromDateEnd&&r.innerFromDateEnd.setHours(0,0,0,0);o.innerToDateStart&&o.innerToDateStart.setHours(0,0,0,0);o.innerToDateEnd&&o.innerToDateEnd.setHours(0,0,0,0);for(var u=!1,p=a.numColumn*a.numRow;p>0;p--){var h=null,f=null,m=!1,g=!1;switch(a.unit){default:case"d":h=new Date(i.viewDateStart.getFullYear(),i.viewDateStart.getMonth(),p*a.unitRange-(a.unitRange-1),0,0,0,0),f=new Date(i.viewDateEnd.getFullYear(),i.viewDateEnd.getMonth(),p*a.unitRange,0,0,0);break;case"m":h=new Date(i.viewDateStart.getFullYear(),p*a.unitRange-(a.unitRange-1)-1,1),f=new Date(i.viewDateStart.getFullYear(),p*a.unitRange,0)}r.innerFromDateStart>=h&&r.innerFromDateEnd<=f&&(g=!0),h>=r.innerFromDateEnd&&f<=o.innerToDateStart&&(g=!0),o.innerToDateStart>=h&&o.innerToDateEnd<=f&&(g=!0),h>=r.innerFromDateStart&&f<=o.innerToDateEnd&&(g=!0),h>i.viewDateEnd&&(m=!0),u=t(h,d),s.unshift({currentDateStart:h,currentDateOver:f,selectRange:g,disabled:e(h,a),out:m,today:u,selectToday:u&&a.currentDayHighlight,firstSelectDay:!1,lastSelectDay:!1})}if("d"===a.unit&&1===a.unitRange&&7===a.numColumn)for(var v=s[0].currentDateStart.getDay(),p=v>=a.startDay?v-a.startDay:7-(a.startDay-v);p--;){var y=new Date(s[0].currentDateStart.getTime());y.setDate(s[0].currentDateStart.getDate()-1),h=new Date(y.getTime()),f=new Date(h.getTime());var g=!1;r.innerFromDateStart&&o.innerToDateEnd&&(l=new Date(r.innerFromDateStart.getTime()).setHours(0,0,0,0),c=new Date(o.innerToDateEnd.getTime()).setHours(0,0,0,0),h>=l&&f<=c&&(g=!0)),s.unshift({currentDateStart:h,currentDateOver:f,selectRange:g,disabled:e(h,a),out:!0,today:!1,firstSelectDay:!1,lastSelectDay:!1}),s.pop()}var D=null;for(p=s.length;p--;)s[p].index=p,D&&s[p].selectRange&&!D.selectRange&&(s[p].lastSelectDay=!0),!D&&s[p].selectRange&&s[p].currentDateOver>=o.innerToDateEnd&&(s[p].lastSelectDay=!0),D&&!s[p].selectRange&&D.selectRange&&(s[p+1].firstSelectDay=!0),!s[p-1]&&s[p].selectRange&&s[p].currentDateStart<=r.innerFromDateStart&&(s[p].firstSelectDay=!0),D=s[p];for(var k=[],w=0;w<a.numRow;w++){k[w]=[];for(var b=0;b<a.numColumn;b++){if(k[w][b]=s[b+w*a.numColumn],a.markerColumn)for(var O=a.markerColumn.length;O--;)a.markerColumn[O].numb-1===b&&(k[w][b].markerColumn=a.markerColumn[O].name||"marker-column");if(a.markerRow)for(var O=a.markerRow.length;O--;)a.markerRow[O].numb-1===w&&(k[w][b].markerRow=a.markerRow[O].name||"marker-row");k[w][b].markerDay=n(k[w][b],a.markerDays),k[w][b].id=k[w][b].currentDateStart.getTime()}}return s=null,k},isSameDay:t};function t(t,e){return t.getDate()<=e.getDate()&&t.getMonth()<=e.getMonth()&&t.getFullYear()<=e.getFullYear()&&t.getDate()>=e.getDate()&&t.getMonth()>=e.getMonth()&&t.getFullYear()>=e.getFullYear()}function e(t,e){var n=e.limitDateNotBefore,a=e.limitDateNotAfter;return n&&a?n>t||t>a:n?n>t:!!a&&a<t}function n(t,e){var n=!1;if(e){var a=new Date(t.currentDateStart.getFullYear(),0,0),i=Math.floor((t.currentDateStart-a)/864e5);a=new Date(t.currentDateOver.getFullYear(),0,0);for(var r=Math.floor((t.currentDateOver-a)/864e5),o=e.length;o--;)if(e[o]>=i&&e[o]<=r){n=!0;break}}return n}}angular.module("tp.ui.datepicker",["tp.ui.timepicker","tp.i18n","datetime","ngInputDate"]).directive("tpDatepicker",tpDatepicker).directive("tpDatepickerInline",tpDatepickerInline).factory("tpDatepickerService",tpDatepickerService).run(tpTemplates);var datepickerScope={openCalendar:"=?openCalendar",disable:"=?disable",changeState:"&?changeState",fromDate:"=fromDate",toDate:"=toDate",pickClick:"&?pickClick",applyClick:"&?applyClick",changeTab:"&?changeTab",options:"=?options",activeTab:"=?activeTab",openTab:"=?openTab",initialEmpty:"&?initialEmpty",inputDate:"=inputDate",lightVersion:"=",supportKeyboardNavigation:"=?",isOpen:"=?",showOnInputClick:"=?",onClose:"&?"},datepickerInlineScope={fromDate:"=fromDate",toDate:"=toDate",pickClick:"&?pickClick",options:"=?options",currentFromDate:"=",currentToDate:"=",inputDate:"=inputDate"};function tpDatepickerInline(){return{scope:datepickerInlineScope,controller:["$scope","$timeout","tpDatepickerService","lang","datetimePlaceholder",function(t,e,n,a,i){datepickerController(t,e,n,a,i),t.$watch(function(){return t.getSelectedFromDate()},function(e){t.currentFromDate=e}),t.$watch(function(){return t.getSelectedToDate()},function(e){t.currentToDate=new Date(e.getTime()+t.activeCalendar.diffDateEnd)})}],templateUrl:"template/datepicker/datepicker-inline.html",restrict:"A"}}var KEYBOARD_CODES={LEFT_ARROW:37,RIGHT_ARROW:39,TOP_ARROW:38,DOWN_ARROW:40,TAB:9,ESC:27,ENTER:13};function tpDatepicker(t,e,n,a){return{scope:datepickerScope,link:function(a,i,r){a.showOnInputClick=!angular.isDefined(a.showOnInputClick)||a.showOnInputClick,a.openCalendar=!!a.openCalendar,i.find("input[type=date]").prop("type","text").on("keydown",function(t){t.keyCode===KEYBOARD_CODES.ESC&&a.openCalendar&&(t.preventDefault(),t.stopPropagation())}),a.$watch("isOpen",function(t){(t&&!a.openCalendar||!t&&a.openCalendar)&&a.showCalendar()}),n(function(){a.contentLoaded=!0}),a.showCalendar=function(){if(a.openCalendar=!a.openCalendar,!0===a.disable)a.openCalendar=!1,o();else if(a.openCalendar){if(a.positionUpdated=!1,a.fromDate){var r=new Date(a.fromDate).getHours(),s=new Date(a.fromDate).getMinutes();a.$broadcast("time-updated",{hours:r,minutes:s})}n(function(){var n=i.find(".calendar"),r=i.find(".extended"),o=n.offset().top+n.innerHeight()>e.innerHeight,s=r.offset().top<n.innerHeight(),d=1;if(s&&o){var u=n.innerHeight(),p=e.innerHeight-(r.offset().top+r.innerHeight()),h=r.offset().top,f=p>h;d=((f?p:h)-10)/(n.innerHeight()+19);var m=(u-u*d)/2-19*d;n[0].style.setProperty("transform","scale("+d+")"),n[0].style.setProperty("margin-top","-"+m+"px")}else if(o){var m=n.offset().top-r.offset().top+n.innerHeight()+9;n[0].classList.add("top"),n[0].style.setProperty("top","-"+m+"px")}if(r.offset().left+r.innerWidth()/2<n.innerWidth()*d/2)n.offset({left:20});else if(r.offset().left+n.innerWidth()*d/2+r.innerWidth()/2>e.innerWidth)n.offset({left:e.innerWidth-n.innerWidth()*d-20});else{var g=n.innerWidth()*d,v=(r.innerWidth()-g)/2,y=(n.innerWidth()-g)/2,D=-y+v;n[0].style.setProperty("left",D+"px")}t.bind("click",l),a.supportKeyboardNavigation||t.bind("keyup",c),a.positionUpdated=!0},10),n(function(){a.changeState&&a.changeState()},10)}else o(),n(function(){a.changeState&&a.changeState()},10),a.onClose&&a.onClose()},a.openCalendar&&(a.openCalendar=!1,a.showCalendar());function o(){t.unbind("click",l),t.unbind("keyup",c)}a.updatePosition=function(){n(function(){var t=i.find(".calendar"),n=i.find(".extended");i.find(".dtpicker-input");n.offset().left+n.innerWidth()/2<t.innerWidth()/2?t.offset({left:20}):n.offset().left+t.innerWidth()/2+n.innerWidth()/2>e.innerWidth?t.offset({left:e.innerWidth-t.innerWidth()-20}):t.offset({left:n.offset().left+n.innerWidth()/2-t.innerWidth()/2})},10)};var s=i.find(".tp-datepicker");function l(t){a.$apply(function(){a.showCalendar()})}function c(t){switch(t.keyCode){case KEYBOARD_CODES.ESC:a.$apply(function(){a.showCalendar()});break;case KEYBOARD_CODES.LEFT_ARROW:a.$apply(function(){a.changeLeft(-1),a.changeRight(-1)});break;case KEYBOARD_CODES.RIGHT_ARROW:a.$apply(function(){a.changeRight(1),a.changeLeft(1)})}}(s.length?s:i).click(function(t){t.stopPropagation()})},controller:["$scope","$timeout","tpDatepickerService","lang","datetimePlaceholder","$document","$element",datepickerController],templateUrl:"template/datepicker/datepicker-custom.html",restrict:"A",transclude:!0}}function datepickerController(t,e,n,a,i,r,o){i.year="yyyy",i.month="mm",i.day="dd",i.date="dd",function(){t.options||(t.options={});t.options.mainOptions||(t.options.mainOptions={});"boolean"!=typeof t.options.mainOptions.showPanelTab&&(t.options.mainOptions.showPanelTab=!1);"boolean"!=typeof t.options.mainOptions.instantChanges&&(t.options.mainOptions.instantChanges=!1);"boolean"!=typeof t.options.mainOptions.showPanelCustomButton&&(t.options.mainOptions.showPanelCustomButton=!1);t.options.mainOptions.customPanel||(t.options.mainOptions.customPanel={});t.options.mainOptions.customPanel.dateFormat||(t.options.mainOptions.customPanel.dateFormat="MMM d, yyyy");t.options.mainOptions.startTab||(t.options.mainOptions.startTab=0);t.options.mainOptions.applyButton||(t.options.mainOptions.applyButton={});"string"!=typeof t.options.mainOptions.applyButton.title&&(t.options.mainOptions.applyButton.title=a.tr("Apply selected dates"));"boolean"!=typeof t.options.mainOptions.applyButton.enable&&(t.options.mainOptions.applyButton.enable=!0);t.options.mainOptions.closeButton||(t.options.mainOptions.closeButton={});"string"!=typeof t.options.mainOptions.closeButton.title&&(t.options.mainOptions.closeButton.title="Cancel");"boolean"!=typeof t.options.mainOptions.applyClose&&(t.options.mainOptions.applyClose=!0);t.options.mainOptions.time||(t.options.mainOptions.time={});"boolean"!=typeof t.options.mainOptions.time.enabled&&(t.options.mainOptions.time.enabled=!1);"boolean"!=typeof t.options.mainOptions.time.timeFormat12hours&&(t.options.mainOptions.time.timeFormat12hours=!0);t.options.mainOptions.time.minutesStep||(t.options.mainOptions.time.minutesStep=15);"boolean"!=typeof t.options.mainOptions.time.showTimezone&&(t.options.mainOptions.time.showTimezone=!0);t.options.calendarOptions||(t.options.calendarOptions=[{}]);for(var e=t.options.calendarOptions.length;e--;)t.options.calendarOptions[e].calendarUnitTitle||(t.options.calendarOptions[e].calendarUnitTitle="MMM d, yyyy"),"boolean"!=typeof t.options.calendarOptions[e].calendarUnitTitleRange&&(t.options.calendarOptions[e].calendarUnitTitleRange=!1),t.options.calendarOptions[e].calendarUnit||(t.options.calendarOptions[e].calendarUnit="m"),t.options.calendarOptions[e].calendarUnitCount||(t.options.calendarOptions[e].calendarUnitCount=1),t.options.calendarOptions[e].oneCanvasCalendar||(t.options.calendarOptions[e].oneCanvasCalendar=!1),t.options.calendarOptions[e].unit||(t.options.calendarOptions[e].unit="d"),t.options.calendarOptions[e].unitTitle||(t.options.calendarOptions[e].unitTitle={},t.options.calendarOptions[e].unitTitle.type="date"),"date"===t.options.calendarOptions[e].unitTitle.type&&"string"!=typeof t.options.calendarOptions[e].unitTitle.title&&(t.options.calendarOptions[e].unitTitle.title="d"),"boolean"!=typeof t.options.calendarOptions[e].unitTitleRange&&(t.options.calendarOptions[e].unitTitleRange=!1),("number"!=typeof t.options.calendarOptions[e].startDay||t.options.calendarOptions[e].startDay<0||t.options.calendarOptions[e].startDay>6)&&(t.options.calendarOptions[e].startDay=0),"number"!=typeof t.options.calendarOptions[e].unitRange&&(t.options.calendarOptions[e].unitRange=1),"string"!=typeof t.options.calendarOptions[e].unitSelectRange&&"boolean"!=typeof t.options.calendarOptions[e].unitSelectRange&&(t.options.calendarOptions[e].unitSelectRange=!1),"boolean"!=typeof t.options.calendarOptions[e].enableOneClickRange&&(t.options.calendarOptions[e].enableOneClickRange=!1),"boolean"!=typeof t.options.calendarOptions[e].viewDayOfWeek&&(t.options.calendarOptions[e].viewDayOfWeek="d"===t.options.calendarOptions[e].unit),"number"!=typeof t.options.calendarOptions[e].numColumn&&(t.options.calendarOptions[e].numColumn=7),"number"!=typeof t.options.calendarOptions[e].numRow&&(t.options.calendarOptions[e].numRow=6),t.options.calendarOptions[e].customButtonSelect||(t.options.calendarOptions[e].customButtonSelect=[]),t.options.calendarOptions[e].customButtonCallback||(t.options.calendarOptions[e].customButtonCallback=[]),"boolean"!=typeof t.options.calendarOptions[e].showArrow&&(t.options.calendarOptions[e].showArrow=!0),"boolean"!=typeof t.options.calendarOptions[e].showExtraArrow&&(t.options.calendarOptions[e].showExtraArrow=!1),t.options.calendarOptions[e].limitDateNotBefore instanceof Date?t.options.calendarOptions[e].limitDateNotBefore.setHours(0,0,0,0):t.options.calendarOptions[e].limitDateNotBefore=void 0,t.options.calendarOptions[e].limitDateNotAfter instanceof Date?t.options.calendarOptions[e].limitDateNotAfter.setHours(0,0,0,0):t.options.calendarOptions[e].limitDateNotAfter=void 0,t.options.calendarOptions[e].diffDateEnd||(t.options.calendarOptions[e].diffDateEnd=0),"boolean"!=typeof t.options.calendarOptions[e].currentDayHighlight&&(t.options.calendarOptions[e].currentDayHighlight=!0),"boolean"!=typeof t.options.calendarOptions[e].selectYear&&(t.options.calendarOptions[e].selectYear=!1)}();var s;new Date;function l(){if(t.activeCalendar.startDay>=0){t.dayNames=[];for(var e=7;e--;){var n=new Date,a=n.getDay(),i=t.activeCalendar.startDay-a;n.setDate(n.getDate()+i+6-e),t.dayNames.push(n)}}}t.dirtyDate=!1,t.hideArrow=!1,t.activeTab=t.options.mainOptions.startTab?t.options.mainOptions.startTab:0,t.dayNames=[],t.options.calendarOptions&&(t.activeCalendar=angular.copy(t.options.calendarOptions[t.activeTab]),t.openTab=t.activeCalendar,l()),t.years=[],t.yearInputName="year_hash"+(new Date).getTime(),s=(new Date).getFullYear(),t.years=Array.apply(null,new Array(100)).map(function(t,e){return s-e}),t.$watch("fromDate",function(){D(),O()}),t.$watch("toDate",function(){D(),O()}),t.supportKeyboardNavigation&&t.$watch("openCalendar",function(e){e&&(t.$apply(),T())});var c=null,d=null,u=null,p=null,h=null,f=null,m=null,g=null;function v(e){return function(t,e,n){var a=null,i=null,r=null;switch(e){default:case"m":(a=y(t)).setDate(1),i=y(a),a.setMonth(a.getMonth()*n+1),a.setDate(a.getDate()-1),r=y(a);break;case"y":a=y(t),i=new Date(a.getFullYear(),0,1),r=new Date(a.getFullYear()+(n-1),11,31)}return i.setHours(0,0,0,0),r.setHours(0,0,0,0),{dateStart:i,dateOver:r}}(e,t.activeCalendar.calendarUnit,t.activeCalendar.calendarUnitCount)}function y(t){return t?t instanceof Date?new Date(t.getTime()):"string"==typeof t||"number"==typeof t?new Date(t):null:null}function D(){c=d=y(t.fromDate),u=p=y(t.toDate),function(){h=null,f=null,m=null,g=null;var e=null;t.fromDate?(e=y(t.fromDate),h=v(e).dateStart,f=v(e).dateOver):t.toDate?(e=y(t.toDate),h=v(e).dateStart,f=v(e).dateOver):(h=v(new Date).dateStart,f=v(new Date).dateOver);var n=y(h);switch(t.activeCalendar.calendarUnit){default:case"m":n.setMonth(n.getMonth()+t.activeCalendar.calendarUnitCount);break;case"y":n.setFullYear(n.getFullYear()+t.activeCalendar.calendarUnitCount)}t.toDate&&t.toDate>=n?(e=new Date(t.toDate.getTime()),m=v(e).dateStart,g=v(e).dateOver):(m=v(n).dateStart,g=v(n).dateOver);var a=new Date(f.getTime());a.setDate(a.getDate()+1),a.setHours(0,0,0,0),t.hideArrow=a>=m,t.activeCalendar.oneCanvasCalendar&&(t.hideArrow=!1),t.viewDateLeftStart=h,t.viewDateLeftEnd=f,t.viewDateRightStart=m,t.viewDateRightEnd=g}()}function k(e){var n=v(e);m=n.dateStart,g=n.dateOver;var a=new Date(f.getTime());a.setDate(a.getDate()+1),t.hideArrow=a>=m,t.viewDateRightStart=m,t.viewDateRightEnd=g,O()}function w(e){h=v(e).dateStart,f=v(e).dateOver;var n=new Date(f.getTime());n.setDate(n.getDate()+1),t.hideArrow=n>=m,t.activeCalendar.oneCanvasCalendar&&(t.hideArrow=!1),t.viewDateLeftStart=h,t.viewDateLeftEnd=f,O()}function b(t,e,n,a){var i;return i=new Date(n>0?e:t),a&&i.setMonth(i.getMonth()+a),i.setDate(i.getDate()+n),i.setDate(1),i}D(),t.clickTab=function(n){t.activeTab=n,t.activeCalendar=t.options.calendarOptions[n],D(),O(),l(),t.dirtyDate=!1,t.updatePosition(),t.openTab=t.activeCalendar,e(function(){t.changeTab&&t.changeTab()},10)},t.clickDate=function(n){if(t.activeCalendar.unitSelectRange)switch(t.activeCalendar.unitSelectRange){default:case"w":("d"!==t.activeCalendar.unit||"d"===t.activeCalendar.unit&&1===t.activeCalendar.unitRange)&&(n.currentDateStart.getDay()>=t.activeCalendar.startDay?n.currentDateStart.setDate(n.currentDateStart.getDate()-(n.currentDateStart.getDay()-t.activeCalendar.startDay)):n.currentDateStart.setDate(n.currentDateStart.getDate()-(7-(t.activeCalendar.startDay-n.currentDateStart.getDay()))),n.currentDateOver.getDay()>=t.activeCalendar.startDay?n.currentDateOver.setDate(n.currentDateOver.getDate()+(6+t.activeCalendar.startDay-n.currentDateOver.getDay())):t.activeCalendar.startDay>n.currentDateOver.getDay()&&n.currentDateOver.setDate(n.currentDateOver.getDate()+(t.activeCalendar.startDay-n.currentDateOver.getDay()-1)));break;case"m":1!==n.currentDateStart.getDate()&&n.currentDateStart.setDate(1);var a=new Date;a.setMonth(a.getMonth()-1),a.setDate(0),n.currentDateOver.getDate()!==a.getDate()&&n.currentDateOver.setDate(a.getDate());break;case"y":0!==n.currentDateStart.getMonth()&&(n.currentDateStart.setMonth(0),n.currentDateStart.setDate(1)),11!==n.currentDateOver.getMonth()&&(n.currentDateOver.setMonth(12),n.currentDateOver.setDate(0))}if(n.disabled)return!1;n.selectRange||!c||!d||c.getTime()!==u.getTime()||d.getTime()!==p.getTime()||t.activeCalendar.enableOneClickRange?(c=new Date(n.currentDateStart.getTime()),d=new Date(n.currentDateOver.getTime()),u=new Date(n.currentDateStart.getTime()),p=new Date(n.currentDateOver.getTime())):n.currentDateStart>=c||n.currentDateOver>=d?(u=new Date(n.currentDateStart.getTime()),p=new Date(n.currentDateOver.getTime())):(c=new Date(n.currentDateStart.getTime()),d=new Date(n.currentDateOver.getTime())),t.options.mainOptions.instantChanges?t.applySelect():(O(),t.dirtyDate=!0),e(function(){t.pickClick&&t.pickClick()},0)},t.changeLeft=function(e,n){t.activeCalendar.oneCanvasCalendar&&t.changeRight(e,n);var a=b(h,f,e,n);new Date(a)>=m&&(a=new Date(m)).setDate(a.getDate()-1),w(a)},t.changeRight=function(t,e){var n=b(m,g,t,e);n<=f&&(n=new Date(f)).setDate(n.getDate()+1),k(n)},t.changeLeftInterim=function(e,n){t.activeCalendar.oneCanvasCalendar&&t.changeRightInterim(e,n);var a=new Date(h);a.setYear(a.getFullYear()+e),new Date(a)>=m&&((a=new Date(f)).setDate(1),a.setMonth(m.getMonth()-1),a.setYear(m.getFullYear())),w(a)},t.changeRightInterim=function(t){var e=new Date(g);e.setYear(e.getFullYear()+t),e<=f&&(e=new Date(f)).setDate(e.getDate()+1),k(e)},t.onYearChange=function(e){var n=t.viewDateLeftStart.getFullYear(),a=parseInt(e.year)-n;t.changeLeftInterim(a,"y")},t.customSelectButton=function(e){function n(t,e){var n={};return n.fromDate=t,n.toDate=e,n}switch(e){case"today":e=n(new Date,new Date);break;case"yesterday":var a=new Date,i=(o=-1,(s=new Date(a)).setDate(s.getDate()+o),s);e=n(i,i);break;case"week":e=n(new Date,new Date);var r=new Date;r.getDay()>=t.activeCalendar.startDay?e.fromDate.setDate(r.getDate()-(r.getDay()-t.activeCalendar.startDay)):e.fromDate.setDate(r.getDate()-(7-(t.activeCalendar.startDay-r.getDay()))),r.getDay()>=t.activeCalendar.startDay?e.toDate.setDate(r.getDate()+(6+t.activeCalendar.startDay-r.getDay())):t.activeCalendar.startDay>r.getDay()&&e.toDate.setDate(r.getDate()+(t.activeCalendar.startDay-r.getDay()-1));break;case"7days":(e=n(new Date,new Date)).fromDate.setDate(e.toDate.getDate()-6);break;case"month":(e=n(new Date,new Date)).fromDate.setMonth(e.fromDate.getMonth()-1),e.fromDate.setDate(1),e.toDate.setDate(0);break;case"30days":(e=n(new Date,new Date)).fromDate.setDate(e.fromDate.getDate()-29);break;case"year":(e=n(new Date,new Date)).toDate.setDate(0),e.fromDate.setDate(e.fromDate.getDate()-364);break;case"365days":(e=n(new Date,new Date)).fromDate.setFullYear(e.fromDate.getFullYear()-1)}var o,s;t.fromDate=new Date(e.fromDate.getTime()),t.toDate=new Date(e.toDate.getTime()),t.clickDate({currentDateStart:t.fromDate,currentDateOver:t.fromDate,selectRange:!0}),t.clickDate({currentDateStart:t.toDate,currentDateOver:t.toDate,selectRange:!1}),D(),O(),t.dirtyDate=!1},t.customButtonClick=function(e){e(function(e,n){t.fromDate=e,t.toDate=n})&&t.showCalendar()},t.applySelect=function(n){!n||n.target.className.indexOf("dtpicker-cancel")?(t.options.mainOptions.time.enabled?("[object Date]"===Object.prototype.toString.call(c)&&(t.fromDate=new Date(c.setHours(t.hours,t.minutes,0,0))),"[object Date]"===Object.prototype.toString.call(p)&&(t.toDate=new Date(p.setHours(t.hours,t.minutes,0,0)))):(t.fromDate=c?new Date(c.getTime()):null,t.toDate=p?new Date(p.getTime()+t.activeCalendar.diffDateEnd):null),t.dirtyDate=!1,D(),O(),e(function(){t.applyClick&&t.applyClick()},0),t.options.mainOptions.applyClose&&t.openCalendar&&t.showCalendar()):t.openCalendar&&t.showCalendar()},t.isInputDateDisabled=function(){return t.inputDate>t.options.calendarOptions[0].limitDateNotAfter};var O=function(){t.skeletonLeft=n.buildCalendarSkeleton(t.activeCalendar,{viewDateEnd:f,viewDateStart:h},{innerFromDateStart:c,innerFromDateEnd:d},{innerToDateStart:u,innerToDateEnd:p}),t.skeletonRight=n.buildCalendarSkeleton(t.activeCalendar,{viewDateEnd:g,viewDateStart:m},{innerFromDateStart:c,innerFromDateEnd:d},{innerToDateStart:u,innerToDateEnd:p})};function C(t,e,n){var a=t.neighbors&&t.neighbors[e];if(a)a.focus();else if(n){var i=t.id;S(n);var r=null;T(function(t){t.id===i&&(r=t)}),r&&(a=r.neighbors&&r.neighbors[e])&&a.focus()}}function T(t){var e=o.find(".calendar-day");if(e&&e.length){e.each(function(n,a){a.neighbors={},e[n-1]&&(a.neighbors.left=e[n-1]),e[n+1]&&(a.neighbors.right=e[n+1]),e[n-7]&&(a.neighbors.top=e[n-7]),e[n+7]&&(a.neighbors.bottom=e[n+7]),"function"==typeof t&&t(a,n)})}}function S(e,n){t.changeLeft(e,n),t.changeRight(e,n),t.$apply()}O(),t.getSelectedFromDate=function(){return c},t.getSelectedToDate=function(){return p},t.handleCustomInputClick=function(){t.showOnInputClick&&t.showCalendar()},t.handleDayCellMouseDown=function(t){t.preventDefault()},t.handleMonthKeyboardEvents=function(t){var e=0,n=0;switch(t.keyCode){case KEYBOARD_CODES.LEFT_ARROW:e=-1;break;case KEYBOARD_CODES.RIGHT_ARROW:e=1;break;case KEYBOARD_CODES.TOP_ARROW:e=0,n=-12;break;case KEYBOARD_CODES.DOWN_ARROW:e=0,n=12;break;default:return}(e||n)&&S(e,n)},t.handleCalendarBodyKeyboardEvents=function(t){if(t.target.neighbors)switch(t.keyCode){case KEYBOARD_CODES.LEFT_ARROW:C(t.target,"left",-1);break;case KEYBOARD_CODES.RIGHT_ARROW:C(t.target,"right",1);break;case KEYBOARD_CODES.TOP_ARROW:C(t.target,"top",-1);break;case KEYBOARD_CODES.DOWN_ARROW:C(t.target,"bottom",1);break;case KEYBOARD_CODES.ENTER:e(function(){t.target.click()},0,!1);break;default:return}},t.handleCommonKeyboardEvents=function(e){e.keyCode===KEYBOARD_CODES.ESC&&(e.preventDefault(),e.stopPropagation(),t.showCalendar());var n=o.find(".dtpicker-title"),a=o.find(".dtpicker-cancel");if(e.shiftKey&&e.keyCode===KEYBOARD_CODES.TAB&&e.target===n[0])return e.preventDefault(),void a.focus();e.keyCode===KEYBOARD_CODES.TAB&&!e.shiftKey&&e.target===a[0]&&(e.preventDefault(),n.focus())}}function tpTemplates(t){var e='<div class="dtpicker-content">\t<div class="calendar-canva">\t\t<div class="dtpicker-head">\t\t\t<div class="dtpicker-title" tabindex="0" ng-keyup="supportKeyboardNavigation && handleMonthKeyboardEvents($event)">\t\t\t\t<div class="dtpicker-pager dtpicker-pager-left">\t\t\t\t\t<div ng-if="activeCalendar.showExtraArrow"  ng-click="changeLeftInterim(-1,\'y\')"  class="dtpicker-prev-year"><i class="icon-arrow-double-datepicker-left"></i></div>\t\t\t\t\t<div ng-if="activeCalendar.showArrow" ng-click="changeLeft(-1)" class="dtpicker-prev-month"><i class="icon-arrow-datepicker-left"></i></div>\t\t\t\t</div>\t\t\t\t<div class="dtpicker-month">\t\t\t\t\t<span>{{viewDateLeftStart | date:activeCalendar.calendarUnitTitle}}</span> \t\t\t\t\t<span ng-if="activeCalendar.calendarUnitTitleRange"> &mdash; {{viewDateLeftEnd | date:activeCalendar.calendarUnitTitle}}</span>\t\t\t\t\t<div class="dtpicker-year" ng-if="activeCalendar.selectYear">\t\t\t\t\t\t<select ng-change="onYearChange(activeCalendar)" ng-model="activeCalendar.year">\t\t\t\t\t\t\t<option ng-repeat="year in years">{{ year }}</option>\t\t\t\t\t\t</select>\t\t\t\t\t</div>\t\t\t\t</div>\t\t\t\t<div class="dtpicker-pager dtpicker-pager-right">\t\t\t\t\t<div \t\t\t\t\t\tng-hide="hideArrow"\t\t\t\t\t\tng-if="activeCalendar.showArrow"\t\t\t\t\t\tng-click="changeLeft(1)"\t\t\t\t\t\tclass="dtpicker-next-month">\t\t\t\t\t\t<i class="icon-arrow-datepicker-right"></i>\t\t\t\t\t</div>\t\t\t\t\t<div ng-if="activeCalendar.showExtraArrow"  ng-hide="hideArrow" ng-click="changeLeftInterim(1,\'y\')" class="dtpicker-next-year"><i class="icon-arrow-double-datepicker-right"></i></div>\t\t\t\t</div>\t\t\t</div>\t\t\t<div ng-if="activeCalendar.viewDayOfWeek" class="dtpicker-dayname clearfix">\t\t\t\t<div ng-repeat="dayname in dayNames track by $index" class="dayname-list">{{dayname | date:"EEE" | limitTo: 1}}</div>\t\t\t</div>\t\t</div>\t\t<table class="dtpicker-body" ng-keyup="supportKeyboardNavigation && handleCalendarBodyKeyboardEvents($event)">\t\t\t<tr class="dtpicker-row" ng-repeat="str in skeletonLeft track by $index" ng-init="rowIndex = $index">\t\t\t\t<td           tabindex="{{rowIndex === 0 && cellIndex === 0 ? 0 : -1}}"          id="{{day.id}}" \t\t\t\t\tng-class="\t\t\t\t\t{\'out-day\': day.out, \t\t\t\t\t\'select-day\': day.selectRange, \t\t\t\t\t\'today\': day.today, \t\t\t\t\t\'select-today\':  day.selectToday, \t\t\t\t\t\'range-day\': day.selectRange, \t\t\t\t\t\'change-date\': dirtyDate, \t\t\t\t\t\'first-select-day\': (day.firstSelectDay), \t\t\t\t\t\'last-select-day\': (day.lastSelectDay), \t\t\t\t\t\'disabled-day\': (day.disabled), \t\t\t\t\t\'marker-day\': (day.markerDay), \t\t\t\t\t\'marker-column\': (day.markerColumn), \t\t\t\t\t\'chosen-today\': (day.today === day.firstSelectDay), \t\t\t\t\t\'marker-row\': (day.markerRow)}" \t\t\t\t\tng-click="clickDate(day)"         ng-mousedown="handleDayCellMouseDown($event)"\t\t\t\t\tclass="calendar-day {{day.markerColumn}} {{day.markerRow}}"\t\t\t\t\tng-repeat="day in str track by $index" ng-init="cellIndex = $index">\t\t\t\t\t<div ng-if="activeCalendar.unitTitle.type === \'date\'">\t\t\t\t\t\t<span>\t\t\t\t\t\t\t{{day.currentDateStart | date:activeCalendar.unitTitle.title}} <em class="inline" ng-if="activeCalendar.unitTitleRange">- {{day.currentDateOver | date:activeCalendar.unitTitle.title}}</em>\t\t\t\t\t\t</span>\t\t\t\t\t</div>\t\t\t\t\t<div ng-if="activeCalendar.unitTitle.type === \'index\'">\t\t\t\t\t\t<span>\t\t\t\t\t\t\t<span>{{activeCalendar.unitTitle.Ltitle}}</span>\t\t\t\t\t\t\t<span>{{day.index + 1}}</span>\t\t\t\t\t\t\t<span>{{activeCalendar.unitTitle.Rtitle}}</span>\t\t\t\t\t\t</span>\t\t\t\t\t</div>\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t</div>\t<div ng-if="!activeCalendar.oneCanvasCalendar" class="calendar-canva">\t\t<div class="dtpicker-head">\t\t\t<div class="dtpicker-title" tabindex="0">\t\t\t\t<div class="dtpicker-pager dtpicker-pager-left">\t\t\t\t\t<div ng-if="activeCalendar.showExtraArrow"  ng-hide="hideArrow" ng-click="changeRightInterim(-1,\'y\')" class="dtpicker-prev-year"><i class="icon-arrow-double-datepicker-left"></i></div>\t\t\t\t\t<div \t\t\t\t\t\tng-hide="hideArrow"\t\t\t\t\t\tng-if="activeCalendar.showArrow"\t\t\t\t\t\tng-click="changeRight(-1)"\t\t\t\t\t\tclass="dtpicker-prev-month">\t\t\t\t\t\t\t<i class="icon-arrow-datepicker-left"></i>\t\t\t\t\t</div>\t\t\t\t</div>\t\t\t\t<div class="dtpicker-month">\t\t\t\t\t<span>{{viewDateRightStart | date:activeCalendar.calendarUnitTitle}}</span> \t\t\t\t\t<span ng-if="activeCalendar.calendarUnitTitleRange"> &mdash; {{viewDateRightEnd | date:activeCalendar.calendarUnitTitle}}</span>\t\t\t\t</div>\t\t\t\t<div class="dtpicker-pager dtpicker-pager-right">\t\t\t\t\t<div ng-if="activeCalendar.showArrow" ng-click="changeRight(1)" class="dtpicker-next-month"><i class="icon-arrow-datepicker-right"></i></div>\t\t\t\t\t<div ng-if="activeCalendar.showExtraArrow"  ng-click="changeRightInterim(1,\'y\')" class="dtpicker-next-year"><i class="icon-arrow-double-datepicker-right"></i></div>\t\t\t\t</div>\t\t\t</div>\t\t\t<div ng-if="activeCalendar.viewDayOfWeek" class="dtpicker-dayname clearfix">\t\t\t\t<div ng-repeat="dayname in dayNames track by $index" class="dayname-list">{{dayname | date:"EEE" | limitTo: 1}}</div>\t\t\t</div>\t\t</div>\t\t<table class="dtpicker-body">\t\t\t<tr class="dtpicker-row" ng-repeat="str in skeletonRight">\t\t\t\t<td  \t\t\t\tng-class="\t\t\t\t{\'out-day\': day.out, \t\t\t\t\'select-day\': day.selectRange, \t\t\t\t\'today\': day.today, \t\t\t\t\'select-today\':  day.selectToday, \t\t\t\t\'range-day\': day.selectRange, \t\t\t\t\'change-date\': dirtyDate, \t\t\t\t\'first-select-day\': (day.firstSelectDay), \t\t\t\t\'last-select-day\': (day.lastSelectDay), \t\t\t\t\'disabled-day\': (day.disabled), \t\t\t\t\'marker-day\': (day.markerDay), \t\t\t\t\'marker-column\': (day.markerColumn), \t\t\t\t\'chosen-today\': (day.today === day.firstSelectDay), \t\t\t\t\'marker-row\': (day.markerRow)}" \t\t\t\tng-click="clickDate(day)"\t\t\t\tclass="calendar-day {{day.markerColumn}} {{day.markerRow}}"\t\t\t\tng-repeat="day in str track by $index">\t\t\t\t\t<div ng-if="activeCalendar.unitTitle.type === \'date\'">\t\t\t\t\t\t<span>\t\t\t\t\t\t\t{{day.currentDateStart | date:activeCalendar.unitTitle.title}} <em class="inline" ng-if="activeCalendar.unitTitleRange">- {{day.currentDateOver | date:activeCalendar.unitTitle.title}}</em>\t\t\t\t\t\t</span>\t\t\t\t\t</div>\t\t\t\t\t<div ng-if="activeCalendar.unitTitle.type === \'index\'">\t\t\t\t\t\t<span>\t\t\t\t\t\t\t<span>{{activeCalendar.unitTitle.Ltitle}}</span>\t\t\t\t\t\t\t<span>{{day.index + 1}}</span>\t\t\t\t\t\t\t<span>{{activeCalendar.unitTitle.Rtitle}}</span>\t\t\t\t\t\t</span>\t\t\t\t\t</div>\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t</div>\t<div ng-if="options.mainOptions.showPanelCustomButton && (activeCalendar.customButtonSelect.length || activeCalendar.customButtonCallback.length)" class="calendar-canva additional-canva">\t\t<div class="dtpicker-head">\t\t\t<div class="dtpicker-title">\t\t\t\t<div class="dtpicker-month">{{options.mainOptions.customPanel.title}}</div>\t\t\t</div>\t\t\t<div class="dtpicker-dayname clearfix">\t\t\t\t<div class="dtpicker-daterange">{{fromDate | date:options.mainOptions.customPanel.dateFormat}} - {{toDate | date:options.mainOptions.customPanel.dateFormat}}</div>\t\t\t</div>\t\t</div>\t\t<div class="dtpicker-body">\t\t\t<div class="dtpicker-buttons clearfix">\t\t\t\t<button ng-repeat="customButton in activeCalendar.customButtonSelect" class="btn btn-small btn-uppercased custom-select" ng-click="customSelectButton(customButton.diff())">{{ customButton.buttonName || customButton.butttonName }}</button>\t\t\t\t<button ng-repeat="customButton in activeCalendar.customButtonCallback" class="btn btn-small btn-uppercased custom-select" ng-click="customButtonClick(customButton.callback)">{{customButton.buttonName}}</button>\t\t\t</div>\t\t</div>\t</div></div>';t.put("template/datepicker/datepicker-inline.html",'<div class="tp-datepicker extended custom inline">'+e+"</div>"),t.put("template/datepicker/datepicker-custom.html",'<div class="tp-datepicker extended custom" ng-class="{\'light\': lightVersion === true, \'open\': openCalendar}">\t<div ng-click="handleCustomInputClick()" class="dtpicker-input">\t\t<div ng-transclude ></div>\t</div>\t<div ng-show="openCalendar" class="calendar" ng-keydown="supportKeyboardNavigation && handleCommonKeyboardEvents($event)" ng-animate="\'animate\'" ng-animate-children  animate="animate" ng-class="{\'tabs-on\': options.mainOptions.showPanelTab, \'hidden-on-load\': !contentLoaded, \'hidden-on-position-updated\': !positionUpdated}">\t\t<div class="dtpicker-tabs" ng-if="options.mainOptions.showPanelTab">\t\t\t<div ng-click="clickTab($index)" ng-class="{active: activeTab === $index}" ng-repeat="optionItem in options.calendarOptions" ng-if="options.mainOptions.showPanelTab" class="dtpicker-tab">\t\t\t\t{{optionItem.calendarCaption || optionItem.calendarTitle}}\t\t\t</div>\t\t</div>   <div ng-class="{\'datepicker-body\': true, \'initial-empty\': initialEmpty}" ng-if="openCalendar || !initialEmpty">'+e+'   </div>\t\t<div ng-show="options.mainOptions.time.enabled" id="dtpicker-time" class="dtpicker-time">\t\t\t<tp-time options="options.mainOptions.time" hours="hours" minutes="minutes"></tp-time>\t\t</div>\t\t<div ng-show="!options.mainOptions.hideApplySelect" class="dtpicker-submit">\t\t\t<button ng-if="options.mainOptions.applyButton.enable"             class="dtpicker-sumbit-button"             ng-click="applySelect($event)"             ng-disabled="isInputDateDisabled()"             ng-class="{\'dtpicker-sumbit-button--disabled\': isInputDateDisabled()}">{{options.mainOptions.applyButton.title}}     </button>\t\t\t<button ng-if="options.mainOptions.closeButton.enable"             class="dtpicker-sumbit-button dtpicker-cancel"             ng-click="applySelect($event)">{{options.mainOptions.closeButton.title | t}}      </button>\t\t</div>\t</div></div>')}tpDatepicker.$inject=["$document","$window","$timeout","$q"],tpTemplates.$inject=["$templateCache"],function(t,e){"use strict";var n="yyyy-MM-dd";function a(t){return new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate())}e.module("ngInputDate",["ng"]).factory("inputDate",function(){return{ExtractDate:a}}).directive("input",["dateFilter","$timeout",function(t,e){return{restrict:"EA",require:"?ngModel",link:function(e,a,i,r){if(void 0!==i.type&&"date"===i.type&&r){var o=void 0!==i.time&&void 0!==i.timeFormat?i.timeFormat:i.dateFormat||n;r.$formatters.unshift(function(e){const n=o.replace(/\[/g,"'").replace(/\]/g,"'");return t(e,n)}),r.$parsers.unshift(function(t){return function(t,e){if(void 0===t||""===t)return null;var a,i,r;if(e===n){var o=t.split("-");if(3!==o.length)return null;a=parseInt(o[0],10),i=parseInt(o[1],10),r=parseInt(o[2],10)}else if("function"==typeof moment){var s=moment(t,e.toUpperCase());a=s.year(),i=s.month()+1,r=s.date()}else{var l=new Date(t);a=l.getUTCFullYear(),i=l.getMonth()+1,r=l.getDate()}return i&&a&&r?new Date(a,i-1,r):null}(t,o)})}}}}])}(window,angular),function(t){"use strict";t.module("datetime",[]),t.module("datetime").constant("datetimePlaceholder",{year:"(year)",yearShort:"(year)",month:"(month)",date:"(date)",day:"(day)",hour:"(hour)",hour12:"(hour12)",minute:"(minute)",second:"(second)",millisecond:"(millisecond)",ampm:"(AM/PM)",week:"(week)"});var e={exports:{}};!function(t){void 0!==e&&(e.exports=t);var n="listeners",a={on:function(t,e){return o(this,t).push(e),this},once:function(t,e){var n=this;return a.originalListener=e,o(n,t).push(a),n;function a(){r.call(n,t,a),e.apply(this,arguments)}},off:r,emit:function(t,e){var n=this,a=o(n,t,!0);if(!a)return!1;var i=arguments.length;if(1===i)a.forEach(function(t){t.call(n)});else if(2===i)a.forEach(function(t){t.call(n,e)});else{var r=Array.prototype.slice.call(arguments,1);a.forEach(function(t){t.apply(n,r)})}return!!a.length}};function i(t){for(var e in a)t[e]=a[e];return t}function r(t,e){var a,i=this;if(arguments.length){if(e){if(a=o(i,t,!0)){if(!(a=a.filter(function(t){return t!==e&&t.originalListener!==e})).length)return r.call(i,t);i[n][t]=a}}else if((a=i[n])&&(delete a[t],!Object.keys(a).length))return r.call(i)}else delete i[n];return i}function o(t,e,a){if(!a||t[n]){var i=t[n]||(t[n]={});return i[e]||(i[e]=[])}}i(t.prototype),t.mixin=i}(function t(){if(!(this instanceof t))return new t});var n=e.exports,a=function(t,e,n){var a;if((t=""+t).length>n)t=t.substr(t.length-n);else if(t.length<e)for(a=t.length;a<e;a++)t="0"+t;return t},i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},o=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e};function l(t,e,n){for(var a=0,i=t.toUpperCase(),r=n.toUpperCase();i[e+a]&&i[e+a]==r[a];)a++;return t.substr(e,a)}function c(t,e,n){var i=function(t,e,n){var i,r,o,s;if("static"==e.type)return t.startsWith(e.value,n)?{viewValue:e.value}:{err:2,code:"TEXT_MISMATCH",message:"Pattern value mismatch"};if("number"==e.type)return null==(o=function(t,e){var n=(t=t.substring(e)).match(/^\d+/);return n&&n[0]}(t,n))?{err:1,code:"NUMBER_MISMATCH",message:"Invalid number",viewValue:""}:o.length<e.minLength?{err:1,code:"NUMBER_TOOSHORT",message:"The length of number is too short",value:+o,viewValue:o,properValue:a(+o,e.minLength,e.maxLength)}:(o.length>e.maxLength&&(o=o.substr(0,e.maxLength)),+o<e.min?{err:1,code:"NUMBER_TOOSMALL",message:"The number is too small",value:+o,viewValue:o,properValue:a(e.min,e.minLength,e.maxLength)}:o.length>e.minLength&&"0"==o[0]?{err:1,code:"LEADING_ZERO",message:"The number has too many leading zero",value:+o,viewValue:o,properValue:a(+o,e.minLength,e.maxLength)}:+o>e.max?{err:1,code:"NUMBER_TOOLARGE",message:"The number is too large",value:+o,viewValue:o,properValue:a(e.max,e.minLength,e.maxLength)}:{value:+o,viewValue:o});if("select"==e.type){for(r="",s=0;s<e.select.length;s++)(i=l(t,n,e.select[s]))&&i.length>r.length&&(o=s,r=i);return r?r!=e.select[o]?{err:1,code:"SELECT_INCOMPLETE",message:"Incomplete select",value:o+1,viewValue:r,selected:e.select[o]}:{value:o+1,viewValue:r}:{err:1,code:"SELECT_MISMATCH",message:"Invalid select",viewValue:""}}throw"Unknown token type: "+e.type}(t,e,n);return i.err&&"static"!=e.type&&t.startsWith(e.placeholder,n)&&(1<i.err||i.viewValue.length<=e.placeholder.length)?{empty:!0,viewValue:e.placeholder}:i}function d(t,e){var n,a,i=0,r=[],o=t,s=Array.isArray(o),l=0;for(o=s?o:o[Symbol.iterator]();;){if(s){if(l>=o.length)break;n=o[l++]}else{if((l=o.next()).done)break;n=l.value}if((a=c(e,n.token,i)).node=n,a.pos=i,a.token=n.token,2<=a.err)throw a.text=e,a;i+=a.viewValue.length,r.push(a)}var d=r[r.length-1];if(d.pos+d.viewValue.length<e.length)throw{code:"TEXT_TOOLONG",message:"Text is too long",text:e};return r}function u(t,e){if("static"==e.type)return{viewValue:e.value};var n=e.extract(t);if("number"==e.type)return{value:n,viewValue:a(n,e.minLength,e.maxLength)};if("select"==e.type)return{value:n,viewValue:e.select[n-1]};throw"Unknown type to format: "+e.type}function p(t,e,n){var a,i,r=[],o=e,s=Array.isArray(o),l=0;for(o=s?o:o[Symbol.iterator]();;){if(s){if(l>=o.length)break;i=o[l++]}else{if((l=o.next()).done)break;i=l.value}a=u(t,i.token),"static"!=i.token.type&&i.empty&&!n&&(a.value=null,a.viewValue=i.token.placeholder),r.push(a)}return r}var h=function(){function t(e,n){r(this,t),this.parser=e,this.token=n,this.value=null,this.viewValue=n.value,this.offset=0,this.next=null,this.prev=null,this.nextEdit=null,this.prevEdit=null,this.empty=!0}return t.prototype.unset=function(){"static"==this.token.type||this.parser.noEmpty||(this.empty=!0,this.parser.setValue(this.parser.value,!1))},t.prototype.parse=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=c(t,this.token,e);if(n.err)throw n.node=this,n.token=this.token,n;if(this.parser.noEmpty&&n.empty)throw{code:"NOT_INIT_FORBIDDEN",message:"Empty node is forbidden",node:this};if(n.empty)this.unset();else{this.empty=!1;var a=m(this.parser.copyValue(this.parser.value),this.token,n.value,this.parser);this.parser.setValue(a,!1)}},t.prototype.add=function(t){var e,n,a,i=this.parser.copyValue(this.parser.value);this.empty=!1,i=f(i,this.token,t,this.parser),e=this.token.extract(i),"number"==this.token.type?(n=this.token.min,a=this.token.max):"select"==this.token.type&&(n=1,a=this.token.select.length),e<n&&(i=m(i,this.token,n,this.parser)),a<e&&(i=m(i,this.token,a,this.parser)),this.parser.setValue(i,!1)},t}();function f(t,e,n,a){return"object"==(void 0===t?"undefined":i(t))?(e.add(t,n,a),t):e.add(t,n,a)}function m(t,e,n,a){return"object"==(void 0===t?"undefined":i(t))?(e.restore(t,n,a),t):e.restore(t,n,a)}function g(t){return t}var v=function(t){function e(){r(this,e);var n=s(this,t.call(this));return n._constructor.apply(n,arguments),n.initialize(),n}return o(e,t),e.prototype._constructor=function(t){var e=t.tokens,n=t.noEmpty,a=void 0!==n&&n,i=t.value,r=t.text,o=t.copyValue,s=void 0===o?g:o;if(!e||!e.length)throw new Error("option.tokens is required");this.tokens=e,this.nodes=function(t,e){var n,a,i,r=[],o=e,s=Array.isArray(o),l=0;for(o=s?o:o[Symbol.iterator]();;){if(s){if(l>=o.length)break;n=o[l++]}else{if((l=o.next()).done)break;n=l.value}r.push(new h(t,n))}for(a=0;a<r.length;a++)r[a].next=r[a+1]||null,r[a].prev=r[a-1]||null;for(i=null,a=0;a<r.length;a++)r[a].prevEdit=i,"static"!=r[a].token.type&&(i=r[a]);for(i=null,a=r.length-1;0<=a;a--)r[a].nextEdit=i,"static"!=r[a].token.type&&(i=r[a]);return r}(this,e),this.nameMap=function(t){var e=new Map,n=t,a=Array.isArray(n),i=0;for(n=a?n:n[Symbol.iterator]();;){var r;if(a){if(i>=n.length)break;r=n[i++]}else{if((i=n.next()).done)break;r=i.value}var o=r,s=e.get(o.token.name);s||(s=[],e.set(o.token.name,s)),s.push(o)}return e}(this.nodes),this.value=i,this.text=r,this.noEmpty=a,this.copyValue=s,this.err=!1},e.prototype.initialize=function(){this.setValue(this.value)},e.prototype.parse=function(t){if(!t)throw{code:"EMPTY",message:"The input is empty",oldText:this.text};var e,n;e=d(this.nodes,t);var a,i=[];for(a=this.err?d(this.nodes,this.text):this.nodes,n=0;n<e.length;n++)e[n].empty||e[n].viewValue==a[n].viewValue||(e[n].token=this.nodes[n].token,i.push(e[n]));var r=e.filter(function(t){return t.empty}),o=e.filter(function(t){return t.err});for(n=0;n<e.length;n++)this.nodes[n].value=e[n].value,this.nodes[n].viewValue=e[n].viewValue,this.nodes[n].offset=e[n].pos,this.nodes[n].empty=e[n].empty;if(o.length)throw this.err=!0,o[0];this.err=!1,i.sort(function(t,e){return e.empty?-1:t.empty?1:(e.token.prior||0)-(t.token.prior||0)});var s,l=this.copyValue(this.value),c=i,u=Array.isArray(c),h=0;for(c=u?c:c[Symbol.iterator]();;){if(u){if(h>=c.length)break;s=c[h++]}else{if((h=c.next()).done)break;s=h.value}l=m(l,s.token,s.value,this)}var f=p(l,e).map(function(t){return t.viewValue}).join("");if(t!=f)throw this.err=!0,{code:"INCONSISTENT_INPUT",message:"Successfully parsed but the output text doesn't match the input",text:t,oldText:this.text,properText:f};if(this.text=t,this.value=l,this.emit("change",this.value),r.length)throw{code:"NOT_INIT",message:"Some nodes are empty",text:t,node:r[0]};return this},e.prototype.setValue=function(t){var e,n=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],a=p(t,this.nodes,n),i=0,r="";for(e=0;e<a.length;e++)this.nodes[e].value=a[e].value,this.nodes[e].viewValue=a[e].viewValue,this.nodes[e].offset=i,this.nodes[e].empty=!n&&this.nodes[e].empty,i+=this.nodes[e].viewValue.length,r+=this.nodes[e].viewValue;return this.value=t,this.text=r,this.emit("change",this.value),this},e.prototype.isEmpty=function(t){var e,n;if(t)try{e=d(this.nodes,t)}catch(t){return!1}else e=this.nodes;for(n=0;n<e.length;n++)if("static"!=this.nodes[n].token.type&&!e[n].empty)return!1;return!0},e.prototype.isInit=function(){var t,e=this.nodes,n=Array.isArray(e),a=0;for(e=n?e:e[Symbol.iterator]();;){if(n){if(a>=e.length)break;t=e[a++]}else{if((a=e.next()).done)break;t=a.value}if("static"!=t.token.type&&t.empty)return!1}return!0},e.prototype.unset=function(){var t,e=this.nodes,n=Array.isArray(e),a=0;for(e=n?e:e[Symbol.iterator]();;){if(n){if(a>=e.length)break;t=e[a++]}else{if((a=e.next()).done)break;t=a.value}t.empty=!0}return this.setValue(this.value,!1),this},e.prototype.getText=function(){return this.text},e.prototype.getValue=function(){return this.value},e.prototype.getNodes=function(t){return t?this.nameMap.get(t):this.nodes},e}(n);function y(t,e){if(e.length){var n=D(e,t).map(function(t){return t.node}),a=n[0],i=n[1];return a==i?a:t-a.offset-a.viewValue.length<=i.offset-t?a:i}}function D(t,e){var n,a,i,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:e,o=t,s=Array.isArray(o),l=0;for(o=s?o:o[Symbol.iterator]();;){if(s){if(l>=o.length)break;n=o[l++]}else{if((l=o.next()).done)break;n=l.value}n.offset<=e&&(a={node:n,pos:e-n.offset}),n.offset+n.viewValue.length>=r&&!i&&(i={node:n,pos:r-n.offset})}if(!i){var c=t[t.length-1];i={node:c,pos:c.viewValue.length}}return a||(a={node:t[0],pos:0}),a.pos>a.node.viewValue.length&&(a.pos=a.node.viewValue.length),[a,i]}var k=function(){function t(e,n){r(this,t),this.el=e,this.nodes=n,this.range={node:y(0,this.nodes),start:0,end:"end"}}return t.prototype.selectNearestNode=function(){var t=this.el.getSelection();t&&this.select({node:y(t.start,this.nodes),start:0,end:"end"})},t.prototype.select=function(t){(t=Object.assign(this.range,t)).node&&this.el.setSelection(t.node.offset+t.start,t.node.offset+("end"==t.end?t.node.viewValue.length:t.end))},t.prototype.hasNext=function(){if(this.range.node)return this.range.node.nextEdit},t.prototype.hasPrev=function(){if(this.range.node)return this.range.node.prevEdit},t.prototype.selectNext=function(){var t=this.hasNext(),e={start:0,end:"end"};t&&(e.node=t),this.select(e)},t.prototype.selectPrev=function(){var t=this.hasPrev(),e={start:0,end:"end"};t&&(e.node=t),this.select(e)},t.prototype.get=function(){if(this.nodes.length){var t=this.el.getSelection();if(t){var e=D(this.nodes,t.start,t.end),n=e[0],a=e[1];n.node==a.node&&(this.range={node:n.node,start:n.pos,end:a.pos})}}},t.prototype.atNodeEnd=function(){if(this.range.node){this.get();var t=this.range.node.viewValue.length,e=this.range.node.token.maxLength,n="end"==this.range.start?t:this.range.start;return n==("end"==this.range.end?t:this.range.end)&&n==(null!=e?e:t)||!t}},t.prototype.atNodeStart=function(){if(this.range.node){this.get();var t=this.range.node.viewValue.length,e="end"==this.range.start?t:this.range.start;return e==("end"==this.range.end?t:this.range.end)&&0==e}},t}(),w=function(t){function e(){r(this,e);var n=s(this,t.call(this));return n._constructor.apply(n,arguments),n.initialize(),n}return o(e,t),e.prototype._constructor=function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"";this.el=t,this.tp=e,this.separators=n,this.sel=new k(t,e.getNodes().filter(function(t){return"static"!=t.token.type}))},e.prototype.initialize=function(){var t=this;this.el.on("mousedown",function(){t.mousedown=!0}),this.el.on("focus",function(){t.mousedown||setTimeout(function(){t.sel.select({start:0,end:"end"})})}),this.el.on("click",function(){t.mousedown=!1,t.sel.selectNearestNode()}),this.el.on("input",function(){t.digest(null,t.el.val())}),this.el.on("keydown",function(e){e.altKey||e.ctrlKey||(37==e.keyCode||9==e.keyCode&&e.shiftKey&&t.sel.hasPrev()?(e.preventDefault(),t.tryFixingError(),t.sel.selectPrev()):39==e.keyCode||9==e.keyCode&&!e.shiftKey&&t.sel.hasNext()?(e.preventDefault(),t.tryFixingError(),t.sel.selectNext()):38==e.keyCode?(e.preventDefault(),t.sel.selectNearestNode(),t.sel.range.node&&t.sel.range.node.add(1),t.val(t.tp.getText()),t.sel.select({start:0,end:"end"})):40==e.keyCode?(e.preventDefault(),t.sel.selectNearestNode(),t.sel.range.node&&t.sel.range.node.add(-1),t.val(t.tp.getText()),t.sel.select({start:0,end:"end"})):36==e.keyCode||35==e.keyCode?setTimeout(function(){return t.sel.selectNearestNode()}):46==e.keyCode?t.sel.atNodeEnd()&&(e.preventDefault(),t.tryFixingError(),t.sel.selectNext()):8==e.keyCode&&t.sel.atNodeStart()&&(e.preventDefault(),t.tryFixingError(),t.sel.selectPrev()))}),this.el.on("keypress",function(e){var n=null==e.charCode?e.keyCode:e.charCode,a=String.fromCharCode(n),i=t.separators,r=t.sel.range.node;if(r&&r.next&&"static"==r.next.token.type&&(i+=r.next.viewValue[0]),i.includes(a))return e.preventDefault(),t.tryFixingError(),void t.sel.selectNext();setTimeout(function(){t.sel.atNodeEnd()&&t.sel.range.node.viewValue&&(t.tryFixingError(),t.sel.selectNext())})}),this.el.on("blur",function(){setTimeout(function(){t.tryFixingError()})}),this.tp.on("change",function(){t.err||t.inDigest||(t.val(t.tp.getText()),t.sel.select())});var e=this.el.val();e?this.digest(null,e,!0):this.val(this.tp.getText())},e.prototype.errorViewLength=function(){return this.err&&null!=this.err.viewValue?this.err.viewValue.length:void 0},e.prototype.val=function(t){this.el.val()!=t&&this.el.val(t),this.err=null},e.prototype.tryFixingError=function(){this.err&&(this.err.properValue?this.digest(this.err.node,this.err.properValue,!0):this.err.node&&(this.err.node.unset(),this.digest(null,this.tp.getText())))},e.prototype.digest=function(t,e,n){var a,i=10;for(this.inDigest=!0;i--;){this.err=null;try{t?t.parse(e):this.tp.parse(e)}catch(i){if(this.emit("digest",i),this.sel.get(),"NOT_INIT"==i.code)break;if(this.err=i,!n&&("NUMBER_TOOSHORT"==i.code||"NUMBER_TOOSMALL"==i.code||"NUMBER_MISMATCH"==i.code||"SELECT_MISMATCH"==i.code||"LEADING_ZERO"==i.code))break;if("SELECT_INCOMPLETE"==i.code){t=i.node,e=i.selected,a={end:"end"};continue}null!=i.properValue?(t=i.node,e=i.properValue):null!=i.properText?(t=null,e=i.properText):("EMPTY"==i.code&&this.tp.unset(),i.node&&i.node.unset(),t=null,e=this.tp.getText(),a={start:0,end:"end"});continue}break}if(this.err||(this.val(this.tp.getText()),i<9&&this.sel.select(a)),this.inDigest=!1,i<0)throw new Error("InputMask.digest crashed! Infinite loop on "+e)},e}(n),b=v,O=w;function C(e,n){var i=e.DATETIME_FORMATS,o=/yyyy|yy|y|M{1,4}|dd?|EEEE?|HH?|hh?|mm?|ss?|([.,])sss|a|Z{1,2}|ww|w|'(([^']+|'')*)'/g,s={y:{minLength:1,maxLength:4,max:9999,min:0,name:"year",type:"number"},yy:{minLength:2,maxLength:2,name:"yearShort",type:"number"},yyyy:{minLength:4,maxLength:4,max:9999,min:0,name:"year",type:"number"},MMMM:{name:"month",type:"select",select:i.MONTH},MMM:{name:"month",type:"select",select:i.SHORTMONTH},MM:{minLength:2,maxLength:2,name:"month",type:"number"},M:{minLength:1,maxLength:2,name:"month",type:"number",min:1},dd:{minLength:2,maxLength:2,name:"date",type:"number"},d:{minLength:1,maxLength:2,name:"date",type:"number",min:1},EEEE:{name:"day",type:"select",select:w(i.DAY)},EEE:{name:"day",type:"select",select:w(i.SHORTDAY)},HH:{minLength:2,maxLength:2,name:"hour",type:"number"},H:{minLength:1,maxLength:2,name:"hour",type:"number"},hh:{minLength:2,maxLength:2,name:"hour12",type:"number"},h:{minLength:1,maxLength:2,name:"hour12",type:"number"},mm:{minLength:2,maxLength:2,name:"minute",type:"number"},m:{minLength:1,maxLength:2,name:"minute",type:"number"},ss:{minLength:2,maxLength:2,name:"second",type:"number"},s:{minLength:1,maxLength:2,name:"second",type:"number"},sss:{minLength:3,maxLength:3,name:"millisecond",type:"number"},a:{name:"ampm",type:"select",select:i.AMPMS},ww:{minLength:2,maxLength:2,max:53,name:"week",type:"number"},w:{minLength:1,maxLength:2,max:53,name:"week",type:"number"},Z:{name:"timezone",type:"static"},ZZ:{name:"timezone",type:"static",colon:!0},string:{name:"string",type:"static"}},l={year:{extract:function(t){var e=t.getFullYear()%1e4;return 0<=e?e:0},restore:function(t,e){return t.setFullYear(e)},add:function(t,e){return t.setFullYear(t.getFullYear()+e)},prior:7},yearShort:{extract:function(t){var e=t.getFullYear()%100;return 0<=e?e:e+100},restore:function(t,e){return t.setFullYear(e)},add:function(t,e){return t.setFullYear(t.getFullYear()+e)},prior:7},month:{extract:function(t){return t.getMonth()+1},restore:function(t,e){t.setMonth(e-1),t.getMonth()==e&&t.setDate(0)},add:function(t,e){e=t.getMonth()+e,t.setMonth(e),t.getMonth()==e+1&&t.setDate(0)},prior:5},date:{extract:function(t){return t.getDate()},restore:function(t,e,n){var a=t.getMonth();if(t.setDate(e),t.getMonth()!=a&&e<=31){var i=n.getNodes("month");i&&i.every(function(t){return t.empty})&&t.setDate(e)}},add:function(t,e,n){this.restore(t,t.getDate()+e,n)},prior:4},day:{extract:function(t){return t.getDay()||7},restore:function(t,e){var n=t.getMonth(),a=e-(t.getDay()||7);t.setDate(t.getDate()+a),t.getMonth()!=n&&(0<a?t.setDate(t.getDate()-7):t.setDate(t.getDate()+7))},add:function(t,e){return t.setDate(t.getDate()+e)},prior:4},hour:{extract:function(t){return t.getHours()},restore:function(t,e){return t.setHours(e)},add:function(t,e){return t.setHours(t.getHours()+e)},prior:2},hour12:{extract:function(t){return t.getHours()%12||12},restore:function(t,e){e%=12,12<=t.getHours()&&(e+=12),t.setHours(e)},add:function(t,e){return t.setHours(t.getHours()+e)},prior:2},ampm:{extract:function(t){return t.getHours()<12?1:2},restore:function(t,e){var n=t.getHours();n<12==1<e&&t.setHours((n+12)%24)},add:function(t,e){return t.setHours(t.getHours()+12*e)},prior:3},minute:{extract:function(t){return t.getMinutes()},restore:function(t,e){return t.setMinutes(e)},add:function(t,e){return t.setMinutes(t.getMinutes()+e)},prior:0},second:{extract:function(t){return t.getSeconds()},restore:function(t,e){return t.setSeconds(e)},add:function(t,e){return t.setSeconds(t.getSeconds()+e)},prior:1},millisecond:{extract:function(t){return t.getMilliseconds()},restore:function(t,e){return t.setMilliseconds(e)},add:function(t,e){return t.setMilliseconds(t.getMilliseconds()+e)},prior:1},week:{extract:C,restore:function(t,e){return t.setDate(t.getDate()+7*(e-C(t)))},add:function(t,e){return t.setDate(t.getDate()+7*e)},prior:6}};for(var c in l)l[c].placeholder=n[c];var d=Object.values(s),u=Array.isArray(d),p=0;for(d=u?d:d[Symbol.iterator]();;){var h;if(u){if(p>=d.length)break;h=d[p++]}else{if((p=d.next()).done)break;h=p.value}var f=h;l[f.name]&&t.extend(f,l[f.name])}var m,g,v,y,D,k=(g=0<=(m=-(new Date).getTimezoneOffset())?"+":"-",v=Math.abs(m),y=Math.floor(v/60),D=v%60,g+a(y,2,2)+a(D,2,2));function w(t){var e,n=[];for(e=1;e<t.length;e++)n.push(t[e]);return n.push(t[0]),n}function O(e){for(var n,a=[],i=0;n=o.exec(e);)if(n.index>i&&(a.push(t.extend({value:e.substring(i,n.index)},s.string)),i=n.index),n.index==i){if(n[1])a.push(t.extend({value:n[1]},s.string)),a.push(s.sss);else if(n[2])a.push(t.extend({value:n[2].replace("''","'")},s.string));else if("timezone"==s[n[0]].name){var r=k;s[n[0]].colon&&(r=T(r)),a.push(t.extend({value:r},s[n[0]]))}else a.push(s[n[0]]);i=o.lastIndex}return i<e.length&&a.push(t.extend({value:e.substring(i)},s.string)),a}function C(t){var e=new Date(t.getFullYear(),0,1),n=new Date(e.getTime());4<n.getDay()?n.setDate(n.getDate()+(1-n.getDay())+7):n.setDate(n.getDate()+(1-n.getDay()));var a=t.getTime()-n.getTime();return Math.floor(a/6048e5)}function T(t){return":"==t[3]?t:t.substr(0,3)+":"+t.substr(3,2)}function S(t){return":"!=t[3]?t:t.substr(0,3)+t.substr(4,2)}var E=function(){function t(e){r(this,t),this.tp=e,this.timezone=k,this.timezoneNodes=this.tp.nodes.filter(function(t){return"timezone"==t.token.name})}return t.prototype.parse=function(t){return this.tp.parse(t),this},t.prototype.getText=function(){return this.tp.getText()},t.prototype.setDate=function(t,e){return this.tp.setValue(function(t,e){var n=(60*+(e=S(e)).substr(1,2)+ +e.substr(3,2))*(e[0]+"1");return new Date(t.getTime()+60*(n- -t.getTimezoneOffset())*1e3)}(t,this.timezone),e),this},t.prototype.getDate=function(){return t=this.tp.getValue(),e=this.timezone,n=(60*+(e=S(e)).substr(1,2)+ +e.substr(3,2))*(e[0]+"1"),new Date(t.getTime()+60*(-t.getTimezoneOffset()-n)*1e3);var t,e,n},t.prototype.setTimezone=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:k;if(t!=this.timezone){var e=this.getDate();this.timezone=t;var n=this.timezoneNodes,a=Array.isArray(n),i=0;for(n=a?n:n[Symbol.iterator]();;){var r;if(a){if(i>=n.length)break;r=n[i++]}else{if((i=n.next()).done)break;r=i.value}var o=r;o.token.colon?o.token.value=T(t):o.token.value=S(t)}return this.setDate(e,!1)}},t.prototype.isEmpty=function(){return this.tp.isEmpty.apply(this.tp,arguments)},t.prototype.isInit=function(){return this.tp.isInit.apply(this.tp,arguments)},t.prototype.unset=function(){return this.tp.unset(),this},t}();return function(t){var e,n=O(i[t]||t);e=n.some(function(t){return"yearShort"==t.name})?function(t){return function(e){t.apply(this,arguments);var n=e.getFullYear();n<0&&e.setFullYear(n+100)}}:function(t){return function(e){t.apply(this,arguments);var n=e.getFullYear();n<0&&e.setFullYear(0),9999<n&&e.setFullYear(9999)}};var a=n,r=Array.isArray(a),o=0;for(a=r?a:a[Symbol.iterator]();;){var s;if(r){if(o>=a.length)break;s=a[o++]}else{if((o=a.next()).done)break;s=o.value}var l=s;l.add&&(l.add=e(l.add)),l.restore&&(l.restore=e(l.restore))}var c=new b({tokens:n,value:new Date,copyValue:function(t){return new Date(t.getTime())}});return new E(c)}}function T(e,n,a){var i=function(){function e(t,n){r(this,e),this.el=t,this.doc=n}return e.prototype.on=function(t,e){if("input"!=t)return this.el.on(t,e)},e.prototype.getSelection=function(){var e=this.el[0];if(this.doc.activeElement==e){var n=e.selectionStart,a=e.selectionEnd;return t.isDefined(n)&&t.isDefined(a)?{start:n,end:a}:this.getSelectionIE()}},e.prototype.getSelectionIE=function(){var t=this.el[0],e=this.doc.selection.createRange().getBookmark(),n=t.createTextRange(),a=n.duplicate();n.moveToBookmark(e),a.setEndPoint("EndToStart",n);var i=a.text.length;return{start:i,end:i+n.text.length}},e.prototype.setSelection=function(t,e){var n=this.el[0];this.doc.activeElement==n&&(n.setSelectionRange?n.setSelectionRange(t,e):this.setSelectionIE(t,e))},e.prototype.setSelectionIE=function(t,e){var n=this.el[0].createTextRange();n.moveStart("character",t),n.collapse(),n.moveEnd("character",e-t),n.select()},e.prototype.val=function(){var t;return(t=this.el).val.apply(t,arguments)},e}();return{restrict:"A",require:"?ngModel",link:function(n,r,o,s){if(!s)return!1;o.ngTrim="false";var l,c=e(o.datetime),d=o.datetimeModel&&e(o.datetimeModel),u=new i(r,a[0]),p=new O(u,c.tp,o.datetimeSeparator);function h(t){t&&!l?(l=!0,c.setTimezone("+0000"),d&&d.setTimezone("+0000")):!t&&l&&(l=!1,c.setTimezone(),d&&d.setTimezone())}function f(t){c.setTimezone(t),d&&d.setTimezone(t)}function m(e){return!(!s.$isEmpty(e)&&!s.$isEmpty(o.min))||(t.isDate(e)||(e=d.getDate()),e>=new Date(o.min))}function g(e){return!(!s.$isEmpty(e)&&!s.$isEmpty(o.max))||(t.isDate(e)||(e=d.getDate()),e<=new Date(o.max))}function v(t){return s.$validate?s.$validate():(s.$setValidity("min",m(t)),s.$setValidity("max",g(t))),!s.$error.min&&!s.$error.max}p.on("digest",function(t){"NOT_INIT"!=t.code&&s.$setValidity("datetime",!1)}),c.tp.on("change",function(){n.$evalAsync(function(){p.err?s.$setValidity("datetime",!1):(c.isInit()||c.isEmpty()?s.$setValidity("datetime",!0):s.$setValidity("datetime",!1),c.getText()!=s.$viewValue&&s.$setViewValue(c.getText()))})}),t.isDefined(o.datetimeUtc)&&(0<o.datetimeUtc.length?n.$watch(o.datetimeUtc,h):h(!0)),t.isDefined(o.datetimeTimezone)&&(/^[+-]\d{2}:?\d{2}$/.test(o.datetimeTimezone)?f(o.datetimeTimezone):n.$watch(o.datetimeTimezone,f)),s.$validators&&(s.$validators.min=m,s.$validators.max=g),o.$observe("min",function(){v(c.getDate())}),o.$observe("max",function(){v(c.getDate())}),s.$render=function(){},s.$isEmpty=function(t){return!t||"string"==typeof t&&c.isEmpty(t)},s.$parsers.unshift(function(e){if(t.isUndefined(e)&&(e=c.getText()),!t.isString(e))return e;if(p.digest(null,e),c.isInit()){var n=c.getDate();return s.$validate||v(n)?d?d.setDate(n).getText():new Date(n.getTime()):void 0}}),s.$formatters.push(function(e){return s.$setValidity("datetime",!0),e?function(e){return!(!t.isDate(e)||d)||!(!t.isString(e)||!d)}(e)?(d&&(e=d.parse(e).getDate()),s.$validate||v(e),c.setDate(e).getText()):e:(c.unset(),n.$evalAsync(function(){s.$setViewValue(c.getText())}),c.getText())})},priority:100}}t.module("datetime").factory("datetime",C),C.$inject=["$locale","datetimePlaceholder"],t.module("datetime").directive("datetime",T),T.$inject=["datetime","$log","$document"]}(angular);
function tpTime(){return{scope:{hours:"=?",minutes:"=?",options:"=?"},controller:"tpTimeController",restrict:"AE",replace:!0,template:'<div id="time-wrapper" class="time-wrapper" ng-show="options.enabled"><div class="time-inputs-wrapper"><input type="text" ng-model="viewHours" id="hours" maxlength="2" ng-blur="onBlurHours($event)" ng-keydown="onKeyDownHours($event)" ng-keyup="onKeyUpHours($event)" /><input type="text" ng-model="viewMinutes" id="minutes" maxlength="2" ng-blur="onBlurMinutes($event)" ng-keydown="onKeyDownMinutes($event)" ng-keyup="onKeyUpMinutes($event)" /></div><div ng-show="options.timeFormat12hours" class="meridian-select-wrapper"><select ng-model="meridiem" ng-change="updateTime()" ng-options="key for (key, value) in meridiems" class="light"></select></div><div ng-show="options.showTimezone" class="timezone-wrapper">GMT {{timezone}}</div></div>'}}function tpTimeController(e,i){e.options=angular.extend({enabled:!0,timeFormat12hours:!0,minutesStep:15,showTimezone:!0},e.options);var t,n,o,r=i.trc("publisher.dashboard","AM"),s=i.trc("publisher.dashboard","PM");if(e.options.enabled){var u,m=new Date;e.meridiems={},e.meridiems[r]=1,e.meridiems[s]=2;var p,d,a=46,c=8,l=9,v=37,h=38,f=39,w=40,g=16,k=48,y=57,T=96,b=105,M=void 0!==e.hours?e.hours:m.getHours(),H=void 0!==e.minutes?e.minutes:m.getMinutes(),W=e.options.timeFormat12hours?12:24,$=60,C=e.options.minutesStep,N=!1;e.$on("time-updated",function(e,i){M=i.hours,H=i.minutes,F()}),F(),e.onKeyDownHours=function(i){U(i),isNaN(e.viewHours)||""===e.viewHours||(p=e.viewHours);switch(i.keyCode){case h:D();break;case w:K()}},e.onKeyUpHours=function(i){A(i),function(i){var t=I(e.viewHours,p),n=i.which||i.keyCode;e.options.timeFormat12hours&&0===t&&"00"===e.viewHours&&(e.viewHours=W);B("hours",t)&&(e.viewHours=z(t));(t>W||O(p,n))&&(e.viewHours="");t===W&&(e.viewHours=function(i){return i!==W||e.options.timeFormat12hours?i:z(0)}(W))}(i),P(),S(i)},e.onKeyDownMinutes=function(i){U(i),isNaN(e.viewMinutes)||""===e.viewMinutes||(d=e.viewMinutes);switch(i.keyCode){case h:t=I(e.viewMinutes,d),(t+=C||1)>$-1?(D(),e.viewMinutes=z(t-$)):e.viewMinutes=z(t);break;case w:!function(){var i=I(e.viewMinutes,d);(i-=C||1)<0?(K(),e.viewMinutes=z(i+$)):e.viewMinutes=z(i)}()}var t},e.onKeyUpMinutes=function(i){A(i),function(i){var t=parseInt(e.viewMinutes,10),n=i.which||i.keyCode;B("minutes",t)&&(e.viewMinutes=z(t));(t>$||O(d,n))&&(e.viewMinutes="")}(i),P(),S(i)},e.onBlurHours=function(){var i=parseInt(e.viewHours,10),t=e.options.timeFormat12hours?12:23;!isNaN(e.viewHours)&&i>t&&(x(t),e.hours=t)},e.onBlurMinutes=function(){var i=parseInt(e.viewMinutes,10);!isNaN(e.viewHours)&&i>59&&(e.viewMinutes=z(59),e.minutes=59)},e.updateTime=P,e.timezone=(t=m.getTimezoneOffset(),n=Math.abs(t),o=Math.floor(n/$),(t<0?"+":"-")+o)}function F(){x(M),e.viewMinutes=z(H),e.hours=parseInt(M,10),e.minutes=parseInt(H,10)}function x(i){if(e.options.timeFormat12hours){var t=angular.copy(function(i){var t=i,n=e.meridiems[r];i>12&&(t=i-12);i>=12&&(n=e.meridiems[s]);0===i&&(t=12);return[t,n]}(i));e.viewHours=z(t[0]),e.meridiem=t[1]}else e.viewHours=z(i)}function z(e){return 1===e.toString().length?"0"+e:e}function D(){u=I(e.viewHours,p),e.options.timeFormat12hours?(u===W-1&&(e.meridiem=V()),u>=W&&(u=0)):u===W-1&&(u=-1),e.viewHours=z(u+1)}function K(){u=I(e.viewHours,p),e.options.timeFormat12hours?(u===W&&(e.meridiem=V()),u<=1&&(u=W+1)):u<=0&&(u=W),e.viewHours=z(u-1)}function V(){return e.meridiem===e.meridiems[r]?e.meridiems[s]:e.meridiems[r]}function I(e,i){var t=parseInt(e,10);return(isNaN(t)||""===t)&&(t=parseInt(i,10)),t}function S(e){switch(e.which||e.keyCode){case v:case f:e.preventDefault(),e.stopPropagation()}}function A(e){(e.which||e.keyCode)===g&&(N=!1)}function O(e,i){return e<10&&(i===c||i===a)}function B(i,t){return"hours"===i?1===t.toString().length&&(e.options.timeFormat12hours?t>1:t>2||0===t):1===t.toString().length&&t>5}function U(e){var i=e.which||e.keyCode;(i<k&&i!=l&&i!=c&&i!=v&&i!=f&&i!=a||i>y||N&&i!=v&&N&&i!=f)&&!(i>=T&&i<=b)&&e.preventDefault(),i===g&&(N=!0)}function P(){var i=I(e.viewHours,p),t=I(e.viewMinutes,d);e.hours=function(i){var t=i;(e.meridiem===e.meridiems[r]&&i>12||e.meridiem===e.meridiems[r]&&12===i)&&(t=i-12);e.meridiem===e.meridiems[s]&&i<12&&(t=i+12);return t}(i),e.minutes=t}}function tpTimepicker(e,i,t,n){return{scope:{time:"=?",options:"=?"},link:function(o,r,s){function u(){o.$apply(function(){o.closeWidget()})}function m(e){switch(e.keyCode){case 27:o.$apply(function(){o.closeWidget()})}}o.texts={title:n.trc("publisher.dashboard","Set time"),apply:n.trc("publisher.dashboard","Apply"),cancel:n.trc("publisher.dashboard","Cancel")},o.model={openWidget:!1},o.model.openWidget=!1,"undefined"!=typeof moment?o.model.time=moment(o.time).zone(0):o.model.time=o.model.time.utc().valueOf(),o.tpTimeValues={hours:o.model.time.hour(),minutes:o.model.time.minutes()},o.$broadcast("time-updated",o.tpTimeValues),o.showWidget=function(){o.model.openWidget=!o.model.openWidget,o.model.openWidget&&(t(function(){var t=r.find(".tp-timepicker-wrapper"),n=r.find(".tp-timepicker");n.offset().left+n.innerWidth()/2<t.innerWidth()/2?t.offset({left:20}):n.offset().left+t.innerWidth()/2+n.innerWidth()/2>e.innerWidth?t.offset({left:e.innerWidth-t.innerWidth()-20}):t.offset({left:n.offset().left+n.innerWidth()/2-t.innerWidth()/2}),i.bind("click",u),i.bind("keyup",m)},10),o.$broadcast("time-updated",o.tpTimeValues))},o.closeWidget=function(){o.model.openWidget=!1,i.unbind("click",u),i.unbind("keyup",m)},o.setNewTime=function(){o.model.time.hour(o.tpTimeValues.hours),o.model.time.minutes(o.tpTimeValues.minutes),o.time=o.model.time.utc().valueOf(),o.closeWidget(),o.$broadcast("time-updated",o.tpTimeValues)},r.find(".tp-timepicker-wrapper").click(function(e){e.stopPropagation()})},controller:["$scope",function(e){e.tpTimeOptions={showTimezone:!1}}],restrict:"AE",template:'<div class="tp-timepicker">   <div class="tp-timepicker-handler" ng-click="showWidget()">      {{model.time | tpDateMoment:"hh:mm A":0}}   </div>   <div ng-hide="!model.openWidget" class="tp-timepicker-wrapper">       <div class="tp-timepicker-header">{{texts.title}}</div>       <div class="tp-timepicker-body"><tp-time hours="tpTimeValues.hours" minutes="tpTimeValues.minutes" options="tpTimeOptions"></tp-time></div>       <div class="tp-timepicker-footer"><div class="tp-timepicker-footer-btn tp-timepicker-btn-cancel" ng-click="closeWidget()">{{texts.cancel}}</div><div class="tp-timepicker-footer-btn tp-timepicker-btn-apply" ng-click="setNewTime()">{{texts.apply}}</div></div>   </div></div>'}}angular.module("tp.ui.timepicker",[]).directive("tpTime",tpTime).controller("tpTimeController",tpTimeController).directive("tpTimepicker",tpTimepicker),tpTimeController.$inject=["$scope","lang"],tpTimepicker.$inject=["$window","$document","$timeout","lang"];
angular.module('authModule', [])
.factory('auth', [function(){return {}}])
.directive('authComponent', [function(){return {}}])
.directive('authCustomLogin', [function(){return {}}])
.directive('authState', [function(){return {}}])
angular.module('condeProviderModule', [])
.factory('condeProvider', [function(){return {}}])
angular.module("pianoIdProviderModule",["generalModule"]).factory("pianoIdProvider",["$sce","$window","$q","$rootScope","lang","errorService","eventService","ngEventService","userService","containerService","pianoIdSessionsService","pianoIdGmSsoService","gaService",function(e,t,i,n,r,o,s,a,c,d,u,l,m){function g(e){const t=getParameterByName("sss_mode"),i=getParameterByName("sss_callback_url"),n=getParameterByName("sss_origin_url");t&&i&&n&&(e.sss_mode=t,e.sss_callback_url=i,e.sss_origin_url=n)}var f=!1;let p=null,v=null;var w,P,I,b,h,S,_={},C={},k={};function E(e,t){w=t||w;var i=e.find("iframe")[0];i&&s.customPostMessage("lang",{lang:w},I,i.contentWindow)}function y(e,t){if(0!==e.height){var i={height:e.height+"px"},n=t.find("#piano-id-container, iframe");e.animate?n.animate(i,200):n.css(i),d.resize()}}function V(e){var t=e.parent(),i=e.find("iframe"),n={width:t.width(),center:d.getCenterScreen(),originUrl:d.getOriginUrl()};s.customPostMessage("resize",n,I,i[0].contentWindow),s.customPostMessage("consentWithModes",piano.getCookieConsents(),I,i[0].contentWindow),r.on(t=>E(e,t)),E(e)}function N(e,t,i){var n={trackingId:t,formName:i},r={event:e.event,params:$.extend({},e.params,n),iframeId:getParameterByName("iframeId")};s.postMessage("pianoIdEvent",r)}return C.init=function(e){_=e,C.setOrigin(_.pianoIdUrl),k={aid:_.aid,screen:_.screen,checkout:_.checkout,customFormParams:_.customFormParams,isPasswordlessCheckoutEnabled:_.isPasswordlessCheckoutEnabled(),isPreventPasswordlessLogin:_.isPreventPasswordlessLogin,isSingleStepEnabled:_.isSingleStepEnabled(),affiliateIssuerId:_.getAffiliateIssuerId(),userLoginEmail:_.userLoginEmail,passwordlessSetPaymentEmail:_.passwordlessSetPaymentEmail,isDigitalCodeConfirmationEnabled:_.isDigitalCodeConfirmationEnabled,isSentLoginEmail:_.isSentLoginEmail,isSingleStepFormShown:function(){return!!S&&_.isSingleStepFormShown(S)},getUserToken:_.getUserToken,getPageView:_.getPageView,isGmSso:_.isGmSso||!1,socialName:_.socialName||"",abTestIds:_.abTestIds||[],responseType:_.responseType,stage:_.stage,staticDomain:_.staticDomain,sessions:_.sessions,preview:_.preview||!1},l.init(),s.postMessage("pianoIdProviderInitiated")},n.$on("pianoIdGmSsoChanged",function(e,t){k.isGmSso=t}),C.setStage=function(e){p=e},C.getStage=function(){return p},C.setPianoIdIframeId=function(e){b=e},C.getPianoIdIframeId=function(){return b},C.setPreloaderHeight=function(e){v=e},C.getPreloaderHeight=function(){return v},C.setViewCtrl=function(e){S=e},C.getWidgetOptions=function(){return _},C.setOrigin=function(e){var t;I=0===(t=P=e).indexOf("http")?t:document.location.origin||document.location.href},C.register=function(){},C.login=function(){},C.resetPassword=function(){},C.isNewUser=function(){return f},C.setupDoubleOptInParams=function(e,t){return _.getDoubleOptInParams&&_.getDoubleOptInParams().then(function(i){var n=e.find("iframe")[0];if(n){var r={tbc:i.tbc,termId:i.params.termId,showOfferParams:JSON.stringify(i.params),trackingId:i.trackingId};s.customPostMessage("setupDoubleOptInParams",r,t,n.contentWindow)}})},C.authPianoIdController=function(i,n){i.id="piano-id-"+_randomString(5),C.setPianoIdIframeId(i.id);var u=k.customFormParams;(void 0===t.TPParam.config.checkoutCfInRegister||t.TPParam.config.checkoutCfInRegister)&&(i.formName=u().checkoutFormName),O(),i.error_msg=r.trc("checkout.platform","You should sign in or sign up first");var l=a.subscribe(i.id+"-loginSuccess",function(e,t){!function(e,t){var i=t.user||{};i.firstName=i.given_name,i.lastName=i.family_name,i.valid=!0,i.emailConfirmed=!i.email_confirmation_required,i.confirmed=i.emailConfirmed,i.uid=i.sub,f=!!t.registration;var n=d.getOriginUrl();c.checkUser({aid:e,url:n,userToken:t.token,fromUserIdentity:!0}).then(function(e){return(h=e.models.user.displayName)&&(i.displayName=h,t.user.displayName=h),i.emailState=e.models.user.emailState,e.models.token_list}).catch(function(){return null}).then(function(e){c.onExternalLogin({token_list:e,cookie_domain:t.cookie_domain,user_token:t.token,params:t.user,user:i,registration:f,extendExpiredAccessEnabled:t.extendExpiredAccessEnabled,stage:t.stage})})}(k.aid,t)}),p=a.subscribe(i.id+"-resize",function(e,t){y(t,n)}),v=a.subscribe(i.id+"-customEvent",function(e,t){s.customEvent("customEvent",t),m.sendCustomEvent(t)}),b=a.subscribe(i.id+"-loginResponse",function(e,t){a.fire("pianoIdSingleStepLoginResponse",t)}),S=a.subscribe("submitPianoIdLoginForm",function(){var e=n.find("iframe");s.customPostMessage("submitLoginForm",null,I,e[0].contentWindow)}),E=a.subscribe("updatePianoIdAuthIframeUrl",function(){O()}),T=a.subscribe(i.id+"-loaded",function(e,t){V(n),C.setupDoubleOptInParams(n,I)}),U=a.subscribe(i.id+"-pianoIdEvent",function(e,t){"passwordlessEmailSent"===t.event&&_.passwordlessEmailSentHandler(t.params.loginTokenId),"successDOI"===t.event&&(c.getConfig().user.emailConfirmed=!0),N(t,"function"==typeof k.getPageView&&k.getPageView().trackingId,t.params.formName)}),D={preventExternalLogin:!0};function O(){var n=function(e,n){var r=d.rootElement.width();const o="function"==typeof k.getPageView?k.getPageView():{};var s={aid:k.aid,checkout:k.checkout,template:k.template,sender:n,origin:document.location.origin||document.location.href,width:r,lang:w||t.TPParam.params.lang||"",stage:C.getStage()||k.affiliateIssuerId||k.stage,site:t.TPParam.params.url,screen:c.isUserValid()&&!c.isEmailConfirmed()?"email_is_not_confirmed":k.isSentLoginEmail()?k.isDigitalCodeConfirmationEnabled()?"digital_code":"passwordless_confirmation":k.isPasswordlessCheckoutEnabled?"login":k.screen||"register",create_passwordless_user:k.isPasswordlessCheckoutEnabled&&!k.isPreventPasswordlessLogin(),single_step:k.isSingleStepFormShown(),display_mode:"inline",tbc:o.tbc,page_view_id:o.pageViewId,browser_id:o.browserId,user_state:o.userState,tracking_id:o.trackingId,content_type:piano.getPageViewContext().content_type,page_title:o.pageTitle};return k.staticDomain&&(s.static_domain=k.staticDomain),C.getPreloaderHeight()&&(s.preloader_height=C.getPreloaderHeight()),i.formName?s.form_name=i.formName:k.userLoginEmail()&&(s.email=k.userLoginEmail()),g(s),[e,$.param(s)].join("?")}(k.isGmSso?P+"gm-sso":P,i.id);i.url=e.trustAsResourceUrl(n)}c.getConfig().fillLoginRequiredEventParams(D),s.loginRequiredEvent(D),m.sendLoginRequiredEvent(D),i.unsubscribeNgEventService=function(){l(),p(),v(),b(),S(),E(),T(),U(),o(i).reset()}},C.authPianoIdSocialController=function(e,t){var i=a.subscribe(C.getPianoIdIframeId()+"-pianoIdEvent",function(t,i){i.event&&"changeScreen"===i.event&&i.params&&"register_confirm"===i.params.screen&&(e.showRegisterConfirm=!0),N(i,"function"==typeof k.getPageView&&k.getPageView().trackingId,i.params.formName)});function n(){const t="function"==typeof k.getPageView?k.getPageView():{};var i={client_id:k.aid,content_type:piano.getPageViewContext().content_type,tbc:t.tbc,page_view_id:t.pageViewId,browser_id:t.browserId,user_state:t.userState,tracking_id:t.trackingId,lang:w||""};return"openpass"===(k.socialName||e.socialName).toLowerCase()&&(i.screen="openpass_placeholder"),[P,$.param(i,!0)].join("?")}e.$parent.authBySocial=function(){if(!(k.socialName||e.socialName)||!e.authIsExist())return;const t=function(t){var i={client_id:k.aid,back_url:n(),redirect_uri:TPParam.params.url,social_type:k.socialName||e.socialName,response_type:k.responseType||e.responseType||"code",ab_test_ids:k.abTestIds||[],stage:C.getStage()||k.affiliateIssuerId,affiliate:!0};k.template&&(i.template=k.template);return[t,$.param(i,!0)].join("?")}(P+"api/v1/identity/login/social"),i="function"==typeof k.getPageView&&k.getPageView().trackingId;s.postMessage("pianoIdEvent",{event:"redirect",iframeId:getParameterByName("iframeId"),params:{trackingId:i,url:t}})},e.unsubscribeNgEventService=function(){i()}},C.executeCallbackOnSuccessDOI=function(e){var t=a.subscribe("successDOI",function(){e(),t()})},C.formPianoIdController=function(t,n){var r,o=i.defer(),c=!1;t.isFormHidden=!0,t.id="piano-id-"+_randomString(5);var u=k.customFormParams;t.formName=u().checkoutFormName,t.hideIfComplete=u().hideCompletedFields;var l=function(e,i){var n=d.rootElement.width();const r="function"==typeof k.getPageView?k.getPageView():{};var o={form_name:t.formName,hide_if_complete:t.hideIfComplete,aid:k.aid,checkout:k.checkout,sender:i,origin:document.location.origin||document.location.href,width:n,lang:w||"",stage:C.getStage()||k.affiliateIssuerId||k.stage,access_token:k.getUserToken(),passwordless:k.isPasswordlessCheckoutEnabled,tbc:r.tbc,tracking_id:r.trackingId,page_view_id:r.pageViewId,browser_id:r.browserId,user_state:r.userState,content_type:piano.getPageViewContext().content_type,page_title:r.pageTitle};k.staticDomain&&(o.static_domain=k.staticDomain);C.getPreloaderHeight()&&(o.preloader_height=C.getPreloaderHeight());return[e,$.param(o)].join("?")}(P+"form",t.id),m=a.subscribe(t.id+"-profileUpdated",function(e,t){c=!0,r&&r.resolve(!0)}),g=a.subscribe(t.id+"-change",function(e,t){c=!1}),f=a.subscribe(t.id+"-profileUpdatedError",function(e,t){c=!1,r&&r.resolve(!1)}),p=a.subscribe(t.id+"-pianoIdEvent",function(e,i){"cfFormImpression"===i.event&&t.$apply(function(){t.isFormHidden=!1}),N(i,"function"==typeof k.getPageView&&k.getPageView().trackingId,i.params.formName)}),v=a.subscribe(t.id+"-resize",function(e,t){y(t,n)}),b=a.subscribe(t.id+"-loaded",function(e,t){V(n),o.resolve()}),h=a.subscribe(t.id+"-stateReady",function(e,t){var i=n.find("iframe");s.customPostMessage("setToken",k.getUserToken(),I,i[0].contentWindow)});t.url=e.trustAsResourceUrl(l),t._isValid=function(){return o.promise.then(function(){if(t.isFullFilled||c)return!0;var e=n.find("iframe");return c||(r=i.defer(),s.customPostMessage("submit",{},I,e[0].contentWindow)),r.promise})},t.unsubscribeNgEventService=function(){m(),g(),f(),p(),v(),b(),h()}},C.sessionsController=function(i,n){i.id="piano-id-"+_randomString(5),i.getPianoIdSessionsUrl=function(){const n=function(e,i){const n=d.rootElement.width(),r="function"==typeof k.getPageView?k.getPageView():{},o={aid:k.aid,checkout:k.checkout,preview:k.preview||!1,sender:i,origin:document.location.origin||document.location.href,width:n,lang:w||t.TPParam.params.lang||"",stage:C.getStage()||k.affiliateIssuerId||k.stage,site:t.TPParam.params.url,display_mode:"inline",tbc:r.tbc,page_view_id:r.pageViewId,browser_id:r.browserId,user_state:r.userState,tracking_id:r.trackingId,content_type:piano.getPageViewContext().content_type,page_title:r.pageTitle,device_id:r.deviceId,access_token:k.getUserToken()};k.staticDomain&&(o.static_domain=k.staticDomain);C.getPreloaderHeight()&&(o.preloader_height=C.getPreloaderHeight());k.sessions&&(o.session_limit=k.sessions.session_limit);return[e,$.param(o)].join("?")}(P+"sessions",i.id);return e.trustAsResourceUrl(n)};const r=a.subscribe(i.id+"-resize",function(e,t){y(t,n)}),o=a.subscribe(i.id+"-loaded",function(e,t){V(n)});var c=a.subscribe(i.id+"-stateReady",function(e,t){const i=n.find("iframe");s.customPostMessage("setToken",{token:k.getUserToken()},I,i[0].contentWindow)}),l=a.subscribe("EVENT_CHECKOUT_RELOADED",function(){f()}),m=a.subscribe("EVENT_TEMPLATE_RELOADED",function(){f()}),g=a.subscribe(i.id+"-pianoIdEvent",function(e,t){if("terminateSessionInitiated"===t.event){const e=n.find("iframe");return u.storeState({iframeOrigin:I,iframe:e,params:t.params,id:i.id}),void a.fire("terminateSessionInitiated")}if("sessionsUpdated"===t.event)return void a.fire("sessionsUpdated",t.params);N(t,"function"==typeof k.getPageView&&k.getPageView().trackingId)}),f=function(){const e=n.find("iframe");k.getUserToken()&&s.customPostMessage("setToken",{token:k.getUserToken()},I,e[0].contentWindow)};i.unsubscribeNgEventService=function(){g(),r(),o(),c(),l(),m()}},C.terminateSessionsController=function(e,t){var i;e.disabledButton=!1,e.state=u.getState();var n=e.$watch(function(){return u.getState()},function(t,n){t&&function(t){e.state=t,i&&i();i=a.subscribe(e.state.id+"-pianoIdEvent",c)}(t)});function c(t,i){switch(i.event){case"terminateSessionCompleted":o(e).reset(),a.fire("terminateSessionCompleted",i.params),e.disabledButton=!1;break;case"terminateSessionFailed":const t=r.trc("checkout.platform","Selected session(s) could not be terminated.");o(e).global(t),e.disabledButton=!1}}e.cancelTerminateSessions=function(){a.fire("terminateSessionCanceled"),o(e).reset()},e.terminateSessions=function(){e.disabledButton=!0,o(e).reset(),s.customPostMessage("terminateSessionConfirmed",{timeStamp:e.state.params.timeStamp},e.state.iframeOrigin,e.state.iframe[0].contentWindow)},e.unsubscribeNgEventService=function(){i&&i(),n(),u.clearState()}},C.emailConfirmationRequiredController=function(i,n){var r;i.id="piano-id-"+_randomString(5),r=function(e,i){var n=d.rootElement.width();const r="function"==typeof k.getPageView?k.getPageView():{};var o={aid:k.aid,sender:i,origin:document.location.origin||document.location.href,site:t.TPParam.params.url,screen:"email_confirmation_required",checkout:k.checkout,width:n,lang:w||"",passwordless:k.isPasswordlessCheckoutEnabled,stage:C.getStage()||k.affiliateIssuerId||k.stage,access_token:k.getUserToken(),tbc:r.tbc,page_view_id:r.pageViewId,tracking_id:r.trackingId,browser_id:r.browserId,user_state:r.userState,content_type:piano.getPageViewContext().content_type,page_title:r.pageTitle};g(o),k.staticDomain&&(o.static_domain=k.staticDomain);C.getPreloaderHeight()&&(o.preloader_height=C.getPreloaderHeight());k.userLoginEmail()&&!c.isEmailConfirmed()&&(o.email=k.userLoginEmail());return[e,$.param(o)].join("?")}(P,i.id),i.url=e.trustAsResourceUrl(r);k.customFormParams;var o=a.subscribe(i.id+"-resize",function(e,t){y(t,n)}),s=a.subscribe(i.id+"-loaded",function(){V(n),C.setupDoubleOptInParams(n,I)}),u=a.subscribe(i.id+"-pianoIdEvent",function(e,t){N(t,"function"==typeof k.getPageView&&k.getPageView().trackingId)});i.$on("$destroy",function(){o(),s(),u()})},C.extendUserByCheckoutParams=function(e){angular.extend(e,{displayName:h})},C}]).factory("pianoIdSessionsService",function(){var e={state:void 0,storeState:function(t){e.state=t},getState:function(){return e.state},clearState:function(){e.state=void 0}};return e}).factory("pianoIdGmSsoService",["$rootScope","ngEventService",function(e,t){var i,n={},r=!1;function o(t,i){i&&null!==i.isGmSso&&void 0!==i.isGmSso&&(r=i.isGmSso,e.$broadcast("pianoIdGmSsoChanged",r))}return n.init=function(){i||(i=t.subscribe("setupPianoIdGmSso",o))},n.destroy=function(){i&&(i(),i=null)},e.$on("$destroy",function(){n.destroy()}),n}]).directive("pianoId",["userService","pianoIdProvider","$injector","$window",function(e,t,i,n){return{restrict:"EA",require:"?^view",template:'<div id="piano-id-container">  <auth-piano-id ng-if="authIsExist()"></auth-piano-id>  <form-piano-id ng-if="formIsExist()"></form-piano-id></div>',link:function(r,o,s,a){var c;let d=!!s.stage,u=null;try{c=i.get("viewService")}catch(e){}r.formIsExist=function(){const i=!t.isNewUser(),r=!(void 0===n.TPParam.config.checkoutCfInRegister||n.TPParam.config.checkoutCfInRegister)||i;return e.isUserValid()&&r&&t.getWidgetOptions().widgetSpecificCheckIfVisible()},r.authIsExist=function(){return(!a||c.isActive(a.stateName))&&!(e.isUserValid()&&e.isUserUnrestricted())&&(!d||d&&u)},r.isUserValid=e.isUserValid,t.setPreloaderHeight(s.preloaderHeight),d&&r.$watch(s.stage,function(e){u=e,t.setStage(u)})}}}]).directive("emailConfirmationRequired",["pianoIdProvider","$injector",function(e,t){return{restrict:"EA",scope:{},require:"^view",template:'<iframe id="{{id}}" ng-src="{{url}}" style="width:100%;"></iframe>',link:function(i,n,r,o){var s;try{s=t.get("viewService")}catch(e){}s.isActive(o.stateName)?(o&&e.setViewCtrl(o),e.emailConfirmationRequiredController(i,n)):n.remove()}}}]).directive("authPianoId",["pianoIdProvider","errorService",function(e,t){return{restrict:"EA",scope:{},require:"?^view",template:'<iframe id="{{id}}" ng-src="{{url}}" style="width:100%;"></iframe>',link:function(i,n,r,o){var s=e.getWidgetOptions();o&&(e.setViewCtrl(o),"auth"!==o.stateName&&(o.registerComponentController(i,{passwordlessLoginForm:s.isPasswordlessCheckoutEnabled}),i._isValid=function(){return t(i).reset(),!!s.isSingleStepEnabled()||(t(i).global(i.error_msg),!1)},i.$on("$destroy",function(){o.unregisterComponentController(i)}))),e.authPianoIdController(i,n)}}}]).directive("formPianoId",["pianoIdProvider",function(e){return{restrict:"EA",require:"?^view",scope:{},template:'<iframe ng-hide="isFormHidden" id="{{id}}" ng-src="{{url}}" style="width:100%;"></iframe>',link:function(t,i,n,r){if(r){if(e.setViewCtrl(r),"auth"===r.stateName)return void i.remove();r.registerComponentController(t)}t.$on("$destroy",function(){t.isFullFilled=!0,r&&r&&r.unregisterComponentController(t)}),e.formPianoIdController(t,i)}}}]).directive("pianoIdSocialAuth",["userService","pianoIdProvider","$injector",function(e,t,i){return{restrict:"EA",scope:{},require:"?^view",transclude:!0,template:'<div ng-if="!showRegisterConfirm" ng-transclude></div><div ng-hide="!showRegisterConfirm" class="pn-boilerplate__piano-id-container"><auth-piano-id></auth-piano-id></div>',link:function(n,r,o,s){var a;n.socialName=o.socialName,n.responseType=o.responseType,n.showRegisterConfirm=!1;try{a=i.get("viewService")}catch(e){}o.stage&&(t.setStage(o.stage),n.$watch(o.stage,function(e){e&&t.setStage(o.stage)})),o.preloaderHeight&&t.setPreloaderHeight(o.preloaderHeight),n.authIsExist=function(){return(!s||a&&a.isActive(s.stateName))&&!(e.isUserValid()&&e.isUserUnrestricted())},s&&(t.setViewCtrl(s),s.registerComponentController(n),n.$on("$destroy",function(){s.unregisterComponentController(n)})),t.authPianoIdSocialController(n,r)}}}]).directive("pianoIdSessions",["pianoIdProvider",function(e){return{restrict:"EA",scope:{},require:"?^view",template:'<iframe id="{{id}}" ng-src="{{getPianoIdSessionsUrl()}}" style="width:100%;"></iframe>',link:function(t,i,n,r){r&&(e.setViewCtrl(r),r.registerComponentController(t)),t.$on("$destroy",function(){r&&r&&r.unregisterComponentController(t)}),e.sessionsController(t,i)}}}]).directive("pianoIdTerminateSessionConfirmation",["pianoIdProvider",function(e){return{restrict:"EA",transclude:!0,require:"?^view",replace:!0,template:"<div ng-transclude></div>",link:function(t,i,n,r){r&&(e.setViewCtrl(r),r.registerComponentController(t)),t.$on("$destroy",function(){r&&r&&r.unregisterComponentController(t)}),e.terminateSessionsController(t,i)}}}]);
"use strict";angular.module("creditRedemptionModule",["generalModule"]).factory("creditRedemptionService",["eventService","userService",function(e,t){const i={affiliateState:{}};function n(){return i.affiliateState&&i.affiliateState.creditStates&&i.affiliateState.creditStates.length>0?i.affiliateState.creditStates[0]:null}return i.setAffiliateState=function(e){i.affiliateState=e},i.credits=function(){const e=n();return e?e.total-e.spent:0},i.creditsTotal=function(){const e=n();return e?e.total:0},i.creditExpirationTime=function(){const e=n();let t=null,i=new Date;return e&&(t=function(e){let t=null;return e&&e.length?(e.forEach(function(e){(!t||t.exp>e.exp)&&(t=e)}),t):t}(e.redeemedItems)),t&&t.exp&&(i=new Date(1e3*t.exp)),i},i.redeemCredit=function(){const t=n();t&&e.postMessage("redeemCredit",{cid:t.cid,itemId:i.affiliateState.redemptionCandidateItemId,newRedemptionMethod:i.redemptionMethod()})},i.toggleRedemptionMethod=function(){const e=n();e&&(e.redemptionMethod="A"===e.redemptionMethod?"M":"A")},i.redemptionMethod=function(){const e=n();return e?e.redemptionMethod:null},i.setupScope=function(e){e.affiliateState=i.affiliateState,e.credits=i.credits,e.creditsTotal=i.creditsTotal,e.creditExpirationTime=i.creditExpirationTime,e.redeemCredit=i.redeemCredit,e.toggleRedemptionMethod=i.toggleRedemptionMethod,e.redemptionMethod=i.redemptionMethod},i}]);
angular.module('datesModule', [])
.service('dateUtils', [function(){return {}}])
angular.module('country.selector', [])
.directive('dynamicHtml', [function(){return {}}])
.directive('tpCallingCodeSelector', [function(){return {}}])
.directive('tpCountrySelector', [function(){return {}}])
.factory('CountrySelectorCtrl', [function(){return {}}])
.directive('tpStateSelector', [function(){return {}}])
.factory('StateSelectorCtrl', [function(){return {}}])
angular.module('billing.address', [])
.directive('billingAddressComponent', [function(){return {}}])
var passwordless=angular.module("passwordlessModule",["checkoutModule"]);passwordless.factory("passwordlessService",["tpHTTP","ngEventService","viewService","containerService","userService","eventService","$q","errorService","$rootScope","lang","$window","checkoutGoTo",function(e,t,n,o,r,a,s,i,c,p,l,d){var u,m,f={email:"",error:""};function g(e,n){i(c).reset(),m.config.isSentLoginEmail=!1,m.config.preventPasswordlessLogin=!1,t.fire("submitPianoIdLoginForm");var o=t.subscribe("pianoIdSingleStepLoginResponse",function(t,r){switch(o(),r.type){case"success":return;case"userWithPassword":i(c).global(p.tr("Enter your password, please"));break;case"passwordlessConfirmationRequested":m.config.isSentLoginEmail=!0,m.config.preventPasswordlessLogin=!0,m.config.isDigitalCodeConfirmationEnabled=r.isDigitalCodeConfirmationEnabled,y(m,r.email),d.gotoAuthState(e)}n.reject()})}function h(l){if(0===f.email.length)return i(c).global(p.trc("checkout.platform","Email format is not valid")),l.reject(),l.promise;var d=t.subscribe("gigyaHide",function(e,t){d(),t.afterLogin||l.reject()});m.getDoubleOptInParams().then(function(e){return{tbc:e.tbc,pageViewId:e.pageViewId,termId:e.params.termId,showOfferParams:JSON.stringify(e.params),trackingId:e.trackingId,url:o.getOriginUrl()}}).then(function(t){return function(t){var o={aid:TPParam.params.aid,email:f.email,"g-recaptcha-response":u};return Object.assign(o,t),f.error="",e.post(TPParam.LOGIN_PASSWORDLESS_USER,o).then(function(e){var t,o=e.models.user||{};"auth"===n.getActiveState()&&n.viewStack.pop(),o.userExist?(t=o.sentLoginEmail,m.config.isExistPasswordlessUser=!0,r.isPianoIdUserProvider()?m.config.isSentLoginEmail=t:r.isGigyaUserProvider()?(r.onLoginSuccess(function(){P()},!0),r.login()):util.log("[PASSWORDLESS] Unsupported user provider")):function(e){if(r.isPianoIdUserProvider()){var t={};Object.assign(t,e.userModel,{rememberMe:!1}),r.onExternalLogin({token_list:e.tokenList,cookie_domain:e.cookieDomain,user_token:e.accessToken,user:t,params:t,registration:!0}).then(function(){P()})}else r.isGigyaUserProvider()?(r.onLoginSuccess(function(){P()},!0),a.gigyaPasswordlessLoginEvent({accessTokenName:e.accessToken,accessToken:e.accessToken})):util.log("[PASSWORDLESS] Unsupported user provider")}(o)}).catch(function(e){return f.error=e&&e.errors&&e.errors.length&&e.errors[0].msg,"auth"!==n.getActiveState()&&i(c).global(f.error),s.reject(f.error)})}(t)}).catch(function(){l.reject()})}function P(){m.reload()}function y(e,t){e.config.userLoginEmail=t||""}return{data:f,onCaptchaResolve:function(e){u=e},onCaptchaReady:function(e){e},loginUser:function(e){m=e;var t=s.defer(),o=r.isGigyaUserProvider()&&m.isPasswordlessCheckoutEnabled()&&!r.isUserValid(),a=r.isPianoIdUserProvider()&&m.isSingleStepEnabled()&&!r.isUserValid();return(o||a)&&n.isPasswordlessFormState(n.getActiveState())?(function(e){m.onUserChanged().then(function(t){t&&e.resolve({isPasswordlessLogin:!0})})}(t),function(e,t,n,o){n?g(e,t):o&&h(t)}(e,t,a,o)):t.resolve({isPasswordlessLogin:!1}),t.promise},saveCheckoutParams:function(t,n){t.getDoubleOptInParams().then(function(o){o.paymentMethodNonce=t.input.paymentMethodNonce||"",o.paymentMethodInstrumentId=t.input.paymentMethodInstrumentId||"",function(t,n,o){var r={loginTokenId:t,oid:n.params.oid,termId:n.params.termId,tbc:n.tbc,nonce:n.paymentMethodNonce,instrumentId:n.paymentMethodInstrumentId,showOfferParams:JSON.stringify(n.params)};(function(e,t){e.input&&"boolean"==typeof e.input.areTaxesCalculated&&(t.areTaxesCalculated=e.input.areTaxesCalculated)})(o,r),function(e,t){"boolean"==typeof t.areTaxesCalculated?t.autoComplete=!(!e.paymentMethodNonce&&!e.paymentMethodInstrumentId&&t.areTaxesCalculated):t.autoComplete=!(!e.paymentMethodNonce&&!e.paymentMethodInstrumentId)}(n,r),e({method:"post",url:l.TPParam.SAVE_CHECKOUT_PARAMS,data:r})}(n,o,t)}).catch(function(e){console.error(e)})},updatePianoIdIframe:function(){t.fire("updatePianoIdAuthIframeUrl")},setPaymentEmail:y}}]),passwordless.directive("passwordlessSingleStepCaptcha",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/passwordless-single-step-captcha.html",scope:{},controller:["$scope","passwordlessService","checkout","userService",function(e,t,n,o){angular.extend(e,BaseComponentController),e.data=t.data,e.recaptchaKey=TPParam.RECAPTCHA_SITE_KEY,e.onCaptchaResolve=t.onCaptchaResolve,e.onCaptchaReady=t.onCaptchaReady,e.isCaptchaVerificationRequired=function(){return n.isSingleStepEnabled()&&n.config.passwordlessCaptchaEnabled&&!o.isUserValid()}}],link:function(e,t,n,o){o.registerComponentController(e),o.extendScope(e),t.on("$destroy",function(){o.unregisterComponentController(e)})}}}),passwordless.directive("passwordlessLogin",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/passwordless-login.html",scope:{},controller:["$scope","passwordlessService","checkout","viewService",function(e,t,n,o){angular.extend(e,BaseComponentController),e.data=t.data,e.recaptchaKey=TPParam.RECAPTCHA_SITE_KEY,e.onCaptchaResolve=t.onCaptchaResolve,e.onCaptchaReady=t.onCaptchaReady,e.isSingleStepEnabled=function(){return n.isSingleStepEnabled()&&"auth"!==o.getActiveState()},e.loginUser=function(){return n.passwordlessServiceLogin()}}],link:function(e,t,n,o){o.registerComponentController(e,{passwordlessLoginForm:!0}),o.extendScope(e)}}}),passwordless.directive("passwordlessPaymentMethods",function(){return{restrict:"A",template:'<div ng-if="isUsedForTerm(paymentMethodIds.applePayBt)" class="pn-passwordless-offer-boilerplate__applepay-btn" apple-pay-through-braintree-form-component term-id="{{termId}}"></div>\n<new-flow-components-c-h ng-if="isUsedForTerm(paymentMethodIds.applePayStripe)" payment-source="paymentMethodIds.applePayStripe" term-id="{{termId}}" class="pn-passwordless-offer--applepay-button-container"></new-flow-components-c-h>\n<new-flow-components-c-h ng-if="isUsedForTerm(paymentMethodIds.applePayPayWay)" payment-source="paymentMethodIds.applePayPayWay" term-id="{{termId}}" class="pn-passwordless-offer--applepay-button-container"></new-flow-components-c-h>',scope:{termId:"@"},controller:["$scope","checkout",function(e,t){e.paymentMethodIds={applePayBt:APPLE_PAY_BT,applePayStripe:STRIPE_APPLEPAY,applePayPayWay:PAYWAY_APPLEPAY};var n,o=(n=t._findTerm(e.termId),(n.isSubscription?n.subscriptionPaymentMethods:n.oneOffPaymentMethods)||[]).find(function(e){return"apple_pay"===e.paymentTypeId});e.isUsedForTerm=function(e){return o&&o.id===e}}]}});
var billingConfigModule=angular.module("billingConfigModule",["checkoutModule"]);billingConfigModule.factory("billingConfig",["ngEventService","utilsService","lang","checkoutService",function(e,n,i,o){var t={countryCode:window.TPParam.GEO_COUNTRY_CODE,zipCode:window.TPParam.GEO_COUNTRY_POSTAL_CODE,billingAddressPrefilled:!1,needResidence:!1,sameResidence:!0,postalCodeError:!1,countrySelectorError:!1,billingAddress:{region:{},country:{}},savedBillingAddress:{region:{},country:{}},residenceCountryCode:null,vatLabel:i.tr("VAT"),taxIncludeBilling:!0,showVAT:!1,geoCountryCode:window.TPParam.GEO_COUNTRY_CODE,geoZipCode:window.TPParam.GEO_COUNTRY_POSTAL_CODE,renewBillingCountryCode:null,renewBillingZipCode:null,renewResidenceCountryCode:null,countryTaxSupport:window.TPParam.GEO_COUNTRY_TAX_SUPPORT,taxCountries:[],updateFromTaxRequest:function(n,i){if(n.isRefreshBillingInfoNeeded())return i?(t.countryCode=i.billingCountryCode,t.residenceCountryCode=i.residenceCountryCode,t.zipCode=i.residenceZipCode?i.residenceZipCode:i.billingZipCode,n.isAvalaraTaxEnabled()&&(t.updateByCountryCode(n,t.countryCode),n.input.credit_card.billingAddress&&(t.billingAddress=n.input.credit_card.billingAddress,t.savedBillingAddress=angular.copy(n.input.credit_card.billingAddress),t.billingAddressPrefilled=!0)),t.taxRequest=i,void e.fire("EVENT_BILLING_FROM_TAX_REQUEST")):void(t.taxRequest=null)},updateByCountryCode:function(e,i){var o=n.find(t.taxCountries,function(e){return e.countryCode===i});o&&(t.requiredZipCode=o.requireZipCode,t.vatLabel=o.vatLabel,t.needResidence=o.needResidence,t.taxIncludeBilling=o.taxIncludeBilling,t.countryCode=i,t.countryTaxSupport=o.taxSupport)},taxRequestFromUpi:function(e){var n=null;return e.tax_request&&(n=JSON.parse(e.tax_request)),n},loadTaxCountries:function(e){return o.getTaxCountries(e).then(function(i){return angular.copy(i.models.taxCountries,t.taxCountries),n.contains(e.config.taxSupports,"onesource.tax.us")&&t.updateByCountryCode(e,"US"),t.taxCountries})}};return t}]),billingConfigModule.factory("taxZipCodeVisibility",["ngEventService",function(e){var n;return e.subscribe("EVENT_TAX_ZIP_CODE_VISIBILITY_CHANGE",function(e,n){i(n)}),{subscribe:function(e){return n=e,o},notify:i};function i(e){n&&n(e)}function o(){n=null}}]),billingConfigModule.directive("billingCountry",["checkout",function(e){e.flags.pnWidgetEnabled;const n={restrict:"A",require:"^view",replace:!0,templateUrl:"/widget/checkout/component/partials/billing-country-component.html",link:function(e,n,i,o){o.registerComponentController(e),o.extendScope(e),n.on("$destroy",function(){o.unregisterComponentController(e)})},controller:["$scope","$q","$sce","$timeout","ngEventService","utilsService","billingConfig","taxZipCodeVisibility",function(n,i,o,t,r,d,l,c){var u=!1,s=null,a=!1,C=!1,p="Countries",g=!1;function E(){R(!0)}angular.extend(n,BaseComponentController),l.loadTaxCountries(e).then(function(){T(),t(function(){u=!0})}),n.selectorOptions={selectorModel:{label:"",item:{}},items:{}},n.residenceOptions=angular.copy(n.selectorOptions),n.onZipCodeChanged=E,n.isAvalaraBillingAddressShown=function(){return n.isAvalaraTaxEnabled()&&n.isBillingAddressAvailableForSelectedCountry()&&e.input.billingAddressConfig},n.onBillingCountryChange=function(){u&&l.sameResidence&&(l.zipCode="")},n.onResidenceCountryChange=function(){};var y=c.subscribe(function(n){l.isDuplicateZipCodeHidden=e.config.isTaxZipCodeHidden&&n,v()});r.subscribe(EVENT_CC_ZIP_CODE_CHANGED,function(e,n){l.isDuplicateZipCodeHidden&&(l.zipCode=n.zipCode,E())}),r.subscribe("EVENT_BILLING_CONFIG_ZIP_CODE_CHANGE",function(){E()}),n.onChangeSameResidence=function(){!function(e){l.zipCode="",l.sameResidence&&(l.residenceCountryCode="",l.residenceRequireZipCode=!1,n.residenceOptions.selectorModel.label="",n.residenceOptions.selectorModel.item={});R(e)}(!1),r.fire("EVENT_SAME_RESIDENCE_CHECKBOX_CHANGED")},n.$watch("selectorOptions.selectorModel",function(e){var n=e.item?e.item.countryCode:null;l.countrySelectorError=!1,m(),r.fire("EVENT_COUNTRY_OF_RESIDENCE_SELECTED",n)}),n.$watch("residenceOptions.selectorModel",function(){!function(e){var i=n.residenceOptions.selectorModel.item;l.residenceCountryCode=i.countryCode,l.residenceRequireZipCode=i.requireZipCode&&!l.isDuplicateZipCodeHidden,l.residenceCountryCode&&(l.taxIncludeBilling=i.taxIncludeBilling,l.vatLabel=i.vatLabel);R(e)}(),r.fire("EVENT_BILLING_COUNTRY_SELECTED")}),n._isValid=function(){return!0};var f=r.subscribe("EVENT_BILLING_FROM_TAX_REQUEST",function(){e.isBillingCountryEnabled()&&(g=!0,T(),t(m,0))}),_=r.subscribe("EVENT_BILLING_COUNTRY_SELECTED",function(){l.countrySelectorError=!1,T()}),b=r.subscribe("EVENT_CHECKOUT_RELOADED",function(){e.isBillingCountryEnabled()&&T()}),O=r.subscribe("EVENT_USER_ACCESS_CHANGED",function(){e.isBillingCountryEnabled()&&T()});function v(){l.requiredZipCodeAndNotHidden=l.requiredZipCode&&!l.isDuplicateZipCodeHidden}function T(e){var i;n.selectorOptions.items=x(l.taxCountries,p);var o=l.countryCode||l.geoCountryCode;i=e&&l.countryCode===l.geoCountryCode&&l.renewBillingCountryCode?l.renewBillingCountryCode:n.selectorOptions.selectorModel.item.countryCode===o?n.selectorOptions.selectorModel.item.countryCode:l.countryCode||l.geoCountryCode;var t=d.find(n.selectorOptions.items,function(e){return e.countryCode===i});void 0!==t&&(n.selectorOptions.selectorModel.label=t.name,n.selectorOptions.selectorModel.item=t,l.requiredZipCode=t.requireZipCode,l.vatLabel=t.vatLabel,l.needResidence=t.needResidence,l.taxIncludeBilling=t.taxIncludeBilling,l.countryCode=i,l.countryTaxSupport=t.taxSupport,v()),e&&l.requiredZipCode&&l.zipCode===l.geoZipCode&&l.renewBillingZipCode&&(l.zipCode=l.renewBillingZipCode);var r,c=null;n.selectorOptions.selectorModel.item.countryCode&&(c=n.selectorOptions.selectorModel.item),n.residenceOptions.items=x(l.taxCountries,p,c),r=e&&l.renewResidenceCountryCode?l.renewResidenceCountryCode:!g||l.taxRequest&&l.taxRequest.residenceCountryCode?l.residenceCountryCode:null;var u=d.find(n.residenceOptions.items,function(e){return e.countryCode===r});void 0!==u&&(n.residenceOptions.selectorModel.label=u.name,n.residenceOptions.selectorModel.item=u,l.residenceCountryCode=r,l.residenceRequireZipCode=u.requireZipCode&&!l.isDuplicateZipCodeHidden,l.sameResidence=!l.residenceCountryCode||l.countryCode===l.residenceCountryCode,l.sameResidence||(l.taxIncludeBilling=u.taxIncludeBilling,l.vatLabel=u.vatLabel))}function m(e){var i,o;n.selectorOptions.selectorModel&&n.selectorOptions.selectorModel.item&&(i=n.selectorOptions.selectorModel.item).countryCode&&(l.countryCode=i.countryCode,l.countryTaxSupport=i.taxSupport,l.requiredZipCode=i.requireZipCode,l.vatLabel=i.vatLabel,l.needResidence=i.needResidence,l.taxIncludeBilling=i.taxIncludeBilling,v()),n.residenceOptions.selectorModel&&n.residenceOptions.selectorModel.item&&(o=n.residenceOptions.selectorModel.item,(i&&i.countryCode===o.countryCode||!l.needResidence||g&&(!l.taxRequest||!l.taxRequest.residenceCountryCode))&&(l.sameResidence=!0)),l.sameResidence?(l.residenceCountryCode="",l.residenceRequireZipCode=!1,n.residenceOptions.selectorModel.label="",n.residenceOptions.selectorModel.item={}):n.residenceOptions.selectorModel&&n.residenceOptions.selectorModel.item&&(o=n.residenceOptions.selectorModel.item,l.residenceCountryCode=o.countryCode,l.residenceRequireZipCode=o.requireZipCode&&!l.isDuplicateZipCodeHidden,l.residenceCountryCode&&(l.taxIncludeBilling=o.taxIncludeBilling,l.vatLabel=o.vatLabel)),R(e)}function R(i){function o(){r.fire("PAYMENT_BILLING_PLAN_TABLE_UPDATE"),s=t(function(){n._isValid()&&(i&&(tinypass.withoutWaitPanel=!0),a=!0,e.reload(void 0,!0).then(function(){tinypass.withoutWaitPanel=!1,a=!1,C&&C(),C=!1},function(){tinypass.withoutWaitPanel=!1,a=!1,C&&C(),C=!1}).finally(function(){r.fire("PAYMENT_BILLING_PLAN_TABLE_IS_UPDATED")}))},300)}g=!1,t.cancel(s),u&&(a?C=function(){o()}:o())}function x(e,n,i){return d.filter(e,function(e){return!(i&&i.countryCode===e.countryCode)}).map(function(e){return{category:n,name:e.name,countryCode:e.countryCode,requireZipCode:e.requireZipCode,vatLabel:e.vatLabel,needResidence:e.needResidence,taxIncludeBilling:e.taxIncludeBilling,taxSupport:e.taxSupport,visibility:!0}})}n.$on("EVENT_I18N_LOCALE_CHANGED",function(){u&&e.isBillingCountryEnabled()&&l.loadTaxCountries(e).then(function(){T()})}),n.unsubscribeNgEventService=function(){f(),_(),b(),O(),y()}}]};return n}]).directive("billingAddressWidget",[()=>({restrict:"A",template:'\n        <div id="billing-address-component-container"></div>\n        <div id="offer-widget-container"></div>\n      ',controller:["$scope","$rootScope","widgetService","errorService","checkout","eventService",(e,n,i,o,t,r)=>{const d={applicationId:t.getAid(),billingGeoCountryCode:window.TPParam.GEO_COUNTRY_CODE,billingGeoZipCode:window.TPParam.GEO_COUNTRY_POSTAL_CODE};i.createElement(t.getAid()+"-billing","BillingAddress","#billing-address-component-container",d).then(function(e){e.listen("billingAddressSelectCountry",function(e){})}).catch(function(n){o(e).reset(),e.displayErrors(e,n,o,r)})}]})]);
angular.module('consentModule', [])
.directive('consentsList', [function(){return {}}])
.directive('consentBox', [function(){return {}}])
.factory('checkConsents', [function(){return {}}])
angular.module('redemptionModule', [])
.factory('redeemRedemptionCodeService', [function(){return {}}])
.factory('redemptionService', [function(){return {}}])
.directive('redemptionComponent', [function(){return {}}])
.directive('redemptionCodeAndInfo', [function(){return {}}])
.directive('redeemCodeInput', [function(){return {}}])
.directive('redemptionPrintAddress', [function(){return {}}])
angular.module('giftModule', [])
.factory('giftService', [function(){return {}}])
.directive('renewableGiftFormComponent', [function(){return {}}])
.directive('giftFormComponent', [function(){return {}}])
.directive('giftInputTime', [function(){return {}}])
.directive('giftInputName', [function(){return {}}])
.directive('giftInputEmail', [function(){return {}}])
.directive('giftInputMessage', [function(){return {}}])
angular.module('upgradeModule', [])
.factory('upgradeService', [function(){return {}}])
.directive('completeUpgradeComponent', [function(){return {}}])
.directive('upgradeAuthenticationComponent', [function(){return {}}])
.directive('upgradeAuthenticationReceipt', [function(){return {}}])
.directive('upgradePurchaseReceipt', [function(){return {}}])
.directive('upgradeSharedSubscriptionComponent', [function(){return {}}])
angular.module('sharedSubscriptionModule', [])
.directive('sharedSubscriptionComponent', [function(){return {}}])
.directive('sharedSubscriptionFormComponent', [function(){return {}}])
.directive('redeemSharedSubscriptionComponent', [function(){return {}}])
angular.module('sharedSubscriptionCommonModule', [])
.factory('sharedSubscriptionService', [function(){return {}}])
.factory('ssHelpers', [function(){return {}}])
.factory('ssComponentController', [function(){return {}}])
.factory('ssFormComponentController', [function(){return {}}])
angular.module('renewableGiftModule', [])
.directive('redeemRenewableGiftComponent', [function(){return {}}])
angular.module('continueThreeDSPurchaseModule', [])
.directive('continueThreeDSPurchaseComponent', [function(){return {}}])
angular.module('tpConfirmModule', [])
.directive('tpDropConfirm', [function(){return {}}])
angular.module('widgetModule', [])
.factory('widgetService', [function(){return {}}])
angular.module('passThroughModule', [])
.directive('passThroughFormComponent', [function(){return {}}])
angular.module('registrationServiceModule', [])
.factory('registrationService', [function(){return {}}])
var swgModule=angular.module("swgModule",["generalModule","tp.i18n"]);swgModule.factory("swgService",["tpHTTP","$q","$window","ngEventService","lang","eventService",function(e,t,r,o,n,u){var s,c={};return o.subscribe("swgCheckoutComplete",function(e,t){s&&s.resolve(t)}),c.isAvailableForTerm=function(e){return e.sku},c.startCheckout=function(e){return s&&s.reject(),s=t.defer(),u.postMessage("swgCheckoutStart",{sku:e.sku,termId:e.termId}),s.promise},c.getUiConfig=function(){return{name:"swg",class:"swg-button",title:n.trc("checkout.platform","Subscribe with Google")}},c}]);
var promocode=angular.module("promocodeModule",["checkoutModule","tp.i18n"]),EVENT_PROMO_CODE_INIT="PROMO_CODE_INIT",EVENT_PROMO_CODE_STATUS_CHANGE="PROMO_CODE_STATUS_CHANGE",EVENT_PROMO_CODE_INPUT_CLICK="EVENT_PROMO_CODE_INPUT_CLICK",EVENT_REAPPLY_PROMO_CODE="EVENT_REAPPLY_PROMO_CODE",EVENT_RESET_PROMO_CODE="EVENT_RESET_PROMO_CODE";promocode.factory("promoCodeService",["tpHTTP","$rootScope","$q","$window","checkout","checkoutUpdatesService","statsService",function(e,o,t,r,n,i,d){return{data:{price:null,verified:!1,resultState:n.input.promoCodeId?"VALIDCODE":null,verifiedPromoCode:{},promoCode:{state:"PROMO_CODE_APPLY",loading:!1,validating:!1,visible:!0,code:""},term:{},isPromoCodeAnon:!1},verify:function(o,i,a,c){return d.getStatsPayload().then(function(d){var l=t.defer();return e({method:"post",url:r.TPParam.PROMO_CODE_VERIFY,params:{aid:o,code:i,termId:a,oid:c,zipCode:n.input.zipCode,countryCode:n.getBillingCountryCode(),billingZipCode:n.getBillingZipCode(),residenceCountryCode:n.getResidenceCountryCode(),userToken:n.params.userToken},data:d}).then(function(e){n.mergeStats(e),l.resolve({data:e,ok:!0})}).catch(function(e){l.resolve({data:e,ok:!1})}),l.promise})},revert:function(o,a){return d.getStatsPayload().then(function(d){var c=t.defer();return e({method:"post",url:r.TPParam.PROMO_CODE_REVERT,params:{promoCodeId:o,oid:a},data:d}).then(function(e){return n.mergeStats(e),n.flags.selectedTerm.isZero=!1,i.updatePaymentMethods(!0,n).then(function(){return e})}).then(function(e){c.resolve({data:e,ok:!0})}).catch(function(e){c.resolve({data:e,ok:!1})}),c.promise})},isAnonPromoCode:function(o,i,a){return d.getStatsPayload().then(function(d){var c=t.defer();return e({method:"post",url:r.TPParam.PROMO_CODE_IS_ANON,params:{code:o,termId:i,aid:a},data:d}).then(function(e){n.mergeStats(e),c.resolve({data:e,ok:!0})}).catch(function(e){c.resolve({data:e,ok:!1})}),c.promise})},handleZeroPrice:function(e){e&&(n.flags.selectedPaymentMethod={}||n.flags.selectedPaymentMethod,n.flags.selectedPaymentSource={}||n.flags.selectedPaymentSource,n.flags.selectedPaymentMethod.id=ZERO),i.updatePaymentMethods(!0,n)}}}]),promocode.directive("promoCodeComponent",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/promo-code-component.html",scope:{skipValidation:"@",term:"="},link:function(e,o,t,r){r.registerComponentController(e),o.on("$destroy",function(){r.unregisterComponentController(e)})},controller:["$scope","$element","promoCodeService","checkout","tpHTTP","ngEventService","modalService","errorService","$timeout","shakeService","lang","purchaseService","userService","passwordlessService","$q","checkoutGoTo","autoApplyService",function(e,o,t,r,n,i,d,a,c,l,m,p,s,u,f,E,C){var O;angular.extend(e,BaseComponentController),e.PROMO_CODE_APPLY="PROMO_CODE_APPLY",e.PROMO_CODE_RESULT="PROMO_CODE_RESULT",e.PROMO_CODE_RESULT_STATE={VALIDCODE:"VALIDCODE",INVALIDCODE:"INVALIDCODE",UNLOCKED:"UNLOCKED",ANOTHERTERM:"ANOTHERTERM",ANOTHERESOURCE:"ANOTHERESOURCE"};var T=!1,_=!1,P=function(){_=!1,a(e).reset(),e.price=t.data.price,e.verified=t.data.verified,e.input=r.input,e.promoCode=t.data.promoCode,e.selectedTerm=e.term||r.flags.selectedTerm,(null===e.input.promoCode||t.data.term.termId&&e.selectedTerm.termId!==t.data.term.termId)&&S(),angular.copy(e.selectedTerm,t.data.term),e.resultState=t.data.resultState,e.verifiedPromoCode=t.data.verifiedPromoCode,i.fire(EVENT_PROMO_CODE_INIT),r.params.promoCode&&r.isPromoCodeAvailable(e.selectedTerm)&&(e.input.promoCode=r.params.promoCode,e.promoCode.code=r.params.promoCode,C.isState2()?C.isAutoApply()?e.apply():O=i.subscribe("PROMO_CODE_AUTO_APPLY",function(){O(),e.apply()}):e.apply()),c(function(){o.find(".promo-code-description-enter").show(),o.find(".promo-code-description-error").hide()},0)};function h(){const e=document.querySelectorAll(".promo-code-input");Array.from(e).filter(v)[0].focus()}function v(e){for(;e;){if("none"===getComputedStyle(e).display)return!1;e=e.parentElement}return!0}function S(){_=!1,r.resetDiscount(),e.promoCode.state=e.PROMO_CODE_APPLY,e.promoCode.loading=!1,e.promoCode.validating=!1,e.promoCode.code="",e.resultState=null,t.data.resultState=null}e.isNeedApplyAfterReload=!1,e.apply=function(){if(_=!0,!e.input.promoCode)return e.resultState=e.PROMO_CODE_RESULT_STATE.INVALIDCODE,r.isSelectedTermLocked()||a(e).component({field:"promocode",message:m.trc("checkout.platform","Promo code is required")}),void h();if(r.isPromoCodeApplyWithoutUserEnabled()){var o=e.term||r.getSelectedTerm();t.isAnonPromoCode(r.input.promoCode,o.termId,r.getAid()).then(function(e){e.ok?e.data.models.isPromoCodeAnon?c():r.passwordlessServiceLogin().then(c):l()})}else r.passwordlessServiceLogin().then(c);function c(){if(!r.isPromoCodeApplyWithoutUserEnabled()&&!r.isUserValid()){if(!r.isSelectedTermLocked())return void a(e).global(m.trc("checkout.platform","You should sign in or sign up first"));if(E.gotoAuthState(r,null,function(){e.isNeedApplyAfterReload&&(E.gotoLockedPromoCode(r),e.isNeedApplyAfterReload=!1,e.apply())},!0))return void(e.isNeedApplyAfterReload=!0)}e.selectedTerm=e.term||r.flags.selectedTerm,e.promoCode.validating=!0;var o=e.term||r.getSelectedTerm();(function(e){return r.input.oid?Promise.resolve():function(e){return r.createOrder(r.params.aid,r.params.offerId,r.params.templateId,r.params.userToken,e.termId).then(function(e){return e.errors&&e.errors.length>0?f.reject(e):e})}(e).then(function(e){r.input.oid=e.models.oid})})(o).then(function(){!function(o,c){T=!1,t.verify(r.getAid(),r.input.promoCode,o.termId,c).then(function(c){r.softResetDiscount().then(function(){if(a(e).reset(),c.ok){n.extractModels(c.data,e),n.extractModels(c.data,t.data),e.promoCode.state=e.PROMO_CODE_RESULT;var s=c.data.models;e.resultState===e.PROMO_CODE_RESULT_STATE.VALIDCODE?function(o,n){r.discountSelectedTerm(o.chargeAmount,o.chargeAmountInMinorUnit,o.chargeCurrency,o.chargeDisplayAmount,o.promotionBillingPlan,o.verifiedPromoCode.promoCodeId,n.termId),r.reload(void 0,!0).then(function(){r.sendGoogleAnalyticsEvent({eventAction:"promoApplied",eventLabel:"Promo applied",params:{offerId:r.config.offerId,templateId:r.config.offerTemplateId,templateVariantId:r.config.offerTemplateVariantId,promotionId:o.verifiedPromoCode.promotionId,termId:n.termId}}),r.input.isFreePromo=o.hasFreeTrial,t.handleZeroPrice(e.isZero),i.fire(EVENT_CHECKOUT_PRICE_CHANGED),document.querySelector(".promo-code-revert").focus()})}(s,o):e.resultState===e.PROMO_CODE_RESULT_STATE.UNLOCKED?function(o,n){r.discountSelectedTerm(o.chargeAmount,o.chargeAmountInMinorUnit,o.chargeCurrency,o.chargeDisplayAmount,o.promotionBillingPlan,o.verifiedPromoCode.promoCodeId,n.termId),r.reload(void 0,!0).then(function(){r.input.validUnlockPromoCode=!0,E.gotoNextState(r,p,!1,!0,!0),r.sendGoogleAnalyticsEvent({eventAction:"promoApplied",eventLabel:"Promo applied",params:{offerId:r.config.offerId,templateId:r.config.offerTemplateId,templateVariantId:r.config.offerTemplateVariantId,promotionId:o.verifiedPromoCode.promotionId,termId:n.termId}}),t.handleZeroPrice(e.isZero),i.fire(EVENT_CHECKOUT_PRICE_CHANGED)})}(s,o):e.resultState===e.PROMO_CODE_RESULT_STATE.ANOTHERTERM?function(e){var o=e.otherTerms[0],t=e.verifiedPromoCode;d.openDialog({class:"promo-code-another-term-dialog",templateUrl:"/widget/checkout/component/partials/promo-code-another-term-dialog.html",controller:["$scope","$modalInstance","ngEventService",function(e,n,i){function d(e){n.close()}e.otherTerm=o,e.verifiedPromoCode=t,e.close=function(){d(!1),document.querySelector(".button.promo-code-apply").focus()},e.selectTerm=function(){d(!0),r.checkoutWithNewTerm(o)}}]})}(s):e.resultState===e.PROMO_CODE_RESULT_STATE.ANOTHERESOURCE?function(o){var t=e.otherTerms[0],n=e.otherTermOfferPubId,i=o.verifiedPromoCode;d.openDialog({class:"promo-code-another-term-dialog",templateUrl:"/widget/checkout/component/partials/promo-code-another-term-dialog.html",controller:["$scope","$modalInstance",function(e,o){e.otherTerm=t,e.verifiedPromoCode=i,e.selectTerm=function(){o.close(),r.reload({offerId:n,termId:t.termId}).then(function(){r.checkoutWithNewTerm(t,n)})}}]})}(s):e.resultState===e.PROMO_CODE_RESULT_STATE.INVALIDCODE&&function(){r.resetDiscount(),r.sendGoogleAnalyticsEvent({eventAction:"promoInvalid",eventLabel:"Promo invalid",params:{offerId:r.config.offerId,templateId:r.config.offerTemplateId,templateVariantId:r.config.offerTemplateVariantId,code:e.input.promoCode}}),r.isSelectedTermLocked()||a(e).component({field:"promocode",message:m.trc("checkout.platform","Your promo code is not valid")});h()}()}else l();e.promoCode.validating=!1})})}(o,r.input.oid)})}function l(){r.input.promoCode=null,e.promoCode.state=e.PROMO_CODE_APPLY,e.promoCode.loading=!1,e.promoCode.validating=!1,e.promoCode.code="",a(e).global(m.trc("checkout.platform","Can not validate promo code")),h()}},e.revert=function(o){o&&o.stopPropagation();var n=r.input.oid;t.revert(e.verifiedPromoCode.promoCodeId,n).then(function(o){return o.ok?(S(),r.reload(void 0,!0)):(a(e).global(m.trc("checkout.platform","Can not revert promo code")),f.when())}).then(function(){h()})},e.isPromoCodeAvailable=function(){return r.isPromoCodeAvailable(e.term)},e.isPromoCodeValid=function(){return t.data.resultState===e.PROMO_CODE_RESULT_STATE.VALIDCODE},Helper.wrapMethod("isSelectedTermLocked",r,e);var g=i.subscribe(EVENT_RESET_PROMO_CODE,function(){_=!1}),A=i.subscribe(EVENT_CHECKOUT_TERM_SELECTED,function(){P()}),I=i.subscribe(EVENT_REAPPLY_PROMO_CODE,function(){_&&e.apply()}),R=i.subscribe("logout",function(){S()});e.inputClick=function(){i.fire(EVENT_PROMO_CODE_INPUT_CLICK),o.find(".promo-code-description-enter").show(),o.find(".promo-code-description-error").hide()},e.$watch(function(){return e.resultState===e.PROMO_CODE_RESULT_STATE.INVALIDCODE&&!T},function(){e.resultState!==e.PROMO_CODE_RESULT_STATE.INVALIDCODE||T||(i.fire(EVENT_PROMO_CODE_STATUS_CHANGE),o.find(".promo-code-description-enter").hide(),o.find(".promo-code-description-error").show(),T=!0)}),e.unsubscribeNgEventService=function(){g(),I(),A(),R()},P()}]}}),promocode.directive("animateLockedPromoCode",function(){return{scope:!1,controller:["$scope","$element","ngEventService","shakeService","$timeout","checkout","lang",function(e,o,t,r,n,i,d){var a=t.subscribe(EVENT_PROMO_CODE_INIT,function(){n(function(){o.find(".promo-code-description-enter").show(),o.find(".promo-code-description-error").hide()},0)}),c=t.subscribe(EVENT_PROMO_CODE_INPUT_CLICK,function(){n(function(){o.find(".promo-code-description-enter").show(),o.find(".promo-code-description-error").hide(),o.find(".promo-code-apply").html(d.trc("checkout.platform","Apply"))},0)}),l=t.subscribe(EVENT_PROMO_CODE_STATUS_CHANGE,function(){i.isSelectedTermLocked()&&n(function(){var e=o.find(".promo-code-lock"),t=o.find(".promo-code-description-enter"),n=o.find(".promo-code-description-error");t.show(),n.hide(),t.css({position:"relative"}),n.css({position:"relative"}),r.shake(e),t.animate({top:-15,opacity:0},600,function(){t.hide(),t.animate({top:0,opacity:1},3),n.animate({top:-15,opacity:0},3,function(){n.show(),n.animate({top:0,opacity:1},600,function(){i.resize(),o.find(".promo-code-apply").html(d.trc("checkout.platform","Try again !"))})})})},0)});e.$on("$destroy",function(){a(),c(),l()})}]}});
angular.module("futureStartModule",["checkoutModule","tp.i18n"]).factory("futureStartService",["tpHTTP","$window","checkout","$q",function(e,t,n,r){function a(a,o){var i=r.defer();if(isNaN(Date.parse(a)))return i.reject("invalid date"),i.promise;var s,u,c,l=(new Date).setHours(0,0,0,0),f=(s=l,u=o,c=new Date(s),c.setDate(c.getDate()+u),c).setHours(23,59,59,999);if(a<l||a>f)i.reject("the date is out of period");else{var d=a.getTime()/1e3;e({method:"POST",url:t.TPParam.APPLY_DEFERRED_START,params:{aid:n.getAid(),oid:n.input.oid,accessStartTime:d,userToken:n.params.userToken}}).then(function(){i.resolve(d)}).catch(function(e){i.reject(e)})}return i.promise}return{form:{startDate:n.input.accessStartTime?new Date(1e3*n.input.accessStartTime):null},resetDeferredStart:function(){this.form.startDate&&(this.form.startDate=null,this.applyDeferredStart())},applyDeferredStart:function(){const e=this.form;return a(this.form.startDate,n.getSelectedTerm().deferredStartMaxDays).then(function(e){n.input.accessStartTime=e,n.reload(void 0,!0)}).catch(function(t){throw e.startDate=n.input.accessStartTime?new Date(1e3*n.input.accessStartTime):null,t})}}}]).directive("futureStartComponent",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/future-start-component.html",scope:{skipValidation:"@",term:"="},link:function(e,t,n,r){r.registerComponentController(e),e.extendScope=function(){r.extendScope(e)},e.extendScope(),t.on("$destroy",function(){r.unregisterComponentController(e)}),e.isElementBelongsWidget=function(e){return t.has(e).length>0}},controller:["$scope","checkout","futureStartService","ngEventService","lang","errorService","$locale","dateUtils","$element",function(e,t,n,r,a,o,i,s,u){angular.extend(e,BaseComponentController);var c=!1,l=!1,f={ESC:27,ENTER:13},d=null,p=u.find(".future-start-input");function m(){o(e).reset(),n.resetDeferredStart();var r=t.getSelectedTerm();r&&r.deferredStartMaxDays&&(e.datePickerOptions={mainOptions:{instantChanges:!0,applyButton:{enable:!1},closeButton:{enable:!0}},calendarOptions:[{oneCanvasCalendar:!0,enableOneClickRange:!0,calendarUnitTitle:"MMMM yyyy",limitDateNotBefore:new Date,limitDateNotAfter:s.addDays(new Date,r.deferredStartMaxDays)}]},e.isCalendarOpen=!1,d=e.form.startDate)}function S(){return p&&p.length?p:u.find(".future-start-input")}function D(){n.applyDeferredStart().then(function(){o(e).reset(),d=e.form.startDate}).catch(function(){o(e).reset(),o(e).component({field:"startDate",message:a.trc("checkout.platform","Invalid future start date.")})})}function g(t){console.log("--- mousedown"),$(t.target).is(":focus")?T():e.isCalendarOpen&&(l=!0,T())}function h(){e.isCalendarOpen=!1}function T(){e.isCalendarOpen=!e.isCalendarOpen}function C(e){e&&e.setSelectionRange(-1,-1)}e.form=n.form;const E=i.DATETIME_FORMATS.mediumDate;e.dateFormat=E,e.datePlaceholder=E.toUpperCase().replace(new RegExp("(Y+)"),"YYYY").replace(new RegExp("(M+)"),"MMM"),e.isFutureStartAvailable=function(){return t.isFutureStartAvailable(t.getSelectedTerm())},e.startDateInputBlur=function(t){e.isElementBelongsWidget(t.relatedTarget)||(S().off("mousedown",g),h(),c&&(c=!1,D()))},e.startDateInputChange=function(){c=!0},e.applyStartDate=D,e.handleInputKeyUp=function(t){switch(t.keyCode){case f.ENTER:h(),C(t.target),c&&(c=!1,D());break;case f.ESC:h(),C(t.target),c&&(c=!1,null!==d&&(e.form.startDate=d));break;default:return}},e.handleInputFocus=function(t){l?l=!1:t.originalEvent&&(e.isCalendarOpen=!0,S().on("mousedown",g))},e.handleCalendarClose=function(){e.isCalendarOpen=!1;var t=S();t.is(":focus")||t.off("mousedown",g)},e.handleDayPick=function(){D(),S().blur()};var v=r.subscribe(EVENT_CHECKOUT_TERM_SELECTED,function(){m()});e.unsubscribeNgEventService=function(){v()},m()}]}});
angular.module('experianModule', [])
.factory('experianService', [function(){return {}}])
.directive('experianBillingAddress', [function(){return {}}])
var antifraudCaptchaV3=angular.module("antifraudCaptchaV3Module",[]);antifraudCaptchaV3.factory("captchaV3Service",["eventService","ngEventService","$q","tpHTTP","errorService","lang",function(e,a,t,n,c,r){var o=!1;function i(){return o}return{isCaptchaV3Enabled:i,getCaptchaV3Enabled:function(c){var i,u;(i=t.defer(),u=a.subscribe("get-captcha-v3-config-value",function(e,a){u(),i.resolve(a.config)}),e.postMessage("get-captcha-v3-config"),i.promise).then(function(a){return a.aid?a:function(a){return n({method:"post",url:TPParam.GET_FRAUD_PREVENTION_CONFIG,params:{aid:a}}).then(function(a){var t=a.models.config;return e.postMessage("set-captcha-v3-config",{config:t}),t})}(c)}).then(function(e){var a;a=e.enabled,o=a}).catch(function(){console.error(r.tr("Unable to load captcha V3 configuration"))})},getCaptchaV3Token:function(n){var c=t.defer();if(i()){var r=a.subscribe("captcha-v3-token",function(e,a){r(),c.resolve(a.token)});e.postMessage("get-captcha-v3-token",{action:n})}else c.resolve();return c.promise}}}]);
angular.module('antifraudCaptchaV2Module', [])
.factory('captchaV2Service', [function(){return {}}])
.directive('paymentMethodCaptcha', [function(){return {}}])
angular.module('antifraudCaptchaV2ProviderModule', [])
.factory('captchaV2Provider', [function(){return {}}])
angular.module('subscriptionReactivationModule', [])
.factory('reactivateSubscriptionService', [function(){return {}}])
.directive('reactivateSubscriptionComponent', [function(){return {}}])
angular.module('renewableGiftCommonModule', [])
.factory('gifteeDetailsFormService', [function(){return {}}])
angular.module('paymentProviderModule', [])
.factory('creditCardUtils', [function(){return {}}])
angular.module('paymentServiceModule', [])
.factory('paymentService', [function(){return {}}])
angular.module('purchaseServiceDataModule', [])
.factory('purchaseServiceData', [function(){return {}}])
angular.module('purchaseServiceModule', [])
.factory('purchaseService', [function(){return {}}])
angular.module('paymentProviders', [])
.factory('postmessageService', [function(){return {}}])
.factory('utilsService', [function(){return {}}])
angular.module('termGateServiceModule', [])
.factory('termGateService', [function(){return {}}])
angular.module('alreadyHasAccessModule', [])
.directive('alreadyHasAccessComponent', [function(){return {}}])
angular.module('confirmationModule', [])
.directive('confirmationComponent', [function(){return {}}])
angular.module('bankSecureModule', [])
.directive('bankSecureComponent', [function(){return {}}])
.factory('paymentProvider', [function(){return {}}])
angular.module('paymentProviderModule')
.factory('passwordlessPaymentService', [function(){return {}}])
angular.module('paypalExpressCheckoutProviderModule', [])
.factory('paypalExpressCheckoutProvider', [function(){return {}}])
.directive('paypalExpressCheckoutProviderFormComponent', [function(){return {}}])
angular.module('paypalExpressCheckout', [])
.factory('paypalExpressCheckoutService', [function(){return {}}])
angular.module('creditCardModule', [])
.factory('creditCard', [function(){return {}}])
.factory('creditCardService', [function(){return {}}])
.directive('ccFormComponent', [function(){return {}}])
.directive('braintreeValidate', [function(){return {}}])
angular.module('payPalModule', [])
.factory('payPal', [function(){return {}}])
angular.module('mockModule', [])
.factory('mock', [function(){return {}}])
.directive('mockFormComponent', [function(){return {}}])
angular.module('openpayCashModule', [])
.factory('openpayCashService', [function(){return {}}])
.factory('openpayCashProvider', [function(){return {}}])
.directive('openpayCashFormComponent', [function(){return {}}])
.directive('openpayBillControls', [function(){return {}}])
angular.module('zeroModule', [])
.factory('zero', [function(){return {}}])
.directive('zeroFormComponent', [function(){return {}}])
angular.module('payWhatYouWantModule', [])
.factory('payWhatYouWantData', [function(){return {}}])
.directive('payWhatYouWantFormComponent', [function(){return {}}])
angular.module('externalVerificationModule', [])
.factory('externalVerificationService', [function(){return {}}])
.directive('externalVerificationComponent', [function(){return {}}])
.controller('externalApiFieldsetCtrl', [function(){return {}}])
.directive('externalApiFieldset', [function(){return {}}])
.directive('externalApiFieldsetList', [function(){return {}}])
.directive('externalApiFieldsetExists', [function(){return {}}])
.directive('externalApiFieldsetNew', [function(){return {}}])
.directive('externalApiFieldsetForm', [function(){return {}}])
.directive('externalApiFieldsetField', [function(){return {}}])
.directive('externalApiFieldsetInput', [function(){return {}}])
.directive('externalApiFieldsetHint', [function(){return {}}])
.directive('inject', [function(){return {}}])
angular.module('printAddressModule', [])
.factory('printAddressService', [function(){return {}}])
.directive('printAddressComponent', [function(){return {}}])
angular.module('checkoutMockModule', [])
angular.module('checkoutBraintreeGooglePayMockModule', [])
angular.module('checkoutDatatransGooglePayMockModule', [])
angular.module('payPalBtModule', [])
.factory('payPalBt', [function(){return {}}])
.factory('payPalBtService', [function(){return {}}])
.directive('paypalThroughBraintreeFormComponent', [function(){return {}}])
angular.module('applePayBtModule', [])
.factory('applePayBt', [function(){return {}}])
.factory('applePayBtService', [function(){return {}}])
.directive('applePayThroughBraintreeFormComponent', [function(){return {}}])
angular.module('spreedlyDefaultStrategyModule', [])
.factory('spreedlyDefaultStrategy', [function(){return {}}])
angular.module('spreedlyPayULatamStrategyModule', [])
.factory('spreedlyPayULatamStrategy', [function(){return {}}])
angular.module('spreedlyModule', [])
.factory('spreedly', [function(){return {}}])
angular.module('edgilPaywayProviderModule', [])
.factory('edgilPaywayProvider', [function(){return {}}])
.factory('edgilCreditCardService', [function(){return {}}])
.directive('edgilPaywayProviderFormComponent', [function(){return {}}])
angular.module('eigenProviderModule', [])
.factory('eigenProvider', [function(){return {}}])
.factory('eigenCreditCardService', [function(){return {}}])
.directive('eigenProviderFormComponent', [function(){return {}}])
angular.module('braintreeCommonModule', [])
.factory('braintreeFactory', [function(){return {}}])
angular.module('providersModuleCH', [])
.factory('eventsServiceCH', [function(){return {}}])
.factory('providersServiceCH', [function(){return {}}])
.directive('newFlowComponentsCH', [function(){return {}}])
.service('ppCreditCardActionsService', [function(){return {}}])
.directive('dynamicBaseInputsComponent', [function(){return {}}])
angular.module('datatransCommonModule', [])
.factory('datatransIntegrationService', [function(){return {}}])
angular.module('datatransPostfinanceCommonModule', [])
.factory('datatransPostfinanceIntegrationService', [function(){return {}}])
angular.module('easypayCommonModule', [])
.factory('easypayBoletoService', [function(){return {}}])
.factory('easypayDirectDebitService', [function(){return {}}])
angular.module('eigenCommonModule', [])
.factory('eigenMiraSecureV2', [function(){return {}}])
.factory('eigenMiraSecureV3', [function(){return {}}])
.factory('eigenService', [function(){return {}}])
.factory('eigenServiceV2', [function(){return {}}])
.factory('eigenServiceV3', [function(){return {}}])
angular.module('klarnaCommonModule', [])
.factory('klarnaService', [function(){return {}}])
angular.module('obiCommonModule', [])
.factory('obiIntegrationService', [function(){return {}}])
.factory('obiPaypalIntegrationService', [function(){return {}}])
angular.module('applepayssModuleCH', [])
angular.module('applepaystripeModuleCH', [])
.factory('applepaystripeProviderCH', [function(){return {}}])
.directive('applepaystripeComponentCH', [function(){return {}}])
angular.module('applepaywayModuleCH', [])
.factory('applepaywayProviderCH', [function(){return {}}])
.directive('applepaywayComponentCH', [function(){return {}}])
angular.module('cybersourceModuleCH', [])
.factory('cybersourceCardServiceCH', [function(){return {}}])
.factory('cybersourceProviderCH', [function(){return {}}])
.directive('cybersourceComponentCH', [function(){return {}}])
angular.module('cybersourcetmsModuleCH', [])
.factory('cybersourcetmsScaForPurchaseCH', [function(){return {}}])
.factory('cybersourcetmsProviderCH', [function(){return {}}])
.directive('cybersourcetmsComponentCH', [function(){return {}}])
angular.module('edgilModuleCH', [])
.factory('edgilCardServiceCH', [function(){return {}}])
.factory('edgilProviderCH', [function(){return {}}])
.directive('edgilComponentCH', [function(){return {}}])
angular.module('onetModuleCH', [])
.factory('onetCardServiceCH', [function(){return {}}])
.factory('onetProviderCH', [function(){return {}}])
.directive('onetComponentCH', [function(){return {}}])
angular.module('stripeModuleCH', [])
.factory('stripeCardServiceCH', [function(){return {}}])
.factory('stripeProviderCH', [function(){return {}}])
.directive('stripeComponentCH', [function(){return {}}])
angular.module('wirecardModuleCH', [])
.factory('wirecardCardServiceCH', [function(){return {}}])
.factory('wirecardProviderCH', [function(){return {}}])
.directive('wirecardComponentCH', [function(){return {}}])
angular.module('gocardlessddModuleCH', [])
.factory('gocardlessddCardServiceCH', [function(){return {}}])
.factory('gocardlessddProviderCH', [function(){return {}}])
.directive('gocardlessddComponentCH', [function(){return {}}])
angular.module('gmoModuleCH', [])
.factory('gmoCardServiceCH', [function(){return {}}])
.factory('gmoProviderCH', [function(){return {}}])
.directive('gmoComponentCH', [function(){return {}}])
angular.module('bancardModuleCH', [])
.factory('bancardCardServiceCH', [function(){return {}}])
.factory('bancardProviderCH', [function(){return {}}])
.directive('bancardComponentCH', [function(){return {}}])
angular.module('paymentezModuleCH', [])
.factory('paymentezCardServiceCH', [function(){return {}}])
.factory('paymentezProviderCH', [function(){return {}}])
.directive('paymentezComponentCH', [function(){return {}}])
angular.module('payuindiaccModuleCH', [])
.factory('payuindiaccCardServiceCH', [function(){return {}}])
.factory('payuindiaccProviderCH', [function(){return {}}])
.directive('payuindiaccComponentCH', [function(){return {}}])
angular.module('payuindiaccv2ModuleCH', [])
.factory('payuindiaccv2CardServiceCH', [function(){return {}}])
.factory('payuindiaccv2ProviderCH', [function(){return {}}])
.directive('payuindiaccv2ComponentCH', [function(){return {}}])
angular.module('payuindiaupiModuleCH', [])
.factory('payuindiaupiProviderCH', [function(){return {}}])
.directive('payuindiaupiComponentCH', [function(){return {}}])
angular.module('payuindianbModuleCH', [])
.factory('payuindianbProviderCH', [function(){return {}}])
.directive('payuindianbComponentCH', [function(){return {}}])
angular.module('payuchileccModuleCH', [])
.factory('payuchileccCardServiceCH', [function(){return {}}])
.factory('payuchileccProviderCH', [function(){return {}}])
.factory('payuchileccDropdownsCH', [function(){return {}}])
.directive('payuchileccComponentCH', [function(){return {}}])
angular.module('payubrazilccModuleCH', [])
.factory('payubrazilccCardServiceCH', [function(){return {}}])
.factory('payubrazilccProviderCH', [function(){return {}}])
.factory('payubrazilccDropdownsCH', [function(){return {}}])
.directive('payubrazilccComponentCH', [function(){return {}}])
angular.module('payubrazilbbModuleCH', [])
.factory('payubrazilbbProviderCH', [function(){return {}}])
.factory('payubrazilbbDropdownsCH', [function(){return {}}])
.directive('payubrazilbbComponentCH', [function(){return {}}])
angular.module('payucolombiaccModuleCH', [])
.factory('payucolombiaccCardServiceCH', [function(){return {}}])
.factory('payucolombiaccProviderCH', [function(){return {}}])
.factory('payucolombiaccDropdownsCH', [function(){return {}}])
.directive('payucolombiaccComponentCH', [function(){return {}}])
angular.module('payucolombiapseModuleCH', [])
.factory('payucolombiapseProviderCH', [function(){return {}}])
.factory('payucolombiapseDropdownsCH', [function(){return {}}])
.directive('payucolombiapseComponentCH', [function(){return {}}])
angular.module('payuperuccModuleCH', [])
.factory('payuperuccCardServiceCH', [function(){return {}}])
.factory('payuperuccProviderCH', [function(){return {}}])
.factory('payuperuccDropdownsCH', [function(){return {}}])
.directive('payuperuccComponentCH', [function(){return {}}])
angular.module('payuargentinaccModuleCH', [])
.factory('payuargentinaccCardServiceCH', [function(){return {}}])
.factory('payuargentinaccProviderCH', [function(){return {}}])
.factory('payuargentinaccDropdownsCH', [function(){return {}}])
.directive('payuargentinaccComponentCH', [function(){return {}}])
angular.module('datatranstwintModuleCH', [])
.factory('datatranstwintIntegrationServiceCH', [function(){return {}}])
.factory('datatranstwintProviderCH', [function(){return {}}])
.directive('datatranstwintComponentCH', [function(){return {}}])
angular.module('datatransgooglepayModuleCH', [])
.factory('datatransgooglepayIntegrationServiceCH', [function(){return {}}])
.factory('datatransgooglepayProviderCH', [function(){return {}}])
.directive('datatransgooglepayComponentCH', [function(){return {}}])
angular.module('datatransapplepayModuleCH', [])
.factory('datatransapplepayIntegrationServiceCH', [function(){return {}}])
.factory('datatransapplepayProviderCH', [function(){return {}}])
.directive('datatransapplepayComponentCH', [function(){return {}}])
angular.module('volgaModuleCH', [])
.factory('volgaProviderCH', [function(){return {}}])
.directive('volgaComponentCH', [function(){return {}}])
angular.module('vippsModuleCH', [])
.factory('vippsCardServiceCH', [function(){return {}}])
.factory('vippsProviderCH', [function(){return {}}])
.directive('vippsComponentCH', [function(){return {}}])
angular.module('inbasModuleCH', [])
.factory('inbasProviderCH', [function(){return {}}])
.directive('inbasComponentCH', [function(){return {}}])
angular.module('inbafModuleCH', [])
.factory('inbafProviderCH', [function(){return {}}])
.directive('inbafComponentCH', [function(){return {}}])
angular.module('datatranspaypalModuleCH', [])
.factory('datatranspaypalIntegrationServiceCH', [function(){return {}}])
.factory('datatranspaypalProviderCH', [function(){return {}}])
.directive('datatranspaypalComponentCH', [function(){return {}}])
angular.module('gmodocomoModuleCH', [])
.factory('gmodocomoProviderCH', [function(){return {}}])
.factory('gmodocomoIntegrationServiceCH', [function(){return {}}])
.directive('gmodocomoComponentCH', [function(){return {}}])
angular.module('gmosoftbankModuleCH', [])
.factory('gmosoftbankProviderCH', [function(){return {}}])
.factory('gmosoftbankIntegrationServiceCH', [function(){return {}}])
.directive('gmosoftbankComponentCH', [function(){return {}}])
angular.module('creditguardModuleCH', [])
.factory('creditguardProviderCH', [function(){return {}}])
.factory('creditguardCardServiceCH', [function(){return {}}])
.directive('creditguardComponentCH', [function(){return {}}])
angular.module('gmoauModuleCH', [])
.factory('gmoauProviderCH', [function(){return {}}])
.factory('gmoauIntegrationServiceCH', [function(){return {}}])
.directive('gmoauComponentCH', [function(){return {}}])
angular.module('gocardlessdropinModuleCH', [])
.factory('gocardlessdropinCardServiceCH', [function(){return {}}])
.factory('gocardlessdropinProviderCH', [function(){return {}}])
.directive('gocardlessdropinComponentCH', [function(){return {}}])
angular.module('datatransCheckoutModule', [])
.factory('datatransProvider', [function(){return {}}])
.directive('datatransFormComponent', [function(){return {}}])
angular.module('datatransPostfinanceCheckoutModule', [])
.factory('datatransPostfinanceProvider', [function(){return {}}])
.directive('datatransPostfinanceFormComponent', [function(){return {}}])
angular.module('easypayCheckoutModule', [])
.factory('easypayBoletoProvider', [function(){return {}}])
.factory('easypayDirectDebitProvider', [function(){return {}}])
.factory('easypayMbwayProvider', [function(){return {}}])
.factory('easypayMultibancoProvider', [function(){return {}}])
.directive('easypayDirectDebitProviderFormComponent', [function(){return {}}])
.directive('easypayBillControls', [function(){return {}}])
.directive('easypayMbwayFormComponent', [function(){return {}}])
.directive('easypayBoletoFormComponent', [function(){return {}}])
.directive('easypayMultibancoFormComponent', [function(){return {}}])
angular.module('klarnaCheckoutModule', [])
.directive('klarnaFormComponent', [function(){return {}}])
.factory('klarnaProvider', [function(){return {}}])
angular.module('obiCheckoutModule', [])
.factory('obiProvider', [function(){return {}}])
.factory('obiCheckoutService', [function(){return {}}])
.directive('obiFormComponent', [function(){return {}}])
angular.module('obiPaypalCheckoutModule', [])
.factory('obiPaypalProvider', [function(){return {}}])
.directive('obiPaypalFormComponent', [function(){return {}}])
angular.module('sonyModuleCH', [])
.factory('sonyCardServiceCH', [function(){return {}}])
.factory('sonyProviderCH', [function(){return {}}])
.factory('sonyScaServiceCH', [function(){return {}}])
.directive('sonyComponentCH', [function(){return {}}])
angular.module('zlickModuleCH', [])
.factory('zlickIntegrationServiceCH', [function(){return {}}])
.factory('zlickProviderCH', [function(){return {}}])
.directive('zlickComponentCH', [function(){return {}}])
angular.module('stripeelementsModuleCH', [])
.factory('stripeelementsCardServiceCH', [function(){return {}}])
.factory('stripeelementsProviderCH', [function(){return {}}])
.directive('stripeelementsComponentCH', [function(){return {}}])
angular.module('chaseModuleCH', [])
.factory('chaseCardServiceCH', [function(){return {}}])
.factory('chaseProviderCH', [function(){return {}}])
.directive('chaseComponentCH', [function(){return {}}])
angular.module('paypalcheckoutModuleCH', [])
.factory('paypalcheckoutIntegrationServiceCH', [function(){return {}}])
.factory('paypalcheckoutProviderCH', [function(){return {}}])
.directive('paypalcheckoutComponentCH', [function(){return {}}])
angular.module('braintreegooglepayModuleCH', [])
.factory('braintreegooglepayIntegrationServiceCH', [function(){return {}}])
.factory('braintreegooglepayProviderCH', [function(){return {}}])
.directive('braintreegooglepayComponentCH', [function(){return {}}])
angular.module('eppModuleCH', [])
.factory('eppProviderCH', [function(){return {}}])
angular.module('tp.directives', [])
.directive('ngEnter', [function(){return {}}])
.directive('tpclipboard', [function(){return {}}])
.directive('tpUploader', [function(){return {}}])
.directive('ignoreDirty', [function(){return {}}])
.directive('fakeInput', [function(){return {}}])
.directive('tpImageCrop', [function(){return {}}])
.directive('tpShow', [function(){return {}}])
.directive('fadey', [function(){return {}}])
.directive('animatePosition', [function(){return {}}])
.directive('animateMargin', [function(){return {}}])
.directive('iframeContainer', [function(){return {}}])
.directive('errorSection', [function(){return {}}])
.directive('warningSection', [function(){return {}}])
.directive('autoSelect', [function(){return {}}])
.directive('zeroClipboard', [function(){return {}}])
.directive('selectAllCheckbox', [function(){return {}}])
.directive('tpDisableEnter', [function(){return {}}])
.directive('tpDecimalFilter', [function(){return {}}])
.directive('searchInput', [function(){return {}}])
.directive('tpCurrencyInput', [function(){return {}}])
.directive('preventTypingNonNumber', [function(){return {}}])
.directive('tpDropDown', [function(){return {}}])
.directive('tpUnitPopover', [function(){return {}}])
.directive('tpCharLimit', [function(){return {}}])
.directive('onEnter', [function(){return {}}])
.directive('tpHeaderDescription', [function(){return {}}])
.directive('d3Planet', [function(){return {}}])
.directive('translationsProgressMeter', [function(){return {}}])
.directive('translationsTotal', [function(){return {}}])
.directive('setIframeHeightOnload', [function(){return {}}])
.directive('tpInfiniteScroll', [function(){return {}}])
.filter('tpDateFormatFilter', [function(){return {}}])
angular.module('tp.ui.address', [])
.filter('formatAddress', [function(){return {}}])
.directive('regionSelect', [function(){return {}}])
angular.module('tp.ui.grid', [])
.filter('toCssClass', [function(){return {}}])
.directive('tpGrid', [function(){return {}}])
angular.module('tp.ui.cc', [])
.directive('tpCreditCardForm', [function(){return {}}])
angular.module('checkoutGoToModule', [])
.factory('checkoutGoTo', [function(){return {}}])
var tpComponentsModule=angular.module("tpComponentsModule",["generalModule","containerServiceModule"]);tpComponentsModule.directive("a",["trackExternalEvent","getTrackingId","addQueryParameterToUrl","$timeout","ngEventService",function(e,t,n,r,o){return{restrict:"E",link:function(i,a){var s;r(function(){var e=a.attr("href");function i(){var e=void 0===a.attr("noptid"),r=t();e&&r&&a.attr("href",n(a.attr("href"),"_ptid",r))}e&&0===e.indexOf("http")&&("_parent"!==a.attr("target")&&"_top"!==a.attr("target")&&a.attr("target","_blank"),i(),s=o.subscribe(EVENT_TRACKING_ID_CHANGED,function(){r(function(){i()})}))}),a.on("click",function(t){if("click"===t.type){var n=a.attr("href")||"";0===n.lastIndexOf("http",0)&&e("EXTERNAL_LINK",decodeURI(function(e){var t=e.split(/[?#]/)[0],n=t.length-1;return"/"===t[n]&&(t=t.slice(0,n)),t}(n)),{href:encodeURI(n)})}}),i.$on("$destroy",function(){s&&s()})}}}]),tpComponentsModule.directive("radioTrackBy",function(){return{restrict:"A",scope:{ngModel:"=",ngValue:"=",radioTrackBy:"@"},link:function(e){e.ngValue[e.radioTrackBy]===e.ngModel[e.radioTrackBy]&&(e.ngModel=e.ngValue)}}}),tpComponentsModule.factory("getExternalEventParams",function(){return function(e){var t,n={};for(var r in e)e.hasOwnProperty(r)&&0===r.indexOf("externalEvent")&&"externalEvent"!==r&&(n[(t=r.split("externalEvent")[1],t.charAt(0).toLowerCase()+t.slice(1))]=e[r]);return n}}),tpComponentsModule.directive("externalEvent",["eventService","getExternalEventParams","trackExternalEvent","gaService",function(e,t,n,r){return{restrict:"A",link:function(o,i,a){i.on("submit click",function(o){if(~["click","submit"].indexOf(o.type)){var i=t(a);n("EXTERNAL_EVENT",a.externalEvent,i),e.customEvent("customEvent",{eventName:a.externalEvent,params:i}),r.sendCustomEvent(i)}})}}}]),tpComponentsModule.directive("showIf",["$animate",function(e){return{restrict:"A",link:function(e,t,n){e.$watch(n.showIf,function(e){t.html(toBoolean(e)?e:""),t.toggleClass("ng-hide",toBoolean(e))})}}}]),tpComponentsModule.factory("checkMobile",["$q","$timeout","containerService",function(e,t,n){return function(){return n.getNewWidth()<=600}}]),tpComponentsModule.directive("mobile",["checkMobile",function(e){return{restrict:"A",transclude:!0,scope:{},template:'<div class="mobile-mode" ng-if="check()" ng-transclude></div>',controller:["$scope",function(t){t.check=function(){return e()}}]}}]),tpComponentsModule.directive("desktop",["checkMobile",function(e){return{restrict:"A",transclude:!0,scope:{},template:'<div class="desktop-mode" ng-if="check()" ng-transclude></div>',controller:["$scope",function(t){t.check=function(){return!e()}}]}}]),tpComponentsModule.directive("onEnter",["$parse",function(e){return function(t,n,r){var o=e(r.onEnter);n.bind("keyup",function(e){13===e.keyCode&&t.$apply(function(){o(t,{$event:e})})})}}]),tpComponentsModule.directive("errorMessage",["$parse",function(e){return{scope:!1,controller:["$scope","$element","$attrs","ngEventService","errorService","shakeService",function(e,t,n,r,o,i){var a=o(e).TYPES,s=o(e).getId(),c=n.name,l=n.errorMessage,u=null,d=function(){u&&u.remove(),t.removeClass("error")},p=r.subscribe(EVENT_ERRORS_CHANGED,function(){d();var n=null,r=o(e).errors();angular.forEach(r,function(e){angular.isObject(e)&&e.field===c&&e.type===a.COMPONENT&&(n=e)}),!t.is(":visible")||!n||n.displayed&&n.displayedOn!==s||(n.displayed=!0,"shake"===l?(i.shake(t),t.addClass("error")):(u=$("<div class='"+l+"'>"+n.message+"</div>"),t.after(u),t.addClass("error")))});function m(){d()}t.click(function(){d()}),t.on("keydown",m),e.$on("$destroy",function(){p(),t.off("keydown",m)})}]}}]),tpComponentsModule.directive("config",["containerService","configService",function(e,t){return{restrict:"E",link:function(n,r,o){isNumber(o.width)&&(e.setConfigWidth(o.width),e.resize());var i=!1;angular.forEach(o,function(e,n){var r;r="$",n.substr(0,r.length)!==r&&(i=!0,t.setProperty(n,e))}),i&&t.changed()}}}]),tpComponentsModule.directive("hideIfBlank",["$animate",function(e){return{link:function(e,t){e.$watch(function(){},function(){var e=t.text().replace(/[\s\uFEFF\xA0\n]/gim,""),n=0===t.children().length&&""===e;t.toggleClass("ng-hide",n)})}}}]),tpComponentsModule.directive("reCaptcha",["ngEventService","checkMobile","containerService",function(e,t,n){var r,o,i=3;return{restrict:"EA",template:"",scope:{key:"@",showResetButton:"=?",onResolve:"&?",onReady:"&?",onExpired:"&?"},link:function(a,s){var c=!1;if(!a.key)return void console.warn("There is no re-captcha site-key. See more: https://developers.google.com/recaptcha/docs/display");function l(e){if(0!==e)try{r=grecaptcha.render(s.get(0),{sitekey:a.key,callback:m,"expired-callback":function(){a.onExpired&&a.onExpired()}}),a.showResetButton&&(s.addClass("re-captcha--right-padded"),p(r)),$(window).on("resize",_.debounce(u,300)),a.onReady&&a.onReady({id:r})}catch(t){setTimeout(function(){l(e--)},1e3)}else console.warn("ReCaptcha can't be initialized")}function u(){d(),function(){var e=n.getNewWidth()>320;if(!c)return void s.removeClass("re-captcha--mobile re-captcha--mobile-wide");e?s.addClass("re-captcha--mobile-wide"):s.removeClass("re-captcha--mobile-wide");s.addClass("re-captcha--mobile")}()}function d(){c=t()}function p(e){if(grecaptcha&&grecaptcha.reset){var t=document.createElement("div");t.className="reset-icon pn-icon--refresh",t.onclick=function(){grecaptcha.reset(e),p(e)},n=t,angular.element(".reset-icon.pn-icon--refresh").length||s.append(n)}var n}function m(e){s.addClass("captcha-resolved"),a.onResolve&&a.$apply(function(){a.onResolve({response:e})})}l(i),d(),o=e.subscribe("RECAPTCHA_RESET",function(){grecaptcha&&grecaptcha.reset&&grecaptcha.reset(r)}),a.resolve=m,s.on("$destroy",o)}}}]),tpComponentsModule.directive("ngEnter",function(){return function(e,t,n){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(n.ngEnter)}),t.preventDefault())})}}),tpComponentsModule.directive("tooltipComponent",["$document","$sce",function(e,t){return{restrict:"A",scope:{tooltipTitle:"@",tooltipCssClass:"@",tooltipType:"@",tooltipEllipsis:"@",tooltipDisabled:"="},compile:function(){return{pre:function(n,r,o){if("false"!==o.tooltip){r.addClass("tp-tooltip");var i=!1,a=e.find(".tp-tooltip-hover");0===a.length&&(a=$('<div class="tp-tooltip-hover"></div>'),e.find("body").append(a)),a.hide(),r.on("mousemove",function(e){0===n.tooltipTitle.length||i||(a.outerWidth()>e.pageX?a.offset({left:e.pageX,top:e.pageY+16}):a.offset({left:e.pageX-a.outerWidth()-16,top:e.pageY+16}))}),r.on("mouseenter",function(e){"ellipsis"===n.tooltipType&&r[0].scrollWidth<=r[0].offsetWidth||(!function(){if(void 0!==o.tooltipEllipsis){const e=r.find("> .ellipsis"),t=r.width(),n=function(e){const t=e&&e.text().trim(),n=$('<span style="position: fixed; visibility: hidden;white-space: nowrap">'+t+"</span>");angular.element(document.body).append(n);const r=n.width();return n.remove(),Math.round(r)}(e);return n>t}return!0}()?i=!0:0!==n.tooltipTitle.length?n.tooltipDisabled?i=!0:(n.tooltipCssClass&&a.addClass(n.tooltipCssClass),a.html(t.getTrustedHtml(n.tooltipTitle)),a.show()):i=!0)}).on("mouseleave",function(){i=!1,n.tooltipCssClass&&a.removeClass(n.tooltipCssClass),a.css("left","-999em"),a.hide()}),r.on("$destroy",function(){a.hide()}),r.on("click",function(){n.tooltipTitle.length}),n.$watch("tooltipTitle",function(e){a.html(t.getTrustedHtml(e))})}}}}}}]),tpComponentsModule.directive("tpDropdown",["$document",function(e){var t=null,n=angular.noop;return{restrict:"A",replace:!0,transclude:!0,scope:{alignment:"=",disabled:"=ngDisabled"},template:"<div ng-transclude></div>",link:function(r,o,i){i.alignment=void 0===i.alignment?"center":i.alignment;var a=o.find(".dropdown-menu"),s=o.find(".tp-drop-down-button");o.parent().bind("click",function(){n()}),o.bind("click",function(c){if(!r.disabled){c.preventDefault(),c.stopPropagation(),function(){var t=document.getElementsByClassName("tp-modal")[0],n=0;if(t){var r=t.getElementsByTagName("div")[0],c=r.getBoundingClientRect();n=c.top}"center"===i.alignment&&(p=parseInt(a.outerWidth(!0)/2-s.outerWidth(!0)/2),a.css({left:-p,right:"auto"}));if("left"===i.alignment){var l=o[0].getBoundingClientRect()||{},u=l.top+s.outerHeight(!0)+1-n,d=e.outerWidth(!0)-l.right||0,p=o.offset().left||0;p>a.outerWidth(!0)?a.css({top:u,right:d,left:"unset"}):a.css({top:u,left:p,right:"unset"})}}();var l=o===t;t&&n(),l||(o.addClass("open"),t=o,n=function(r){r&&(r.preventDefault(),r.stopPropagation()),e.unbind("click",n),o.removeClass("open"),n=angular.noop,t=null},e.bind("click",n))}})}}}]),tpComponentsModule.factory("dropdownTabNavigationService",["KEY_CODES",function(e){return function(t,n){const r='a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, [tabindex="0"], [contenteditable]',o=t.querySelector(n.toggleDropdownMenuButtonSelector);function i(t){t.key===e.ESCAPE?(n.closeMenu(),t.preventDefault(),n.isMenuOpened()&&t.stopPropagation()):t.key===e.ENTER?setTimeout(function(){l()},150):t.key===e.SPACE?setTimeout(function(){l()},150):t.key===e.TAB&&t.shiftKey&&n.isMenuOpened()&&n.closeMenu()}function a(){c().removeEventListener("keydown",s),c().addEventListener("keydown",s)}function s(o){if(o.key===e.ESCAPE)n.closeMenuOnClick(o),t.querySelector(n.toggleDropdownMenuButtonSelector).focus(),o.preventDefault(),o.stopPropagation();else if(o.key===e.TAB)n.closeMenuOnClick(o);else if([e.ARROW_UP,e.ARROW_DOWN].includes(o.key)){const t=function(e){const t=e.querySelectorAll(r);return Array.from(t).filter(d)}(c());let n=t.indexOf(document.activeElement);o.key===e.ARROW_DOWN?n=(n+1)%t.length:o.key===e.ARROW_UP&&(n=(n-1+t.length)%t.length),t[n].focus(),o.preventDefault()}}function c(){return t.querySelector(n.dropdownMenuContainerSelector)}function l(){u().focus()}function u(){return c().querySelector("button")}function d(e){for(;e;){if("none"===getComputedStyle(e).display)return!1;e=e.parentElement}return!0}return o.removeEventListener("keydown",i),o.addEventListener("keydown",i),{attachDropdownMenuEvents:function(){u().addEventListener("focus",a)},detachDropdownMenuEvents:function(){c().removeEventListener("keydown",s),u().removeEventListener("focus",a)}}}}]),angular.module("exceptionHandler",[]).factory("$exceptionHandler",["$log",function(e){return function(t,n){e.warn(t);var r=window.pnErrorWatcher;r&&r.manualLog(t)}}]),window.PP_LIST={CREDIT_CARD:4,MOCK:5,ZERO:0,PAYPAL_BT:11,EDGIL_PAYWAY:19,PAYPAL_EXPRESS_CHECKOUT:22,EIGEN:24,APPLE_PAY_BT:25,OPENPAY_CASH:26,EASYPAY_MULTIBANCO:28,EASYPAY_MBWAY:29,EASYPAY_DIRECT_DEBIT:30,EASYPAY_BOLETO:31,KLARNA:32,OBI:33,OBI_PAYPAL:34,DATATRANS:35,DATATRANS_POSTFINANCE:36,ONET:37,APPLE_PAY_SS:38,CYBER_SOURCE:39,STRIPE:40,STRIPE_APPLEPAY:41,PAYWAY_APPLEPAY:42,WIRECARD:45,CREDIT_GUARD_CC:66,PAY_U_BRAZIL_BOLETO:62,VOLGA:63,INVOICE_BASED_SECOND:72,INVOICE_BASED_FIRST:75,EPP:100},angular.extend(window,window.PP_LIST);var generalModule=angular.module("generalModule",["ui.router","ajaxServices","ngSanitize","JwtModule"]);function getMonths(){return{"01":"1 - Jan","02":"2 - Feb","03":"3 - Mar","04":"4 - Apr","05":"5 - May","06":"6 - Jun","07":"7 - Jul","08":"8 - Aug","09":"9 - Sept",10:"10 - Oct",11:"11 - Nov",12:"12 - Dec"}}function getYears(){for(var e=(new Date).getFullYear(),t={},n=e;n<e+13;++n){t[(n+"").substring(2)]=n}return t}function isString(e){return"string"==typeof e}function isNumber(e){return e&&""!==e&&!isNaN(e)}function lowercase(e){return isString(e)?e.toLowerCase():e}function toBoolean(e){if("function"==typeof e)e=!0;else if(e&&0!==e.length){var t=lowercase(""+e);e=!("f"===t||"0"===t||"false"===t||"no"===t||"n"===t||"[]"===t)}else e=!1;return e}function _randomString(e){e||(e=5);for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*n.length));return t}generalModule.constant("KEY_CODES",{ESCAPE:"Escape",ARROW_UP:"ArrowUp",ARROW_DOWN:"ArrowDown",ARROW_LEFT:"ArrowLeft",ARROW_RIGHT:"ArrowRight",ENTER:"Enter",SPACE:" ",TAB:"Tab"}),generalModule.constant("APPLE_PAY_IDENTIFIERS",{BRAINTREE:"applepaybt",STRIPE:"applepay_stripe",PAYWAY:"applepay_pw",DATATRANS:"datatrans_applepay"}),generalModule.constant("PAYMENT_METHOD_TYPES",{CARD:"credit_card",APPLE_PAY:"apple_pay"}),generalModule.factory("cookieService",function(){var e={getCookie:function(e){for(var t=e+"=",n=decodeURIComponent(document.cookie).split(";"),r=0;r<n.length;r++){for(var o=n[r];" "===o.charAt(0);)o=o.substring(1);if(0===o.indexOf(t))return o.substring(t.length,o.length)}return""},setCookie:function(e,t,n,r){var o=e+"="+t+";expires="+n;r&&(o+=";path="+r),document.cookie=o},eraseCookie:function(e,t){this.setCookie(e,"",(new Date).toUTCString(),t)}};return e});var util={debug:getParameterByName("debug"),log:function(){if(util.debug&&void 0!==window.console&&void 0!==window.console.log){var e=arguments;(function(){var e=["__webdriver_evaluate","__selenium_evaluate","__webdriver_script_function","__webdriver_script_func","__webdriver_script_fn","__fxdriver_evaluate","__driver_unwrapped","__webdriver_unwrapped","__driver_evaluate","__selenium_unwrapped","__fxdriver_unwrapped"],t=["_phantom","__nightmare","_selenium","callPhantom","callSelenium","_Selenium_IDE_Recorder"];for(var n in t){var r=t[n];if(window[r])return!0}for(var o in e){var i=e[o];if(window.document[i])return!0}for(var a in window.document)if(a.match(/\$[a-z]dc_/)&&window.document[a].cache_)return!0;return!!(window.external&&window.external.toString&&window.external.toString()&&-1!==window.external.toString().indexOf("Sequentum")||window.document.documentElement.getAttribute("selenium")||window.document.documentElement.getAttribute("webdriver")||window.document.documentElement.getAttribute("driver"))})()&&(e=function(e){var t="";try{for(var n=0;n<e.length;n++)try{t+=JSON.stringify(e[n])+", "}catch(e){t+=""+e}return e=[t]}catch(t){return e}}(e)),"object"==typeof window.console.log?window.console.log.apply.call(console.log,console,e):console.log.apply(console,e)}}},urlParams=null;function getDeviceType(){const e=navigator.userAgent;return/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(e)?"tablet":/Mobile|iP(hone|od)|Android|BlackBerry|IEMobile|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(e)?"mobile":"desktop"}function getActiveState(){return angular.element(document.body).injector().get("viewService").getActiveState()}function getSelectedTermId(){const e=angular.element(document.body).injector().get("checkout").getSelectedTerm();return e?e.termId:null}function getParameterByName(e){if(!urlParams){var t,n=/\+/g,r=/([^&=]+)=?([^&]*)/g,o=function(e){return decodeURIComponent(e.replace(n," "))},i=window.location.search.substring(1);for(urlParams={};t=r.exec(i);)urlParams[o(t[1])]=o(t[2])}var a=urlParams[e];return!a&&window.TPParam&&window.TPParam.params&&(a=window.TPParam.params[e]),a}function getQueryParamInStringByName(e,t){var n=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(e);return null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))}function getIntParam(e,t){var n=getParameterByName(e);return void 0!==n&&isNaN(n)?t:new Number(n)}BaseComponentController={_isValid:function(){return!0},displayErrors:function(e,t,n,r){if(t)if(Array.isArray(t))for(var o=0;o<t.length;o++){let e=t[o].msg||t[o].message;e&&""!==e.trim()&&i(e)}else"object"!=typeof t?"string"==typeof t&&i(t):t.message?i(t.message):util.log("Unable to extract error message",t);function i(t){n(e).global(t),r.checkoutPaymentErrorEvent(t)}}};var EVENT_CHECKOUT_PAYMENT_METHODS_CHANGED="EVENT_CHECKOUT_PAYMENT_METHODS_CHANGED",EVENT_CHECKOUT_TERM_SELECTED="EVENT_CHECKOUT_TERM_SELECTED",EVENT_APPLY_REDEEM_CODE="EVENT_APPLY_REDEEM_CODE",EVENT_CHECKOUT_CONSENT_CHANGED="EVENT_CHECKOUT_CONSENT_CHANGED",EVENT_CHECKOUT_RESET_SELECTED_PAYMENT_METHOD="EVENT_CHECKOUT_RESET_SELECTED_PAYMENT_METHOD",EVENT_CHECKOUT_PRICE_CHANGED="EVENT_CHECKOUT_PRICE_CHANGED",EVENT_CHECKOUT_APPLY_NEW_PRICE_ERROR="EVENT_CHECKOUT_APPLY_NEW_PRICE_ERROR",EVENT_CHECKOUT_REDEEM_DONE="EVENT_CHECKOUT_REDEEM_DONE",EVENT_APPLE_PAY_CAN_MAKE_PAYMENTS="EVENT_APPLE_PAY_CAN_MAKE_PAYMENTS",EVENT_BILLING_COUNTRY_SELECTED="EVENT_BILLING_COUNTRY_SELECTED",EVENT_COUNTRY_OF_RESIDENCE_SELECTED="EVENT_COUNTRY_OF_RESIDENCE_SELECTED",EVENT_SAME_RESIDENCE_CHECKBOX_CHANGED="EVENT_SAME_RESIDENCE_CHECKBOX_CHANGED",EVENT_BILLING_FROM_TAX_REQUEST="EVENT_BILLING_FROM_TAX_REQUEST",EVENT_ZIP_CODE_CHANGED="EVENT_CC_ZIP_CODE_CHANGED",EVENT_CC_ZIP_CODE_CHANGED="EVENT_CC_ZIP_CODE_CHANGED",EVENT_USER_ACCESS_CHANGED="EVENT_USER_ACCESS_CHANGED",EVENT_ERRORS_CHANGED="EVENT_ERRORS_CHANGED",EVENT_TERMINAL_ERROR="EVENT_TERMINAL_ERROR",EVENT_CONFIG_RELOAD="EVENT_CONFIG_RELOAD",EVENT_STATS_TRACKED="EVENT_STATS_TRACKED",EVENT_TRACKING_ID_CHANGED="EVENT_TRACKING_ID_CHANGED",EVENT_PAY_WITH_NEW_CHANGED="EVENT_PAY_WITH_NEW_CHANGED",EVENT_UPDATE_BILLING_ADDRESS_REGION="EVENT_UPDATE_BILLING_ADDRESS_REGION",EVENT_PAY_WHAT_YOU_WANT_SHOULD_BE_APPLIED="EVENT_PAY_WHAT_YOU_WANT_SHOULD_BE_APPLIED",EVENT_EXPERIAN_ADDRESS_CHANGED="EVENT_EXPERIAN_ADDRESS_CHANGED",EVENT_RESET_ERRORS="EVENT_RESET_ERRORS",EVENT_HIGHLIGHT_ERROR_FIELDS="EVENT_HIGHLIGHT_ERROR_FIELDS",EVENT_TAX_VALIDATION_FAILED="EVENT_TAX_VALIDATION_FAILED",ENABLE_SAVE_BUTTON="ENABLE_SAVE_BUTTON",DISABLE_SAVE_BUTTON="DISABLE_SAVE_BUTTON",EVENT_SAME_RESIDENCE_CHANGE="EVENT_SAME_RESIDENCE_CHANGE",EVENT_SETUP_CUSTOM_VARIABLES="setupCustomVariables",EVENT_SETUP_AFFILIATE_STATE="setupAffiliateState",EVENT_SETUP_EVT_FIELDS="setupEVTFields",EVENT_ADD_CARD="EVENT_ADD_CARD",EVENT_INIT_BANCARD="EVENT_INIT_BANCARD",EVENT_GOTO_PREVIOUS_STATE="EVENT_GOTO_PREVIOUS_STATE",EVENT_TEMPLATE_RELOADED="EVENT_TEMPLATE_RELOADED",EVENT_TEMPLATE_LOGIN_CHECK_FINISHED="EVENT_TEMPLATE_LOGIN_CHECK_FINISHED",EVENT_TEMPLATE_LOGIN_SUCCESS="EVENT_TEMPLATE_LOGIN_SUCCESS",EVENT_TERMINATE_SESSION_COMPLETED="terminateSessionCompleted",EVENT_TERMINATE_SESSION_INITIATED="terminateSessionInitiated",EVENT_TERMINATE_SESSION_CANCELED="terminateSessionCanceled",EVENT_RELOAD_OFFER="reloadOffer",EVENT_TEMPLATE_INITIATED="templateInitiated",EVENT_PREVENT_CLOSE="eventPreventClose",EVENT_SESSIONS_UPDATED="EVENT_SESSIONS_UPDATED",EVENT_UPDATE_SCOPE_VALUES="EVENT_UPDATE_SCOPE_VALUES";generalModule.factory("ngEventService",["$rootScope",function(e){var t={fire:function(t,n,r,o,i,a){if(!t||""===t)throw new Error("eventName is required");util.log("[NG EVENT SERVICE] Firing event:",arguments),e.$broadcast(t,n,r,o,i,a)},subscribe:function(t,n){if(!t||""===t)throw new Error("eventName is required");if(!n)throw new Error("callback is required");return e.$on(t,n.bind(arguments))}};return t}]),generalModule.factory("stateService",function(){var e={active:!(TPParam&&TPParam.params?TPParam.params:{}).preload};return{get:function(t){return e[t]},set:function(t,n){e[t]=n}}}),generalModule.factory("eventLogger",["$http","$window",function(e,t){var n={log:"https://api.tinypass.com/api/v3/anon/error/log"};function r(r,i){try{var a=function(){var e={aid:null,offerId:null,gaTrackingId:null},n=location.href.match(/aid=([\w\d]+)&/),r=location.href.match(/offerId=([\w\d]+)&/);return n&&(e.aid=n[1]),r&&(e.offerId=r[1]),t.ga&&t.ga(function(t){e.gaTrackingId=t.get("trackingId")}),e}(),s=function(e,t,n){var r,o,i=[];try{r="string"==typeof t?{message:t}:JSON.stringify(t)}catch(e){r="parse error"}try{o=JSON.stringify(n)}catch(e){o="meta error"}return i.push("=====checkout event====="),i.push("eventName: "+e),t&&i.push("payload: "+r),i.push("meta: "+o),i.push("=====event body end====="),i.join("\n")}(r,i,a);if(!a)return;if(-1===["lGr3ciYmC7","6qv8OniKQO","bMMF5VBfpu","FU52w9tupu","HTa7sve2pu","6N1iEZE6pe","Dqaa75yqpu"].indexOf(a.aid)&&"edgilHostedPageSubmitForm"!==r)return;e({method:"POST",url:n.log,data:"log_message="+o(s),headers:{"Content-Type":"application/x-www-form-urlencoded","Piano-request-without-spinner":1}})}catch(e){console.warn("can't log event due to:",e)}}function o(e){var t=getParameterByName("widget"),n=[{message:e,tags:t?[t]:[]}];return JSON.stringify(n)}return{logGaEvent:function(e){r("gaEvent",e)},logGaFailedEvent:function(e){r("gaEvent [FAILED]",e)},logEvent:r}}]),generalModule.factory("gaService",["$window","stateService","integrationEventsService","eventLogger","eventService","$q","ngEventService",function(e,t,n,r,o,i,a){var s=["showOffer","termSelected","promoApplied","promoInvalid","loginSuccess","loginFailed","registrationFailed","registrationSuccess","checkoutSuccess"],c={sendGoogleAnalyticsEvent:function(e){if(e){e.eventCategory=e.eventAction;var t=" ";e.eventAction="",angular.forEach(e.params,function(n,r){n&&(e.eventAction+=t+r+"_"+n,t="____",e.eventLabel+=" "+r+":"+n)});var n={};-1!==s.indexOf(e.eventCategory)&&(n.nonInteraction=!0);var i={eventCategory:e.eventCategory,eventAction:e.eventAction,eventLabel:e.eventLabel};o.emitGAEvent(Object.assign(i,e.params,n)),r.logGaEvent(e)}},emitEvent:function(e,t,n){n=n||{},o.emitGAEvent(Object.assign({eventLabel:e,eventCategory:t},n))},sendCheckoutCloseEvent:function(e){c.emitEvent("Checkout close","checkoutClose",e)},sendCustomEvent:function(e){c.emitEvent("Checkout custom event","checkoutCustomEvent",e)},sendCheckoutStateChangeEvent:function(e,t){c.emitEvent("Checkout state change","checkoutStateChange",{stateName:e,offerId:TPParam.config.offerId,termId:t&&t.termId,term:t})},sendStartCheckoutEvent:function(e){c.emitEvent("Start checkout","startCheckout",e)},sendLoginRequiredEvent:function(e){c.emitEvent("Login required","loginRequired",e)},sendShowTemplateEvent:function(e){c.emitEvent("Show template","showTemplate",e)}};return c}]),generalModule.factory("statsService",["ngEventService","stateService","$q","$http","exposeJsonParameter",function(e,t,n,r,o){var i={},a=null,s=null,c=[],l=[],u=[],d=!1,p=null,m="tpcc_",f="terms",g=["aid","preview","userProvider","userToken","url","tags","tbc","contentCreated","contentSection","contentType","contentAuthor","experienceId","experienceExecutionId","experienceActionId","browserId","userState","pageViewId","visitId","trackingId","previewTemplateVersion","offerId","checkoutFlowId","offerTemplateId","templateId","templateVariantId","offerTemplateVariantId","pageTitle","referrerUrl","templatePubId","templateVersionPubId","templateVersion","templateCategory","isPasswordlessCheckoutEnabled","isSingleStepEnabled","isDoubleOptInEnabled","affiliateState","deviceId"],h=["aid","preview","userProvider","userToken"];function E(){if(s)return n.when(y());var e=n.defer();return c.push(e),e.promise}function v(){if(s)return n.when(C());var e=n.defer();return l.push(e),e.promise}function C(){return d?{checkoutStats:i}:{initStatParams:s}}function y(){return{checkoutStats:i,initStatParams:s}}function T(e){E().then(function(){angular.extend(i,e)})}function S(e){p=e}return{getStatsPayload:v,getStats:E,mergeStats:T,getParams:function(){var e=n.defer();return a?e.resolve(a):u.push(e),e.promise},trackView:function(e){S(e),"offer"!==e&&TPParam.TRACK_VIEW&&v().then(function(t){r({method:"POST",url:TPParam.TRACK_VIEW,params:{view:e},data:t,headers:{"Piano-request-without-spinner":1}}).then(function(e){e&&e.models&&e.models.checkoutStats&&T(e.models.checkoutStats)})})},setCheckoutView:S,getPageView:function(){let e=y(),t=null,n=null,r=null,o=null,i=null,a=null,s=null;return e&&e.initStatParams&&(t=e.initStatParams.tbc,n=e.initStatParams.pageViewId,r=e.initStatParams.browserId,o=e.initStatParams.pageTitle,i=e.initStatParams.trackingId,a=e.initStatParams.userState,s=e.initStatParams.deviceId),{tbc:t,pageViewId:n,browserId:r,pageTitle:o,trackingId:i,userState:a,deviceId:s}},handleTrackStatEvent:function(n,E){if(t.set("active",!0),!TPParam.TRACK_SHOW)return;s=function(e,t){var n={};return function(e,t,n){g.forEach(function(r){e&&e[r]?n[r]=e[r]:t&&t[r]&&(n[r]=t[r])})}(e,t,n),function(e,t,n){var r;if(e&&e[f]?r=e[f]:t&&t[f]&&(r=t[f]),Array.isArray(r)){var o=[];r.forEach(function(e){e&&o.push(e.termId)}),n.termIds=o}}(e,t,n),P(t,n),P(e,n),function(e){e.checkoutView=p}(n),n.cookie_consents=JSON.stringify(piano.getCookieConsents()),function(e){e.previous_user_segments=piano.getUserSegments()}(n),function(e){e.userState=piano.getUserState()}(n),function(e,t,n){"upgradeOffer"===e.offerType&&(t&&t.changeOptions&&(n.shownTerms=t.changeOptions.map(function(e){return e.termToId}),n.shownUpgradeOptions=t.changeOptions),e&&e.termId&&(n.termId=e.termId),e&&e.termChangeOptionId&&(n.upgradeOptionId=e.termChangeOptionId))}(e,t,n),function(e,t){var n=o(e.sessions||null,null);t.isSessionLimitReached=n?n.hit_limit:n}(e,n),n}(E,TPParam.config),A(E,i,s);let v,T={},S=E.oid&&E.termId3ds;function P(e,t){e&&$.each(e,function(e,n){0===e.indexOf(m)&&(t[e]=n)})}function A(e,t,n){i=t,a=e,s=n}function _(){c.forEach(function(e){e.resolve(y())}),c=[],l.forEach(function(e){e.resolve(C())}),l=[],u.forEach(function(e){e.resolve(a)}),u=[],e.fire(EVENT_STATS_TRACKED,{params:a,stat:i})}S?(T.oid=E.oid,T.restoreCheckoutStats=!0,v=function(e){let t={};return h.forEach(function(n){e[n]&&(t[n]=e[n])}),t}(s)):(v={initStatParams:s},_()),r({method:"POST",url:function(){let e=TPParam.TRACK_SHOW,t=getParameterByName("lang");return t&&(e=e+"?lang="+t),e}(),params:T,data:v,headers:{"Piano-request-without-spinner":1}}).then(function(e){d=!0,A(E,e.data.models.stats,s),S&&_()})}}}]),generalModule.factory("browserIdService",["ngEventService","$q",function(e,t){var n=t.defer();return e.subscribe("passBrowserId",function(e,t){n.resolve(t.browserId)}),{getBrowserId:function(){return n.promise}}}]),generalModule.run(["ngEventService",function(e){e.subscribe("passPcidBrowserId",function(e,t){piano.setBrowserId(t.browser_id)}),e.subscribe("passPageViewContext",function(e,t){piano.setPageViewContext(t)}),e.subscribe("passCookieConsents",function(e,t){piano.setCookieConsents(t)}),e.subscribe("passUserSegments",function(e,t){piano.setUserSegments(t)}),e.subscribe("passUserState",function(e,t){piano.setUserState(t)})}]),generalModule.factory("configService",["ngEventService",function(e){var t={};return{get:function(){return t},setProperty:function(e,n){t[e]=n},changed:function(){e.fire(EVENT_CONFIG_RELOAD,t)}}}]),generalModule.factory("apiService",["$http",function(e){var t={method:"post",headers:{"Piano-request-without-spinner":1}};return{call:function(n,r,o){var i=angular.copy(t);return i.url="/api/v3"+n,o&&(i.method=o),i.params=r,e(i)}}}]),generalModule.factory("modalService",["$rootScope","$q","$http","$templateCache","$injector","$timeout","$document","$compile","$controller","KEY_CODES",function(e,t,n,r,o,i,a,s,c,l){var u={},d={created:!1,visible:!1,domEl:null},p={created:!1,scope:null,domEl:null},m=function(t,n,r){var o=a.find("body").eq(0);if(!d.created){var c=e.$new(!0),u=s('<div class="modal-overlay"></div> ')(c);o.append(u),d.created=!0,d.domEl=u}if(!d.visible){var m=$(d.domEl),f=r.speed||600;m.addClass("active"),m.animate({opacity:1},f),d.visible=!0}var g=angular.element('<div class="modal '+(r.class||"")+'"></div>');g.addClass("active"),g.animate({opacity:1},f),g.html(n.content),g.prepend('<div tabindex="0" class="ma-modal-title"></div>');var h=s(g)(n.scope);p.created=!0,p.scope=n.scope,p.domEl=g,d.domEl.append(h),i(function(){var e,t;a.find("body").eq(0).find('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])').each(function(){var e=angular.element(this);if(!p.domEl[0].contains(this)){var t=e.attr("tabindex");t&&e.attr("data-original-tabindex",t),e.attr("tabindex","-1"),e.attr("data-focus-disabled","true")}}),e=p.domEl.find(".tp-close--last"),t=p.domEl.find(".ma-modal-title"),e.length&&t.length?(e.on("keydown",function(e){e.key!==l.TAB||e.shiftKey||(e.preventDefault(),t.focus())}),t.on("keydown",function(t){t.key===l.TAB&&t.shiftKey&&(t.preventDefault(),e.focus())}),t.focus()):p.domEl.find("button")[0].focus()},0)},f=function(e,t,n){var r,o,i=t.speed||600;a.find("body").eq(0).find('[data-focus-disabled="true"]').each(function(){var e=angular.element(this),t=e.attr("data-original-tabindex");e.removeAttr("data-focus-disabled"),t?(e.attr("tabindex",t),e.removeAttr("data-original-tabindex")):e.removeAttr("tabindex")}),d.created&&d.visible&&($(d.domEl).animate({opacity:0},i,"swing"),$(d.domEl).removeClass("active"),d.visible=!1),p.created&&(r=p.domEl.find(".tp-close--last"),o=p.domEl.find(".ma-modal-title"),r.length&&r.off("keydown"),o.length&&o.off("keydown"),$(p.domEl).animate({opacity:0,marginTop:0},i,"swing",function(){$(p.domEl).removeClass("active"),$(p.domEl).removeClass("error"),p.domEl.remove(),p.scope.$destroy(),p.scope=null,p.domEl=null,p.created=!1,a.find(".ma-navigation__tab.active a").eq(0).focus(),n&&n()}))};return u.openDialog=function(i){var a,s,l,u={close:function(e){f(0,i,e)}};if(util.log("MODAL OPTIONS",i),!i.template&&!i.templateUrl)throw new Error("One of template or templateUrl options is required.");t.all([(l=i,l.template?t.when(l.template):n.get(l.templateUrl,{cache:r}).then(function(e){return e.data}))].concat((a=i.resolve,s=[],angular.forEach(a,function(e,n){(angular.isFunction(e)||angular.isArray(e))&&s.push(t.when(o.invoke(e)))}),s))).then(function(t){var n=(i.scope||e).$new();n.close=u.close;var r={},o=1;i.controller&&(r.$scope=n,r.$modalInstance=u,angular.forEach(i.resolve,function(e,n){r[n]=t[o++]}),c(i.controller,r)),m(0,{scope:n,content:t[0]},i)})},u.getModalEl=function(){return p?p.domEl:null},u}]),generalModule.factory("shakeService",function(){var e={shake:function(e){for(var t=Math.random()<.5?-2:2,n=0;n<10;n++)$(e).animate({"margin-left":(t=-t)+"px"},10+2*n);$(e).animate({"margin-left":0},5)}};return e}),generalModule.factory("EventManager",function(){return function(){var e={};return{emit:function(t,n){r(t);var o=e[t];if(!o)return void console.info("Event `",t,"` with no subscribers was emitted.");o.forEach(function(e){e.call(this,n)})},subscribe:t,getEventSubscriptionFunc:function(e){return t.bind(null,e)},unsubscribe:n};function t(t,o){r(t),function(e){if("function"!=typeof e)throw new TypeError("Expected callback to be a function, but got "+e)}(o);var i=e[t];return i||(i=e[t]=[]),i.push(o),n.bind(null,t,o)}function n(t,n){r(t);var o=e[t];if(o){var i=o.indexOf(n);-1!==i?o.splice(i,1):console.warn("Given callback was not found for the event `{0}`.".format(t))}else console.warn("Attempt to unsubscribe from the unknown event `{0}`.".format(t))}function r(e){if(!e)throw new TypeError("Expected event name to be a non-empty string, but got "+e)}}}),generalModule.directive("customScript",["$parse",function(e){return{restrict:"EA",scope:{},link:function(t,n){function r(n){var r=n.substring(2,n.length-1),o=e(r)(t.$parent);return"string"==typeof o?'"'+o+'"':o}function o(e){try{e=function(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"')}(function(e){return e?e.replace(/#{(.*?)}/g,r):e}(e))}catch(e){console.error(e)}return"try {\n"+e+"\n} catch (e) { console.error(e); }"}n.ready(function(){var e=document.createElement("script"),t=o(n.html());e.type="text/javascript",e.innerHTML=t,n.empty(),document.body.appendChild(e)})}}}]),generalModule.directive("boilerplateCloseButton",["configService",function(e){return{restrict:"E",transclude:!0,replace:!0,template:"<button ng-if='isShowBoilerplateCloseButton()' class='boilerplate-close-button' type='button' ng-click='close()' aria-label=\"{{'Close the modal' | t}}\"></button>",link:function(t,n,r){t.isShowBoilerplateCloseButton=function(){var t=e.get().closeButtonType,n="false"!==getParameterByName("showCloseButton"),r="inline"!==getParameterByName("displayMode");return n&&"boilerplate"===t&&r}}}}]),generalModule.directive("pnSticky",["$timeout","$interval","utilsService",function(e,t,n){return{restrict:"A",link:function(e,r){var o=r.parent(),i=o[0];o.scroll(n.throttle(function(){l(),i.scrollHeight>i.clientHeight?c||(r.css({position:"fixed",bottom:"0"}),c=!0):c&&(r.css({position:"static",bottom:""}),c=!1)},200));var a=t(function(){i.scrollHeight>i.clientHeight&&(r.css({position:"fixed",bottom:"0"}),l())},100,100),s=!1,c=!1;function l(){s||(t.cancel(a),s=!0)}e.$on("$destroy",l)}}}]),generalModule.factory("windowStateService",[function(){return{checkIframeOrChildWindow:function(){return!0}}}]),generalModule.factory("exposeTemplateParams",function(){return function(e){var t=["aid","debug","displayMode","iframeId","offerId","tags","templateId","templateVariantId","url","width"].concat(["trackingId","experienceId","experienceExecutionId","experienceActionId","sessions"]),n={};return angular.forEach(t,function(t){e[t]&&(n[t]=e[t])}),n}}),generalModule.factory("exposeJsonParameter",function(){return function(e,t){var n=t;try{n=JSON.parse(e)}catch(e){}return n}}),generalModule.service("integrationEventsService",function(){this.dispatchLocal=function(e,t){IntegrationEvents.dispatchLocal(e,t)},this.listenExternal=function(e,t){IntegrationEvents.listenExternal(e,t)},this.listenLocal=function(e,t){IntegrationEvents.listenLocal(e,t)}}),generalModule.factory("topLocation",["$window","eventService","$q",function(e,t,n){var r=function(){var r=n.defer();return t.postMessage("getLocation",{resultCallback:function(t){var n=e.document.createElement("a");n.href=t.result,r.resolve(n)}}),r.promise};return r.hash=function(e){t.postMessage("setLocationHash",{hash:e})},r}]),generalModule.factory("addQueryParameterToUrl",function(){return function(e,t,n){var r,o;e.indexOf("#")>0?(o=e.indexOf("#"),r=e.substring(e.indexOf("#"),e.length)):(r="",o=e.length);var i=e.substring(0,o).split("?"),a="?";if(i.length>1){var s=i[1];s.length&&(a+=s+"&")}return a+=t+"="+encodeURIComponent(n),i[0]+a+r}}),generalModule.factory("setupTrackingId",["ngEventService",function(e){return function(t){var n=piano._getTrackingId();piano._setTrackingId(t),n!==t&&e.fire(EVENT_TRACKING_ID_CHANGED,t)}}]),generalModule.service("utilsService",["cookieService","lang","jwtService",function(e,t,n){this.isIphone=function(){return/iPhone/.test(navigator.userAgent)&&!window.MSStream},this.isIOS=function(){return!!navigator.platform&&/iP(ad|hone|od)/.test(navigator.platform)},this.isFbOrInstagramApp=function(){var e=navigator.userAgent||navigator.vendor||window.opera;return e.indexOf("FBAN")>-1||e.indexOf("FBAV")>-1||e.indexOf("Instagram")>-1},this.isMobileUserAgent=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},this.contains=function(e,t){return angular.isArray(e)?e.some(function(e){return e===t}):(util.log("method contains() works only with Arrays"),!1)},this.last=function(e){if(angular.isArray(e))return e[e.length-1];util.log("method last() works only with Arrays")},this.forEach=function(e,t){return angular.isArray(e)?(e.forEach(function(e,n){t(e,n)}),e):angular.isObject(e)?(Object.keys(e).forEach(function(n){t(e[n],n)}),e):e},this.map=function(e,t){return angular.isArray(e)?e.map(function(e,n){return t(e,n)}):angular.isObject(e)?Object.keys(e).map(function(n){return t(e[n],n)}):[]},this.reduce=function(e,t,n){if(angular.isArray(e))return e.reduce(t,n)},this.find=function(e,t){if(angular.isArray(e))return e.find(t);util.log("method find() works only with Arrays")},this.filter=function(e,t){return angular.isArray(e)?e.filter(t):(util.log("method filter() works only with Arrays"),[])},this.omit=function(e,t){var n=[],r={};return"string"==typeof t&&(n=[t]),angular.isArray(t)&&(n=[].concat(t)),angular.isArray(e)&&e.forEach(function(e,t){r[t]=e}),angular.isObject(e)&&!angular.isArray(e)&&(r=angular.extend({},e)),n.forEach(function(e){delete r[e]}),r},this.debounce=function(e,t,n){var r;return function(){var o=this,i=arguments,a=n&&!r;clearTimeout(r),r=setTimeout(function(){r=null,n||e.apply(o,i)},t),a&&e.apply(o,i)}},this.setExtendExpiredAccessCookie=function(t,n){var r=new Date;r.setMonth(r.getMonth()+6),e.setCookie(t+"__eea",n?"true":"false",r.toUTCString(),"/")},this.removeExtendExpiredAccessCookie=function(t){e.eraseCookie(t+"__eea","/")},this.jwtDecode=function(e,t){return n.decode(e,t)},this.throttle=function(e,t){var n,r,o=!1;return function i(){if(o)return n=arguments,void(r=this);e.apply(this,arguments),o=!0,setTimeout(function(){o=!1,n&&(i.apply(r,n),n=r=null)},t)}},this.combine=function(e){return function(){e.forEach(function(e){"function"==typeof e&&e()})}};var r=/^([_A-Za-z0-9-&№^=%'"!?*+./#\\$]+)@([_A-Za-z0-9-&№^=%'"!?*+./#\\]+)\.([_A-Za-z0-9-+.]+)$/;this.isEmailValid=function(e){var t=e&&e.trim();return!!t&&(!(t.length>255)&&r.test(t))},this.queryStringToMap=function(e){var t={};if(!e)return t;for(var n,r=/\+/g,o=/([^&=]+)=?([^&]*)/g,i=function(e){return decodeURIComponent(e.replace(r," "))};n=o.exec(e);)t[i(n[1])]=i(n[2]);return t},this.getCustomErrorMessages=function(e){var n={},r=e.find("[error-custom-msg]");return r.length&&r.each(function(e,r){n[r.name]=t.trc("checkout.platform",r.getAttribute("error-custom-msg"))}),n}}]),generalModule.factory("getTrackingId",function(){return function(){return piano._getTrackingId()}}),generalModule.factory("trackExternalEvent",function(){return function(e,t,n){piano._logAutoMicroConversion(e,t,n)}}),generalModule.factory("interceptAjax",["lang",function(e){tinypass.loadingStatusContainerId="loading-status",tinypass.waitLockedBy=null,tinypass.withoutWaitPanel=!1;var t=null;return tinypass.showWaitPanel=function(e,t){"function"==typeof window.CustomEvent&&document.dispatchEvent(new CustomEvent("EVENT_SHOW_WAIT_PANEL",{detail:{id:e,content:t}}))},tinypass.hideWaitPanel=function(e){(!e&&"others"===tinypass.waitLockedBy||e===tinypass.waitLockedBy)&&(t&&(t.stop(),t.remove()),tinypass.waitLockedBy=null)},tinypass.generateLoadingStatusContainer=function(){const e=document.getElementById(tinypass.loadingStatusContainerId);e&&e.remove();const t=Object.assign(document.createElement("div"),{id:tinypass.loadingStatusContainerId,role:"status",className:"visually-hidden"});return t.setAttribute("aria-live","polite"),t},tinypass.refreshLoadingStatusInContainer=function(e){const t=document.getElementById(tinypass.loadingStatusContainerId);t&&(t.innerHTML=e)},{appendLoaderTo:function(n){document.addEventListener("EVENT_SHOW_WAIT_PANEL",function(r){!function(r){if(tinypass.withoutWaitPanel||tinypass.waitLockedBy)return;tinypass.waitLockedBy=r.detail.id||"others",t&&t.remove();t=r.detail.content?$('<div id="waitParent">'+r.detail.content+"</div>"):$('<div id="waitParent"><div id="waitPanel">'+e.tr("Loading...")+"</div></div>");$("."+n).prepend(t)}(r)})}}}]),generalModule.factory("keysService",[function(){return{isEscape:function(e){return"Esc"===e||"Escape"===e},isEnter:function(e){return"Enter"===e},isSpace:function(e){return" "===e}}}]),generalModule.factory("windowService",["$window",function(e){var t,n;return{openWindow:function(o,i){return r(),t&&(t.close(),t=null),t=e.open(o.url,o.target,o.features),n=setInterval(function(){t?t.closed&&(i&&i(),r()):r()},1e3),t}};function r(){n&&(clearInterval(n),n=null)}}]),generalModule.filter("encodeURIComponent",["$window",function(e){return e.encodeURIComponent}]);var Helper=function(){};Helper.wrapMethod=function(e,t,n){n[e]=function(n,r,o){return t[e](n,r,o)}};var IntegrationEvents=function(){var e={"externalApiFieldset.change":"externalApiFieldset.change","ga.created":"ga.created","ga.performance.tracker.created":"ga.performance.tracker.created"},t="_piano_._local_.",n="_piano_._external_.";function r(e){return t+e}function o(e){return n+e}function i(t){if(!(t in e))throw new Error("event "+t+" is not recognized")}function a(e){var t=angular.isDate(e),n=angular.isArray(e),r=angular.isObject(e);return t?new Date(e):n?angular.copy(e,[]):r&&!n?angular.copy(e,{}):e}return{dispatchLocal:function(e,t){i(e),document.dispatchEvent(new CustomEvent(r(e),{detail:a(t)}))},dispatchExternal:function(e,t){i(e),document.dispatchEvent(new CustomEvent(o(e),{detail:a(t)}))},listenLocal:function(e,t){document.addEventListener(r(e),function(e){t(e)})},listenExternal:function(e,t){document.addEventListener(o(e),function(e){t(e)})}}}();Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var r=arguments[1],o=0;o<n;){var i=t[o];if(e.call(r,i,o,t))return o;o++}return-1}});var piano=function(e){var t={},n={listen:function(t,n){e.listenLocal(t,n)},externalEvent:function(t,n){e.dispatchExternal(t,n)},_setTrackingId:function(e){t.trackingId=e},_getTrackingId:function(){return t.trackingId},setBrowserId:function(e){t._browserId=e},setPageViewContext:function(e){t._pageViewContext=e},getPageViewContext:function(){return t._pageViewContext||{}},setCookieConsents:function(e){t._cookieConsents=e},getCookieConsents:function(){return t._cookieConsents},setUserSegments:function(e){t._userSegments=e},getUserSegments:function(){return t._userSegments},setUserState:function(e){t._userState=e},getUserState:function(){return t._userState},getBrowserId:function(){return t._browserId}},r=function(e,n){if(t.trackingId)switch(((TPParam||{}).params||{}).os||"desktop"){case"ios":case"android":o(e,n);break;default:parent.postMessage(JSON.stringify({event:"iframeLogRequest",url:e,queryParams:n}),"*")}},o=function(e,t){var n=[];for(var r in t){var o=t[r];n.push(encodeURIComponent(r)+"="+encodeURIComponent("object"==typeof o?JSON.stringify(o):o))}var i=e+"?"+(n=n.join("&"));if(!util.debug&&navigator.sendBeacon)navigator.sendBeacon(i);else{var a=new XMLHttpRequest;a.open("GET",i,!1),a.send()}};n._logAutoMicroConversion=function(e,n,o){var i=Object.assign(piano.getPageViewContext(),{tracking_id:t.trackingId,browser_id:t._browserId,event_type:e,event_group_id:n,custom_params:o||"",cookie_consents:piano.getCookieConsents(),previous_user_segments:piano.getUserSegments(),user_state:piano.getUserState()});void 0!==n?void 0!==e?r("/api/v3/conversion/logAutoMicroConversion",i):util.log("Parameter eventType is required to log micro conversion."):util.log("Parameter eventGroupId is required to log micro conversion.")},n.logFunnelStep=function(e,n,o){var i=Object.assign(piano.getPageViewContext(),{tracking_id:t.trackingId,browser_id:t._browserId,step_number:e,step_name:n,custom_params:o||"",cookie_consents:piano.getCookieConsents(),previous_user_segments:piano.getUserSegments(),user_state:piano.getUserState()});void 0!==e?void 0!==n?r("/api/v3/conversion/logFunnelStep",i):util.log("Parameter stepName is required to log funnel step."):util.log("Parameter stepNumber is required to log funnel step.")},n.logMicroConversion=function(e,n){var o=Object.assign(piano.getPageViewContext(),{tracking_id:t.trackingId,browser_id:t._browserId,event_group_id:e,custom_params:n||"",cookie_consents:piano.getCookieConsents(),previous_user_segments:piano.getUserSegments(),user_state:piano.getUserState()});void 0!==e?r("/api/v3/conversion/logMicroConversion",o):util.log("Parameter eventGroupId is required to log micro conversion.")};var i=function(e,n,o,i,a,s,c){var l=Object.assign(piano.getPageViewContext(),{tracking_id:t.trackingId,browser_id:t._browserId,term_id:e,term_name:n,cookie_consents:piano.getCookieConsents(),previous_user_segments:piano.getUserSegments(),user_state:piano.getUserState()});void 0!==e?void 0!==n?(void 0!==o&&(l.step_number=o),void 0!==i&&(l.amount=i),void 0!==a&&(l.currency=a),void 0!==s&&(l.custom_params=s),void 0!==c&&(l.conversion_category=c),r("/api/v3/conversion/log",l)):util.log("Parameter termName is required to log conversion."):util.log("Parameter termId is required to log conversion.")};return n.logConversion=function(e){"object"==typeof e?i(e.term_id,e.term_name,e.step_number,e.amount,e.currency,e.custom_params,e.conversion_category):i.apply(this,arguments)},n.reloadTemplateWithUserToken=function(e){},n}(IntegrationEvents),containerServiceModule=angular.module("containerServiceModule",["ui.router","ngSanitize","generalModule"]);containerServiceModule.factory("containerService",["$window","$rootScope","$rootElement","$timeout","$interval","$document","eventService","errorService","windowStateService","ngEventService","utilsService","gaService",function(e,t,n,r,o,i,a,s,c,l,u,d){var p,m,f={},g={};function h(e,t){var n=e.document?e.document.body:e.body,r=t.documentElement||{};return Math.max(n.scrollHeight,r.scrollHeight,n.offsetHeight,r.offsetHeight,n.clientHeight,r.clientHeight)}return f.$rootScope=t,f.rootElement=n,$(document).on("focus","input, textarea, select",function(){a.postMessage("inputFocus")}).on("blur","input, textarea, select",function(){a.postMessage("inputBlur")}),f.getConfig=function(){return{container:this._getConfigFn().container}},f.getPreferredWidth=function(){return this.preferredWidth},f.setPreferredWidth=function(e){this.preferredWidth=e},f.setConfigWidth=function(e){this.widthFromConfigDirective=e},f.init=function(e,t){this._getConfigFn=t;var n=getParameterByName("displayMode");this.isModal="modal"===n,this.isPopup="popup"===n,this.isInline="inline"===n,this.isPreview=!!getParameterByName("preview"),this.isOpenedFromInlineCheckout="true"===getParameterByName("isOpenedFromInlineCheckout"),this.container=this.getConfig().container,this.suggestedWidth=getIntParam("width",1),this.preferredWidth=e.preferredWidth,f.clearResizeHandler(),f.initResizeHandler(this.container)},f.clearResizeHandler=function(){g.interval&&o.cancel(g.interval),"remove"in Element.prototype||(Element.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)}),g.handleResizeIFrame&&g.handleResizeIFrame.remove(),g.resizeObs&&g.resizeObs.disconnect(),g.loaded&&g.loaded(),g={}},f.initResizeHandler=function(e){var t=document.createElement("iframe");g.handleResizeIFrame=t;e.css("position","relative"),t.width="100%",t.height="100%",t.setAttribute("style",function(){let e="position: absolute !important; z-index: -1 !important;";return u.isIOS()&&(e+=" left: -10000px !important; top: -10000px !important;"),e}()),t.setAttribute("tabindex","-1"),e.prepend(t),p=t.contentWindow||t.contentDocument,m=t.contentDocument||{};var n=function(e,t,n){var r=h(e,t);r!==n.lastHeight&&(n.lastHeight=r,f.resize())}.bind(this,p,m,{lastHeight:-1});if("function"==typeof ResizeObserver){var r=new ResizeObserver(n);r.observe(t),g.resizeObs=r}else p.onresize=n;g.interval=o(n,500),window.onload=function(){f.resize()},f.onReady(function(){f.resize()}),g.loaded=l.subscribe("loaded",function(){f.resize()})},f.onReady=function(e){"loading"!==document.readyState?e():document.addEventListener?document.addEventListener("DOMContentLoaded",e):document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&e()})},l.subscribe("RESIZE_MODAL_CHECKOUT",function(e,t){var n=t.iframe,r=t.width;setTimeout(function(){f.suggestedWidth=r,n.config.width&&(f.suggestedWidth=r<n.config.width?r:n.config.width),f.resize()},100)}),f.resize=function(){var e;if(p&&m)e=h(p,m);else{var t=f.rootElement.height(),n=f.rootElement[0].parentElement?f.rootElement[0].parentElement.clientHeight:0;e=t||n}if(f.isModal||f.isPopup||f.isPreview){var r=f.getNewWidth();angular.element("body").css("min-width",r),angular.element("body").width(r),f.rootElement.width(r),f.container.width(r),a.resizeEvent({width:r,height:e}),setTimeout(f.scrollTop,500)}else a.resizeEvent({height:e})},f.scrollTop=function(){document.defaultView.scrollTo(0,0)},f.getNewWidth=function(){if(f.isModal||f.isPopup){this.widthFromConfigDirective&&(f.preferredWidth=this.widthFromConfigDirective);var e=f.suggestedWidth;return(f.preferredWidth<=e||isNaN(e))&&(e=f.preferredWidth),parseInt(e)}return parseInt(f.suggestedWidth)},f.getCenterScreen=function(e,t){e=e||0,t=t||0;var n=parseInt(getParameterByName("parentWidth"),10),r=parseInt(getParameterByName("parentDualScreenLeft"),10),o=parseInt(getParameterByName("parentDualScreenTop"),10);return{left:n/2-e/2+r,top:parseInt(getParameterByName("parentOuterHeight"),10)/2-t/2+o}},f.getOriginUrl=function(){return getParameterByName("url")},f.purge=function(e){try{f.rootElement.remove()}catch(e){}a.purgeEvent(e),d.sendCheckoutCloseEvent(e)},f.close=function(e){try{f.rootElement.remove()}catch(e){}a.closeEvent(e)},f}]);var tpDrop=function(e,t,n,r,o,i,a,s,c,l){var u=".tp-dropdown__container",d=".search-query",p=".tp-dropdown__list",m=".tp-dropdown__link",f="Tab",g="Enter",h="Escape",E="ArrowDown",v="ArrowUp",C="INPUT";return function(e){return r.all({tpl:(t=e,t.template?r.when(t.template):o.get(t.templateUrl,{cache:i}).then(function(e){return e.data})),opts:r.when(e)}).then(S);var t};function y(e,t){var n="right"===t.side||"left"===t.side,r=n?"top":"left",o=n?"height":"width",i=n?"outerHeight":"outerWidth",a="left"===r?function(e,t,n,r,o){var i={};return i[e]=T(r)?function(e,t,n,r,o){var i=o.centerOn[n](),a=o.style[t];return l(o.centerOn,e)+(i-a)}(e,t,n,0,o):l(o.centerOn,e),i}(r,o,i,e,t):function(e,t,n,r,o){var i={};return i[e]=T(r)?l(o.centerOn,e)+o.centerOn[n]()/2-o.style[t]/2+(o.centerOn[n]()-o.style[t]):l(o.centerOn,e)+o.centerOn[n]()/2-o.style[t]/2,i}(r,o,i,e,t);return a="right"===t.side?c("left","outerWidth",t,a):"left"===t.side?s("right","width","left","scrollLeft",e,t,a):"top"===t.side?s("bottom","height","top","scrollTop",e,t,a):c("top","outerHeight",t,a);function s(e,t,n,r,o,i,a){return a[e]=o[t]()-l(i.centerOn,n)-o[r](),a}function c(e,t,n,r){return r[e]=l(n.centerOn,e)+n.centerOn[t](),r}function l(e,t){return e.offset()[t]}}function T(e){return"rtl"===e.context.dir}function S(e){var o,i,T=r.defer(),S=e.tpl,P=e.opts||{style:{width:200}},A=function(e){if(e.centerOn){var n=e.centerOn.parents().filter(function(){var e=$(this).css("position");return("fixed"===e||"absolute"===e)&&!1===$(this).hasClass("modal")}).last();return n.length>0?n:t.find("body")}return t.find("body")}(P),_=(P.scope||n).$new(),b=t.find("body");_.$close=N,_.$dismiss=O,(P.rejecter||function(){var e=r.defer();return t.on("click",function n(r){t.off("click",n),r&&(r.preventDefault(),r.stopPropagation()),e.reject()}),e.promise}()).then(O,O),P.controller&&a(P.controller,{$scope:_});var w=s(angular.element(S))(_);A.append(w),b.addClass("component-opened");var I=function(){var e;!function(e,t){switch(e.side){case"right":e.centerOn.offset().left+e.centerOn.width()+t.width()>window.innerWidth&&(e.side="left");break;case"left":e.centerOn.offset().left-t.width()<0&&(e.side="right");break;case"bottom":e.centerOn.offset().top+e.centerOn.height()+t.height()>window.innerHeight&&(e.side="top");break;case"top":e.centerOn.offset().top-t.height()<0&&(e.side="bottom")}}(P,w),i=P.side||"bottom",o=function(e,t){return t.centerOn?y(e,t):function(e,t){return{left:e.width()/2-t.style.width/2,top:e.height()/2-t.style.height/2}}(e,t)}(A,P),w.css({display:"block",position:"absolute"}).on("click",function(e){e.preventDefault(),e.stopPropagation(),P.closeOnSelect&&O()}).addClass(i).addClass(P.cl).css(o).css(P.style),(e=angular.element(u)).is(":visible")&&e.find(d).focus(),angular.element(p).on("keydown",function(e){!function(e){switch(e.key){case f:N();break;case h:e.preventDefault(),e.stopPropagation(),N();break;case g:e.target.click();break;case E:e.preventDefault(),e.target.nextElementSibling?e.target.nextElementSibling.focus():e.target.tagName===C&&angular.element(m).first().focus();break;case v:e.preventDefault(),e.target.previousElementSibling?e.target.previousElementSibling.focus():e.target.tagName!==C&&angular.element(d).focus()}}(e)})};if(_.type&&"enchained"===_.type){var k=c(I,50),M=function(){c.cancel(k)};T.promise.then(M,M)}else l(I,0);return T.promise;function N(e){w.remove(),T.resolve(e),b.removeClass("component-opened"),P.centerOn[0].focus()}function O(e){w.remove(),T.reject(e),b.removeClass("component-opened")}}};tpDrop.$inject=["$injector","$document","$rootScope","$q","$http","$templateCache","$controller","$compile","$interval","$timeout"],angular.module("tpDrop.module",["ngSanitize","generalModule"]).factory("tpDrop",tpDrop);var userServiceModule=angular.module("userServiceModule",["ui.router","ajaxServices","ngSanitize","generalModule","tp.i18n"]);userServiceModule.factory("userService",["$rootScope","$rootElement","$q","tpHTTP","eventService","ngEventService","errorService","gaService","lang","utilsService","cookieService",function(e,t,n,r,o,i,a,s,c,l,u){var d=_randomString(16),p=null,m=!1,f=[],g=function(){return{app:{},user:{},stats:{},fillLoginIframeParams:v,fillLoginRequiredParamsToGoogleAnalytics:v,fillLoginRequiredEventParams:v,fillLoginSuccessEventParams:v}},h={};h.$rootScope=e,h.rootElement=t,h.userConfirmationStatus=Object.freeze({UNCONFIRMED:"UNCONFIRMED",WAIT_CONFIRMATION:"WAIT_CONFIRMATION",PRE_CONFIRMED:"PRE_CONFIRMED",CONFIRMED:"CONFIRMED"});var E,v=function(){};function C(){var e=window.TPParam.params||window.TPParam.app||h.getConfig().app;return e?e.userProvider:""}function y(e){return e.extendExpiredAccessEnabled&&l.setExtendExpiredAccessCookie(h.getConfig().app.aid,e.extendExpiredAccessEnabled),h.loginSuccessNoPostMessage(e).then(function(){E&&E.resolve(e)})}return h.getConfig=function(){return{app:g().app,user:g().user,stats:g().stats,fillLoginIframeParams:g().fillLoginIframeParams||v,fillLoginRequiredParamsToGoogleAnalytics:g().fillLoginRequiredParamsToGoogleAnalytics||v,fillLoginRequiredEventParams:g().fillLoginRequiredEventParams||v,fillLoginSuccessEventParams:g().fillLoginSuccessEventParams||v}},h.init=function(e){if(g=e,!TPParam.LOGIN)throw"Login handler URL (variable TPParam.LOGIN) is not set"},h.isUserValid=function(){return h.getConfig().user&&!0===h.getConfig().user.valid},h.getUserUid=function(){return h.getConfig().user&&h.getConfig().user.uid},h.isUserReadOnly=function(){if(this.isPianoIdUserProvider())return!1;var e=u.getCookie(h.getConfig().app.aid+"__eea"),t=h.getConfig().user;return"true"===e&&Date.now()>parseInt(t.login_timestamp,10)+t.token_expiration},h.isUserUnrestricted=function(){var e=h.getConfig().user;return!!e&&(e.emailState?h.userConfirmationStatus.CONFIRMED===e.emailState||h.userConfirmationStatus.PRE_CONFIRMED===e.emailState:h.isUserConfirmed())},h.isUserConfirmed=function(){return h.getConfig().user&&h.getConfig().user.confirmed},h.isEmailConfirmed=function(){return h.getConfig().user&&h.getConfig().user.emailConfirmed},h.allowLogout=function(){return h.isUserValid()&&h.isProviderAllowLogout()},h.allowLogin=function(){return h.allowTinypassAccountsLogin()||h.isGigyaUserProvider()},h.allowTinypassAccountsLogin=function(){var e=h.getConfig().app;return e&&e.useTinypassAccounts},h.isPublisherUserRefProvider=function(){return"publisher_user_ref"===C()},h.isGigyaUserProvider=function(){return"gigya"===C()},h.isCondeUserProvider=function(){return"conde"===C()},h.isPianoIdUserProvider=function(){return"piano_id"===C()},h.isPianoIdLiteUserProvider=function(){return"piano_id_lite"===C()},h.isJanrainUserProvider=function(){return"janrain"===C()},h.allowMyAccountLogin=function(){return h.allowTinypassAccountsLogin()},h.allowTinypassAccountsLogout=function(){return h.isProviderAllowLogout()&&h.isUserValid()},h.isProviderAllowLogout=function(){return h.allowTinypassAccountsLogin()||h.isCondeUserProvider()||h.isPianoIdUserProvider()||h.isGigyaUserProvider()||h.isJanrainUserProvider()},h.logout=function(){h.isProviderAllowLogout()&&o.postMessage("logout",{closeOnLogout:getParameterByName("closeOnLogout")}),l.removeExtendExpiredAccessCookie(h.getConfig().app.aid),m=!1},h.loginSuccessNoPostMessage=function(e){return function(e){var t=n.defer();m?t.reject(!1):(m=!0,e||(e={}),h.getConfig().fillLoginSuccessEventParams(e),e.resultCallback=function(){angular.forEach(f,function(t){t.callback(e)}),f=l.filter(f,function(e){return!e.oneTime}),t.resolve(e)},o.postMessage("loginSuccess",e));return t.promise}(e)},h.onUserProfileUpdated=function(e){o.postMessage("userProfileUpdateSuccess",e)},h.register=function(){return h.login("register")},h.checkUser=function(e){return r({method:"get",url:"/checkout/user/check",params:e})},h.login=function(e,t){e||(e="login");var r=getParameterByName("aid"),l=getParameterByName("url"),u=(E=n.defer()).promise;if(o.postMessage("loginStart",{}),u.finally(function(){o.postMessage("loginEnd",{})}),util.log("[USER SERVICE] Cannot continue without valid user...sending loginRequiredEvent"),h.allowTinypassAccountsLogin()){m=!1;var f={displayMode:"popup",aid:r,width:360,height:660,state:e,iframeId:"login-"+_randomString(10),host_url:l,url:window.location.href};h.getConfig().fillLoginIframeParams(f);var g=TPParam.LOGIN+"?"+$.param(f,!0)+"#/"+e;p=function(e,t){var n=parseInt(getParameterByName("parentWidth"),10),r=parseInt(getParameterByName("parentHeight"),10),o=e.width?e.width:n,i=e.height?e.height:r,a=parseInt(getParameterByName("parentDualScreenLeft"),10),s=parseInt(getParameterByName("parentDualScreenTop"),10),c=n/2-o/2+a,l=parseInt(getParameterByName("parentOuterHeight"),10)/2-i/2+s,u=window.open(t,d,"scrollbars=yes,status=0,toolbar=0,resizable=1, width="+o+", height="+i+", top="+l+", left="+c);return window.focus&&u.focus(),u}(f,g),i.subscribe("readyToSubmitStats",function(){o.customPostMessage("submitStats",h.getConfig().stats,document.location.origin,p)}),i.subscribe("loginSuccess",function(e,t){if((t=t||{}).reloadAfterLogin=!0,E.resolve(t),y(t),p&&!1===p.closed){try{p.document.body.innerHTML=null}catch(e){}p.close()}})}else{var v={aid:r};h.getConfig().fillLoginRequiredParamsToGoogleAnalytics(v);var C={};C.startScreen=e,h.getConfig().fillLoginRequiredEventParams(C),function(e,t){if(t)return Object.assign(e,t)}(C,t),o.loginRequiredEvent(C).then(function(e){(e.callbackNotFound||!1!==e.result)&&(E.reject(!1),a().terminal(c.trc("checkout.platform","Cannot start checkout. User not logged in")))}),s.sendLoginRequiredEvent(C)}return E.promise},h.onLoginSuccess=function(e,t){e&&f.push({callback:e,oneTime:t})},h.cleanSuccessLoginCallbacks=function(){f=l.filter(f,function(e){return!e.oneTime})},h.loginSuccessPosted=function(){return m},h.setLoginSuccessPosted=function(e){m=e},h.onExternalLogin=y,i.subscribe("changeLocale",function(e,t){t&&t.locale&&c.list().then(function(e){for(var n in e)if(e[n].locale===t.locale){c.update(t.locale);break}})}),i.subscribe("externalLoginSuccess",function(e,t){(t=t||{}).reloadAfterLogin=!0,y(t)}),h.userChanged=function(e){E&&E.resolve(e)},h}]);var eventModule=angular.module("eventModule",["generalModule"]);eventModule.factory("eventService",["$window","$rootScope","$q","configService",function(e,t,n,r){var o={};function i(){return getParameterByName("iframeId")}return o.last=null,o.resultCallbacks={},o.postMessage=function(t,n){var r=((TPParam||{}).params||{}).os||"desktop";try{switch(r){case"ios":!function(e,t){window.webkit.messageHandlers[e].postMessage(t)}(t,n);break;case"android":!function(e,t){var n=JSON.stringify(t);PianoAndroid[e](n)}(t,n);break;default:!function(t,n){var r={};o.parentURL=getParameterByName("url"),o.parentURL||(o.parentURL=window.location!==window.parent.location?document.referrer:document.location.href);if(r.sender=i(),r.displayMode=getParameterByName("displayMode"),r.recipient="opener",r.event=t,r.params=n,n&&n.resultCallback){var a=_randomString(16);r.params.resultCallbackId=a,o.resultCallbacks[a]=n.resultCallback,delete n.resultCallback}util.log("[EVENT SERVICE] Post message:"+t,r),$.postMessage(JSON.stringify(r),o.parentURL,"popup"===r.displayMode?e.opener:e.parent)}(t,n)}}catch(e){util.log("[EVENT SERVICE] Event wasn't expected: ",t)}},o.customPostMessage=function(e,t,n,r){var o={};o.sender=i(),o.event=e,o.params=t,util.log("[EVENT SERVICE] Custom post message:"+e,o),$.postMessage(JSON.stringify(o),n,r)},o.resizeEvent=function(e){if(e.iframeId=i(),null===o.last)o.postMessage("loaded",e),o.last=e;else if(e.height!==o.last.height||e.width!==o.last.width){var t=r.get().closeButtonType;void 0!==t&&(e.closeButtonType=t),o.postMessage("resize",e),o.last=e}},o.purgeEvent=function(e){o.postMessage("purge",e)},o.closeEvent=function(e){o.postMessage("close",e)},o.closeAndRefreshEvent=function(e){o.postMessage("closeAndRefresh",e)},o.checkoutStateChange=function(e,t){o.postMessage("checkoutStateChange",{stateName:e,offerId:TPParam.config.offerId,termId:t&&t.termId,term:t})},o.startCheckoutEvent=function(e){o.postMessage("startCheckout",e)},o.showAuthForm=function(e){o.postMessage("showAuthForm",e)},o.startThreeDBankSecure=function(){o.postMessage("startThreeDBankSecure")},o.loginRequiredEvent=function(e){var t=n.defer();return e.resultCallback=function(e){t.resolve(e)},o.postMessage("loginRequired",e),t.promise},o.initContext=function(){var e=n.defer();return o.postMessage("initContext",{resultCallback:function(t){e.resolve(t)}}),e.promise},o.gigyaPasswordlessLoginEvent=function(e){e.iframeId=i(),o.postMessage("gigyaPasswordlessLogin",e)},o.customEvent=function(e,t){o.postMessage(e,t)},o.systemErrorEvent=function(e){e.iframeId=i(),o.postMessage("error",e)},o.submitPayment=function(e){o.postMessage("submitPayment",e)},o.completeEvent=function(e){o.postMessage("complete",e)},o.alreadyPurchasedEvent=function(e){o.postMessage("alreadyPurchased",e)},o.checkoutPaymentErrorEvent=function(e){o.postMessage("checkoutPaymentError",{message:e,iframeId:i()})},o.loginEvent=function(e){o.postMessage("login",e)},o.registerEvent=function(e){o.postMessage("register",e)},o.getParentSize=function(){o.postMessage("parentSize")},o.isMobileDevice=function(){return TPParam&&TPParam.params&&("ios"===TPParam.params.os||"android"===TPParam.params.os)},o.emitGAEvent=function(e){o.postMessage("emitGAEvent",e)},o.emitMetricsEvent=function(e){o.postMessage("emitMetricsEvent",e)},o.completeUpgradePurchase=function(e){o.postMessage("completeUpgradePurchase",e)},o.frequencyEvent=function(e){o.postMessage("frequencyEvent",e)},$().ready(function(){$.receiveMessage(function(e){var n;try{if(util.log("[EVENT SERVICE] Received message:",e),-1!==["https://core.spreedly.com","https://jsl.prod.obi.aol.com","https://pay.datatrans.com","https://vpos.infonet.com.py:8888","https://vpos.infonet.com.py","https://flex.cybersource.com","https://testflex.cybersource.com"].indexOf(e.origin))return;var r=e.data.replace(/\/\*.*?\*\//g,"");(n=JSON.parse(r)).sender&&0===n.sender.indexOf("piano-id-")&&(n.event=n.sender+"-"+n.event),"init-social"===n.eventName&&(n={event:"init-social",params:n}),n.event&&-1!==n.event.indexOf("-3ds-complete")&&(n={event:"3ds-complete",params:n}),t.$broadcast(n.event,n.params),n.params&&n.params.resultCallbackId&&o.resultCallbacks[n.params.resultCallbackId]&&(o.resultCallbacks[n.params.resultCallbackId](n.params),delete o.resultCallbacks[n.params.resultCallbackId])}catch(t){util.log("[EVENT SERVICE][Could not parse message:",e)}})}),o}]);var errorModule=angular.module("errorModule",["generalModule"]);errorModule.factory("errorService",["$rootScope","eventService","ngEventService","gaService",function(e,t,n,r){var o={},i={GLOBAL:"global",COMPONENT:"component",TERMINAL:"terminal"};return function(r){var a={},s=null;return a.error=function(e,t){if(!r)throw Error("The $scope is undefined");var o=t;o||(o={}),angular.isString(o)&&(o={message:t}),o.type=e,o.errorInstanceId=r.errorInstanceId,s.errors.push(o),n.fire(EVENT_ERRORS_CHANGED)},a.global=function(e){a.error(i.GLOBAL,e)},a.globals=function(e){angular.forEach(e,function(e){a.error(i.GLOBAL,e)})},a.component=function(e){a.error(i.COMPONENT,e)},a.components=function(e){angular.forEach(e,function(e){a.error(i.COMPONENT,e)})},a.terminal=function(o){var a=o;a||(a={}),angular.isString(a)&&(a={message:o}),a.type=i.TERMINAL,r&&(a.errorInstanceId=r.errorInstanceId),n.fire(EVENT_TERMINAL_ERROR,a);var s=a.message;e.terminalError=s,e.terminalErrorHeading=a.heading,t.systemErrorEvent({message:s})},a.reset=function(){r&&s.errors.length>0&&(s.errors=[],n.fire(EVENT_ERRORS_CHANGED,r.errorInstanceId))},a.errors=function(e){var t=[];if(r){var n=function(r){angular.forEach(r.errors,function(e){t.push(e)}),e||angular.forEach(r.children,function(e){n(e)})};n(s)}else angular.forEach(o,function(e){angular.forEach(e.errors,function(e){t.push(e)})});return t},a.childrenErrors=function(){var e=[];if(r){var t=function(n){angular.forEach(n.errors,function(t){e.push(t)}),angular.forEach(n.children,function(e){t(e)})};angular.forEach(s.children,function(e){t(e)})}else e=[];return e},a.resetDisplayed=function(){var e=a.getId();angular.forEach(o,function(t){var n=[];angular.forEach(t.errors,function(t){t.displayedOn!==e&&n.push(t)}),t.errors=n}),n.fire(EVENT_ERRORS_CHANGED,r.errorInstanceId)},a.TYPES=i,a.getId=function(){return r?r.errorInstanceId:null},function(){var e,t,n;if(r){if(!((n=r)&&n.$evalAsync&&n.$watch))throw Error("The first parameter should be scope");r.errorInstanceId?s=o[r.errorInstanceId]:(r.errorInstanceId=_randomString(16),s={children:[],errors:[],errorInstanceId:r.errorInstanceId,$id:r.$id},o[r.errorInstanceId]=s,(e=(t=function(e){return e?e.errorInstanceId?e.errorInstanceId:e.$parent?t(e.$parent):void 0:null})(r.$parent))&&o[e].children.push(s))}}(),a}}]);var dependencies=["exceptionHandler","generalModule","tpComponentsModule","antifraudCaptchaV3Module","antifraudCaptchaV2ProviderModule","checkoutModule","renewableGiftCommonModule","giftModule","promocodeModule","futureStartModule","redemptionModule","externalVerificationModule","authModule","passThroughModule","country.selector","billing.address","tpDrop.module","tp.i18n","paymentProviderModule","consentModule","html5.placeholder","creditCardModule","mockModule","paymentServiceModule","applePayBtModule","payWhatYouWantModule","alreadyHasAccessModule","zeroModule","confirmationModule","checkoutMockModule","checkoutBraintreeGooglePayMockModule","checkoutDatatransGooglePayMockModule","bankSecureModule","sharedSubscriptionModule","renewableGiftModule","continueThreeDSPurchaseModule","printAddressModule","providersModuleCH","upgradeModule","subscriptionReactivationModule","creditRedemptionModule","promocodeSynchronizationModule","widgetModule","pollingModule","paymentComponentModule"],checkoutComponentsModule=angular.module("checkoutComponentsModule",dependencies);checkoutComponentsModule.constant("COMPONENT_TO_OPTIONS_MAP",{"account-header-component":{},"term-selector-component":{termSelector:!0},"future-start-component":{},"promo-code-component":{},"pay-what-you-want-form-component":{},"auth-component":{},"payment-form-component":{paymentForm:!0},"already-has-access-component":{},"external-verification-component":{},"print-address-component":{},"confirmation-component":{},"gift-form-component":{},"redemption-component":{redemptionForm:!0},"reactivate-subscription-component":{reactivationForm:!0},"complete-upgrade-component":{},"upgrade-authentication-component":{}}),checkoutComponentsModule.directive("view",["$animate","checkout","COMPONENT_TO_OPTIONS_MAP","$compile","viewService","$timeout","performanceMetricsService","billingConfig","checkoutGoTo","creditRedemptionService",function(e,t,n,r,o,i,a,s,c,l){var u="lazy-transclude",d='<div>    <div error-list=""></div>    <div class="'+u+'"></div>     <div class="clearfix"></div></div>';function p(e){var t=NodeFilter?NodeFilter.SHOW_ELEMENT:1,r=function e(t,n){var r=n||[],o=t.nextNode();return o?e(t,r.concat(o)):r}(document.createNodeIterator(e.get(0),t,null,null),null).map(function(e){return Array.prototype.slice.call(e.attributes)}).filter(function(e){return e.length}).reduce(function(e,t){return e.concat(t)},[]).map(function(e){return e.name});return Object.keys(n).filter(function(e){return-1!==r.indexOf(e)}).reduce(function(e,t){return angular.extend(e,n[t])},{})}return{restrict:"A",replace:!0,template:function(e,t){var n=p(e),r=e.get(0).innerHTML.trim();return o.registerState(t.view,n,r),d},link:function(e,n,s,c){var l="view-"+s.view,d=o.getStateManager(s.view);e.isPreviewMod=t.isPreviewMod,n.addClass("view "+l),n.attr("id",l),c.setViewAsInactive=function(){n.removeClass("view-show")},c.setViewAsActive=function(){if(n.addClass("view-show"),!n.hasClass("view-showed")){var t=function(e){return e.find("."+u)}(n);n.addClass("view-showed"),t.append(d.template),r(t.contents())(e),i(function(){a.onViewRendered(s.view)},0)}}},controller:["$scope","$q","$element","$attrs","ngEventService","viewService","$timeout","exposeTemplateParams","exposeJsonParameter","userService","giftService","redemptionService","setupTrackingId","statsService","browserIdService","offerStateService","isMobileUserAgent","creditRedemptionService","gifteeDetailsFormService",function(e,n,r,o,i,a,c,l,u,d,p,m,f,g,h,E,v,C,y){var T=this;this.options={hasTermSelector:!1,hasPaymentForm:!1,hasRedemptionForm:!1,hasPasswordlessLoginForm:!1},this.active=!1,this.components=[],this.stateName=o.view,this.name="view-"+this.stateName,this.registerComponentController=function(e,t){e.providerName&&(this.components=this.components.filter(function(t){return e.providerName!==t.providerName})),t&&this.registerComponentOptions(t),this.components.push(e)},this.unregisterComponentController=function(e){this.components=this.components.filter(function(t){return t.$id===e.$id&&e.unsubscribeNgEventService&&e.unsubscribeNgEventService(),t.$id!==e.$id})},this.registerComponentOptions=function(e){e&&e.termSelector&&(T.options.hasTermSelector=e.termSelector),e&&e.paymentForm&&(T.options.hasPaymentForm=e.paymentForm),e&&e.redemptionForm&&(T.options.hasRedemptionForm=e.redemptionForm),e&&e.reactivationForm&&(T.options.hasReactivationForm=e.reactivationForm),e&&e.passwordlessLoginForm&&(T.options.hasPasswordlessLoginForm=e.passwordlessLoginForm)},this._isValid=function(){var e=n.defer(),t=[];return angular.forEach(this.components,function(e){(!e._validateViewOnCompletePurchase||e._validateViewOnCompletePurchase&&e._validateViewOnCompletePurchase())&&e._isValid&&t.push(n.when(e._isValid()))}),n.all(t).then(function(t){var n=!0;angular.forEach(t,function(e){!1===e&&(util.log('["'+T.name+'" validation] component is not valid'),n=!1)}),e.resolve(n)},function(){util.log('["'+T.name+'" validation] validation has failed with rejection'),e.resolve(!1)}),e.promise},this.extendScope=function(n){function r(){n.app=t.config.app,n.terms=t.config.terms,n.user=t.config.user,n.custom=u(TPParam.params.customVariables||{},{}),n.passwordlessCaptchaEnabled=t.config.passwordlessCaptchaEnabled,n.input=t.input,n.billingConfig=s,n.access=t.access,n.selectedTerm=t.flags.selectedTerm,n.flags=t.flags,n.allowLogout=t.allowLogout,n.isShowBoilerplateCloseButton=t.isShowBoilerplateCloseButton,n.giftEmailParams=p.form,n.voucher=m.voucher,n.externalCheckoutConfig=t.getExternalCheckoutConfig(),n.gotoOfferState=E.gotoOfferState,n.getOfferState=E.getOfferState,n.preselectTermId=t.preselectTermId,n.startCheckoutWithPreselectedTerm=t.startCheckoutWithPreselectedTerm,n.changeOptions=t.config.changeOptions,n.groupedChangeOptions=t.config.groupedChangeOptions,n.selectedChangeOption=t.flags.selectedChangeOption,n.sessions=t.config.sessions,y.getFormValue&&(n.renewableGiftEmailParams=y.getFormValue()),C.setupScope&&C.setupScope(n),g.getParams().then(function(t){var r={};angular.extend(r,TPParam.params),angular.extend(r,t),n.params=l(r),n.customCookies=u(r.customCookies||{},{}),n.activeMeters=u(r.activeMeters||[],[]),h.getBrowserId().then(function(t){e.browserId=t})})}Helper.wrapMethod("startCheckout",t,n),Helper.wrapMethod("startRenewableGift",t,n),Helper.wrapMethod("startUpgrade",t,n),Helper.wrapMethod("startRedemption",t,n),Helper.wrapMethod("allowRedemption",t,n),Helper.wrapMethod("canInitCheckoutWithAnon",t,n),Helper.wrapMethod("isUserValid",t,n),Helper.wrapMethod("isNewCustomer",t,n),Helper.wrapMethod("allowTinypassAccountsLogin",t,n),Helper.wrapMethod("allowTinypassAccountsLogout",t,n),Helper.wrapMethod("allowTinypassAccountsLogout1",t,n),Helper.wrapMethod("logout",t,n),Helper.wrapMethod("login",t,n),Helper.wrapMethod("register",t,n),Helper.wrapMethod("isSelectedTermLocked",t,n),Helper.wrapMethod("isPaymentMethod",t,n),Helper.wrapMethod("isPaymentMethodSelected",t,n),Helper.wrapMethod("isMockUsed",t,n),Helper.wrapMethod("selectPaymentMethod",t,n),Helper.wrapMethod("resetPaymentSelection",t,n),Helper.wrapMethod("close",t,n),Helper.wrapMethod("canSelectPaymentMethod",t,n),Helper.wrapMethod("isPayWhatYouWantTerm",t,n),Helper.wrapMethod("isConfirmStepEnabled",t,n),Helper.wrapMethod("selectTerm",t,n),Helper.wrapMethod("isPasswordlessCheckoutEnabled",t,n),Helper.wrapMethod("isDoubleOptInEnabled",t,n),Helper.wrapMethod("isVatEuEnabled",t,n),Helper.wrapMethod("isVatCanadaEnabled",t,n),Helper.wrapMethod("isTaxUsEnabled",t,n),Helper.wrapMethod("isUsBillingCountry",t,n),Helper.wrapMethod("isUsBillingCountryLabel",t,n),Helper.wrapMethod("isEuBillingCountryLabel",t,n),Helper.wrapMethod("isBillingCountryEnabled",t,n),Helper.wrapMethod("getBillingAddressEnabled",t,n),Helper.wrapMethod("isOneSourceTaxEnabled",t,n),Helper.wrapMethod("isAvalaraTaxEnabled",t,n),Helper.wrapMethod("isUsSelected",t,n),Helper.wrapMethod("isCanadaSelected",t,n),Helper.wrapMethod("isBillingAddressAvailableForSelectedCountry",t,n),Helper.wrapMethod("isPaymentTerm",t,n),Helper.wrapMethod("isTermSelected",t,n),Helper.wrapMethod("isExternalTerm",t,n),Helper.wrapMethod("isGiftTerm",t,n),Helper.wrapMethod("isDynamicTerm",t,n),Helper.wrapMethod("isFreeDynamic",t,n),Helper.wrapMethod("isPayableTerm",t,n),Helper.wrapMethod("isChargingTerm",t,n),Helper.wrapMethod("hasTax",t,n),Helper.wrapMethod("toggleVatColumn",t,n),Helper.wrapMethod("isVatColumnAvailable",t,n),Helper.wrapMethod("isTaxColumnVisible",t,n),Helper.wrapMethod("isVatColumnVisible",t,n),Helper.wrapMethod("getVatLabel",t,n),Helper.wrapMethod("gotoAuthState",t,n),Helper.wrapMethod("hasAccess",t,n),Helper.wrapMethod("isUpgradeOffer",t,n),Helper.wrapMethod("isBillingPlanExpanded",t,n),Helper.wrapMethod("getBillingPlanToDisplay",t,n),Helper.wrapMethod("toggleBillingPlanTableExpander",t,n),Helper.wrapMethod("getBillingPlanTableExpanderLabel",t,n),Helper.wrapMethod("isBillingPlanCollapsible",t,n),Helper.wrapMethod("isExternalCheckoutAvailable",t,n),Helper.wrapMethod("startExternalCheckout",t,n),Helper.wrapMethod("isPromoCodeAvailable",t,n),Helper.wrapMethod("getDurationHTMLString",t,n),Helper.wrapMethod("isUpgradeOfferType",t,n),Helper.wrapMethod("isForUpgrade",t,n),n.params=l(TPParam.params||{}),r(),n.isAuthorizationSupportedByPaymentMethod=function(){var e=t.flags.selectedPaymentMethod;return!e||e&&!0===e.authSupported||e&&[50].includes(e.id)},n.getFreeTrialType=function(){var e=t.getSelectedTerm(),n=e.originalBillingPlan?e.originalBillingPlan.billingPlanTable:null,r=e.billingPlanTable.some(function(e,t){return"true"===e.isFree&&(!n||"true"===n[t].isFree)}),o=e.billingPlanTable.some(function(e,t){return"true"===e.isFree&&n&&"false"===n[t].isFree});return r&&o?"FREE_TRIAL_TERM_PROMO":r?"FREE_TRIAL_TERM":o?"FREE_TRIAL_PROMO":"NOT_FREE_TRIAL"},n.getPayableTermType=function(){var e=t.getSelectedTerm();return t.isPayableTerm(e)?!t.alreadyPurchased()&&e.isSubscription&&e.hasFreeTrial?"FREE_TRIAL_SUBSCRIPTION":!t.alreadyPurchased()&&e.hasFreeTrial?"FREE_TRIAL":"PAYABLE":"NOT_PAYABLE_TERM"},n.getTaxType=function(){if(t.hasTax()){if(t.isTaxCnbcEnabled())return"CNBC";if(t.isVatEuEnabled())return"EU";if(t.isTaxUsEnabled())return"US";if(t.isVatCanadaEnabled()&&t.input.canadianTaxes.length>1)return"MANY_RATE_CA";if(t.isVatCanadaEnabled()&&1===t.input.canadianTaxes.length)return"ONE_RATE_CA"}return"NONE"},n.getReceiptType=function(){return t.isRenewableGiftFlow(t.flags.selectedTerm)?"RenewableGiftPurchase":t.isUpgradeAuthentication()?"UpgradeAuthentication":t.isForUpgrade()?"UpgradePurchase":t.isPaymentMethod(OPENPAY_CASH)?"OpenpayCash":t.isPaymentMethod(EASYPAY_MULTIBANCO)?"EasypayMultibanco":t.isPaymentMethod(EASYPAY_MBWAY)?"EasypayMbway":t.isPaymentMethod(EASYPAY_DIRECT_DEBIT)?"EasypayDirectDebit":t.isPaymentMethod(EASYPAY_BOLETO)?"EasypayBoleto":t.isPaymentMethod(ONET)?"Onet":t.isPaymentMethod(VOLGA)?"Volga":t.isPaymentMethod(INVOICE_BASED_FIRST)?"Inbaf":t.isPaymentMethod(INVOICE_BASED_SECOND)?"Inbas":t.isPaymentMethod(EPP)?"Epp":t.isPaymentMethod(PAY_U_BRAZIL_BOLETO)?"PayUBrazilBoleto":t.isGiftTerm(t.flags.selectedTerm)?"GiftPurchase":n.isRedemption()?"GiftRedemption":t.isExternalTerm(t.flags.selectedTerm)?"External":t.isRegistrationTerm(t.flags.selectedTerm)?"Registration":"Purchase"},n.getReceiptTemplateConfig=function(){var e={footer:!0};return t.isPaymentMethod(EASYPAY_BOLETO)?(e.footer=!1,e):e},n.isRedemption=function(){return m.state===m.STATE_DONE},n.getGifteeDisplayName=function(){return n.renewableGiftEmailParams.firstName&&n.renewableGiftEmailParams.lastName?n.renewableGiftEmailParams.firstName+" "+n.renewableGiftEmailParams.lastName:n.renewableGiftEmailParams.email},n.getSelectedPaymentMethodName=function(){return t.input.receipt.paymentMethodName?t.input.receipt.paymentMethodName:t.flags.selectedPaymentMethod?t.flags.selectedPaymentMethod.name:null},n.isApplePayPaymentMethod=function(){return t.isPasswordlessCheckoutEnabled()&&n.getSelectedPaymentMethodName()&&n.getSelectedPaymentMethodName().toLowerCase().includes("apple pay")},n.isTermDiscounted=function(){return t.flags.isDiscounted},n.isMobileUserAgent=v,n.isGigyaUserProvider=d.isGigyaUserProvider,n.allowLogin=d.allowLogin,n.allowInvalidUser=function(){return t.canInitCheckoutWithAnon()||"offer"===a.getActiveState()&&(d.allowTinypassAccountsLogin()||d.isGigyaUserProvider())};var o=i.subscribe(EVENT_SETUP_CUSTOM_VARIABLES,function(e,t){n.custom=u(t||{},{})}),f=i.subscribe(EVENT_CHECKOUT_RELOADED,function(){r()}),T=i.subscribe(EVENT_VIEW_ACTIVATED,function(){c(function(){t.resize()})}),S=i.subscribe(EVENT_CHECKOUT_TERM_SELECTED,function(){r()}),P=i.subscribe(EVENT_CHECKOUT_PRICE_CHANGED,function(){r()}),A=i.subscribe(EVENT_STATS_TRACKED,function(){r()}),_=i.subscribe(EVENT_CHANGE_OPTIONS_CONFIG_UPDATED,function(){r()}),b=i.subscribe(EVENT_SESSIONS_UPDATED,function(){r()}),w=i.subscribe(EVENT_UPDATE_SCOPE_VALUES,function(){r()});n.unsubscribeNgEventService=function(){f(),T(),S(),P(),A(),o(),_(),b(),w()}},this.extendScope(e),a.registerView(this),this.registerComponentOptions(a.getStateManager(this.stateName).options)}]}}]),checkoutComponentsModule.factory("isMobileUserAgent",function(){return function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}}),checkoutComponentsModule.directive("autoCloseApplePayReceipt",["checkout","eventService",function(e,t){return{restrict:"A",scope:{closingDelay:"@?",transitionTimeUp:"@?",transitionTimeDown:"@?",animationOffsetBottom:"@?",animationOffsetTop:"@?",animationContainerSize:"@?"},link:{pre:function(){t.postMessage("toggleIframeShadow",{isEnabled:!1})},post:function(n,r){var o,i=anime.timeline({}),a=!1,s=r.find("button.apple-pay-receipt__close");function c(){n.closingDelay=n.closingDelay?parseInt(n.closingDelay,10):4e3,n.transitionTimeUp=n.transitionTimeUp?parseInt(n.transitionTimeUp,10):1300,n.transitionTimeDown=n.transitionTimeDown?parseInt(n.transitionTimeDown,10):1300,n.animationOffsetBottom=n.animationOffsetBottom?parseInt(n.animationOffsetBottom,10):300,n.animationOffsetTop=n.animationOffsetTop?parseInt(n.animationOffsetTop,10):100,n.animationContainerSize=n.animationContainerSize?parseInt(n.animationContainerSize,10):560,r.parent().height(n.animationContainerSize),o=r.parent().height()-n.animationOffsetBottom,i.add({targets:".apple-pay-receipt-animation-container",keyframes:[{opacity:0},{translateY:o,opacity:0},{translateY:n.animationOffsetTop,opacity:1,duration:n.transitionTimeUp}],easing:"easeInOutSine"}).add({targets:".in .circle",strokeDashoffset:[anime.setDashoffset,0],easing:"easeInOutSine",duration:n.transitionTimeUp+200},n.transitionTimeUp/3).add({targets:".in .check",strokeDashoffset:[anime.setDashoffset,0],easing:"easeInOutSine",duration:600,complete:function(){s.toggleClass("apple-pay-button--disabled",!1)}},n.transitionTimeUp).add({targets:".apple-pay-receipt-animation-container",keyframes:[{translateY:n.animationOffsetTop,opacity:1},{translateY:o,opacity:0}],duration:n.transitionTimeDown,easing:"easeInOutSine",delay:100,begin:i.pause,complete:l}),setTimeout(u,n.closingDelay)}function l(){e.close(function(){t.postMessage("toggleIframeShadow",{isEnabled:!0})})}function u(){a||(a=!0,s.toggleClass("apple-pay-button--disabled",!0),i.play())}r.ready(function(){c()}),s.on("click touch",function(){u()})}}}}]),checkoutComponentsModule.directive("errorMsg",["errorService",function(e){return{restrict:"A",require:["^view","ngModel"],scope:{msg:"@errorMsg"},link:function(t,n,r,o){var i=o[0],a=o[1];t._isValid=function(){e(t).reset();var n=!0;return a.$error&&angular.forEach(a.$error,function(e,t){e&&(n=!1)}),n||e(t).global(t.msg),n},i.registerComponentController(t)}}}]),checkoutComponentsModule.directive("termSelectorComponent",["checkout","$sce",function(e,t){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/term-selector-component.html",link:function(e,t,n,r){r.registerComponentController(e,{termSelector:!0}),t.attr("id","term-selector-component"),e.extendScope=function(){r.extendScope(e)},e.extendScope(),t.on("$destroy",function(){r.unregisterComponentController(e)})},controller:["$scope","$timeout","ngEventService",function(t,n,r){angular.extend(t,BaseComponentController),t.isTermDiscounted=function(){return e.flags.isDiscounted},t.isUnlimInterval=function(e){return e&&2147483647===parseInt(e.cycles,10)},angular.forEach(e.config.terms,function(e,n){t["term"+(n+1)]=e}),t._isValid=function(){return e.isTermSelected()};var o=r.subscribe(EVENT_CHECKOUT_RELOADED,function(){t.extendScope()});t.unsubscribeNgEventService=function(){o()}}]}}]),checkoutComponentsModule.directive("dynamicName",["$parse",function(e){return{restrict:"A",priority:1e4,controller:["$scope","$element","$attrs",function(t,n,r){var o=e(r.dynamicName)(t);delete r.dynamicName,n.removeAttr("data-dynamic-name"),n.removeAttr("dynamic-name"),r.$set("name",o)}]}}]),checkoutComponentsModule.directive("paymentFormComponent",["checkout","providersServiceCH","captchaV2Provider","captchaV3Service","lang","widgetService","errorService","ngEventService","paymentComponentService",function(e,t,n,r,o,i,a,s,c){const l={restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/payment-form-component.html",transclude:!0,compile:function(t,c){return t.append('\n          <div ng-show="!isSelectedTermLocked()">\n            <div ng-if="hasSelectedPc() && !isPaymentMethod(ZERO)">\n              <div payment-component></div>\n            </div>\n            <div ng-if="hasSelectedPc() && isPaymentMethod(ZERO)">\n              <div ng-if="isPaymentMethod(ZERO)">\n                <div payment-component-zero-form></div>\n              </div>\n            </div>\n          </div>\n        '),{post:function(t,c,l,u){u.registerComponentController(t,{paymentForm:!0}),c.attr("id","payment-form-component"),n.setSiteKey(e.config.captcha2SiteKey),u.extendScope(t),t.isCaptchaV3Enabled=r.isCaptchaV3Enabled(),n.instantiateCaptchaVariables(t);var d=s.subscribe("EVENT_CHECKOUT_PRICE_CHANGED",function(){f()}),p=s.subscribe("PAYMENT_BILLING_PLAN_TABLE_IS_UPDATED",function(){f()}),m=s.subscribe("fullRedirectThreeDSTimeout",function(){e.enabledCheckout(),a(t).reset(),a(t).component(o.trc("checkout.platform","Safari has an issue with some redirects, please, update your Safari version to enable redirects."))});function f(){const e=i.getElementIdByType("Payment"),t=i.getElement(e.elementId);t&&t.then(e=>e.dispatchSignal("paymentProcessUpdate"))}c.on("$destroy",function(){u.unregisterComponentController(t),n.clearCaptchaListeners(),d(),p(),m()})}}},controller:["$scope","$rootScope",function(n,r){angular.extend(n,BaseComponentController),Helper.wrapMethod("isPaymentMethodRequired",e,n),Helper.wrapMethod("isZeroPayment",e,n),Helper.wrapMethod("isSelectedTermAutoRenewChoiceAvailable",e,n),n.hasNewFlow=function(){var n=e.flags.selectedPaymentMethod&&e.flags.selectedPaymentMethod.id,r=n===EDGIL_PAYWAY;return t.hasNewFlow(n)&&!r},n.input=e.input,n.hasSelectedPc=(()=>!!c.getSelectedPaymentMethod())}]},u=e.removeVolgaIfNotSwitzerlandCountrySelected(e.input.paymentMethods),d=e.getPmList(u);return e.flags.pnWidgetEnabled&&u.length===d.length&&(delete l.templateUrl,l.template='\n        <div ng-show="!isSelectedTermLocked()">\n            <div billing-country></div>\n            <div ng-if="!isPaymentMethod(ZERO)"><div payment-component></div></div>\n            <div ng-if="isPaymentMethod(ZERO)">\n              <div payment-component-zero-form></div>\n            </div>\n        </div>\n        '),l}]),checkoutComponentsModule.directive("paymentMethodSelectorComponent",["checkout","ngEventService","paymentComponentService","widgetService",function(e,t,n,r){return{restrict:"A",require:["^view","^paymentFormComponent"],templateUrl:"/widget/checkout/component/partials/payment-method-selector-component.html",link:function(e,t,n,r){const o=r[0];o.registerComponentController(e);let i=null;function a(e){!function(e){const t=function(e){for(;null!==e;){if("BUTTON"===e.tagName)return e;if(e.hasAttribute("payment-method-selector-component"))return null;e=e.parentNode}return null}(e.target);t&&(Array.from(t.parentElement.children).forEach(e=>{e.setAttribute("tabindex","-1")}),t.setAttribute("tabindex","0"),i=t)}(e)}function s(e){switch(e.key){case"ArrowLeft":e.preventDefault(),e.stopPropagation(),function(e){if(e.target.previousElementSibling)return void c(e.target,e.target.previousElementSibling);const n=t.find(".payment-method-tile");c(e.target,n[n.length-1])}(e);break;case"ArrowRight":e.preventDefault(),e.stopPropagation(),function(e){if(e.target.nextElementSibling)return void c(e.target,e.target.nextElementSibling);const n=t.find(".payment-method-tile");c(e.target,n[0])}(e);break;case"Enter":i=document.activeElement;break;case"Tab":c(e.target,i)}}function c(e,t){t&&(e.setAttribute("tabindex",-1),t.setAttribute("tabindex",0),t.focus())}t.attr("id","payment-method-selector-component"),t.on("$destroy",function(){t.off("keydown",s),t.off("click",a),o.unregisterComponentController(e),i=null}),t.on("click",a),t.on("keydown",s)},controller:["$scope","$rootScope",function(o,i){angular.extend(o,BaseComponentController),o.paymentMethods=e.removeVolgaIfNotSwitzerlandCountrySelected(e.input.paymentMethods),o.selectedPaymentMethod=null;var a=t.subscribe(EVENT_CHECKOUT_PAYMENT_METHODS_CHANGED,function(t,n){util.log("[PM SELECTOR] Got new payment method event",n),o.paymentMethods=e.removeVolgaIfNotSwitzerlandCountrySelected(n)}),s=t.subscribe(EVENT_COUNTRY_OF_RESIDENCE_SELECTED,function(t,n){o.paymentMethods=e.removeVolgaIfNotSwitzerlandCountrySelected(e.input.paymentMethods,n),e.resetPaymentSelectionIfVolgaSelected(n)}),c=t.subscribe(EVENT_CHECKOUT_RESET_SELECTED_PAYMENT_METHOD,function(){o.selectedPaymentMethod=null});o.unsubscribeNgEventService=function(){a(),c(),s()},o.selectPaymentMethod=function(i){const a=e.flags.pnWidgetEnabled;o.selectedPaymentMethod=i;const s=r.getElementIdByType("Payment");if(!a||!i.paymentMethodType)return o.hasErrors()&&o.reset(),t.fire("EVENT_TAX_ZIP_CODE_VISIBILITY_CHANGE",!1),r.destroy(s.elementId),e.selectPaymentMethod.apply(e,Array.prototype.slice.call(arguments));e.unselectPaymentMethods(),e.flags.selectedPaymentMethod=null,i.selected=!0,r.destroy(s.elementId).then(function(){n.setSelectedPaymentMethod(i)})},Helper.wrapMethod("isPaymentMethod",e,o),Helper.wrapMethod("isPaymentMethodSelected",e,o),Helper.wrapMethod("resetPaymentSelection",e,o),Helper.wrapMethod("canSelectPaymentMethod",e,o),Helper.wrapMethod("isPaymentMethodRequired",e,o),Helper.wrapMethod("isZeroPayment",e,o),o._isValid=function(){return e.isPaymentMethodSelected()},o.getCurrencyClass=function(){return e.getSelectedTerm()&&e.getSelectedTerm().chargeCurrency&&e.getSelectedTerm().chargeCurrency.toLowerCase()}}]}}]),checkoutComponentsModule.directive("closeButton",["checkout",function(e){return{restrict:"A",require:"^view",replace:!0,templateUrl:"/widget/checkout/component/partials/close-button-component.html",scope:{title:"@",usePrimaryColor:"=?"},link:function(t,n,r,o){o.registerComponentController(t),n.on("click",function(){t.$apply(function(){e.close()})}),n.on("$destroy",function(){o.unregisterComponentController(t)})},controller:["$scope",function(e){angular.extend(e,BaseComponentController)}]}}]),checkoutComponentsModule.directive("nextButton",["viewService",function(e){return{restrict:"A",require:"^view",replace:!0,templateUrl:"/widget/checkout/component/partials/next-button-component.html",scope:{title:"@"},link:function(t,n,r,o){o.registerComponentController(t),n.on("click",function(){t.$apply(function(){e.gotoNextView()})}),n.on("$destroy",function(){o.unregisterComponentController(t)})},controller:["$scope",function(e){angular.extend(e,BaseComponentController)}]}}]),checkoutComponentsModule.directive("previousButton",["viewService","ngEventService",function(e,t){return{restrict:"A",require:"^view",replace:!0,templateUrl:"/widget/checkout/component/partials/previous-button-component.html",scope:{title:"@"},link:function(n,r,o,i){i.registerComponentController(n),r.on("click",function(){t.fire(EVENT_GOTO_PREVIOUS_STATE,{isConfirmation:e.isActive("confirmation")}),n.$apply(function(){e.gotoPreviousState()})}),r.on("$destroy",function(){i.unregisterComponentController(n)})},controller:["$scope",function(t){angular.extend(t,BaseComponentController),t.hasPreviousState=e.hasPreviousState}]}}]),checkoutComponentsModule.directive("errorList",function(){return{restrict:"A",templateUrl:"/widget/checkout/component/partials/error-list-component.html",scope:!1,controller:["$scope","$element","ngEventService","errorService","$timeout","$rootScope",function(e,t,n,r,o,i){e.errors=[];var a=r(e).getId(),s=n.subscribe(EVENT_ERRORS_CHANGED,function(){e.errors.length=0,o(function(){var n=[],s=r(i).errors(!0);angular.forEach(s,function(e){e.displayed&&e.displayedOn!==a||(n.push(e),e.displayed=!0,e.displayedOn=a)});s=r(e).errors(!0);angular.forEach(s,function(e){e.displayed&&e.displayedOn!==a||(n.push(e),e.displayed=!0,e.displayedOn=a)}),o(function(){var o=r(e).childrenErrors();if(angular.forEach(o,function(e){e.displayed&&e.displayedOn!==a||(n.push(e),e.displayed=!0,e.displayedOn=a)}),n.length>0){e.errors=n;const r=t.find("li"),o=r[r.length-1];o&&o.focus()}},0)},0)});e.$on("$destroy",function(){s()}),e.reset=function(){r(e).resetDisplayed()},e.hasErrors=function(){return e.errors&&e.errors.length},e.hasOneError=function(){return e.errors&&1===e.errors.length},e.isWarning=function(){return e.hasOneError()&&e.errors[0].isWarning}}]}}),checkoutComponentsModule.directive("completePurchaseButton",["checkout","ngEventService",function(e,t){return{restrict:"A",require:"^view",replace:!0,templateUrl:"/widget/checkout/component/partials/complete-purchase-button-component.html",scope:{title:"@",isDisabled:"=?"},link:function(n,r,o,i){n.isDisabled=!1;var a=!1,s=t.subscribe("PURCHASE_FAILED",function(){a=!1}),c=t.subscribe("TOGGLE_PURCHASE_DISABLED",function(e,t){n.isDisabled=t});i.registerComponentController(n),r.on("click",function(){n.isDisabled||a||(a=!0,e.completePayment().finally(function(){a=!1}))}),r.on("$destroy",function(){i.unregisterComponentController(n),s(),c()})},controller:["$scope",function(e){angular.extend(e,BaseComponentController)}]}}]),checkoutComponentsModule.directive("gotoConfirmationButton",["checkout",function(e){return{restrict:"A",require:"^view",replace:!0,templateUrl:"/widget/checkout/component/partials/goto-confirmation-component.html",scope:{title:"@",isDisabled:"=?"},link:function(t,n,r,o){var i=!1;o.registerComponentController(t),n.on("click",function(){t.isDisabled||i||(i=!0,e.confirmPayment().finally(function(){i=!1}))}),n.on("$destroy",function(){o.unregisterComponentController(t)})},controller:["$scope",function(e){angular.extend(e,BaseComponentController)}]}}]),checkoutComponentsModule.directive("accountHeaderComponent",["checkout",function(e){return{restrict:"A",templateUrl:"/widget/checkout/component/partials/account-header-component.html",replace:!0,link:function(e,t,n){e.noLanguage=n.hasOwnProperty("noLanguage")},controller:["$scope",function(t){t.login=e.login,t.logout=e.logout,t.isUserValid=e.isUserValid,t.allowLogout=e.allowLogout,t.allowTinypassAccountsLogin=e.allowTinypassAccountsLogin,t.allowTinypassAccountsLogout=e.allowTinypassAccountsLogout}]}}]),checkoutComponentsModule.directive("debugger",["checkout",function(e){return{restrict:"A",templateUrl:"/widget/checkout/component/partials/debugger.html",link:function(e){e.$watch(function(){return e.log.length},function(){$("#debugger #log-output").scrollTop(1e10)})},controller:["$scopes",function(t){t.app=e.config.app,t.terms=e.config.terms,t.log=e.log,t.input=e.input,t.access=e.access,t.changeOptions=e.config.changeOptions,t.groupedChangeOptions=e.config.groupedChangeOptions,t.sessions=e.config.sessions}]}}]),checkoutComponentsModule.directive("checkout",["checkout","eventService",function(e,t){return{restrict:"A",template:'<div ng-if="isContextLoaded" ng-transclude=""></div>',transclude:!0,link:function(e,t){t.addClass("checkout")},controller:["$scope","$element","$attrs",function(n,r,o){var i="context"===getParameterByName("initMode");n.isContextLoaded=!i;var a={preferredWidth:o.width,preferredHeight:o.height};i?t.initContext().then(function(t){n.isContextLoaded=!0,a=angular.extend({},a,t),e.init(n,a)}):(n.isContextLoaded=!0,e.init(n,a))}]}}]),checkoutComponentsModule.directive("purchaseReceipt",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/purchase-receipt-component.html",link:function(e,t,n,r){r.registerComponentController(e),r.extendScope(e),t.on("$destroy",function(){r.unregisterComponentController(e)})}}}),checkoutComponentsModule.directive("registrationReceipt",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/registration-receipt-component.html",scope:{},link:function(e,t,n,r){r.registerComponentController(e),r.extendScope(e),t.on("$destroy",function(){r.unregisterComponentController(e)})}}}),checkoutComponentsModule.directive("externalReceipt",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/external-receipt-component.html",link:function(e,t,n,r){r.registerComponentController(e),r.extendScope(e),t.on("$destroy",function(){r.unregisterComponentController(e)})}}}),checkoutComponentsModule.directive("giftRedemptionReceipt",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/gift-redemption-receipt-component.html",link:function(e,t,n,r){r.registerComponentController(e),r.extendScope(e),t.on("$destroy",function(){r.unregisterComponentController(e)})}}}),checkoutComponentsModule.directive("giftPurchaseReceipt",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/gift-purchase-receipt-component.html",link:function(e,t,n,r){r.registerComponentController(e),r.extendScope(e),t.on("$destroy",function(){r.unregisterComponentController(e)})}}}),checkoutComponentsModule.directive("renewableGiftReceipt",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/renewable-gift-receipt-component.html",link:function(e,t,n,r){r.registerComponentController(e),r.extendScope(e),t.on("$destroy",function(){r.unregisterComponentController(e)})}}}),checkoutComponentsModule.directive("openpayCashReceipt",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/openpay-cash-receipt-component.html",link:function(e,t,n,r){r.registerComponentController(e),r.extendScope(e),t.on("$destroy",function(){r.unregisterComponentController(e)})}}}),checkoutComponentsModule.directive("easypayMultibancoReceipt",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/easypay-multibanco-receipt-component.html",link:function(e,t,n,r){r.registerComponentController(e),r.extendScope(e),t.on("$destroy",function(){r.unregisterComponentController(e)})}}}),checkoutComponentsModule.directive("easypayMbwayReceipt",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/easypay-mbway-receipt-component.html",link:function(e,t,n,r){r.registerComponentController(e),r.extendScope(e),t.on("$destroy",function(){r.unregisterComponentController(e)})}}}),checkoutComponentsModule.directive("easypayDirectDebitReceipt",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/easypay-direct-debit-receipt-component.html",link:function(e,t,n,r){r.registerComponentController(e),r.extendScope(e),t.on("$destroy",function(){r.unregisterComponentController(e)})}}}),checkoutComponentsModule.directive("easypayBoletoReceipt",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/easypay-boleto-receipt-component.html",link:function(e,t,n,r){r.registerComponentController(e),r.extendScope(e),t.on("$destroy",function(){r.unregisterComponentController(e)})}}}),checkoutComponentsModule.directive("onetReceipt",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/onet-receipt-component.html",link:function(e,t,n,r){r.registerComponentController(e),r.extendScope(e),t.on("$destroy",function(){r.unregisterComponentController(e)})}}}),checkoutComponentsModule.directive("volgaReceipt",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/volga-receipt-component.html",link:function(e,t,n,r){r.registerComponentController(e),r.extendScope(e),t.on("$destroy",function(){r.unregisterComponentController(e)})}}}),checkoutComponentsModule.directive("inbafReceipt",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/inbaf-receipt-component.html",link:function(e,t,n,r){r.registerComponentController(e),r.extendScope(e),t.on("$destroy",function(){r.unregisterComponentController(e)})}}}),checkoutComponentsModule.directive("inbasReceipt",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/inbas-receipt-component.html",link:function(e,t,n,r){r.registerComponentController(e),r.extendScope(e),t.on("$destroy",function(){r.unregisterComponentController(e)})}}}),checkoutComponentsModule.directive("brazilBoletoReceipt",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/brazil-boleto-receipt-component.html",link:function(e,t,n,r){r.registerComponentController(e),r.extendScope(e),t.on("$destroy",function(){r.unregisterComponentController(e)})}}}),checkoutComponentsModule.factory("offerStateService",["containerService","eventService","checkout","gaService",function(e,t,n,r){var o=getParameterByName("offerState"),i=[];return{registerState:function(e){o||(o=e),i.push(e)},getOfferState:function(){return o},gotoOfferState:function(i){if(e.isInline)return n.params.offerState=i,t.startCheckoutEvent(n.params),void r.sendStartCheckoutEvent(n.params);o=i}}}]),checkoutComponentsModule.directive("offerState",function(){return{restrict:"A",replace:!0,transclude:!0,template:'<div><div class="offer-state" ng-if="state === getOfferState()"  > <div ng-transclude></div></div></div>',controller:["$scope","offerStateService",function(e,t){e.state="",e.registerState=function(n){e.state=n,t.registerState(n)},e.gotoOfferState=t.gotoOfferState,e.getOfferState=t.getOfferState}],link:function(e,t,n){e.registerState(n.offerState)}}}),checkoutComponentsModule.directive("hideIfNoPaymentMethods",function(){return{restrict:"A",scope:{subscriptionPaymentMethods:"="},link:function(e,t){e.subscriptionPaymentMethods&&e.subscriptionPaymentMethods.length||t.remove()}}}),checkoutComponentsModule.directive("boilerplateLoginDropdown",["dropdownTabNavigationService",function(e){return{restrict:"E",replace:!0,templateUrl:"/widget/checkout/component/partials/boilerplate-login-dropdown.html",controller:["$scope","$document","$element",function(t,n,r){let o;const i=r[0],a=".pn-boilerplate-login__button",s=".pn-boilerplate-login__dropdown";function c(e){jQuery(e.target)[0]!==r.find(a)[0]&&l()}function l(){t.isDropdownOpen&&(t.isDropdownOpen=!1,t.$apply())}t.isDropdownOpen=!1,t.buttonInit=function(){o=e(i,{toggleDropdownMenuButtonSelector:a,dropdownMenuContainerSelector:s,closeMenu:l,closeMenuOnClick:c,isMenuOpened:function(){return t.isDropdownOpen}})},t.logoutToggle=function(){t.isDropdownOpen=!t.isDropdownOpen,setTimeout(()=>{t.isDropdownOpen&&(o.detachDropdownMenuEvents(),o.attachDropdownMenuEvents())},0)},t.displayUserName=function(e){return e.firstName&&e.lastName?e.firstName+" "+e.lastName:e.firstName||e.lastName?e.firstName||e.lastName:e.email||e.displayName},n.on("click",function(){l()})}]}}]),checkoutComponentsModule.directive("addressSelector",["errorService","lang",function(e,t){return{restrict:"E",scope:{getAddressesList:"=",getStructuredAddress:"=?",showManually:"=?",setInputValue:"=?",disabled:"=?",preselectedRegion:"=?",inputPlaceholder:"@",isStatic:"@"},replace:!0,templateUrl:"/widget/checkout/component/partials/address-selector.html",link:function(n,r){document.addEventListener("click",function(o){n.isDropdownOpen&&0===r[0].getElementsByClassName(o.target.className).length&&(n.isDropdownOpen=!1,n.validInput||n.isStatic||""===n.query||(n.hasError=!0,n.showManually(n.hasError),e(n).reset(),e(n).component(t.trc("checkout.platform","Please select one of provided addresses."))),n.$apply())})},controller:["$scope","ngEventService","errorService",function(e,t,n){e.isDropdownOpen=!1,e.validInput=!1,e.hasError=!1,e.query="",e.lastQuery="",e.blockInput=!1,e.searchTimeout=null,e.searchResults=e.isStatic?e.getAddressesList():[];var r=t.subscribe("PAYMENT_BILLING_PLAN_TABLE_UPDATE",function(){e.isStatic||(e.query="",e.validInput=!1,e.hasError=!1)});e.$on("$destroy",function(){r()}),e.search=function(){if(e.blockInput&&(e.query=e.lastQuery),e.validInput=!1,e.hasError=!1,!e.isStatic&&""===e.query)return e.setInputValue({}),void e.showManually(e.hasError);e.isDropdownOpen=!0,e.isStatic||(e.searchResults=[],clearTimeout(e.searchTimeout),e.searchTimeout=setTimeout(function(){tinypass.withoutWaitPanel=!0,e.blockInput=!0,e.lastQuery=e.query,""===e.query?(e.searchResults=[],e.hasError=!1,e.blockInput=!1,tinypass.withoutWaitPanel=!1):e.getAddressesList(e.query).then(function(t){e.setInputValue({}),e.searchResults=t.models.addresses||[],e.hasError=0===e.searchResults.length,e.showManually(e.hasError)}).catch(function(t){e.hasError=!0,e.showManually(!0),n(e).reset(),n(e).component(t.errors[0].msg)}).finally(function(){e.blockInput=!1,tinypass.withoutWaitPanel=!1})},700))},e.getFullAddress=function(t){e.isStatic?e.setInputValue(t):e.getStructuredAddress(t.id).then(function(t){e.validInput=!0,e.setInputValue(t.models.address)}).catch(function(t){e.validInput=!1,e.hasError=!0,n(e).reset(),n(e).component(t.errors[0].msg)}),e.query=e.getItem(t),e.isDropdownOpen=!1},e.getItem=function(t){return e.isStatic?t.regionName:t.suggestion}}]}}]),checkoutComponentsModule.directive("banner",["eventService",function(e){return{restrict:"A",link:function(t,n){e.postMessage("bannerInit"),n.on("$destroy",function(){e.postMessage("bannerDestroy")})}}}]),checkoutComponentsModule.directive("dropdownToggle",function(){return{restrict:"E",scope:{isOn:"=",label:"=",onChange:"="},replace:!0,templateUrl:"/widget/checkout/component/partials/dropdown-toggle.html"}}),checkoutComponentsModule.directive("scrollModalTo",["eventService",function(e){return{restrict:"A",link:function(t,n,r){n.on("click",function(t){t.preventDefault(),t.stopPropagation();var n=parseInt(r.x,10)||0,o=parseInt(r.y,10)||0;e.postMessage("scrollModalTo",{x:n,y:o})})}}}]),checkoutComponentsModule.directive("savedPaymentMethodsKeyboardNavigation",["KEY_CODES",function(e){return{restrict:"A",link:function(t,n){const r='[type="radio"]',o="button";function i(e){if("INPUT"===e.target.tagName)return f(g(n=e.target)),void n.setAttribute("tabindex","0");var n;(function(e){for(;null!==e;){if("BUTTON"===e.tagName)return e;if(e.hasAttribute("saved-payment-methods-keyboard-navigation"))return null;e=e.parentNode}return null})(e.target)&&function(e){const n=g(e);f(n);const o=n.querySelector(r);o.setAttribute("tabindex","0"),t.$emit("SET_SELECTED_VALUE_AFTER_FOCUS_CHANGE",{upiId:o.value}),o.focus()}(e.target)}function a(t){switch(t.key){case e.ARROW_UP:s(t,"previousElementSibling");break;case e.ARROW_DOWN:s(t,"nextElementSibling");break;case e.ARROW_LEFT:case e.ARROW_RIGHT:c(t)}}function s(t,n){const o=g(document.activeElement),i=o[n];i?function(e,t){if(p(document.activeElement)){const e=t.querySelector(r);return void l(e)}d(document.activeElement)&&(e.preventDefault(),e.stopPropagation(),u(t,!0))}(t,i):function(e,t){const n=e.parentElement.children;if(n.length<=1)return;u(t?n[0]:n[n.length-1],d(document.activeElement))}(o,t.key===e.ARROW_DOWN)}function c(e){e.preventDefault(),e.stopPropagation();const t=function(e){if(d(document.activeElement))return e.querySelector(r);if(p(document.activeElement)){const t=e.querySelector(o);return m(t)?t:null}return null}(g(document.activeElement));t&&l(t)}function l(e){document.activeElement.setAttribute("tabindex","-1"),e.setAttribute("tabindex","0"),e.focus()}function u(e,n){const i=e.querySelector(o),a=e.querySelector(r);if(m(i)?(l(i),a.setAttribute("tabindex","-1")):l(a),n){const n=Array.from(e.parentElement.children).indexOf(e);t.$emit("SET_SELECTED_VALUE_AFTER_FOCUS_CHANGE",{upiId:a.value,nextRowIndex:n})}}function d(e){if(e)return"BUTTON"===e.tagName}function p(e){if(e)return"INPUT"===e.tagName}function m(e){if(!e)return!1;const t=window.getComputedStyle(e);return"none"!==t.display&&"hidden"!==t.visibility&&"0"!==t.opacity}function f(e){!e||e&&null===e.parentElement||Array.from(e.parentElement.children).forEach(e=>{e.querySelector(r).setAttribute("tabindex","-1"),e.querySelector(o)&&e.querySelector(o).setAttribute("tabindex","-1")})}function g(e){return function(e,t){for(;null!==e;){if(e.hasAttribute(t))return e;e=e.parentNode}return null}(e,"ng-repeat")}t.$on("$destroy",function(){n.off("click",i),n.off("keydown",a)}),n.on("click",i),n.on("keydown",a)}}}]),checkoutComponentsModule.directive("customCheckbox",["KEY_CODES",function(e){return{restrict:"C",link:function(t,n){let r;function o(t){if(t.key===e.SPACE){const e=n.find("input");e&&e.click()}}setTimeout(()=>{(r=n.find("label"))&&(r.on("keydown",o),r.attr("tabindex","0"))},0),t.$on("$destroy",function(){r&&r.off("keydown",o)})}}}]),checkoutComponentsModule.directive("addCreditCard",["KEY_CODES",function(e){return{restrict:"C",link:function(t,n){function r(t){switch(t.key){case e.SPACE:case e.ENTER:setTimeout(()=>{document.querySelector(".go-back-to-cards").focus()},0)}}n.on("keydown",r),t.$on("$destroy",function(){n.off("keydown",r)})}}}]),checkoutComponentsModule.directive("goBackToCards",["KEY_CODES",function(e){return{restrict:"C",link:function(t,n){function r(t){switch(t.key){case e.SPACE:case e.ENTER:setTimeout(()=>{document.querySelector(".add-credit-card").focus()},0)}}n.on("keydown",r),t.$on("$destroy",function(){n.off("keydown",r)})}}}]);var checkoutService=angular.module("checkoutServiceModule",["checkoutModule"]);checkoutService.factory("checkoutService",["tpHTTP","$q","$window","statsService",function(e,t,n,r){var o={getOffer$:null,isTimeOutDelay:!1,getOffer:function(i,a,s){return s=s||n.TPParam.GET_OFFER,r.getStatsPayload().then(function(n){return!0===o.isTimeOutDelay?o.getOffer$.promise:(o.getOffer$=t.defer(),o.isTimeOutDelay=!0,setTimeout(function(){o.isTimeOutDelay=!1;var t=o.getOffer$;o.getOffer$=null,e({method:"post",url:s,params:i,data:n}).then(function(e){a.mergeStats(e),t.resolve(e)}).catch(function(e){t.reject(e)}).finally(function(){t=null})},10),o.getOffer$.promise)})},getAccess:function(t,o){return r.getStatsPayload().then(function(r){var i=o?o.termId:null;return e({method:"post",url:n.TPParam.GET_ACCESS,params:{aid:t.params.aid,offerId:t.params.offerId,termId:i,userToken:t.params.userToken,userProvider:t.params.userProvider,zone:t.params.zone,preview:t.params.preview,checkoutFlowId:t.params.checkoutFlowId,countryCode:t.getBillingCountryCode(),residenceCountryCode:t.getResidenceCountryCode(),billingZipCode:t.getBillingZipCode(),zipCode:t.input.zipCode,upgradedTermId:t.params.targetedTermId,termChangeOptionId:t.getSelectedChangeOption().termChangeOptionId,offerType:t.params.offerType,subscription_id:t.getSelectedChangeOption().subscriptionFromId,oid:t.getOid()},data:r})})},getUserResource:function(o){return r.getStats().then(function(r){var i={aid:o.params.aid,userToken:o.params.userToken,userProvider:o.params.userProvider,tbc:r.initStatParams.tbc,pageViewId:r.initStatParams.pageViewId};return e({method:"post",url:n.TPParam.GET_USER_RESOURCES,params:i,data:{checkoutStats:o.stats}}).catch(function(e){t.reject(e)})})},setAsDefaultPaymentMethod:function(t){return e({method:"post",url:n.TPParam.APPLY_DEFAULT_PAYMENT_METHOD,params:t})},createOrder:function(t,o,i,a,s,c,l,u,d){return r.getStatsPayload().then(function(r){return e({method:"post",url:n.TPParam.CREATE_ORDER,params:{aid:t,offer_id:o,offer_template_id:i,userToken:a,term_id:s,zone:c.params.zone,experienceId:c.params.experienceId,preview:c.params.preview,oid:c.input.oid,checkoutFlowId:c.params.checkoutFlowId,countryCode:c.getBillingCountryCode(),residenceCountryCode:c.getResidenceCountryCode(),billingZipCode:c.getBillingZipCode(),zipCode:c.input.zipCode,upgradedTermId:c.params.targetedTermId,reactivateSubscriptionId:c.params.reactivateSubscriptionId,term_change_option_id:l,offer_type:u,subscription_id:d,isRenewableGift:c.params.isRenewableGift},data:r}).then(function(e){return c.mergeStats(e),e})})},restoreCheckoutObjects:function(t){return e({method:"post",url:n.TPParam.RESTORE_CHECKOUT_OBJECTS,params:{oid:t},data:{}})},getTaxCountries:function(r){var o={aid:r.params.aid,lang:r.getLang()};return e({method:"post",url:n.TPParam.GET_TAX_COUNTRIES,params:o}).catch(function(e){t.reject(e)})},getExperianAddressValue:function(t,r,o){return e({method:"post",url:n.TPParam.EXPERIAN_SEARCH,params:{query:t,country:r,aid:o.aid,userToken:o.userToken,userProvider:o.userProvider,userRef:o.userRef,janrainCaptureToken:o.janrainCaptureToken}})},verifyAvalaraAddress:function(t,r){r.region||(r.region={});var o=angular.copy(r);return delete o.country.regions,e({method:"post",url:n.TPParam.AVALARA_ADDRESS_VERIFY,params:{aid:t.aid,billingAddress:o,userToken:t.userToken,userProvider:t.userProvider}})},getStructuredExperianAddress:function(t,r,o){return e({method:"post",url:n.TPParam.EXPERIAN_FORMAT,params:{id:t,country:r,aid:o.aid,userToken:o.userToken,userProvider:o.userProvider,userRef:o.userRef,janrainCaptureToken:o.janrainCaptureToken}})},billingAddressApply:function(t,r,o,i){var a={addressLine1:r.addressLine1,addressLine2:r.addressLine2,addressLine3:r.addressLine3,city:r.city,postalCode:r.postalCode,country:{pubId:r.country.pubId,countryCode:r.country.countryCode},verified:r.isVerified,providerType:i};return r.region&&(a.regionName=r.region.regionName,a.region={pubId:r.region.pubId,regionName:r.region.regionName},r.region.pubId||delete a.region),e({method:"post",url:n.TPParam.BILLING_ADDRESS_APPLY,params:{oid:t,aid:o.aid,billingAddress:a,userToken:o.userToken,userProvider:o.userProvider,userRef:o.userRef,janrainCaptureToken:o.janrainCaptureToken}})},getTaxRegions:function(t){return e({method:"post",url:n.TPParam.COUNTRIES_AND_REGIONS,params:{aid:t.aid,userToken:t.userToken,userProvider:t.userProvider,userRef:t.userRef,janrainCaptureToken:t.janrainCaptureToken}})}};return o}]);var viewService=angular.module("viewServiceModule",["checkoutModule"]);viewService.factory("viewService",["$q","$document","$window","$rootScope","$state","eventService","ngEventService","lang","errorService","userService","utilsService","$injector","statsService","gaService",function(e,t,n,r,o,i,a,s,c,l,u,d,p,m){var f={views:[],viewStack:[]};if(f.$stateProvider=window.$stateProvider,f.startState=null,f.steps=[],f.disabled=!1,f.preventStateChange=!1,f.stateManager={},d.has("$transitions")){var g=d.get("$transitions");g.onStart({to:!0},function(e,t){return f._viewStateChange({},e.to(),e.params(),e.from()),!1}),g.onError({},function(){util.log("NOT FOUND STATE")})}else f.viewStateChangeListener=r.$on("$stateChangeStart",function(e,t,n,r){e.preventDefault(),f._viewStateChange(e,t,n,r)}),r.$on("$stateNotFound",function(){util.log("NOT FOUND STATE")});function h(e,t,n){var r=null;if(angular.forEach(f.views,function(e){e.options[t]&&(r=e)}),r)return f.gotoState(r.stateName,e),r.stateName;throw new Error(n)}return f._viewStateChange=function(e,t,o,s){if(!f.preventStateChange){for(var l=0;l<n.document.styleSheets.length;l++){var u=n.document.styleSheets[l],d=(u.ownerNode?u.ownerNode:u.owningElement).getAttribute("tp-style");null!==d&&d.indexOf("-custom-style")>-1&&(u.disabled=!0)}angular.forEach(f.views,function(e){if(e.active=!1,e.setViewAsInactive(),e.stateName===t.name){p.trackView(e.stateName),e.active=!0,e.setViewAsActive();for(var r=0;r<n.document.styleSheets.length;r++){var o=n.document.styleSheets[r],i=(o.ownerNode?o.ownerNode:o.owningElement).getAttribute("tp-style");"offer"!==t.name&&"checkout-custom-style"===i&&(o.disabled=!1),i===t.name+"-custom-style"&&(o.disabled=!1)}}});var m,g=window.navigator.userAgent,h=g.indexOf("MSIE"),E=g.indexOf("Trident/"),v=g.indexOf("Edge/");if(h>0||E>0||v>0)var C=setInterval(function(){var e=$("input:visible:focus").first();e.length?(e.blur().focus(),clearInterval(C)):$("input:visible").first().focus()},1e3);f.viewStack.length>o.step&&(m=f.viewStack[o.step].params),c(r).reset(),a.fire(EVENT_VIEW_ACTIVATED,t,m),i.postMessage(EVENT_VIEW_ACTIVATED)}},f.registerState=function(e,t,n){f.stateManager[e]={options:t||{},template:n||""}},f.getStateManager=function(e){return f.stateManager[e]},f.isActive=function(e){var t=!1;return angular.forEach(f.views,function(n){n.stateName===e&&(t=n.active)}),t},f.registerView=function(e){e.stateName.match(/^state/)&&f.steps.push(e.stateName),"error"===e.stateName&&(f.errorView=e),f.$stateProvider.state(e.stateName,{url:"/"+e.stateName+"/:step"});for(var t=0;t<f.views.length;t++)if(f.views[t].stateName===e.stateName)return void(f.views[t]=e);f.views.push(e)},f._saveHistoryAndGoToState=function(e,t){if(f.isViewExists(e)){var n=u.last(f.viewStack);return(n&&"auth"===n.stateName||n&&"state2"===n.stateName&&"alreadyHasAccess"===e)&&f.viewStack.pop(),n&&n.stateName===e&&f.viewStack.pop(),e===f.startState&&(f.viewStack=[]),t&&t.term?i.checkoutStateChange(e,t.term):i.checkoutStateChange(e),m.sendCheckoutStateChangeEvent(e,t&&t.term?t.term:null),f.viewStack.push({stateName:e,params:t}),o.go(e,{step:f.viewStack.length-1},{location:"replace",reload:!1})}c(r).terminal(s.trc("checkout.platform","Error. State {0} doesn't exist",e))},f.saveHistory=function(e,t){f.viewStack.push({stateName:e,params:t})},f.gotoState=function(e,t){if(e!==f.getActiveState())return f._saveHistoryAndGoToState(e,t)},f._validateCurrentView=function(){util.log("[ViewService] validateCurrentView");for(var t=e.defer(),n=[],r=0;r<f.views.length;r++)f.views[r].stateName===o.current.name&&n.push(e.when(f.views[r]._isValid()));return e.all(n).then(function(e){var n=!0;angular.forEach(e,function(e){!1===e&&(util.log('[ViewService] view for state "'+o.current.name+'" is not valid'),n=!1)}),util.log("[ViewService] validateCurrentView result = ",n),n?t.resolve():t.reject()},function(){util.log("[ViewService] validateCurrentView has failed with rejection"),t.reject()}),t.promise},f.setStartState=function(e){f.startState=e,p.setCheckoutView(f.startState)},f.getActiveState=function(){for(var e=0;e<f.views.length;e++)if(f.views[e].active)return f.views[e].stateName;return null},f.getViews=function(){return f.views},f.isViewExists=function(e){var t=!1;return f.getViews().forEach(function(n){n.stateName===e&&(t=!0)}),t},f._validateViews=function(){util.log("[ViewService] validateViews");var t=e.defer(),n=[];return angular.forEach(f.views,function(t){t._isValid&&n.push(e.when(t._isValid()))}),e.all(n).then(function(e){var n=!0;angular.forEach(e,function(e){!1===e&&(util.log("[ViewService] view is not valid"),n=!1)}),util.log("[ViewService] validateViews result = ",n),n?t.resolve():t.reject()},function(){util.log("[ViewService] validateViews has failed with rejection"),t.reject()}),t.promise},f.gotoPaymentStateFromBankSecureState=function(){"confirmation"===function(){if(f.viewStack.length>=2)return f.viewStack[f.viewStack.length-2].stateName;return"unknown"}()?(f.viewStack.pop(),f.gotoPreviousState()):f.gotoPreviousState()},f._gotoNextState=function(e){for(var t=-1,n=0;n<f.views.length;n++)f.steps[n]===o.current.name&&(t=n+1);t>0&&t<f.steps.length&&f._saveHistoryAndGoToState(f.steps[t],e)},f.gotoPreviousState=function(){if(f.viewStack.length>1){var e=f.viewStack.pop();"auth"!==e.stateName&&"state2"!==e.stateName||l.cleanSuccessLoginCallbacks();var t=f.viewStack[f.viewStack.length-1];i.checkoutStateChange(t.stateName),m.sendCheckoutStateChangeEvent(t.stateName),o.go(t.stateName,{step:f.viewStack.length-1},{location:"replace"})}},f.hasPreviousState=function(){return!1===f.disabled&&f.viewStack&&f.viewStack.length>1},f.gotoNextView=function(e){f.notify("Next button clicked"),f._validateCurrentView().then(function(){f._gotoNextState(e)})},f.notify=function(e){},f.isTermSelectorState=function(e){var t=!1;return angular.forEach(f.views,function(n){n.options.hasTermSelector&&n.stateName===e&&(t=!0)}),t},f.isPaymentFormState=function(e){var t=!1;return angular.forEach(f.views,function(n){n.options.hasPaymentForm&&n.stateName===e&&(t=!0)}),t},f.isPasswordlessFormState=function(e){var t=!1;return angular.forEach(f.views,function(n){n.options.hasPasswordlessLoginForm&&n.stateName===e&&(t=!0)}),t},f.gotoRedemptionState=function(e){h(e,"hasRedemptionForm",s.trc("checkout.platform","Not found redemption view"))},f.gotoSubscriptionReactivationState=function(e){var t=s.trc("checkout.platform","Not found subscription reactivation view");f.disable(!0),h(e,"hasReactivationForm",t)},f.gotoTermSelectorState=function(e){var t=null;if(angular.forEach(f.views,function(e){e.options.hasTermSelector&&(t=e)}),t)return f.gotoState(t.stateName,e),t.stateName;throw new Error(s.trc("checkout.platform","Not found term selector view"))},f.gotoPaymentState=function(e){var t=null;if(angular.forEach(f.views,function(e){e.options.hasPaymentForm&&(t=e)}),t)return f.gotoState(t.stateName,e),t.stateName;throw new Error(s.trc("checkout.platform","Not found term selector view"))},f.disable=function(e){f.disabled=!0,f.preventStateChange=!e},f.enable=function(){f.disabled=!1,f.preventStateChange=!1},f.reset=function(){f.viewStack.length>=1&&(f.viewStack[0].stateName===f.startState?f.viewStack=[f.viewStack[0]]:f.viewStack=[])},f}]);var checkoutUpdates=angular.module("checkoutUpdatesModule",["checkoutModule"]);checkoutUpdates.factory("checkoutUpdatesService",["ngEventService","containerService","$q","PAYMENT_METHOD_TYPES",function(e,t,n,r){var o={updateSelectedTerm:function(e){var t,n=e.getSelectedTerm();n&&(t=e._findTerm(n))&&(angular.forEach(e.config.terms,function(e){e.selected=!1}),t.selected=!0,angular.copy(t,e.flags.selectedTerm),t.isCustomPriceAvailable||(e.input.chargeAmount=e.flags.selectedTerm.chargeAmount,e.input.chargeDisplayAmount=e.flags.selectedTerm.chargeDisplayAmount,e.input.chargeAmountInMinorUnit=e.flags.selectedTerm.chargeAmountInMinorUnit,e.input.chargeAmountAndTax=e.flags.selectedTerm.chargeAmount,e.input.chargeDisplayAmountAndTax=e.flags.selectedTerm.chargeDisplayAmount,e.input.chargeCurrency=e.flags.selectedTerm.chargeCurrency,e.input.firstRealPriceWithTax=e.flags.selectedTerm.firstRealPriceWithTax),e.input.canadianTaxes=e.canadianTaxes())},updatePaymentMethods:function(t,o){var i,a=o.flags.selectedTerm.isSubscription?o.flags.selectedTerm.subscriptionPaymentMethods:o.flags.selectedTerm.oneOffPaymentMethods;a.forEach(e=>{e.paymentMethodType&&(e.identifier+=" "+e.paymentMethodType)}),!o.flags.selectedTerm.isZero||o.flags.selectedTerm.isSchedule||o.isDynamicTerm(o.flags.selectedTerm)||(a=[{id:ZERO}]),a||(a=[]),util.log("[CHECKOUT] Selecting new payment methods list",a),angular.copy(a,o.input.paymentMethods),i=[],angular.forEach(o.input.paymentMethods,function(e){(e.paymentTypeId!==r.APPLE_PAY||o.flags.applePayCanMakePaymentIdentifiers.get(e.identifier))&&i.push(e)}),angular.copy(i,o.input.paymentMethods),function(){if(o.access.isStripeSubscription&&!0===o.access.isStripeSubscription){var e=[];angular.forEach(o.input.paymentMethods,function(t){!1===t.byop&&e.push(t)}),angular.copy(e,o.input.paymentMethods)}}(),util.log("[CHECKOUT] Cleanup payment methods list",o.input.paymentMethods);var s,c=!t;if(o.input.paymentMethods&&1===o.input.paymentMethods.length&&void 0!==o.input.paymentMethods[0].id)s=o.selectPaymentMethod(o.input.paymentMethods[0],c);else if(o.flags.selectedPaymentMethod&&void 0!==o.flags.selectedPaymentMethod.id)s=o.selectPaymentMethod(o.flags.selectedPaymentMethod,c);else{var l,u=window.ApplePaySession;angular.forEach(o.input.paymentMethods,function(e){"apple_pay"===e.paymentTypeId&&(l=e)}),u&&l&&(s=o.selectPaymentMethod(l,c))}return s?n.all([s]).then(function(){o.isZeroPayment()||e.fire(EVENT_CHECKOUT_PAYMENT_METHODS_CHANGED,o.input.paymentMethods)}):(o.isZeroPayment()||e.fire(EVENT_CHECKOUT_PAYMENT_METHODS_CHANGED,o.input.paymentMethods),n.when(!1))},updatePromoCode:function(){e.fire(EVENT_REAPPLY_PROMO_CODE)},updatePayWhatYouWant:function(){e.fire(EVENT_REAPPLY_PAY_WANT_YOU_WANT)},updatePreferredWith:function(e,n){t.setPreferredWidth(e),n.resize()}};return o}]);var metricModule=angular.module("performanceMetricsModule",["generalModule"]);metricModule.factory("performanceMetricsService",["$window","stateService","integrationEventsService","eventLogger","eventService","ngEventService",function(e,t,n,r,o,i){var a={},s={loadtime:200,rendering:{total:200,scripting:200}},c="EVENT_TP_PERFORMANCE_DATA",l=[{resourceRegExp:new RegExp("/checkout/offer/show"),label:"showOffer"},{resourceRegExp:new RegExp("/api/tinypass.min.js$"),label:"tinypassMinJS"},{resourceRegExp:new RegExp("/xbuilder/experience/execute"),label:"experienceExecute"}],u={};function d(e){var t=function(e){if(p(e))return{loadtime:"resource"===e.entryType?e.responseEnd-e.startTime:e.duration,dnsLookup:e.domainLookupEnd-e.domainLookupStart,tcp:e.connectEnd-e.connectStart,ttfb:e.responseStart-e.startTime,fetchStart:e.fetchStart,initiatorType:e.initiatorType,resource:e.name,responseEnd:e.responseEnd}}(e),n=function(e){var t=e.name,n=l.find(function(e){return t.match(e.resourceRegExp)});return n&&n.label}(e);t.loadtime<s.loadtime||(m("fetchStart",t.fetchStart,e.initiatorType,n),m("load",t.loadtime,e.initiatorType,n))}function p(e){return"script"===e.initiatorType||"iframe"===e.initiatorType}function m(e,t,n,r){var i;i={metricName:e,metricValue:t,metricType:n,metricLabel:r},o.emitMetricsEvent({hitType:"timing",timingCategory:i.metricType,timingVar:i.metricName,timingValue:Math.round(i.metricValue),timingLabel:i.metricLabel})}return i.subscribe(c,function(e,t){d(t.entry)}),window.performance&&"function"==typeof performance.getEntries&&performance.getEntries().forEach(function(e){!function(e){(function(e){return l.some(function(t){return e.name.match(t.resourceRegExp)})&&p(e)})(e)&&d(e)}(e)}),a.onViewRendered=function(e){var t,n;"offer"!==e||u.offer||(u[e]=Date.now(),t=u[e]-TPPerformance.documentParseStart,n=u[e]-TPPerformance.domContentLoaded,t>s.rendering.total&&m("rendering",t,"viewRendering","offerScreen:totalTime"),n>s.rendering.scripting&&m("rendering",n,"viewRendering","offerScreen:scripting"))},a}]),angular.element(document).ready(function(){window.TPInjector=angular.bootstrap(document.getElementById("ng-app"),["checkoutComponentsModule"],{strictDi:!0})});var EVENT_VIEW_ACTIVATED="EVENT_VIEW_ACTIVATED",EVENT_VIEW_CHANGED="EVENT_VIEW_CHANGED",EVENT_REDEMPTION_CODE_APPLIED_ON_DOI=(EVENT_APPLY_REDEEM_CODE="EVENT_APPLY_REDEEM_CODE","EVENT_REDEMPTION_CODE_APPLIED_ON_DOI"),EVENT_CHECKOUT_STARTED="EVENT_CHECKOUT_STARTED",EVENT_CHECKOUT_RELOADED="EVENT_CHECKOUT_RELOADED",EVENT_CHECKOUT_SUCCESS="EVENT_CHECKOUT_SUCCESS",EVENT_CHECKOUT_CLOSED="EVENT_CHECKOUT_CLOSED",EVENT_REAPPLY_PROMO_CODE="EVENT_REAPPLY_PROMO_CODE",EVENT_RESET_PROMO_CODE="EVENT_RESET_PROMO_CODE",EVENT_REAPPLY_PAY_WANT_YOU_WANT="EVENT_REAPPLY_PAY_WANT_YOU_WANT",EVENT_CHANGE_OPTIONS_CONFIG_UPDATED="EVENT_CHANGE_OPTIONS_CONFIG_UPDATED",REACTIVATE_SUB_QUERY_PARAM="reactivate_sub",UPGRADE_SUB_QUERY_PARAM="upgrade_sub",LINKED_TERM_TYPE_NAME="linked",LINKED_TERM_PASSED_DATA_KEYS=["name","description","linkedTermData","linkedTermSignedData"],BILLING_PLAN_DEFAULT_VISIBLE_ROWS=3;window.angular=angular;var checkoutModule=angular.module("checkoutModule",["ui.router","ajaxServices","purchaseServiceModule","ngSanitize","generalModule","eventModule","errorModule","performanceMetricsModule","checkoutUpdatesModule","checkoutServiceModule","checkoutGoToModule","viewServiceModule","passwordlessModule","experianModule","billingConfigModule","userServiceModule","containerServiceModule","tpComponentsModule","tp.i18n","consentModule","authModule","swgModule","pianoIdProviderModule","creditRedemptionModule","callbackStorageModule"]);checkoutModule.config(["$compileProvider","$qProvider","$stateProvider","$httpProvider",function(e,t,n,r){var o=["/frontend/providers/components","/widget/checkout/component","/widget/myaccount/partials/common","/widget/myaccount/partials/wallet"];e.debugInfoEnabled&&e.debugInfoEnabled(!0),e.commentDirectivesEnabled&&e.commentDirectivesEnabled(!1),e.cssClassDirectivesEnabled&&e.cssClassDirectivesEnabled(!1),t.errorOnUnhandledRejections&&t.errorOnUnhandledRejections(!1),e.aHrefSanitizationWhitelist&&e.aHrefSanitizationWhitelist(/^\s*(https?|data|local|ftp|mailto|file|javascript|sms):/),r.interceptors.push(["$templateCache",function(e){return{request:function(t){return"GET"===t.method&&void 0===e.get(t.url)&&function(e){for(var t=0;t<o.length;t++)if(-1!==e.indexOf(o[t]))return!0;return!1}(t.url)&&(util.log("%c[CHECKOUT] Error: there is no template in $templateCache - ".concat(t.url),"color: red;"),e.put(t.url,"")),t}}}]),window.$stateProvider=n}]),checkoutModule.run(["interceptAjax",function(e){e.appendLoaderTo("checkout")}]),checkoutModule.run(["$document","KEY_CODES","eventService","containerService","lang",function(e,t,n,r,o){o.on(function(){n.postMessage("closeButtonAriaLabelChanged",o.tr("Close the modal")),n.postMessage("iframeTitleAttributeChanged",o.tr("Payment and account management"))}),e.on("keydown",function(e){e.key===t.ESCAPE&&r.isModal&&n.postMessage("tryToCloseModal")})}]),checkoutModule.factory("checkout",["$window","$rootScope","$state","$rootElement","eventService","purchaseService","$timeout","ngEventService","$q","viewService","modalService","errorService","windowStateService","userService","containerService","tpHTTP","gaService","lang","checkConsents","configService","trackExternalEvent","utilsService","eventLogger","auth","statsService","swgService","setupTrackingId","performanceMetricsService","passwordlessService","externalVerificationService","billingConfig","checkoutService","checkoutUpdatesService","checkoutGoTo","captchaV3Service","pianoIdProvider","creditRedemptionService","updateDirAttrOnLangChanges","printAddressService","windowService","$filter","callbackStorage","paymentComponentPollingService","widgetService","pollingService","PAYMENT_SESSION_STATES","exposeJsonParameter","gaService",function(e,t,n,r,o,i,a,s,c,l,u,d,p,m,f,g,h,E,v,C,y,T,S,P,A,_,b,w,I,k,M,N,O,R,D,x,L,V,U,B,H,F,$,G,W,q,Y,h){const j=TPParam.params.aid;TPParam.PN_WIDGET_ENABLED&&G.init&&G.init(j).catch(function(e){d(t).reset(),d(t).global(e)}),angular.extend(t,window.PP_LIST);var K=null,z={name:"",details:[],startedAt:null,renewsOn:null,alreadyPurchased:null,canBeRenewed:null,canBeRenewedUsingExistedUPI:null,renewChargeAmount:null,renewChargeCurrency:null,renewChargeDisplayAmount:null,renewFirstRealPriceWithTax:null,inRenewal:null,renewalType:null,inGracePeriod:null},Z={id:null,externalApiConfigurationId:null,externalApiFields:[],externalApiUserLocation:null},J={};s.subscribe("trackStat",A.handleTrackStatEvent),J.name="CheckoutService",J.$rootScope=t,J.rootElement=r,J.log=[],J.flags={},J.input={},J.internal={checkAccessAndGotoAlreadyPurchaseScreen:ue};var Q={oid:null,autoRenew:!0,chargeDisplayAmount:null,chargeAmount:null,chargeAmountInMinorUnit:null,chargeCurrency:"USD",chargeCurrencySymbol:"$",originalChargeCurrencySymbol:null,originalChargeAmount:null,originalChargeAmountInMinorUnit:null,originalChargeCurrency:null,originalChargeDisplayAmount:null,renewFirstRealPriceWithTax:null,promotionBillingPlan:null,isTermLockedByPromocode:!1,paymentMethods:[],receipt:{},user_data:{first_name:null,last_name:null},termId:null,offerId:null,zipCode:null,confirmated:{billingPlan:null,chargeAmount:null,taxAmount:null,total:null,taxRate:null,hstRate:null,hstAmount:null,qstRate:null,qstAmount:null,pstRate:null,pstAmount:null,gstRate:null,gstAmount:null},credit_card:{},paypalBt:{},applePayBt:{},consents:[],canadianTaxes:[],customFormTermId:null,offerType:null,changeOptions:[],subscriptionId:void 0};J.setUpiId=function(e){var t=null===e&&null===J.input.upiId,n=J.input.upiId!==e;J.flags.isPaymentMethodChanged=t||n,J.input.upiId=e},J.getUpiId=function(){return J.input.upiId},angular.copy(Q,J.input),J.termGate={},J.access={},angular.copy(z,J.access),J.flags.applePayCanMakePaymentIdentifiers=new Map,J.flags.selectedTerm={},J.flags.selectedChangeOption={};var X={},ee={};function te(){return getQueryParamInStringByName(getParameterByName("url"),REACTIVATE_SUB_QUERY_PARAM)}function ne(){return getQueryParamInStringByName(getParameterByName("url"),UPGRADE_SUB_QUERY_PARAM)}function re(){return J.params.purchasedLinkedTermData}function oe(e){if(e){A.mergeStats({term_id:e.termId}),TPParam.LINKED_TERM_MANUAL_CHECKOUT_TRACKING||A.trackView("external_checkout_start");var t=function(e){return LINKED_TERM_PASSED_DATA_KEYS.reduce(function(t,n){return"object"==typeof n&&n.hasOwnProperty("originalKeyName")&&n.hasOwnProperty("passedKeyName")?t[n.passedKeyName]=e[n.originalKeyName]:t[n]=e[n],t},{})}(e);A.getStats().then(function(e){var n=e.checkoutStats?{offer_id:e.checkoutStats.offer_id,offer_template_id:e.checkoutStats.offer_template_id,offer_template_version_id:e.checkoutStats.offer_template_version_id}:{},r=e.checkoutStats?{page_view_id:e.checkoutStats.pageview_id,page_view_content:{content_created:e.checkoutStats.content_created,content_author:e.checkoutStats.content_author,content_section:e.checkoutStats.content_section,tags:e.checkoutStats.tags}}:{};o.postMessage("callLinkedTermSelectedCallback",{linkedTermData:t,offerStatData:n,pageViewData:r})}).catch(function(){o.postMessage("callLinkedTermSelectedCallback",{linkedTermData:t,offerStatData:{},pageViewData:{}})})}}function ie(e){e.alreadyPurchased&&re()&&me(JSON.parse(re()))}function ae(e){return ge(e)?function(){var e=c.defer(),t=!1;o.showAuthForm();var n=s.subscribe("pianoIdLoginSuccess",function(){t=!0,n&&n(),e.resolve()}),r=s.subscribe("authFormClosed",function(o){J.params.userToken||t||e.reject({notAuthorized:!0}),n&&n(),r&&r()});return e.promise}():c.when()}function se(e){var t=J.getSelectedTerm();return(!J.isDynamicTerm(t)||!ce(t))&&(J.isAvalaraTaxProvider()&&t?e&&"00000001"!==t.termLevelTaxProductCategory:e)}function ce(e){return e.billingPlanTable.every(function(e){return"true"===e.isFree})}function le(e,t){return e&&e.id===window.PP_LIST.VOLGA&&"CH"!==t}function ue(e){return e=e||J.getSelectedTerm(),N.getAccess(J,e).then(function(e){if(e.data.models.alreadyPurchased)if(f.isModal||f.isPopup)me(e.data);else{if(J.params.noNeedStartCheckoutAfterLogin)return void delete J.params.noNeedStartCheckoutAfterLogin;J._findTerm(e.data.models.sourceTermId)?J.startCheckout(e.data.models.sourceTermId):J.config.terms&&J.config.terms.length&&J.config.terms[0]&&J.config.terms[0].termId&&J.startCheckout(J.config.terms[0].termId)}return e.data.models.alreadyPurchased})}function de(){if(J.params.userToken=null,Be({}),J.config.checkoutAuthenticationInSeparateState&&J.getSelectedTerm()&&J._unselectTerm(),J.resetAssociatedData(),J.config.isRedemption&&!J.params.startFromInlineCheckout&&l.isActive("redemption"))l.gotoState("redemption");else if((J.isPrintAddressPopulated()||"printAddress"===l.getActiveState())&&J.getSelectedTerm()){J.termGate.adrCollectionSucceeded=!1;let e=J.getSelectedTerm().termId;J._unselectTerm(),l.reset(),J.startCheckout(e)}else i.resetStateToZeroPoint&&i.resetStateToZeroPoint(),l.gotoState("offer")}function pe(){J.flags.isDiscounted=!1,J.input.originalChargeAmount=J.input.chargeAmount,J.input.originalChargeAmountInMinorUnit=J.input.chargeAmountInMinorUnit,J.input.originalChargeCurrency=J.input.chargeCurrency,J.input.originalChargeCurrencySymbol=J.input.chargeCurrencySymbol,J.input.originalChargeDisplayAmount=J.input.chargeDisplayAmount}function me(e,t,n){util.log("[CHECKOUT] already purchased",e);var r={alreadyPurchased:e.models.alreadyPurchased,name:e.models.name,details:e.models.details&&e.models.details.split(";"),startedAt:e.models.startedAt,renewsOn:e.models.renewsOn,expiresOn:e.models.expiresOn,canBeRenewed:e.models.canBeRenewed,canBeRenewedUsingExistedUPI:e.models.canBeRenewedUsingExistedUPI,renewChargeAmount:e.models.renewChargeAmount,renewChargeCurrency:e.models.renewChargeCurrency,renewChargeDisplayAmount:e.models.renewChargeDisplayAmount,renewFirstRealPriceWithTax:e.models.renewFirstRealPriceWithTax,sourceTermId:e.models.sourceTermId,sourceTerm:e.models.sourceTerm,renewBillingCountryCode:e.models.renewBillingCountryCode,renewBillingZipCode:e.models.renewBillingZipCode,renewResidenceCountryCode:e.models.renewResidenceCountryCode,renewHasTax:e.models.renewHasTax,termChangeOptionId:e.models.termChangeOptionId,renewalType:e.models.renewalType,inGracePeriod:e.models.inGracePeriod,isStripeSubscription:e.models.isStripeSubscription};angular.copy(r,J.access),J.isUpgradeOfferType()?(J.flags.selectedTerm=r.sourceTerm,J._selectChangeOption(r.termChangeOptionId,!0)):J._selectTerm(r.sourceTerm,!0),r.canBeRenewed&&(J.input.chargeAmount=r.renewChargeAmount,J.input.chargeCurrency=r.renewChargeCurrency,J.input.chargeDisplayAmount=r.renewChargeDisplayAmount,J.input.firstRealPriceWithTax=r.renewFirstRealPriceWithTax,J.input.chargeAmountAndTax=r.renewChargeAmount,J.input.chargeDisplayAmountAndTax=r.renewChargeDisplayAmount,pe(),J.config.hasTax=r.renewHasTax),M.renewBillingCountryCode=r.renewBillingCountryCode,M.renewBillingZipCode=r.renewBillingZipCode,M.renewResidenceCountryCode=r.renewResidenceCountryCode,J.config.hasTax=r.renewHasTax,J.isUpgradeOfferType()?function(e){e.models.renewalBillingPlan&&(J.getSelectedChangeOption().billingPlanTable=e.models.renewalBillingPlan);e.models.nextPeriodBillingPlan&&(J.getSelectedChangeOption().nextPeriodBillingPlanTable=e.models.nextPeriodBillingPlan);if(e.models.renewalBillingPlanModel){var t=J.getSelectedChangeOption();angular.forEach(e.models.renewalBillingPlanModel,function(e,n){t[n]=e})}e.models.renewalOriginalBillingPlanModel&&(J._findChangeOption(J.getSelectedChangeOption()).originalBillingPlan=e.models.renewalOriginalBillingPlanModel)}(e):function(e){e.models.renewalBillingPlan&&(J.getSelectedTerm().billingPlanTable=e.models.renewalBillingPlan);e.models.nextPeriodBillingPlan&&(J.getSelectedTerm().nextPeriodBillingPlanTable=e.models.nextPeriodBillingPlan);if(e.models.renewalBillingPlanModel){var t=J.getSelectedTerm();angular.forEach(e.models.renewalBillingPlanModel,function(e,n){t[n]=e})}e.models.renewalOriginalBillingPlanModel&&(J._findTerm(J.getSelectedTerm()).originalBillingPlan=e.models.renewalOriginalBillingPlanModel)}(e),s.fire(EVENT_USER_ACCESS_CHANGED),J.isUpgradeOfferType()?function(e){o.alreadyPurchasedEvent({rid:fe(e)})}(e):function(e){var t,n=J.getSelectedTerm();if(n&&n.resource)t=n.resource.rid;else if(e.models.sourceTermId){var r=J._findTerm(e.models.sourceTermId);r&&r.resource&&(t=r.resource.rid)}o.alreadyPurchasedEvent({rid:t})}(e),n||R.gotoAlreadyHasAccess(J)}function fe(e){return J.getSelectedChangeOption()&&J.getSelectedChangeOption().resourceToId||J._findChangeOption(e.models.termChangeOptionId)&&J._findChangeOption(e.models.termChangeOptionId).resourceToId}function ge(e){return!!(J.isAuthForPrintAddressRequired()||"registration"===e.type||J.isPasswordlessCheckoutEnabled()&&!J.isSingleStepEnabled()||!J.isPasswordlessCheckoutEnabled()&&J.config.checkoutAuthenticationInSeparateState||J.isRenewableGiftFlow(e))&&(!J.isUserValid()||m.isUserReadOnly())}function he(){return J.passwordlessServiceLogin().then(function(e){return!!e.isPasswordlessLogin&&ue()}).then(function(e){if(e)return c.reject()})}angular.copy(X,J.flags.selectedTerm),angular.copy(ee,J.flags.selectedChangeOption),J.flags.isRenewNow=!1,J.flags.selectedPaymentMethod=null,J.flags.termComplete=!1,J.flags.paymentComplete=!1,J.flags.termSelectorActivated=!1,J.flags.changeOptionSelectorActivated=!1,J.flags.receiptActivated=!1,J.flags.hasLoginRequiredCallback=!1,J.flags.autoCompleteRegistrationTerm=!0,J.flags.needUpdateUserResources=!1,J.flags.isPaymentMethodChanged=!0,J.flags.affiliateState={},J.flags.isCaptchaV3Enabled=!1,J.flags.isAddressFormNeedLocalValidation=!1,J.flags.isBillingPlanExpanded=!1,J.flags.isLinkedTermManualCheckoutTrackingEnabled=!1,J.flags.pnWidgetEnabled=TPParam.PN_WIDGET_ENABLED,J.config={terms:[{}],originalTerms:[{}],additionalTerms:[{}],userResources:[{}],user:{},changeOptions:[],groupedChangeOptions:[],termChangeOptionId:null,sessions:null},J.GAProccesses=0,J.params={},J.redemptionLoginRequiredParams={state:null,form:{redeemCode:null}},J.closeButtonTypes={default:"default",boilerplate:"boilerplate"},J.SYSTEM_ERROR_CODES={100:E.trc("checkout.platform","Please try again later"),101:E.trc("checkout.platform","Your payment is being processed. Try to refresh the page in 30 seconds")},J.init=function(n,r){var i,c,u;setTimeout(()=>{const e=tinypass.generateLoadingStatusContainer(),t=document.querySelector('[view="receipt"]');t&&t.after(e)},0),l.setStartState((i="true"===getParameterByName("isCheckout"),c=void 0===getParameterByName("termId"),u=getParameterByName("offerState"),J.params.reactivateSubscriptionId=te(),J.params.upgradeSubscriptionId=ne(),!i||!c||u||J.params.reactivateSubscriptionId||J.isUpgradeAuthentication()?"offer":"state1")),D.getCaptchaV3Enabled&&D.getCaptchaV3Enabled(j);var p=r.preferredWidth||450;J.flags.hasLoginRequiredCallback="true"===getParameterByName("hasLoginRequiredCallback"),J.initConfig(),angular.copy(Q,J.input);var g=getParameterByName("gaAccount"),v=getParameterByName("gaClientId");g&&v&&$e(g,v),J.params.rurl_3ds&&window.TPParam.FULL_REDIRECT_3DS_ENABLED?(J.input.rurl_3ds=J.params.rurl_3ds,l.setStartState("continueThreeDSPurchase"),N.restoreCheckoutObjects(J.params.oid).then(function(e){J.flags.selectedTerm=e.models.currentTerm,J.flags.selectedPaymentMethod=e.models.paymentMethod,J.input.sharedAccountCount=J.flags.selectedTerm?J.flags.selectedTerm.sharedAccountCount:0})):J.flags.pnWidgetEnabled&&J.params.payment_session_id&&J.params.payment_session_state===q.TERMINAL&&(l.setStartState("continueThreeDSPurchase"),N.restoreCheckoutObjects(J.params.oid).then(function(n){J.flags.selectedTerm=n.models.currentTerm,J.flags.selectedPaymentMethod=n.models.paymentMethod,J.input.sharedAccountCount=J.flags.selectedTerm?J.flags.selectedTerm.sharedAccountCount:0;const r={async_processing:!1,first_name:window.TPParam.config.user.firstName,last_name:window.TPParam.config.user.lastName,processId:"pc-payment-"+J.params.oid,oid:J.params.oid,offerId:J.params.offerId,termId:J.params.termId,url:J.params.url};$.checkWithPolling(e.TPParam.CHECK_COMPLETE,J,r,0,W.completeTimeout(),function(e){e?function(e){e.errors.length>0?d(t).terminal(e.errors[0].msg||e.errors[0].message):e.models.receipt&&(angular.copy(e.models.receipt,J.input.receipt),R.gotoReceipt(J))}(e):d(t).terminal(E.trc("checkout.platform","Could not complete purchase. Unexpected error has happened"))})})),J.params.oid&&(J.input.oid=J.params.oid),J.params.promoCode&&(J.input.promoCode=J.params.promoCode),J.params.promoCodeId&&(J.input.promoCodeId=J.params.promoCodeId),J.params.promoCodeTermId&&(J.input.promoCodeTermId=J.params.promoCodeTermId),J.params.accessStartTime&&(J.input.accessStartTime=J.params.accessStartTime),J.params.offerType&&(J.input.offerType=J.params.offerType),J.params.subscriptionId&&(J.input.subscriptionId=J.params.subscriptionId),r.affiliateState&&(J.flags.affiliateState=r.affiliateState,L.setAffiliateState&&L.setAffiliateState(r.affiliateState)),this.config.isRedemption&&l.setStartState("redemption"),J.params.reactivateSubscriptionId=te(),J.params.upgradeSubscriptionId=ne();var C=getQueryParamInStringByName(getParameterByName("url"),"shared_account_code");C||(C=J.params.shared_account_code||J.params.sharedAccountCode),C&&(J.params.shared_account_code=C,l.setStartState("redeemSharedSubscription"));var y=getQueryParamInStringByName(getParameterByName("url"),"gift_redemption_code");y||(y=J.params.gift_redemption_code||J.params.giftRedemptionCode),y&&(J.params.gift_redemption_code=y,l.setStartState("redeemRenewableGift")),"true"===getParameterByName("isAuth")&&(l.setStartState("auth"),P.currentState.name=getParameterByName("authStartScreen")||"login");var T=angular.element("#checkout-container");f.init({preferredWidth:p},function(){return{container:T}}),m.init(function(){return{app:J.config.app,user:J.config.user,stats:A.getPageView(),fillLoginIframeParams:function(e){e.offerId=J.config.offerId,e.offerType=J.config.offerType,e.templateId=J.config.offerTemplateId,e.templateVariantId=J.config.offerTemplateVariantId,e.gaClientId=J.params.gaClientId,e.email=J.config.sharedAccountEmail},fillLoginRequiredParamsToGoogleAnalytics:function(e){e.offerId=J.config.offerId,e.templateId=J.config.offerTemplateId,e.templateVariantId=J.config.offerTemplateVariantId},fillLoginRequiredEventParams:function(e){e.term=J._findTerm(J.params.termId||K),e.isRedemption=J.params.isRedemption,e.termId=K,e.currentState=l.getActiveState(),e.affiliateState=L.affiliateState,e.redemption={},angular.copy(J.redemptionLoginRequiredParams,e.redemption),J.params.shared_account_code&&(e.sharedAccountCode=J.params.shared_account_code),J.params.reactivateSubscriptionId&&(e.reactivateSubscriptionId=J.params.reactivateSubscriptionId),J.params.upgradeSubscriptionId&&(e.upgradeSubscriptionId=J.params.upgradeSubscriptionId)},fillLoginSuccessEventParams:function(e){e.termId=K}}});var S={aid:J.getAid(),screen:J.params.authStartScreen,isGmSso:J.params.isGmSso||!1,stage:J.params.pianoIdStage,staticDomain:J.params.staticDomain,pianoIdUrl:J.params.pianoIdUrl||"https://id.tinypass.com/id/",checkout:1,abTestIds:getParameterByName("abTestIds")||[],socialName:getParameterByName("socialName"),responseType:getParameterByName("responseType"),getDoubleOptInParams:function(){return J.getDoubleOptInParams()},customFormParams:J.getCustomFormParams,passwordlessEmailSentHandler:function(e){I.saveCheckoutParams(J,e)},isPasswordlessCheckoutEnabled:J.isPasswordlessCheckoutEnabled,isPreventPasswordlessLogin:J.isPreventPasswordlessLogin,isSingleStepEnabled:J.isSingleStepEnabled,getAffiliateIssuerId:function(){},userLoginEmail:function(){return J.config.userLoginEmail||J.config.user.email},passwordlessSetPaymentEmail:function(){I.setPaymentEmail(J)},isSentLoginEmail:function(){return J.config.isSentLoginEmail},isDigitalCodeConfirmationEnabled:function(){return J.config.isDigitalCodeConfirmationEnabled},isSingleStepFormShown:function(e){return J.isSingleStepEnabled()&&"auth"!==e.stateName},getUserToken:function(){return J.params.userToken},widgetSpecificCheckIfVisible:function(){return!!J.getCustomFormParams().checkoutFormName&&J.isPaymentMethodRequired()&&(J.canSelectPaymentMethod()||J.isPaymentMethodSelected())},getPageView:A.getPageView,preview:J.isPreviewMod(),sessions:J.config.sessions};if(x.init(S),m.onLoginSuccess(function(e){J.params.userToken=e.user_token,Be(e.user),function(){if(!J.isAutoCompleteRegistrationTerm())return!1;!J.isTermSelected()&&J.config.terms&&1===J.config.terms.length&&"registration"===J.config.terms[0].type&&(e=J.config.terms[0],J.reload({}).then(function(){if(J.isUserValid()&&m.isUserUnrestricted()){var t=J._findTerm(e);return J.selectTerm(t)}return!1}));var e}()},!1),TPParam.error)d().terminal(TPParam.error);else{if(TPParam.config&&TPParam.config.consoleError&&util.log("%c[CHECKOUT] Error: ".concat(TPParam.config.consoleError),"color: red;"),util.log("[CHECKOUT] Startup params",this.params),util.log("[CHECKOUT] Startup config",this.config),J.input.user_data.first_name=J.config.user.firstName,J.input.user_data.last_name=J.config.user.lastName,"true"===getParameterByName("allowReturnToStartState")&&l.saveHistory(l.startState),J.params.voucherCode&&s.fire(EVENT_APPLY_REDEEM_CODE,{}),!r.isReload)s.fire(EVENT_CHECKOUT_STARTED),(J.isUpgradeOfferType()?J.params.termChangeOptionId:J.params.termId)?a(function(){_()},0):"offer"===l.startState?a(function(){J.startShowOffer(),w()},0):"redemption"===l.startState?a(function(){o.startCheckoutEvent(J.params),h.sendStartCheckoutEvent(J.params),J.startRedemption()},0):"redeemSharedSubscription"===l.startState?a(function(){o.startCheckoutEvent(J.params),h.sendStartCheckoutEvent(J.params),R&&R.gotoRedeemSharedSubscriptionState&&"function"==typeof R.gotoRedeemSharedSubscriptionState&&R.gotoRedeemSharedSubscriptionState()},0):"redeemRenewableGift"===l.startState?a(function(){o.startCheckoutEvent(J.params),h.sendStartCheckoutEvent(J.params),R&&R.gotoRedeemRenewableGiftState&&"function"==typeof R.gotoRedeemRenewableGiftState&&R.gotoRedeemRenewableGiftState()},0):"auth"===l.startState?a(function(){R.gotoAuthState(J,null,function(){J.close()},!0)},0):"continueThreeDSPurchase"===l.startState?a(function(){o.startCheckoutEvent(J.params),h.sendStartCheckoutEvent(J.params),R.gotoContinueThreeDSPurchaseState()},0):a(function(){R.gotoCheckoutStart(J),w()},0);A.getParams().then(function(e){b(e.trackingId),s.fire("updatePianoIdAuthIframeUrl")}),J.params.directCheckout&&J.hasOnlyOneTerm()&&a(function(){J.params.termId=J.config.terms[0].termId,_()},0),o.postMessage("ACTIVE_PAYMENT_METHODS_IDS_INITIALIZED",function(e){if(!Array.isArray(e)||!e.length)return[];var t={};return e.reduce(function(e,n){return Array.isArray(n.oneOffPaymentMethods)&&n.oneOffPaymentMethods.length&&n.oneOffPaymentMethods.forEach(function(n){void 0===n.id||t.hasOwnProperty(n.id)||(e.push(n.id),t[n.id]=n.id)}),e},[])}(this.config.terms))}function _(){var e;if(J.isUpgradeOfferType())e=J._findChangeOption(J.params.termChangeOptionId);else if((e=J._findTerm(J.params.termId))&&e.newCustomersOnly&&!J.isNewCustomer())return void d().terminal(E.trc("term.name",e.name)+" "+E.trc("checkout.platform","is restricted for new customers only")+" ");l.setStartState("state1"),J.startCheckout(e),w()}function w(){"true"===getParameterByName("reloadAfterLogin")&&ue()}},J.initConfig=function(){if(window.TPParam&&window.TPParam.config&&angular.copy(window.TPParam.config,J.config),window.TPParam&&window.TPParam.params&&angular.copy(window.TPParam.params,J.params),J.params.userToken&&m.isPianoIdUserProvider()){var e=T.jwtDecode(J.params.userToken);J.config.user.login_timestamp=e.login_timestamp,J.config.user.token_expiration=1e3*(e.exp-e.iat)}J.isUpgradeOfferType()&&window.TPParam.config&&window.TPParam.config.changeOptions&&(J.config.groupedChangeOptions=Ge(window.TPParam.config.changeOptions)),J.params.termChangeOptionId&&(J.config.termChangeOptionId=J.params.termChangeOptionId),J.config.sessions=Y(TPParam.params.sessions||null,null),angular.copy(J.config.consents,Q.consents)},J.isUserValid=function(){return m.isUserValid()},J.isNewCustomer=function(){return J.config.isNewCustomer},J.isExternalCheckoutAvailable=function(e){return!!_.isAvailableForTerm&&_.isAvailableForTerm(e)},J.isTermAllowedToSelect=function(e){return!J.isTermRestrictedForNewCustomers(e,J.isNewCustomer())&&!J.hasAccess(J,e.resource.rid)},J.isTermRestrictedForNewCustomers=function(e,t){var n=e.newCustomersOnly&&!t;return n&&d(J.$rootScope).global(E.trc("term.name",e.name)+" "+E.trc("checkout.platform","is restricted for new customers only")+" "),n},J.isSelectedTermLocked=function(){return J.flags&&J.flags.selectedTerm&&J.input&&J.input.isTermLockedByPromocode&&!J.input.validUnlockPromoCode&&!J.access.alreadyPurchased},J.isBillingPlanExpanded=function(){return J.flags.isBillingPlanExpanded},J.isBillingPlanCollapsible=function(e){return!!e&&e.length>BILLING_PLAN_DEFAULT_VISIBLE_ROWS},J.getBillingPlanToDisplay=function(e){var t=e;J.isBillingPlanCollapsible(e)&&!J.isBillingPlanExpanded()&&(t=e.slice(0,BILLING_PLAN_DEFAULT_VISIBLE_ROWS));var n=new Date;return t.forEach(function(e){if(e.dateValue){var t=new Date(1e3*e.dateValue),r=n.getDate()===t.getDate()&&n.getMonth()===t.getMonth()&&n.getFullYear()===t.getFullYear();e.date=r?E.tr("Today"):H("date")(t,"mediumDate")}e.endDate&&(e.duration=E.tr("Ends on {0}",H("date")(new Date(1e3*e.endDate),"mediumDate")))}),t},J.getDurationHTMLString=function(e){return e&&e.includes("∞")?function(e){if(/[Aa]+pple/g.test(navigator.vendor))return e.replace("∞","<span class='duration-infinity duration-infinity--safari'>∞</span>");return e.replace("∞","<span class='duration-infinity'>∞</span>")}(e):e},J.toggleBillingPlanTableExpander=function(e){J.flags.isBillingPlanExpanded=e},J.getBillingPlanTableExpanderLabel=function(){return J.flags.isBillingPlanExpanded?E.trc("checkout.platform","Hide"):E.trc("checkout.platform","Show more")},J.isPaymentMethodRequired=function(){return J.getSelectedTerm().isPaymentMethodRequired},J.isAuthForPrintAddressRequired=function(){var e=J.termGate.adrCollectionEnabled&&!J.termGate.adrCollectionSucceeded;return J.isGiftTerm(J._findTerm(J.input.termId))?e&&J.termGate.shippingAddressCollectionEnabled:e},J.isRequirePrintAddress=function(){if(J.isGiftTerm(J._findTerm(J.input.termId))){var e=J.termGate.adrCollectionEnabled&&J.termGate.shippingAddressCollectionEnabled,t=e&&J.input.giftParamsFormFilled&&!J.termGate.adrCollectionSucceeded;return J.flags.isAddressFormNeedLocalValidation=e,t}return J.termGate.adrCollectionEnabled&&!J.termGate.adrCollectionSucceeded},J.isZeroPayment=function(){return J.flags&&J.flags.selectedPaymentMethod&&J.flags.selectedPaymentMethod.id===ZERO},J.isTermSelected=function(){return J.flags.selectedTerm&&J.flags.selectedTerm.selected},J.isPaymentMethod=function(e){return void 0!==e&&(J.isPaymentMethodSelected()&&J.flags.selectedPaymentMethod.id===e&&!J.isMockUsed())},J.isPaymentMethodSelected=function(){return null!=J.flags.selectedPaymentMethod},J.isPayWhatYouWantTerm=function(){return J.flags.selectedTerm.billingPlanTable&&1===J.flags.selectedTerm.billingPlanTable.length&&"true"===J.flags.selectedTerm.billingPlanTable[0].isPayWhatYouWant},J.isPaymentTerm=function(e){return e&&"payment"===e.type},J.isExternalTerm=function(e){return e&&"external"===e.type},J.isGiftTerm=function(e){return e&&"gift"===e.type},J.isRenewableGiftFlow=function(e){return e&&e.allowPurchaseAsGift&&J.params.isRenewableGift},J.isDynamicTerm=function(e){return e&&"dynamic"===e.type},J.isFreeDynamic=function(e){return J.isDynamicTerm(e)&&e.isZero},J.isPayableTerm=function(e){return J.isPaymentTerm(e)||J.isGiftTerm(e)||J.isDynamicTerm(e)},J.isChargingTerm=function(e){return e&&!e.isZero&&!e.hasFreeTrial&&J.isPayableTerm(e)},J.isRegistrationTerm=function(e){return e&&"registration"===e.type},J.isSelectedTermAutoRenewChoiceAvailable=function(){return J.flags.selectedTerm.isSubscription&&!J.flags.selectedTerm.forceAutoRenew&&(J.access&&!J.access.alreadyPurchased||!J.access)&&!J.isGiftTerm(J.flags.selectedTerm)},J.isConfirmStepEnabled=function(){return J.config.isConfirmStepEnabled&&se(J.hasTax()||J.isTaxCnbcEnabled())},J.isDoubleOptInEnabled=function(){return J.config.isDoubleOptInEnabled},J.passwordlessServiceLogin=function(){if(!J.isUserValid()&&I.loginUser)return I.loginUser(J);var e=c.defer();return e.resolve({isPasswordlessLogin:!1}),e.promise},J.isPasswordlessCheckoutEnabled=function(){return J.config.isPasswordlessCheckoutEnabled},J.isPreventPasswordlessLogin=function(){return J.config.preventPasswordlessLogin},J.isPrintAddressPopulated=function(){return J.termGate&&J.termGate.adrCollectionEnabled&&J.termGate.adrCollectionSucceeded},J.isSingleStepEnabled=function(){return J.config.isSingleStepEnabled&&J.isPasswordlessCheckoutEnabled()},J.isPromoCodeApplyWithoutUserEnabled=function(){return J.config.isPromoCodeApplyWithoutUserEnabled},J.isPasswordlessCheckoutEnabledAndUserInvalid=function(){return J.config.isPasswordlessCheckoutEnabled&&!J.isUserValid()},J.isAutoEmailDetectionEnabled=function(){return J.config.isAutoDetectEmailEnabled},J.isMockUsed=function(){return J.config&&J.config.useMock},J.isPreviewMod=function(){return J.params&&J.params.preview&&(!0===J.params.preview||"true"===J.params.preview)},J.isPromoCodeAvailable=function(e){var t=e||J.getSelectedTerm();return!t.isCustomPriceAvailable&&t.allowPromoCodes&&!J.input.validUnlockPromoCode&&(J.access||J.access&&!J.access.alreadyPurchased)},J.isFutureStartAvailable=function(e){return e.allowDeferredStart&&!J.access.inRenewal},J.isSameResidence=function(){return M.sameResidence},J.isTaxEnabled=function(){return!(!J.config.taxSupports||!J.config.taxSupports.length)},J.isTaxCnbcEnabled=function(){return T.contains(J.config.taxSupports,"tax.cnbc")},J.isVatEuEnabled=function(){var e=T.contains(J.config.taxSupports,"vat.eu")||T.contains(J.config.taxSupports,"avalara.vat.eu");return e&&J.config.taxSupports.length>1?"vat.eu"===M.countryTaxSupport||"avalara.vat.eu"===M.countryTaxSupport:e},J.isBillingCountryEnabled=function(){return J.isVatMXEnabled()||J.isVatAUEnabled()||J.isVatNOEnabled()||J.isVatJPEnabled()||J.isVatChEnabled()||J.isVatCanadaEnabled()||J.isVatEuEnabled()||J.isTaxUsEnabled()||J.isCustomVatEnabled()||J.isUKVatEnabled()||J.isRUVatEnabled()||J.isZAVatEnabled()},J.isEuBillingCountryLabel=function(){return M.needResidence},J.isUsBillingCountry=function(){return!1===M.needResidence},J.isUsBillingCountryLabel=function(){return!M.needResidence},J.getBillingAddressEnabled=function(){return J.input.billingAddressEnabled},J.getConfigForBillingAddress=function(){return{billingLabel:E.trc("checkout.platform","Your billing address"),billingConfig:M,billingRegions:J.input.billingAddressesRegions,onZipChanged:function(){s.fire("EVENT_BILLING_CONFIG_ZIP_CODE_CHANGE")},dontBlockFieldsOnPrefilled:!0,checkFields:!0}},J.isVatMXEnabled=function(){return T.contains(J.config.taxSupports,"vat.mx")||T.contains(J.config.taxSupports,"avalara.vat.mx")},J.isVatAUEnabled=function(){return T.contains(J.config.taxSupports,"vat.au")||T.contains(J.config.taxSupports,"avalara.vat.au")||T.contains(J.config.taxSupports,"afc.au")},J.isVatNOEnabled=function(){return T.contains(J.config.taxSupports,"vat.no")||T.contains(J.config.taxSupports,"avalara.vat.no")},J.isVatJPEnabled=function(){return T.contains(J.config.taxSupports,"vat.jp")||T.contains(J.config.taxSupports,"avalara.vat.jp")},J.isVatChEnabled=function(){return T.contains(J.config.taxSupports,"vat.ch")||T.contains(J.config.taxSupports,"avalara.vat.ch")},J.isCustomVatEnabled=function(){return T.contains(J.config.taxSupports,"custom.vat")||T.contains(J.config.taxSupports,"avalara.custom.vat")||T.contains(J.config.taxSupports,"afc.custom")},J.isUKVatEnabled=function(){return T.contains(J.config.taxSupports,"avalara.vat.uk")},J.isRUVatEnabled=function(){return T.contains(J.config.taxSupports,"avalara.vat.ru")},J.isZAVatEnabled=function(){return T.contains(J.config.taxSupports,"avalara.vat.za")},J.isVatCanadaEnabled=function(){return T.contains(J.config.taxSupports,"vat.canada")||T.contains(J.config.taxSupports,"avalara.vat.canada")||T.contains(J.config.taxSupports,"afc.canada")},J.isTaxUsEnabled=function(){return T.contains(J.config.taxSupports,"tax.us")||T.contains(J.config.taxSupports,"avalara.tax.us")||T.contains(J.config.taxSupports,"onesource.tax.us")||T.contains(J.config.taxSupports,"afc.us")},J.isAvalaraTaxEnabled=function(){return T.contains(J.config.taxSupports,"avalara.tax.us")||T.contains(J.config.taxSupports,"avalara.vat.canada")},J.isAvalaraTaxProvider=function(){return J.config.taxSupports.findIndex(e=>e.indexOf("avalara")>-1)>-1},J.isTaxJarPostalCodesEnabled=function(){return T.contains(J.config.taxSupports,"vat.canada")||T.contains(J.config.taxSupports,"tax.us")},J.isBillingAddressAvailableForSelectedCountry=function(){return-1!==M.billingAddressCountries.indexOf(M.countryCode)},J.isOneSourceTaxEnabled=function(){return T.contains(J.config.taxSupports,"onesource.tax.us")},J.isUsSelected=function(){return"US"===M.countryCode},J.isCanadaSelected=function(){return"CA"===M.countryCode},J.isVatColumnVisible=function(){return J.isVatColumnAvailable()&&M.showVAT},J.isVatColumnAvailable=function(){return se(J.hasTax()&&M.taxIncludeBilling)},J.isTaxColumnVisible=function(){return se(J.hasTax())},J.togglePurchaseDisabled=function(e){s.fire("TOGGLE_PURCHASE_DISABLED",e)},J.applyTax=function(e,t,n){var r=c.defer();return function(e){M.updateByCountryCode(J,e.countryCode),e.residenceCountryCode=M.needResidence?e.countryCode:null,J.input.zipCode=e.zipCode;var t={billingCountryCode:e.countryCode,residenceCountryCode:e.residenceCountryCode,residenceZipCode:e.zipCode,billingZipCode:e.billingZipCode};M.updateFromTaxRequest(J,t)}(t),g({method:"post",url:TPParam.APPLY_TAX_ACTION,params:{aid:J.getAid(),oid:J.input.oid,countryCode:J.getBillingCountryCode(),zipCode:J.getBillingZipCode(),billingZipCode:J.getBillingZipCode(),residenceCountryCode:J.getResidenceCountryCode()}}).then(function(){!n&&o.postMessage("applyTaxCompleted",t),r.resolve(t)}).catch(function(t){!n&&o.postMessage("applyTaxFailed"),Ne(e,t.errors),r.reject()}),r.promise},J.hasOnlyFreeIntervals=ce,J.collectPurchaseData=function(){return g({method:"post",url:TPParam.PN_COLLECT_PURCHASE_DATA_URL,params:{aid:J.getAid(),oid:J.input.oid,sessionId:J.input.paymentComponentSessionId,countryCode:J.getBillingCountryCode(),zipCode:J.getBillingZipCode(),billingZipCode:J.getBillingZipCode(),residenceCountryCode:J.getResidenceCountryCode(),consents:J.input.consents}})},J.isAutoCompleteRegistrationTerm=function(){return J.flags.autoCompleteRegistrationTerm},J.isShowBoilerplateCloseButton=function(){var e=C.get().closeButtonType,t="false"!==getParameterByName("showCloseButton"),n="inline"!==getParameterByName("displayMode"),r=e===J.closeButtonTypes.boilerplate;return t&&r&&n},J.hasExternalVerificationGate=function(){return J.termGate.externalApiConfigurationId&&"accepted"!==J.termGate.externalVerificationStatus},J.hasAccess=function(e){return J.flags.needUpdateUserResources&&(J.flags.needUpdateUserResources=!1,N.getUserResource(J).then(function(e){angular.copy(e.data.models.userResources,J.config.userResources)})),J.config.userResources.indexOf(e)>-1},J.hasResources=function(e){if(!e)return!1;if(!J.flags.selectedTerm||!J.flags.selectedTerm.resource||!J.flags.selectedTerm.resource.rid)return!1;var t=[];return"string"==typeof e&&(t=e.indexOf(",")>=0?e.replace(/\s/gm,"").split(","):[e]),Array.isArray(e)&&(t=e.slice(0)),t.some(function(e){return e===J.flags.selectedTerm.resource.rid})},J.hasMultiplePaymentMethods=function(){return J.input.paymentMethods&&J.input.paymentMethods.length>1},J.hasTax=function(){return J.config.hasTax},J.hasOnlyOneTerm=function(){return J.config.terms&&1===J.config.terms.length},J.reloadIfNeed=function(){He.apply(J,arguments)},J.getGeoCountryCode=function(){return window.TPParam.GEO_COUNTRY_CODE},J.getCustomFormParams=function(){var e,t={},n=window.TPParam.params.formNameByTermId;if(n){var r=JSON.parse(n),o=J.input.customFormTermId;o&&(e=r[o])}return e&&(t.checkoutFormName=e,t.hideCompletedFields=window.TPParam.params.hideCompletedFields||!1),t},J.mergeStats=function(e){e&&e.models&&e.models.checkoutStats&&A.mergeStats(e.models.checkoutStats)},J.resize=function(){f.resize()},J.getPreferredWidth=function(){return f.getPreferredWidth()},J.allowTinypassAccountsLogin=function(){return m.allowTinypassAccountsLogin()},J.allowLogout=function(){return m.allowLogout()},J.allowTinypassAccountsLogout=function(){return"receipt"!==l.getActiveState()&&m.allowTinypassAccountsLogout()},J.logout=function(){m.logout(),de()},J.resetAssociatedData=function(){s.fire(EVENT_RESET_PROMO_CODE)},J.sendGoogleAnalyticsEvent=function(e){e&&e.params&&(e.params.aid=J.getAid()),h.sendGoogleAnalyticsEvent(e)},J.register=function(){return J.login("register")},J.login=function(e){return function(){if(m.isCondeUserProvider()){var t=e||"login";if(f.isModal){var n=c.defer();return P.currentState.name=t,R.gotoAuthState(J,null,function(){"auth"===l.getActiveState()&&l.gotoPreviousState(),n.resolve()},!0),n.promise}var r={};return angular.copy(J.params,r),r.isAuth=!0,r.authStartScreen=t,o.startCheckoutEvent(r),h.sendStartCheckoutEvent(r),c.reject()}return m.login(e).then(function(e){var t=e.user;return He(!0,!1,t)})}().then(function(){return ue(null)})},J.startRedemption=function(){function e(e){e?l.gotoRedemptionState():(o.startCheckoutEvent(J.params),h.sendStartCheckoutEvent(J.params))}J.flags.inStartCheckoutFlow=!0,J.params.isRedemption=!0,J.params.startFromInlineCheckout=!1,f.isModal||f.isPopup?(o.startCheckoutEvent(J.params),h.sendStartCheckoutEvent(J.params),e(!0)):(J.params.termId=null,J.params.startFromInlineCheckout=!0,e(!1)),J.flags.inStartCheckoutFlow=!1},J.gotoRedemptionState=function(){l.gotoRedemptionState()},J.startUpgradeAuthentication=function(){J.params.termId=null,J.params.startFromInlineCheckout=f.isInline,J.params.startFromInlineCheckout?(o.startCheckoutEvent(J.params),h.sendStartCheckoutEvent(J.params)):(l.disable(!0),l.gotoState("upgradeAuthentication"))},J.startSubscriptionReactivation=function(){J.params.termId=null,J.params.startFromInlineCheckout=f.isInline,J.params.startFromInlineCheckout?(o.startCheckoutEvent(J.params),h.sendStartCheckoutEvent(J.params)):l.gotoSubscriptionReactivationState()},J.startExternalCheckout=function(e){_.startCheckout(e).then(function(){J.sendGoogleAnalyticsEvent({eventAction:"externalReceiptDisplayed",eventLabel:"External receipt displayed",params:{offerId:J.config.offerId,templateId:J.config.offerTemplateId,templateVariantId:J.config.offerTemplateVariantId,termId:J.input.termId}})})},J.addTermTypeToParams=function(e,t){var n=J._findTerm(t);return n?Object.assign({},e,{type:n.type}):e},J.getExternalCheckoutConfig=function(){return _.getUiConfig?_.getUiConfig():{}},J.startCheckout=function(e){if(J.isUpgradeOfferType())return e.termId=e.termToId,void function(e){if(e&&"object"==typeof e){var t="object"==typeof e?e:J._findChangeOption(e);J.notify("[CHECKOUT] Starting upgrade checkout with termToId:"+t.termToId+" and termChangeOptionId:"+t.termChangeOptionId),A.mergeStats({promo_code:"",promotion_id:"",promo_state:0}),J.input.promotionBillingPlan=null,t.termToId&&(J.params.termId=t.termToId),t.termChangeOptionId&&(J.params.termChangeOptionId=t.termChangeOptionId),J.input.oid&&(J.params.oid=J.input.oid),J.input.promoCodeId&&(J.params.promoCodeId=J.input.promoCodeId),J.input.promoCodeTermId&&(J.params.promoCodeTermId=J.input.promoCodeTermId),J.input.accessStartTime&&(J.params.accessStartTime=J.input.accessStartTime),J.flags.affiliateState&&(J.params.affiliateState=J.flags.affiliateState),o.startCheckoutEvent(J.params),h.sendStartCheckoutEvent(J.params),f.isInline||(t&&J.selectChangeOption(t,J.config.offerId),A.mergeStats({upgrade_option_id:t.termChangeOptionId,term_id:t.termToId}),TPParam.LINKED_TERM_MANUAL_CHECKOUT_TRACKING||A.trackView("external_checkout_start"))}else R.gotoCheckoutStart(J)}(e);var t=e&&"object"==typeof e?e.termId:e,n=J._findTerm(t);if(n&&n.type===LINKED_TERM_TYPE_NAME&&J.params.requestUserAuthForLinkedTerm&&!JSON.parse(J.params.requestUserAuthForLinkedTerm))oe(n);else if(K=t,J.canCheckout()||J.isPasswordlessCheckoutEnabled())if(J.notify("[CHECKOUT] Starting checkout with termId:"+t),A.mergeStats({promo_code:"",promotion_id:"",promo_state:0}),J.input.promotionBillingPlan=null,t&&(J.params.termId=t),J.input.oid&&(J.params.oid=J.input.oid),J.input.promoCodeId&&(J.params.promoCodeId=J.input.promoCodeId),J.input.promoCodeTermId&&(J.params.promoCodeTermId=J.input.promoCodeTermId),J.input.accessStartTime&&(J.params.accessStartTime=J.input.accessStartTime),J.flags.affiliateState&&(J.params.affiliateState=J.flags.affiliateState),"boolean"==typeof J.flags.isRenewableGift&&(J.params.isRenewableGift=J.flags.isRenewableGift,J.flags.isRenewableGift=!1),n&&n.type===LINKED_TERM_TYPE_NAME)ae(n).then(function(){oe(n)},ie);else{var r=J.addTermTypeToParams(J.params,e);o.startCheckoutEvent(r),h.sendStartCheckoutEvent(r),f.isInline||(t?n&&J.selectTerm(n):R.gotoCheckoutStart(J))}else m.loginSuccessPosted()||m.login("register",{termType:n&&n.type}).then(function(e){return He(!0,!1,e.user)}).then(function(){m.isPublisherUserRefProvider()||m.isPianoIdLiteUserProvider()||J.startCheckout(t)})},J.startRenewableGift=function(e){J.flags.isRenewableGift=!0,J.startCheckout(e)},J.startUpgrade=function(e){J.startCheckout(e)},J.getPmList=(e=>e.filter(e=>!!e.paymentMethodType)),J.removeVolgaIfNotSwitzerlandCountrySelected=function(e,t){return t||(t=M.countryCode),J.input.paymentMethods.filter(function(e){return!le(e,t)})},J.resetPaymentSelectionIfVolgaSelected=function(e){e||(e=M.countryCode),le(J.flags.selectedPaymentMethod,e)&&(J.resetPaymentSelection(),s.fire(EVENT_CHECKOUT_RESET_SELECTED_PAYMENT_METHOD))},J.allowRedemption=function(){return J.config.redemptionEnabled},J.systemError=function(e){o.systemErrorEvent({message:e})},J.notify=function(e,t){util.log.apply(console,arguments)},J.canCheckout=function(){return!(J.config.settings&&J.config.settings.requiresValidUser&&!1===J.isUserValid()&&!J.canInitCheckoutWithAnon())||J.isPasswordlessCheckoutEnabled()},J.onAlreadyPurchased=me,J.preselectTermId=function(e){J.flags.preselectedTermId=e},J.startCheckoutWithPreselectedTerm=function(){if(d(J.$rootScope).reset(),J.flags.preselectedTermId)return J.startCheckout(J.flags.preselectedTermId);d(J.$rootScope).global(E.trc("checkout.platform","Please select a plan before continuing"))},J.selectTerm=function(e,t,n,r,a){if("inline"===window.TPParam.params.displayMode)return J.startCheckout(e),c.reject();var s=t;if(s||(s=J.params.offerId),"string"==typeof e&&!(e=J._findTerm(e)))return d(J.$rootScope).reset(),d(J.$rootScope).global(E.trc("checkout.platform","Term not found")),J.enabledCheckout(),c.reject();if(e.termId===J.input.termId&&!a)return J.enabledCheckout(),c.reject();if(!J.canCheckout())return J.enabledCheckout(),c.reject();var u=e;return d(J.$rootScope).reset(),J.isTermRestrictedForNewCustomers(u,J.isNewCustomer())?(J.enabledCheckout(),c.reject()):u.restrictCheckoutProcess?(u.sellDate?d(J.$rootScope).global(E.trc("term.name",u.name)+" "+E.trc("checkout.platform","sales start on")+" "+u.sellDate):u.hasFinishedSales?d(J.$rootScope).global(E.trc("term.name",u.name)+" "+E.trc("checkout.platform","sales of the old season has finished and the sales of new season have not started yet")):d(J.$rootScope).global(E.trc("term.name",u.name)+" "+E.trc("checkout.platform","sales have not started yet")),J.enabledCheckout(),c.reject()):(J.input.termId=e.termId,J.input.offerId=s,J.input.customFormTermId=e.termId,angular.copy(z,J.access),f().then(function(t){if(ge(u)){var n=c.defer();return R.gotoAuthState(J,function(){K=e.termId,J.input.customFormTermId=e.termId},function(){J.isRequirePrintAddress()&&U.getAddressList(J.getAid(),J.params).then(function(e){J.termGate.adrCollectionAvailableAddresses=e}),m.isUserValid()&&!m.isUserUnrestricted()?n.reject():n.resolve(t)},!0),n.promise}return c.when(t)}).then(function(){var e=c.defer();return ue(u).then(function(t){t?e.reject():e.resolve()}),e.promise}).then(function(e){p(e)}));function p(t,a){t&&t.models.alreadyPurchased&&!J.isUpgradeOffer()?me(t,u.termId,r):a||(m.isUserValid()&&!m.isUserUnrestricted()?l.gotoState("user-non-confirmed"):(J._selectTerm(e,n,r),o.postMessage("selectTerm",{alreadyPurchased:J.access.alreadyPurchased}),"registration"===e.type?i.purchaseStarting(J,e):R.gotoNextState(J,i,r)))}function f(){return J.disableCheckout(),i.createOrder(J,e.termId,s,J.params.templateId).then(function(e){if(util.log("[CHECKOUT] order created",e),J.input.oid=e.models.oid,J.input.paymentComponentSessionId=e.models.paymentComponentSessionId,J.input.billingAddressEnabled=e.models.billingAddressEnabled,J.input.sharedAccountCount=e.models.sourceTerm?e.models.sourceTerm.sharedAccountCount:0,J.input.isTermLockedByPromocode=e.models.isTermLockedByPromocode,angular.copy(z,J.access),angular.copy(Z,J.termGate),angular.copy(e.models.user,J.config.user),J.input.isApplyPaymentMethodEnabled=e.models.isApplyPaymentMethodEnabled,J.input.deferredStartMaxDays=e.models.deferredStartMaxDays,J.input.billingAddressEnabled&&(M.zipCode="",M.geoZipCode="",M.billingAddressFields=e.models.billingAddressFields||{},M.billingAddressCountries=Object.keys(M.billingAddressFields),N.getTaxRegions(J.params).then(function(e){J.input.billingAddressesRegions=e.models.countries,J.isAvalaraTaxEnabled()&&(J.input.billingAddressConfig=J.getConfigForBillingAddress())})),J.params.userToken&&m.isPianoIdUserProvider()){var t=T.jwtDecode(J.params.userToken);J.config.user.login_timestamp=t.login_timestamp,J.config.user.token_expiration=1e3*(t.exp-t.iat)}var n={id:e.models.termGateId,externalApiTitle:e.models.externalApiTitle,externalApiApplyButtonName:e.models.externalApiApplyButtonName,externalApiVerifyNew:e.models.externalApiVerifyNew,externalApiConfigurationId:e.models.externalApiConfigurationId,externalApiFields:e.models.externalApiFields,externalVerificationStatus:e.models.externalVerificationStatus,externalVerificationConversionId:e.models.externalVerificationConversionId,externalApiSource:e.models.externalApiSource,externalApiFieldCountry:e.models.externalApiFieldCountry,externalApiSavedForms:e.models.externalApiSavedForms,externalApiPrepopulationForm:e.models.externalApiPrepopulationForm,adrCollectionAvailableAddresses:e.models.adrCollectionAvailableAddresses,adrCollectionCountries:e.models.adrCollectionCountries,adrCollectionEnabled:e.models.adrCollectionEnabled,shippingAddressCollectionEnabled:e.models.shippingAddressCollectionEnabled,adrDefaultCountry:e.models.adrDefaultCountry,adrPrepopulationForm:e.models.adrPrepopulationForm};return n.externalApiFields&&n.externalApiFields.length&&angular.forEach(n.externalApiFields,function(e){e.value=e.defaultValue}),angular.copy(n,J.termGate),J.flags.isDiscounted=!1,c.when(e)}).catch(function(e){var t;return"object"==typeof e&&(e.errors&&e.errors.length?t=e.errors[0].message||e.errors[0].msg:e.message&&(t=e.message)),t?getParameterByName("termId")?d().terminal(E.trc("service.error.codes",t)):d(J.$rootScope).global(E.trc("service.error.codes",t)):d().terminal(E.trc("checkout.platform","Create order failed")),J._unselectTerm(),c.reject(e)}).finally(function(){J.enabledCheckout()})}},J.selectChangeOption=function(e,t,n,r,a){if("inline"===window.TPParam.params.displayMode)return J.startCheckout(e),c.reject();var s=t;return s||(s=J.params.offerId),J.canCheckout()?(d(J.$rootScope).reset(),J.input.termId=e.termId,J.input.offerId=s,J.input.customFormTermId=e.termId,angular.copy(z,J.access),function(){return J.disableCheckout(),i.createOrder(J,e.termId,s,J.params.templateId,null,null,e.termChangeOptionId,J.config.offerType,e.subscriptionFromId).then(function(e){if(util.log("[CHECKOUT] order created",e),J.input.oid=e.models.oid,J.input.billingAddressEnabled=e.models.billingAddressEnabled,J.input.sharedAccountCount=e.models.sourceTerm?e.models.sourceTerm.sharedAccountCount:0,J.input.isTermLockedByPromocode=e.models.isTermLockedByPromocode,angular.copy(z,J.access),angular.copy(Z,J.termGate),angular.copy(e.models.user,J.config.user),J.input.isApplyPaymentMethodEnabled=e.models.isApplyPaymentMethodEnabled,J.flags.selectedTerm=e.models.sourceTerm,J.input.billingAddressEnabled&&(M.zipCode="",M.geoZipCode="",M.billingAddressFields=e.models.billingAddressFields||{},M.billingAddressCountries=Object.keys(M.billingAddressFields),N.getTaxRegions(J.params).then(function(e){J.input.billingAddressesRegions=e.models.countries,J.isAvalaraTaxEnabled()&&(J.input.billingAddressConfig=J.getConfigForBillingAddress())})),J.params.userToken&&m.isPianoIdUserProvider()){var t=T.jwtDecode(J.params.userToken);J.config.user.login_timestamp=t.login_timestamp,J.config.user.token_expiration=1e3*(t.exp-t.iat)}var n={id:e.models.termGateId,externalApiTitle:e.models.externalApiTitle,externalApiApplyButtonName:e.models.externalApiApplyButtonName,externalApiVerifyNew:e.models.externalApiVerifyNew,externalApiConfigurationId:e.models.externalApiConfigurationId,externalApiFields:e.models.externalApiFields,externalVerificationStatus:e.models.externalVerificationStatus,externalVerificationConversionId:e.models.externalVerificationConversionId,externalApiSource:e.models.externalApiSource,externalApiFieldCountry:e.models.externalApiFieldCountry,externalApiSavedForms:e.models.externalApiSavedForms,externalApiPrepopulationForm:e.models.externalApiPrepopulationForm,adrCollectionAvailableAddresses:e.models.adrCollectionAvailableAddresses,adrCollectionCountries:e.models.adrCollectionCountries,adrCollectionEnabled:e.models.adrCollectionEnabled,shippingAddressCollectionEnabled:e.models.shippingAddressCollectionEnabled,adrDefaultCountry:e.models.adrDefaultCountry,adrPrepopulationForm:e.models.adrPrepopulationForm};return n.externalApiFields&&n.externalApiFields.length&&angular.forEach(n.externalApiFields,function(e){e.value=e.defaultValue}),angular.copy(n,J.termGate),J.flags.isDiscounted=!1,c.when(e)}).catch(function(e){var t="object"==typeof e?function(e){var t;return e.errors&&e.errors.length?t=e.errors[0].message||e.errors[0].msg:e.message&&(t=e.message),t}():null;return t?function(e){getParameterByName("termChangeOptionId")?d().terminal(E.trc("service.error.codes",e)):d(J.$rootScope).global(E.trc("service.error.codes",e))}(t):d().terminal(E.trc("checkout.platform","Create order failed")),J._unselectChangeOption(),c.reject(e)}).finally(function(){J.enabledCheckout()})}().then(function(e){return c.when(e)}).then(function(e){var t=c.defer();return e&&e.models&&e.models.alreadyPurchased?(!function(e){if(f.isModal||f.isPopup)me(e);else{if(J.params.noNeedStartCheckoutAfterLogin)return void delete J.params.noNeedStartCheckoutAfterLogin;var t=J._findChangeOption(e.models.termChangeOptionId);t?J.startCheckout(t):J.config.changeOptions&&J.config.changeOptions.length&&J.startCheckout(J.config.changeOptions[0])}}(e),t.reject()):t.resolve(),t.promise}).then(function(){m.isUserValid()&&!m.isUserUnrestricted()?l.gotoState("user-non-confirmed"):(J._selectChangeOption(e,n,r),o.postMessage("selectChangeOption",{alreadyPurchased:J.access.alreadyPurchased}),"registration"===e.type?i.purchaseStarting(J,e):R.gotoNextState(J,i,r))})):(J.enabledCheckout(),c.reject())},J.checkoutWithNewTerm=function(e,t){J.selectTerm(e,t,!0,!1),"gift"===e.type?R.gotoGiftParams(J):R.gotoPaymentState(J,i,e,t)},J.getWidthTerm=function(){return f.getNewWidth()},J.softResetDiscount=function(e){return!0===J.flags.isDiscounted?(J.resetDiscount(),e?c.when(!1):O.updatePaymentMethods(!0,J)):c.when(!1)},J.resetDiscount=function(){if(J.flags.isDiscounted=!1,J.input.promoCodeId=null,J.input.promoCodeTermId=null,J.input.promoCode=null,J.input.originalChargeAmount&&(J.input.chargeAmount=J.input.originalChargeAmount,J.input.chargeAmountInMinorUnit=J.input.originalChargeAmountInMinorUnit,J.input.chargeCurrency=J.input.originalChargeCurrency,J.input.chargeCurrencySymbol=J.input.originalChargeCurrencySymbol,J.input.chargeDisplayAmount=J.input.originalChargeDisplayAmount,J.input.promotionBillingPlan=null,delete J.input.originalChargeAmount,delete J.input.originalChargeAmountInMinorUnit,delete J.input.originalChargeCurrency,delete J.input.originalChargeDisplayAmount,delete J.input.originalChargeCurrencySymbol),angular.forEach(this.config.terms,function(e){e.originalBillingPlan&&(angular.forEach(e.originalBillingPlan,function(t,n){e[n]=t}),delete e.originalBillingPlan)}),O.updateSelectedTerm(J),J.isZeroPayment()){var e=null;J.input.paymentMethods&&1==J.input.paymentMethods.length&&(e=J.input.paymentMethods[0]),J.flags.selectedPaymentMethod=e}return s.fire(EVENT_CHECKOUT_PRICE_CHANGED,{origin:"resetDiscount"}),c.when(!1)},J.getAid=function(){return J.params.aid},J.getOid=function(){return J.input.oid},J.getDoubleOptInParams=function(){return A.getStats().then(function(e){var t={};return angular.copy(J.params,t),J.getLoginTermId()&&(t.termId=J.getLoginTermId()),J.input.oid&&(t.oid=J.input.oid),k.passwordlessEVFields&&(t.externalVerificationFields=k.passwordlessEVFields),{tbc:e.initStatParams.tbc,pageViewId:e.initStatParams.pageViewId,trackingId:e.initStatParams.trackingId,params:t}})},J.discountSelectedTerm=function(e,t,n,r,o,i,a){util.log("[CHECKOUT] Discounting selected with:",e,t,n,r),pe(),J.flags.isDiscounted=!0,J.input.chargeAmount=e,J.input.chargeAmountInMinorUnit=t,J.input.chargeCurrency=n,J.input.chargeDisplayAmount=r,J.input.promotionBillingPlan=o,J.input.promoCodeId=i,J.input.promoCodeTermId=a},J._selectTerm=function(e,t,n){var r;if(r=t&&e?e:J._findTerm(e)){if(util.log("[CHECKOUT] Selecting term",r),angular.forEach(this.config.terms,function(e){e.selected=!1}),r.selected=!0,angular.copy(r,J.flags.selectedTerm),J.input.chargeAmount=J.flags.selectedTerm.chargeAmount,J.input.chargeAmountInMinorUnit=J.flags.selectedTerm.chargeAmountInMinorUnit,J.input.chargeCurrency=J.flags.selectedTerm.chargeCurrency,J.input.chargeCurrencySymbol=J.flags.selectedTerm.chargeCurrencySymbol,J.input.firstRealPriceWithTax=J.flags.selectedTerm.firstRealPriceWithTax,J.input.chargeDisplayAmount=J.flags.selectedTerm.chargeDisplayAmount,J.input.canadianTaxes=J.canadianTaxes(),J.input.customFormTermId=J.flags.selectedTerm.termId,J.params.termId=J.flags.selectedTerm.termId,n)return;angular.copy({},J.flags.selectedPaymentMethod),s.fire(EVENT_CHECKOUT_TERM_SELECTED,r);var i={termName:r.name,termId:r.termId,resourceName:r.resource.name,resourceId:r.resource.rid};o.customEvent("checkoutSelectTerm",i),J.sendGoogleAnalyticsEvent({eventAction:"termSelected",eventLabel:"Term selected",params:{offerId:J.config.offerId,templateId:J.config.offerTemplateId,templateVariantId:J.config.offerTemplateVariantId,termId:r.termId}})}else util.log("Did not find existing term for",e)},J._unselectTerm=function(){angular.forEach(this.config.terms,function(e){e.selected=!1});J.flags.selectedTerm;var e=J.input.zipCode,t=J.input.promoCode;angular.copy(Q,J.input),angular.copy(X,J.flags.selectedTerm),angular.copy(Q.consents,J.input.consents),J.params.termId=null,J.input.user_data.first_name=J.config.user.firstName,J.input.user_data.last_name=J.config.user.lastName,J.input.zipCode=e,J.input.customFormTermId=null,J.input.promoCode=t},J._findTerm=function(e){if(null===e)return null;var t=e;"object"==typeof e&&e.termId&&(t=e.termId);var n=null;return angular.forEach(this.config.terms,function(e){e&&e.termId===t&&(J.notify("[CHECKOUT] Found existing term:"+t),n=e)}),n},J._findChangeOption=function(e){return T.find(J.config.changeOptions,function(t){return t.termChangeOptionId===e})},J._selectChangeOption=function(e,t,n){var r="object"==typeof e?e:J._findChangeOption(e);if(r){if(util.log("[CHECKOUT] Selecting change option",r),angular.forEach(J.config.changeOptions,function(e){e.selected=!1}),r.selected=!0,J.flags.selectedChangeOption=e,J.input.chargeAmount=J.flags.selectedChangeOption.chargeAmount,J.input.chargeAmountInMinorUnit=J.flags.selectedChangeOption.chargeAmountInMinorUnit,J.input.chargeCurrency=J.flags.selectedChangeOption.chargeCurrency,J.input.chargeCurrencySymbol=J.flags.selectedChangeOption.chargeCurrencySymbol,J.input.firstRealPriceWithTax=J.flags.selectedChangeOption.firstRealPriceWithTax,J.input.chargeDisplayAmount=J.flags.selectedChangeOption.chargeDisplayAmount,J.input.canadianTaxes=J.canadianTaxes(),J.input.customFormTermId=J.flags.selectedChangeOption.termId,J.params.termId=J.flags.selectedChangeOption.termId,n)return;angular.copy({},J.flags.selectedPaymentMethod),s.fire(EVENT_CHECKOUT_TERM_SELECTED,r);var i={termName:r.termToName,termId:r.termId,resourceName:r.resource&&r.resource.name,resourceId:r.resource&&r.resource.rid};o.customEvent("checkoutSelectChangeOption",i),h.sendCustomEvent(i)}else util.log("Did not find existing change option for",e)},J._unselectChangeOption=function(){angular.forEach(J.config.changeOptions,function(e){e.selected=!1});var e=J.input.zipCode,t=J.input.promoCode;angular.copy(Q,J.input),angular.copy(ee,J.flags.selectedChangeOption),angular.copy(Q.consents,J.input.consents),J.params.termId=null,J.params.termChangeOptionId=null,J.input.user_data.first_name=J.config.user.firstName,J.input.user_data.last_name=J.config.user.lastName,J.input.zipCode=e,J.input.customFormTermId=null,J.input.promoCode=t};var Ee,ve=!1;function Ce(){!function(){if(J.flags.isCloseClickEventSent)return;e=l.getActiveState(),t=l.viewStack[l.viewStack.length-2],n=J.params.experienceId&&J.params.experienceActionId,r="true"!==J.params.directCheckout&&"offer"===e,i="true"===J.params.directCheckout&&t&&"offer"===t.stateName,n&&(r||i)&&(o.frequencyEvent({experienceId:J.params.experienceId,experienceActionId:J.params.experienceActionId,eventType:"closeClick"}),J.flags.isCloseClickEventSent=!0);var e,t,n,r,i}(),f.purge({alreadyPurchased:J.access.alreadyPurchased,completePayment:J.flags.termComplete,currentState:l.getActiveState()})}J.initPurchase=function(e){var t=e||{purchaseInitiated:!1};return ve=!0,i.initiatePurchase(J).then(function(){return t.purchaseInitiated=!0,t}).finally(function(){ve=!1})},J.selectPaymentMethod=function(e,t){var n=c.defer();return!0===ve?(F.push(r),c.when(!1)):(J.flags.selectedPaymentMethod=null,angular.forEach(this.input.paymentMethods,function(t){t.selected=!1,e&&t.id===e.id&&(J.notify("[CHECKOUT] Payment method selected:"+e.name),t.selected=!0,J.flags.selectedPaymentMethod=t)}),!J.flags.selectedPaymentMethod||t||ve?{purchaseInitiated:!1}:(ve=!0,F.clear(),r(),n.promise));function r(){i.initiatePurchase(J).then(function(){return n.resolve({purchaseInitiated:!0})}).then(function(){s.fire("PROMO_CODE_AUTO_APPLY")}).catch(function(e){n.reject(e)}).finally(function(){ve=!1})}},J.selectPaymentMethodById=function(e,t){var n=Ue(e);return J.selectPaymentMethod(n,t)},J.unselectPaymentMethods=function(){angular.forEach(this.input.paymentMethods,function(e){e.selected=!1})},J.startRenewal=function(){J.flags.isRenewNow=!0,J.access&&J.access.alreadyPurchased&&!J.access.canBeRenewed?J._showSubscriptionHasAlreadyRenewed():(J.access.inRenewal=!0,R.gotoPaymentState(J,i,J.flags.selectedTerm))},J.isRefreshBillingInfoNeeded=function(){return J.flags.isPaymentMethodChanged},J.startShowOffer=function(){l.gotoState("offer")},J.onUserChanged=function(){var e=c.defer(),t=m.isUserValid(),n=s.subscribe(EVENT_CHECKOUT_RELOADED,function(){var r=m.isUserValid();t!==r&&(n(),i.waitInitPurchase().then(function(){e.resolve(r)}))});return e.promise},J.close=function(e){J.config.sessions&&J.config.sessions.hit_limit&&J.config.sessions.session_limit<J.config.sessions.session_count&&!J.isShowBoilerplateCloseButton()&&"receipt"!==l.getActiveState()?J.startShowOffer():(e&&e(),f.close({alreadyPurchased:J.access.alreadyPurchased,completePayment:J.flags.termComplete}),s.fire(EVENT_CHECKOUT_CLOSED))},J.canInitCheckoutWithAnon=function(){return J.config.app&&!0===J.config.app.canInitCheckoutWithAnon},J.fireCheckoutPaymentErrorEvent=function(){var e=d(t).errors(!1);angular.forEach(e,function(e){var t=e.message||e.msg;o.checkoutPaymentErrorEvent(t)})};var ye=function(){Ee.resolve(),J.enabledCheckout()},Te=function(){Ee.reject(),J.enabledCheckout()},Se=function(e){S.logEvent("successPurchase",{async_processing:e?e.async_processing:"params not provided"}),"true"===e.async_processing?(util.log("[CHECKOUT] Asynchronous processing. Completing and granting provisional access",e),angular.copy(JSON.parse(e.receipt),J.input.receipt),J.sendGoogleAnalyticsEvent({eventAction:"checkoutSuccess",eventLabel:"Checkout success",params:{offerId:J.offerId,templateId:J.config.offerTemplateId,templateVariantId:J.config.offerTemplateVariantId,chargeAmount:J.input.receipt.chargeAmount,chargeCurrency:J.input.receipt.chargeCurrency,termId:J.input.termId}}),o.completeEvent(J.addTermTypeToParams(J.input.receipt,J.input.receipt.termId)),Oe(J.input.receipt).finally(ye)):(util.log("[CHECKOUT] completing term",e),J._completeTerm(e).finally(ye))},Pe=function(e){let t;"object"==typeof e?e.errors&&e.errors.length?t=e.errors[0].message||e.errors[0].msg:e.message&&(t=e.message):"string"==typeof e&&(t=e),J.fireCheckoutPaymentErrorEvent(),d().terminal(E.trc("service.error.codes",t))},Ae=function(e){if("object"==typeof e&&e.models&&e.models.alreadyPurchased)return me(e,J.getSelectedTerm().termId,!1),void Te();var n;"object"==typeof e?e.errors&&e.errors.length?n=e.errors[0].message||e.errors[0].msg:e.message&&(n=e.message):"string"==typeof e&&(n=e),n&&(d(t).global(E.trc("service.error.codes",n)),J.fireCheckoutPaymentErrorEvent());var r=e&&e.errors&&e.errors[0];J.getBillingAddressEnabled()&&-1!==["18003","18005"].indexOf(r)&&(M.postalCodeError=!0),Te(),i.initiatePurchase(J)};function _e(){return d(J.$rootScope).reset(),l._validateViews().catch(function(){return util.log("[CHECKOUT] Validation on completePayment has failed"),J.fireCheckoutPaymentErrorEvent(),c.reject()}).then(function(){var e=J.getSelectedTerm(),n=e&&"registration"===e.type;return J.checkConsents(!0).then(function(){return ke()}).then(function(){return Ie()}).then(function(){if(!n)return be()}).then(function(e){return!J.getBillingAddressEnabled()||M.billingAddressPrefilled&&null!==J.getUpiId()||J.isAvalaraTaxEnabled()&&!J.isBillingAddressAvailableForSelectedCountry()?c.when(!0):n||M.billingAddress.postalCode?(e&&e.models&&(M.billingAddress=e.models.billingAddress,M.billingAddress.isVerified=!0,M.zipCode=M.billingAddress.postalCode,s.fire(EVENT_UPDATE_BILLING_ADDRESS_REGION,M.billingAddress.country.countryCode)),N.billingAddressApply(J.input.oid,M.billingAddress,J.params,J.isAvalaraTaxEnabled()?"Avalara":J.isOneSourceTaxEnabled()?"Experian":void 0)):(M.billingAddress.isVerified?d(t).global(E.tr("Address is required")):M.billingAddress.region.regionName?d(t).global(E.tr("Postal code is required")):d(t).global(E.tr("Area is required")),M.postalCodeError=!0,c.reject())}).then(function(){return he()}).then(function(){return we()}).then(function(){J.sendGoogleAnalyticsEvent({eventAction:"submitPayment",eventLabel:"Submit payment",params:{termId:J.params.termId,term:J._findTerm(J.params.termId)}})}).then(function(){return De()})})}J.completeUpgradeThreeDS=function(e){i.completeUpgradeThreeDS(J,function(t){e(t).then(function(){R.gotoReceipt(J)}).catch(Pe)},Pe)},J.completePaymentThreeDS=function(){i.completePurchaseThreeDS(J,Se,Ae)},J.reInitPurchase=function(){i.initiatePurchase(J)},J.completePayment=function(){var e={termId:J.params.termId,term:J._findTerm(J.params.termId)};return o.submitPayment(e),Ee=c.defer(),J.disableCheckout(),d(J.$rootScope).reset(),_e().then(function(){return e=c.when(),angular.forEach(l.views,function(t){angular.forEach(t.components,function(t){J.isPaymentMethod(t.PAYMENT_PROVIDER_ID)&&t.customActionOnCompletePurchase&&(e=t.customActionOnCompletePurchase())})}),e;var e}).then(function(){return i.processPurchase(J,Se,Ae)}).catch(function(e){e&&e.errors&&e.errors.length>0&&e.errors[0].msg&&(e.errors.forEach(function(e){d(t).global({name:e.name,message:E.trc("service.error.codes",e.msg)})}),J.fireCheckoutPaymentErrorEvent()),Te()}),Ee.promise},J.confirmPayment=function(){var e=c.defer();return J.disableCheckout(),d(t).reset(),l._validateViews().then(function(){J.checkConsents(!1).then(function(){return ke()}).then(function(){return Ie()}).then(function(){return be()}).then(function(e){return e&&e.models&&(M.billingAddress=e.models.billingAddress,M.zipCode=M.billingAddress.postalCode),he()}).then(function(){return we()}).then(function(){return e=c.when(),angular.forEach(l.views,function(t){angular.forEach(t.components,function(t){J.isPaymentMethod(t.PAYMENT_PROVIDER_ID)&&t.customActionOnConfirmPayment&&(e=t.customActionOnConfirmPayment())})}),e;var e}).then(function(){return i.waitInitPurchase()}).then(function(){return i.confirmPayment(J)}).then(function(t){var n=J.input.confirmated,r=t.models;n.billingPlan=r.billingPlan,n.nextPeriodBillingPlanTable=r.nextPeriodBillingPlan,n.taxAmount=r.taxAmount,n.chargeAmount=r.chargeAmount,n.chargeAmountInMinorUnit=r.chargeAmountInMinorUnit,n.amount=r.amount,n.total=r.total,n.taxRate=r.taxRate,n.taxAmount=r.taxAmount,n.hstRate=r.hstRate,n.hstAmount=r.hstAmount,n.qstRate=r.qstRate,n.qstAmount=r.qstAmount,n.pstRate=r.pstRate,n.pstAmount=r.pstAmount,n.gstRate=r.gstRate,n.gstAmount=r.gstAmount,J.input.canadianTaxes=J.canadianTaxes(),R.gotoConfirmation(J).finally(function(){e.resolve()})}).catch(function(n){n&&n.errors&&n.errors.length>0&&n.errors[0].msg?n.errors.forEach(function(e){d(t).global({name:e.name,message:E.trc("service.error.codes",e.msg)}),J.fireCheckoutPaymentErrorEvent()}):n&&n.isCheckConsentsError||"BraintreeError"===n.name||d().terminal(E.tr("Confirmation order failed")),e.reject()})},function(){util.log("[CHECKOUT] Validation on confirmPayment has failed"),J.fireCheckoutPaymentErrorEvent(),e.reject()}),e.promise.finally(function(){J.enabledCheckout()})},J.validateOnCompletePayment=_e;var be=function(){if(!M.billingAddressFields||!J.isAvalaraTaxEnabled()||M.billingAddressPrefilled||!J.isBillingAddressAvailableForSelectedCountry())return c.when(!0);if(!M.zipCode)return M.postalCodeError=!0,c.reject({errors:[{msg:E.tr("Please enter a postal code")}]});for(var e=0;e<M.requiredBillingAddressFieldsAnchors.length;e+=1){var t=M.requiredBillingAddressFieldsAnchors[e],n=!1;if(("regionName"===t||M.billingAddress[t])&&("regionName"!==t||M.billingAddress.region.regionName)||(n=!0),n)return c.reject({errors:[{msg:E.tr("Please fill required fields")}]})}return N.verifyAvalaraAddress(J.params,M.billingAddress)},we=function(){var e=J.isGiftTerm(J.getSelectedTerm()),t=J.input.giftRecipientEmail===J.config.user.email;if(e&&J.isPasswordlessCheckoutEnabled()&&J.isSingleStepEnabled()&&t)return c.reject({errors:[{msg:E.tr("You can't purchase gift to yourself")}]})};var Ie=function(){var e=!M.zipCode&&(M.residenceRequireZipCode||M.requiredZipCodeAndNotHidden);return(J.isTaxJarPostalCodesEnabled()&&!J.getIfDuplicateZipCodeIsHidden()||J.isAvalaraTaxEnabled()||J.isOneSourceTaxEnabled())&&e?(M.postalCodeError=!0,c.reject({errors:[{msg:E.tr("Please enter a postal code")}]})):c.when(!0)};function ke(){if(!J.isRegistrationTerm(J.getSelectedTerm())&&J.isTaxEnabled()&&!J.isTaxCnbcEnabled()&&(!J.getBillingCountryCode()||M.needResidence&&!J.isSameResidence()&&!J.getResidenceCountryCode()))return M.countrySelectorError=!0,c.reject({errors:[{msg:E.tr("Please select a billing country")}]})}var Me,Ne=function(e){e&&e.length&&(angular.forEach(e,function(e){e.message=e.msg}),d(J.$rootScope).globals(e))};function Oe(e){return!!e.subscriptionId&&"number"==typeof J.input.sharedAccountCount&&!J.isGiftTerm(J.getSelectedTerm())?(J.input.sharedAccounts=e.sharedAccounts,J.input.termConversionId=e.termConversionId,R.gotoSharedSubscriptionState()):R.gotoReceipt(J)}function Re(e){var t=e&&e.errors&&e.errors.length&&e.errors[0].msg;return t?d().terminal(E.trc("service.error.codes",t)):d().terminal(E.trc("checkout.platform","Reload failed")),console.warn(e),util.log("CHECKOUT - RELOAD ERROR",getParameterByName("iframeId"),e),!1}function De(){var e=J.getSelectedTerm();return e&&e.newCustomersOnly&&!J.isNewCustomer()?(d().terminal(E.trc("term.name",e.name)+" "+E.trc("checkout.platform","is restricted for new customers only")+" "),c.reject(!1)):c.when(!0)}J.checkConsents=function(e){var t=c.defer(),n=i.checkConsentsFunction(),r={isCheckConsentsError:!0};return n&&!0===e?n(J).then(function(){s.fire(EVENT_CHECKOUT_CONSENT_CHANGED),t.resolve()}).catch(function(e){Ne(e),t.reject(r)}):v.isNeeded(J)?(J.isPasswordlessCheckoutEnabled()&&-1!==["offer","auth"].indexOf(l.getActiveState())&&angular.forEach(J.input.consents,function(e){e.required&&(e.checked=!0)}),v(J).then(function(){s.fire(EVENT_CHECKOUT_CONSENT_CHANGED),t.resolve()}).catch(function(e){Ne(e.errors),t.reject(r)})):t.resolve(),t.promise},J._showSubscriptionHasAlreadyRenewed=function(){d().terminal(E.trc("checkout.platform","The subscription has already been renewed"))},J._completeTerm=function(e){var n=c.defer();return e.first_name=J.input.user_data.first_name,e.last_name=J.input.user_data.last_name,e.url=J.params.url,e.device_data=J.input.deviceData,d(t).reset(),i.completePurchase(J,J.input.oid,e,function(e){S.logEvent("completePurchaseSuccess"),J.flags.termComplete=!0,angular.copy(e.receipt,J.input.receipt),J.sendGoogleAnalyticsEvent({eventAction:"checkoutSuccess",eventLabel:"Checkout success",params:{offerId:J.config.offerId,templateId:J.config.offerTemplateId,templateVariantId:J.config.offerTemplateVariantId,chargeAmount:J.input.receipt.chargeAmount,chargeCurrency:J.input.receipt.chargeCurrency,termId:J.input.termId}}),o.completeEvent(J.addTermTypeToParams(J.input.receipt,J.input.receipt.termId)),Oe(e.receipt).finally(function(){s.fire(EVENT_CHECKOUT_SUCCESS),n.resolve()}),document.cookie="ch_sid=; Path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;",J.enabledCheckout()},function(e){S.logEvent("completePurchaseError"),"object"==typeof e&&e.models&&e.models.renewalSubscriptionLockException?J._showSubscriptionHasAlreadyRenewed():(J.enabledCheckout(),n.reject())}),n.promise},J.paymentComponentCompletePurchase=function(){Oe(J.input.receipt).finally(ye)},J.getSelectedTerm=function(){return this.flags.selectedTerm},J.getSelectedChangeOption=function(){return this.flags&&this.flags.selectedChangeOption},J.getLoginTermId=function(){return K},J.getPaymentMethodId=function(){return this.flags&&this.flags.selectedPaymentMethod&&this.flags.selectedPaymentMethod.id},J.goToPasswordlessLoginState=function(e,t){var n=!1;l.gotoState("passwordlessLogin");var r=s.subscribe("passwordlessLoginLoad",function(){r(),e&&e()}),o=s.subscribe("passwordlessLoginSuccess",function(){o(),n=!0,t&&t()});return n},J.setAsDefaultPaymentMethod=function(e){return N.setAsDefaultPaymentMethod(e).then(function(e){var t=e.data.models,n=t&&t.applyResult&&t.applyResult.updateFailedSubscriptionPubIds||{},r=t&&t.applyResult&&t.applyResult.updatedSubscriptionPubIds||[];return Object.keys(n).length>0?(console.error(n),d(J.$rootScope).reset(),r.length>0?d(J.$rootScope).global(E.trc("checkout.platform","Could not apply payment method to all subscriptions")):d(J.$rootScope).global(E.trc("checkout.platform","Could not apply payment method"))):0===r.length&&d(J.$rootScope).global(E.trc("checkout.platform","No eligible active subscriptions.")),{updated:r.length,failed:Object.keys(n).length}}).catch(function(e){d(J.$rootScope).reset(),d(J.$rootScope).global(e.data.errors[0].msg)})},J.canSelectPaymentMethod=function(){return J.input.paymentMethods&&J.input.paymentMethods.length>1&&!J.isZeroPayment()},J.resetPaymentSelection=function(){angular.forEach(this.input.paymentMethods,function(e){e.selected=!1}),J.flags.selectedPaymentMethod=null},J.disableCheckout=function(){const e=E.trc("checkout.platform","Loading");tinypass.refreshLoadingStatusInContainer(e),tinypass.showWaitPanel("checkoutDisable",'<div id="lock-modal-overlay"></div>')},J.enabledCheckout=function(){const e=E.trc("checkout.platform","Loading complete");tinypass.refreshLoadingStatusInContainer(e),tinypass.hideWaitPanel("checkoutDisable")},J.reload=function(t,n){var r=Fe(t);return J.isUpgradeOfferType()?N.getOffer(r,J,e.TPParam.GET_UPGRADE_OFFER).then(function(e){var t=e&&e.models&&e.models.offerData&&e.models.offerData.options||[];J.config.changeOptions=t,J.config.groupedChangeOptions=Ge(t),s.fire(EVENT_CHANGE_OPTIONS_CONFIG_UPDATED),s.fire(EVENT_CHECKOUT_RELOADED)},function(e){Re(e)}):(r.countryCode=J.getBillingCountryCode(),r.residenceCountryCode=J.getResidenceCountryCode(),r.billingZipCode=J.getBillingZipCode(),r.zipCode=J.input.zipCode,r.sameResidence=J.isSameResidence(),r.oid=J.input.oid,r.promoCodeId=J.input.promoCodeId,r.promoCodeTermId=J.input.promoCodeTermId,r.accessStartTime=J.input.accessStartTime,r.isRenewableGift=J.params.isRenewableGift,J.flags.selectedPaymentMethod&&void 0!==J.flags.selectedPaymentMethod.id&&(r.paySourceId=J.flags.selectedPaymentMethod.id),r.city=void 0,M&&M.billingAddress&&M.billingAddress.city&&(r.city=M.billingAddress.city),N.getOffer(r,J).then(function(e){!function(e,t,n){util.log("CHECKOUT - RELOAD",getParameterByName("iframeId"),e);var r=!1;window.TPParam.config=e.models.config,window.TPParam.params=t,J.initConfig(),O.updateSelectedTerm(J),Be(J.config.user),J.params.shared_account_code=getQueryParamInStringByName(getParameterByName("url"),"shared_account_code")||J.params.shared_account_code||J.params.sharedAccountCode,J.params.gift_redemption_code=getQueryParamInStringByName(getParameterByName("url"),"gift_redemption_code")||J.params.gift_redemption_code||J.params.giftRedemptionCode,!J.isUserValid()&&m.loginSuccessPosted()&&m.setLoginSuccessPosted(!1);!J.config.settings.requiresValidUser||J.isUserValid()||J.canInitCheckoutWithAnon()&&!J.isPrintAddressPopulated()&&"printAddress"!==l.getActiveState()||J.isPasswordlessCheckoutEnabled()&&!J.isPrintAddressPopulated()&&"printAddress"!==l.getActiveState()||l.isActive("auth")||de();O.updatePayWhatYouWant(),e.models.alreadyPurchased&&J.getSelectedTerm()&&(me(e,J.getSelectedTerm().termId,n),r=!0);De(),s.fire(EVENT_CHECKOUT_RELOADED)}(e,r,n)},function(e){Re(e)}))},J.getBillingCountryCode=function(){return M.countryCode},J.getRequiredZipCode=function(){return M.requiredZipCode||!1},J.getBillingZipCode=function(){return M.zipCode||M.billingAddress&&M.billingAddress.postalCode},J.getIfDuplicateZipCodeIsHidden=function(){return M.isDuplicateZipCodeHidden},J.onZipCodeChange=T.debounce(function(){s.fire(EVENT_CC_ZIP_CODE_CHANGED,{zipCode:J.input.zipCode})},300),J.getResidenceCountryCode=function(){return M.residenceCountryCode},J.getVatLabel=function(){return M.vatLabel},J.toggleVatColumn=function(){M.showVAT=!M.showVAT},J.alreadyPurchased=function(){return J.access&&J.access.alreadyPurchased},J.canadianTaxes=function(){var e=J.input.confirmated,t=[];return e&&(n("HST",e.hstRate,e.hstAmount),n("QST",e.qstRate,e.qstAmount),n("PST",e.pstRate,e.pstAmount),n("GST",e.gstRate,e.gstAmount)),t;function n(e,n,r){n&&n>0&&t.push({name:e,rate:n,amount:r})}},J.setCustomConfirmationUrl=function(e){Me=e},J.getCustomOrDefaultConfirmationUrl=function(e){return Me||e},J.getPasswordlessEmail=function(){return I.data.email},J.getLang=function(){return xe},J.getTermChargeAmount=function(e){return J.isFreeTrial(e)&&e.authorizationAmount||e.chargeAmount},J.getSelectedTermChargeAmounts=function(e){var t,n=J.getSelectedTerm(),r=e||n.authorizationAmount,o=J.isFreeTrial(n),i=J.isFreeDynamic(n),a=o||i,s=Math.max(J.input.chargeAmountAndTax||0,J.input.chargeAmount||0);r=a&&!J.access.alreadyPurchased&&r||s||J.input.originalChargeAmount;var c=a?r:s,l=a?H("currency")(0,J.input.chargeCurrencySymbol):J.input.chargeDisplayAmountAndTax||J.input.chargeDisplayAmount,u=n.billingPlanTable;return{amount:r,verifyAmount:c<(t=J.isDynamicTerm(n)?n.verificationAmountWithTax:u&&u.length>0?Math.max.apply(Math,u.map(function(e){return o&&e.originalPriceValue||e.priceAndTax})):J.input.originalChargeAmount||n.chargeAmount)?t:r,chargeDisplayAmount:c<t?l:void 0,isFree:!J.isChargingTerm(n)}},J.isFreeTrial=function(e){return!J.isChargingTerm(e)&&e.hasFreeTrial},s.subscribe("successfullyCreditRedeem",function(e,t){util.log("[CHECKOUT] redeem credit successfully: ",t)}),s.subscribe("creditRedeemFailed",function(e,t){let n=t&&t.message;d().terminal(E.trc("checkout.platform","Cannot redeem credit: ")+n),util.log("%c[CHECKOUT] Cannot redeem credit: ".concat(n),"color: red;")}),s.subscribe(EVENT_TERMINAL_ERROR,function(e,t){l.disable()}),s.subscribe("afterSuccessDOI",function(e,t){if(t)if(t.isRedemption)s.fire(EVENT_REDEMPTION_CODE_APPLIED_ON_DOI,t);else{var n=1===l.viewStack.length&&["auth","user-non-confirmed"].includes(l.getActiveState());n||l.gotoPreviousState(),t.termId&&t.offerId&&J.selectTerm(t.termId,t.offerId,null,null,n)}}),s.subscribe(EVENT_TERMINATE_SESSION_INITIATED,function(){l.gotoState("terminateSessionConfirmation")}),s.subscribe(EVENT_TERMINATE_SESSION_COMPLETED,function(e,t){J.config.sessions.session_count=t.session_count,s.fire(EVENT_SESSIONS_UPDATED),J.config.sessions&&t.session_count<=J.config.sessions.session_limit?J.close():l.gotoPreviousState()}),s.subscribe(EVENT_TERMINATE_SESSION_CANCELED,function(){l.gotoPreviousState()}),s.subscribe(EVENT_APPLE_PAY_CAN_MAKE_PAYMENTS,function(e,t){J.flags.applePayCanMakePaymentIdentifiers.set(t.paymentMethodIdentifier,t.canMakePayments)}),s.subscribe(EVENT_SETUP_CUSTOM_VARIABLES,function(e,t){J.config.customVariables=t,window.TPParam.params.customVariables=t}),s.subscribe(EVENT_SETUP_EVT_FIELDS,function(e,t){k.setExternalVerificationFields&&k.setExternalVerificationFields(t)});var xe,Le=!1,Ve=!1;function Ue(e){for(var t=0;t<J.input.paymentMethods.length;t++){var n=J.input.paymentMethods[t];if(n.id===e)return n}}function Be(e){if(!angular.equals(e,J.config.user)){if(angular.copy(e,J.config.user),J.params.userToken&&m.isPianoIdUserProvider()){var t=T.jwtDecode(J.params.userToken);J.config.user.login_timestamp=t.login_timestamp,J.config.user.token_expiration=1e3*(t.exp-t.iat)}m.userChanged(e)}}function He(e,t,n,r,o){return e&&n?J.reload(o,r):e&&t?a(function(){Be({valid:!0}),s.fire(EVENT_CHECKOUT_RELOADED)},0):J.reload(o,r)}function Fe(e){var t=e||{};angular.forEach(["userToken","isRedemption","startFromInlineCheckout","isRenewableGift"],function(e){var n=J.params[e];void 0!==t[e]&&(n=t[e]),t[e]=n});var n=J.getSelectedTerm();return t.termId=n&&n.termId||t.termId,angular.forEach(window.TPParam.params,function(e,n){void 0===t[n]&&(t[n]=e)}),t.lang=xe,t}function $e(e,t){var n=new RegExp("^UA-[0-9a-zA-Z]*-[0-9a-zA-Z]*$").test(e),r=new RegExp("([{]?[0-9a-fA-F]{8}-([0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12}[}]?)|([0-9]*\\.[0-9]*)").test(t);if(!J.gaAppended&&n&&r)try{var o=document.createElement("script");o.innerHTML="(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create', '"+e+"', {  'storage': 'none',  'clientId': '"+t+"'});",document.head.appendChild(o),J.gaAppended=!0}catch(e){}}function Ge(e){var t=e||J.config.changeOptions||[];return Object.entries(t.reduce(function(e,t){return e[t.termFromId]||(e[t.termFromId]=[]),e[t.termFromId].push(t),e},{})).map(e=>{var n=e[0],r=e[1],o=function(e,t){return T.find(e,function(e){return e.termFromId===t})}(t,n);return{currentSubscription:{accessPeriodFromId:o.accessPeriodFromId,accessPeriodFromName:o.accessPeriodFromName,resourceFromName:o.resourceFromName,subscriptionFromBillingPeriod:o.subscriptionFromBillingPeriod,subscriptionFromBillingPlan:o.subscriptionFromBillingPlan,subscriptionFromId:o.subscriptionFromId,termFromId:o.termFromId,termFromName:o.termFromName,termFromType:o.termFromType},changeOptions:r}})}return s.subscribe(EVENT_VIEW_ACTIVATED,function(e,t,n){("offer"===t.name&&Le&&(J.softResetDiscount(!0),J.sendGoogleAnalyticsEvent({eventAction:"checkoutRestarted",eventLabel:"Checkout restarted",params:{offerId:J.config.offerId,templateId:J.config.offerTemplateId,templateVariantId:J.config.offerTemplateVariantId}})),"offer"===t.name)&&(Le=!0,J.sendGoogleAnalyticsEvent({eventAction:"showOffer",eventLabel:"Show offer",params:{offerId:J.config.offerId,templateId:J.config.offerTemplateId,templateVariantId:J.config.offerTemplateVariantId}}),J.params.reactivateSubscriptionId&&J.startSubscriptionReactivation(),J.isUpgradeAuthentication()&&(J.isUserValid()?c.when():J.login()).catch(function(e){throw J.close(J.clearUpgradeSubscriptionId),e}).then(J.startUpgradeAuthentication));if("state1"===t.name&&Ve&&J.softResetDiscount(),"state1"===t.name&&(Ve=!0),"externalVerification"!==t.name||J.hasExternalVerificationGate())if("state2"===t.name&&J.alreadyPurchased()&&!J.access.inRenewal)l.gotoPreviousState();else if("lockedPromoCode"!==t.name||J.isPromoCodeAvailable())if("auth"===t.name&&J.isUserValid())l.gotoPreviousState();else if((!l.isTermSelectorState(t.name)||n&&n.termId)&&"offer"!==t.name){if("state2"===t.name&&n.paySource){var r=Ue(+n.paySource);J.selectPaymentMethod(r)}}else J._unselectTerm();else l.gotoPreviousState();else a(function(){R.gotoCheckoutStart(J)},0)}),s.subscribe("pianoIdLoginSuccess",function(e,t){t.extendExpiredAccessEnabled&&T.setExtendExpiredAccessCookie(J.getAid(),t.extendExpiredAccessEnabled)}),s.subscribe("setExtendExpiredAccess",function(e,t){t&&T.setExtendExpiredAccessCookie(J.getAid(),t)}),s.subscribe("reloadOffer",function(e,t){var n=l.getActiveState(),r=l.isPaymentFormState(n)||"auth"===n||"offer"===n;t&&t.noNeedStartCheckout&&(delete t.noNeedStartCheckout,r=!1);var o=!r&&"auth"===n,i=(t=Fe(t)).reloadAfterLogin,a=t.preventReloadAfterLogin,s=t.user;J.params.userToken=t.userToken,s&&m.isPianoIdUserProvider()&&m.isUserValid()&&x.extendUserByCheckoutParams(s),He(i,a,s,o,t)}),s.subscribe(EVENT_CONFIG_RELOAD,function(){var e=!0;"false"!==C.get().autoCompleteRegistrationTerm&&!1!==C.get().autoCompleteRegistrationTerm||(e=!1),J.flags.autoCompleteRegistrationTerm=e}),V(function(e){var t=xe&&xe!==e;xe=e,t&&J.reload(null,!0),o.postMessage("langChangedWithinOffer",{lang:e})}),s.subscribe("checkProccessesForClose",function(){y("EXTERNAL_EVENT","close"),Ce()}),s.subscribe("gaAppended",function(e,t){$e(t.gaAccount,t.clientId)}),s.subscribe("captcha-v3-enabled-value",function(e,t){var n;n=t.isEnabled,J.flags.isCaptchaV3Enabled=n}),s.subscribe("tpStartLinkedTermCheckout",function(e,t){if(t.termId){var n=J._findTerm(t.termId);n&&n.type===LINKED_TERM_TYPE_NAME&&oe(n)}}),s.subscribe("startLinkedTermProcessAfterExternalLogin",function(e,t){t.termId&&oe(J._findTerm(t.termId))}),J.createOrder=function(e,t,n,r,o,i,a,s){return N.createOrder(e,t,n,r,o,J,i,a,s)},J.isUpgradeOffer=function(){return"UPGRADE"===J.config.checkoutFlowType},J.isUpgradeOfferType=function(){return"upgradeOffer"===J.params.offerType},J.getOfferType=function(){return J.params.offerType||"purchaseOffer"},J.isForUpgrade=function(){return J.isUpgradeOffer()||J.isUpgradeOfferType()},J.getUpgradeOfferId=function(){return J.params.checkoutFlowId},J.isUpgradeAuthentication=function(){return!!J.params.upgradeSubscriptionId},J.clearUpgradeSubscriptionId=function(){delete J.params.upgradeSubscriptionId,o.postMessage("removeQueryParamByName",{paramsToRemove:[UPGRADE_SUB_QUERY_PARAM]})},J.openWindow=function(e,t){return B.openWindow(e,function(){J.enabledCheckout(),t&&t()})},J}]),checkoutModule.factory("threeDSecureInfoLogger",["tpHTTP","statsService",function(e,t){return{logThreeDSecureInfo:function(n){return t.getStatsPayload().then(function(t){return t.checkoutStats.threeDSecureInfo={data:n},e.post(TPParam.LOG_THREE_D_SECURE_INFO,t)})}}}]),angular.module("callbackStorageModule",[]).factory("callbackStorage",[function(){let e=[];return{push:function(t){e.push(t)},clear:t,executeLastAndClear:function(){e.length>0&&(e[e.length-1](),t())}};function t(){e=[]}}]),angular.module("promocodeSynchronizationModule",["viewServiceModule"]).factory("autoApplyService",["viewService","checkout",function(e,t){return{isState2:n,isAutoApply:function(){return n()&&t.hasMultiplePaymentMethods()&&!t.input.paymentMethods.find(function(e){return"apple_pay"===e.paymentTypeId})}};function n(){return"state2"===e.getActiveState()}}]),angular.module("pollingModule",[]).factory("pollingService",["$q","errorService","lang","$rootScope",function(e,t,n,r){const o=1e3,i=12e4;return{completeTimeout:function(){return function(e){const t=e.reduce((e,t)=>e+t,0),n=i-t;let r=n/o,a=n%o;const s=new Array(Math.floor(r)).fill(o);a>0&&s.push(a);return e.concat(s)}([2e3,2e3,2e3,2e3,2e3])}}}]),angular.module("paymentComponentModule",[]).constant("PAYMENT_SESSION_STATES",{INITIATED:"INITIATED",IN_PROCESS:"IN_PROCESS",TERMINAL:"TERMINAL"}).directive("paymentComponent",["lang","checkout","widgetService","$rootScope","$window","ngEventService","errorService","eventService","pollingService","paymentComponentPollingService","paymentComponentService",function(e,t,n,r,o,i,a,s,c,l,u){return{restrict:"A",require:"^view",scope:{},template:`\n               <div id="payment-component-container"></div>\n               <div class="cc_new_card payment-system-condition" ng-if="data.isApplyAsDefaultVisible">\n                <div class="custom-checkbox apply-this-method">\n                  <input type="checkbox" name="isApplyAsDefaultChecked"\n                         ng-model="data.isApplyAsDefaultChecked"\n                         id="pc-apply-payment-method"/>\n                  <label for="pc-apply-payment-method">\n                      <t>Apply this payment method to all active subscriptions</t>\n                  </label>\n                </div>\n               </div>\n               <div consents-list></div>\n                 <div id="payment-component-footer-modal" class="footer-modal">\n                   <div class="complete-purchase-button">\n                     <button\n                       ng-click="paymentComponentCompletePurchase()"\n                       type="button"\n                       class="button big"\n                       name="complete-purchase-button">\n                       ${e.trc("checkout.platform","Complete purchase")}\n                     </button>\n                   </div>\n                 </div>`,link:["scope","element",function(e,t){}],controller:["$scope",function(d){angular.extend(d,BaseComponentController);const p=u.getSelectedPaymentMethod(),m=p&&p.paymentMethodType||void 0,f=p&&p.id||void 0,g=void 0===t.isRememberMyPaymentMethodChecked||t.isRememberMyPaymentMethodChecked,h=!(!t.input.isApplyPaymentMethodEnabled||void 0!==t.isApplyAsDefaultChecked)||t.isApplyAsDefaultChecked,E=t.getSelectedTerm().isSubscription;d.paymentComponentCompletePurchase=function(){const o=(d.data.isRememberMyPaymentMethodChecked||E)&&d.data.isApplyAsDefaultChecked;i={elementId:n.getElementIdByType("Payment").elementId,isApplyAsDefaultChecked:o},a(r).reset(),t.validateOnCompletePayment().then(()=>t.collectPurchaseData()).then(()=>{t.disableCheckout(),n.getElement(i.elementId).then(e=>e.dispatchSignal("paymentProcessStart",{isApplyAsDefaultChecked:i.isApplyAsDefaultChecked}))}).catch(n=>{a(r).reset(),n.isCheckConsentsError?a(r).global({name:n.name,message:e.trc("service.error.codes","Mandatory checkout consent is required!")}):n&&n.errors&&n.errors.length>0&&n.errors[0].msg&&n.errors.forEach(function(t){a(r).global({name:t.name,message:e.trc("service.error.codes",t.msg)})}),t.fireCheckoutPaymentErrorEvent(),t.enabledCheckout()});var i},d.data={isApplyAsDefaultChecked:h,isApplyAsDefaultVisible:!!t.input.isApplyPaymentMethodEnabled,isRememberMyPaymentMethodVisible:!E,isRememberMyPaymentMethodChecked:g},function(){const p=o.location!==o.parent.location?new URLSearchParams(document.location.href).get("url"):document.location.href,g=t.input.paymentComponentSessionId,h=t.getAid(),v=t.config.user.uid,C=t.getSelectedTerm().chargeCurrency,y={isStandalone:!0,applicationId:h,customerId:v,currencyCode:C,resourceUrl:p,paymentMethodType:m,paySourceId:f,isRememberMyPaymentMethodVisible:d.data.isRememberMyPaymentMethodVisible,isRememberMyPaymentMethodChecked:d.data.isRememberMyPaymentMethodChecked,paymentComponentSessionId:g,paymentComponentMode:"payment"},T=n.getElementIdByType("Payment");n.createElement(T.elementId,T.type,"#payment-component-container",y).then(function(n){const p=(e,t,r)=>{const o=e&&e.replace("_","-");n.dispatchSignal("localeChanged",{locale:o})};e.on(p),n.listen("destroy",function(){u.setSelectedPaymentMethod(null),t.isRememberMyPaymentMethodChecked=d.data.isRememberMyPaymentMethodChecked,t.isApplyAsDefaultChecked=d.data.isApplyAsDefaultChecked,e.off(p)}),n.listen("paymentMethodSelected",function(e){t.input.isApplyPaymentMethodEnabled&&(e.data.isNewPaymentMethod?d.data.isApplyAsDefaultVisible=!!E||d.data.isRememberMyPaymentMethodChecked:d.data.isApplyAsDefaultVisible=!1)}),n.listen("rememberMyPaymentMethodChanged",function(e){const n=e.data.isRememberMyPaymentMethodChecked;t.input.isApplyPaymentMethodEnabled&&(d.data.isApplyAsDefaultVisible=n),d.data.isRememberMyPaymentMethodChecked=n}),n.listen("paymentMethodApplyAsDefaultFailed",function(t){t.data.updateFailedSubscriptionCount>0?(a(r).reset(),t.data.updatedSubscriptionCount>0?a(r).global(e.trc("checkout.platform","Could not apply payment method to all subscriptions")):a(r).global(e.trc("checkout.platform","Could not apply payment method"))):0===t.data.updatedSubscriptionCount&&a(r).global(e.trc("checkout.platform","No eligible active subscriptions."))}),n.listen("paymentProcessError",function(e){t.enabledCheckout(),i.fire("ENABLE_COMPLETE_PURCHASE_BUTTON"),a(r).reset(),d.displayErrors(d,e.data,a,s)}),n.listen("paymentProcessComplete",function(n){t.unselectPaymentMethods(),t.flags.selectedPaymentMethod=null,t.enabledCheckout();const i={async_processing:!1,first_name:t.config.user.firstName,last_name:t.config.user.lastName,processId:"pc-payment-"+t.input.oid,oid:t.input.oid,offerId:t.input.offerId,termId:t.input.termId,url:t.params.url};l.checkWithPolling(o.TPParam.CHECK_COMPLETE,t,i,0,c.completeTimeout(),function(n){n?function(e){e.errors.length>0?a(r).terminal(e.errors[0].msg||e.errors[0].message):e.models.receipt&&(angular.copy(e.models.receipt,t.input.receipt),t.paymentComponentCompletePurchase())}(n):a(r).terminal(e.trc("checkout.platform","Could not complete purchase. Unexpected error has happened"))})})}).catch(function(e){a(d).reset(),d.displayErrors(d,e,a,s)})}(),d.$on("$destroy",function(){const e=n.getElementIdByType("Payment");n.destroy(e.elementId),l.cancelPolling()})}]}}]).directive("paymentComponentZeroForm",[function(){return{restrict:"A",template:'\n              <div zero-form-component>\n                <div consents-list></div>\n                <div class="footer-modal">\n                    <div class="complete-purchase-button" complete-purchase-button\n                         title="{{\'Complete\' | t}}"></div>\n                </div>\n              </div>\n               ',link:["scope","element",function(e,t){}],controller:["$scope",function(e){angular.extend(e,BaseComponentController)}]}}]).factory("paymentComponentPollingService",["tpHTTP",function(e){let t;return{checkWithPolling:function n(r,o,i,a,s,c){a++;function l(e){e&&e.models&&"waiting"!==e.models.pollStatus?c(e):a<=s.length?t=setTimeout(function(){n(r,o,i,a,s,c)},s[a-1]):c()}e({method:"post",url:r,params:i,data:{checkoutStats:o.stats}}).then(l).catch(l)},cancelPolling:function(){t&&(clearTimeout(t),t=null)}}}]).factory("paymentComponentService",[function(){let e=null;return{setSelectedPaymentMethod:function(t){e=t},getSelectedPaymentMethod:function(){return e}}}]),angular.module("JwtModule",[]).factory("jwtService",function(){let e=window.atob&&window.atob.bind(window)||function(e){var r=String(e).replace(/=+$/,"");if(r.length%4==1)throw new n("'atob' failed: The string to be decoded is not correctly encoded.");for(var o,i,a=0,s=0,c="";i=r.charAt(s++);~i&&(o=a%4?64*o+i:i,a++%4)?c+=String.fromCharCode(255&o>>(-2*a&6)):0)i=t.indexOf(i);return c},t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function n(e){this.message=e}return n.prototype=new Error,n.prototype.name="InvalidCharacterError",{decode:function(t,n){if(!t)return"";var r=!0===(n=n||{}).header?0:1;return JSON.parse(function(t){var n=t.replace(/-/g,"+").replace(/_/g,"/");switch(n.length%4){case 0:break;case 2:n+="==";break;case 3:n+="=";break;default:throw"Illegal base64url string!"}try{return function(t){return decodeURIComponent(e(t).replace(/(.)/g,function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}))}(n)}catch(t){return e(n)}}(t.split(".")[r]))}}}),angular.module("renewableGiftModule",["generalModule"]).directive("redeemRenewableGiftComponent",["checkout","errorService","ssComponentController","tpHTTP","userService","ngEventService","viewService","$q","lang",function(e,t,n,r,o,i,a,s,c){return{restrict:"A",templateUrl:"/widget/checkout/component/partials/redeem-renewable-gift-component.html",scope:{skipValidation:"@"},require:"^view",link:function(e,t,n,r){r.registerComponentController(e),r.extendScope(e),t.on("$destroy",function(){r.unregisterComponentController(e)})},controller:["$scope",function(t){angular.extend(t,BaseComponentController),t.isUserValidated=!1,t.parentEmail=null,t.parentAccountName=null,t.childEmail=null,t.loaded=!0,t.hasNoErrors=!0,t.errorMessage="",t.errorTitle="",t.businessUrl=window.TPParam.config.app.businessUrl,t.user=window.TPParam.config.user,t.resourceName="",t.selectedTerm,t.register=function(){a()||e.register()},t.close=function(){e.close()},t.userLoggedIn=a,t.validate=function(){return t.loaded=!1,(n={aid:e.getAid(),code:e.params.gift_redemption_code,userToken:e.params.userToken,userProvider:e.params.userProvider,userRef:e.params.userRef,janrainCaptureToken:e.params.janrainCaptureToken},r.post(window.TPParam.REDEEM_GIFTABLE_SUBSCRIPTION_CODE,n).then(function(e){return e.data.models})).then(function(n){t.hasNoErrors=!0,t.resourceName=n.resourceName,t.termName=n.termName,t.isUserValidated=!0,n.alreadyPurchased&&e.onAlreadyPurchased({models:n})}).catch(function(e){!function(e){switch(t.hasNoErrors=!1,e.errors[0].code){case"99010":t.errorTitle=c.trc("checkout.platform","You have already redeemed your gift");break;default:t.errorTitle=c.trc("checkout.platform","Unable to redeem a gift")}t.errorMessage=e.errors[0].msg}(e),t.loaded=!0}).finally(function(){t.loaded=!0});var n};var n=i.subscribe("EVENT_CHECKOUT_RELOADED",function(e){o.isUserValid()&&(t.user=window.TPParam.config.user)});function a(){return e.isUserValid()}t.$on("$destroy",function(){n()})}]}}]);
'use strict';
angular.module("ngLocale", [], ["$provide", function($provide) {
var PLURAL_CATEGORY = {ZERO: "zero", ONE: "one", TWO: "two", FEW: "few", MANY: "many", OTHER: "other"};
$provide.value("$locale", {
  "DATETIME_FORMATS": {
    "AMPMS": [
      "AM",
      "PM"
    ],
    "DAY": [
      "Sunday",
      "Monday",
      "Tuesday",
      "Wednesday",
      "Thursday",
      "Friday",
      "Saturday"
    ],
    "MONTH": [
      "January",
      "February",
      "March",
      "April",
      "May",
      "June",
      "July",
      "August",
      "September",
      "October",
      "November",
      "December"
    ],
    "SHORTDAY": [
      "Sun",
      "Mon",
      "Tue",
      "Wed",
      "Thu",
      "Fri",
      "Sat"
    ],
    "SHORTMONTH": [
      "Jan",
      "Feb",
      "Mar",
      "Apr",
      "May",
      "Jun",
      "Jul",
      "Aug",
      "Sep",
      "Oct",
      "Nov",
      "Dec"
    ],
    "fullDate": "EEEE, MMMM d, y",
    "longDate": "MMMM d, y",
    "medium": "MMM d, y h:mm:ss a",
    "mediumDate": "MMM d, y",
    "mediumTime": "h:mm:ss a",
    "short": "M/d/yy h:mm a",
    "shortDate": "M/d/yy",
    "shortTime": "h:mm a"
  },
  "NUMBER_FORMATS": {
    "CURRENCY_SYM": "$",
    "DECIMAL_SEP": ".",
    "GROUP_SEP": ",",
    "PATTERNS": [
      {
        "gSize": 3,
        "lgSize": 3,
        "macFrac": 0,
        "maxFrac": 3,
        "minFrac": 0,
        "minInt": 1,
        "negPre": "-",
        "negSuf": "",
        "posPre": "",
        "posSuf": ""
      },
      {
        "gSize": 3,
        "lgSize": 3,
        "macFrac": 0,
        "maxFrac": 2,
        "minFrac": 2,
        "minInt": 1,
        "negPre": "(\u00a4",
        "negSuf": ")",
        "posPre": "\u00a4",
        "posSuf": ""
      }
    ]
  },
  "id": "en-us",
  "pluralCat": function (n) {  if (n == 1) {   return PLURAL_CATEGORY.ONE;  }  return PLURAL_CATEGORY.OTHER;}
});
}]);
angular.module('PnSpinnerModule', [])
  .directive('pnSpinner', function () {
    return {
      restrict: 'A',
      scope: {
        size: '@?'
      },
      templateUrl: '/ng/common/pn-spinner/pn-spinner.shtml',
      controller: ['$scope', function ($scope) {
        $scope.spinnerSize = $scope.size || 'small';
      }],
    }
  });

