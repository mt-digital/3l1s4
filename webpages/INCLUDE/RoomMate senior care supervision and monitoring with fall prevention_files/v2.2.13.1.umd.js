!function(e){!function(e){"use strict";var t,i,r,n,s,o,a,c,u,d,l,g,v,p,h,w,m,f,y,S,b,E,I,C,T,D,P,V,k,_,U,A,x,L,O,N,B,F,W=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},R=(e,t,i)=>(W(e,t,"read from private field"),i?i.call(e):t.get(e)),$=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},j=(e,t,i,r)=>(W(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),M=(e,t,i)=>(W(e,t,"access private method"),i);if(false){if("undefined"!=typeof navigator&&"ReactNative"===navigator.product&&"undefined"==typeof crypto)throw new Error("React Native does not have a built-in secure random generator. If you don’t need unpredictable IDs use `nanoid/non-secure`. For secure IDs, import `react-native-get-random-values` before Nano ID.");if("undefined"!=typeof msCrypto&&"undefined"==typeof crypto)throw new Error("Import file with `if (!window.crypto) window.crypto = window.msCrypto` before importing Nano ID to fix IE 11 support");if("undefined"==typeof crypto)throw new Error("Your browser does not have secure random generator. If you don’t need unpredictable IDs, you can use nanoid/non-secure.")}let z=(e=21)=>{let t="",i=crypto.getRandomValues(new Uint8Array(e));for(;e--;){let r=63&i[e];if(36>r)t+=r.toString(36);else if(62>r)t+=(r-26).toString(36).toUpperCase();else if(63>r)t+="_";else t+="-"}return t};const J="_grDebugMode",G=new class{isDebugEnabled(){return!!window.sessionStorage.getItem(J)}startDebug(){window.sessionStorage.setItem(J,"true")}},H=new class{get isLoggingEnabled(){return G.isDebugEnabled()}log(...e){this.displayLog("log",...e)}info(...e){this.displayLog("info",...e)}error(...e){if(e[0]instanceof Error)e.push(e[0].stack);this.displayLog("error",...e)}forceLogError(...e){if(e[0]instanceof Error)e.push(e[0].stack);console.error(...e)}warn(...e){this.displayLog("warn",...e)}displayLog(e,...t){if(this.isLoggingEnabled)console[e](...t)}};function q(e){const t=document.cookie.match(new RegExp(`(^| )${e}=([^;]+)`));if(t)return t[2]}function X(e,t,i=""){const r=new Date;r.setTime(r.getTime()+365*24*60*60*1e3),document.cookie=`${e}=${t}; expires=${r.toUTCString()}; path=/; ${i?`domain=${i}`:""}`}function K(e){const t=new RegExp(`[?&]${e}=([^&#]*)`).exec(window.location.href);return t?decodeURI(t[1]):null}function Y(e){return!!e&&"object"==typeof e}function Z(e,t){const i={...e};for(const r of Object.keys(t))if(e.hasOwnProperty(r)&&Y(e[r])&&Y(t[r])&&!Array.isArray(e[r]))i[r]=Z(e[r],t[r]);else i[r]=t[r];return i}var Q=(e=>(e["SetDomain"]="setDomain",e["SetListToken"]="setListToken",e["SetUserId"]="setUserId",e["SetEvent"]="setEvent",e["SetCookie"]="setCookie",e["SetAutoFunnelData"]="setAutoFunnelData",e["Push"]="push",e["SetCustomServiceWorkerPath"]="setCustomSwPath",e["ViewItem"]="viewItem",e["ViewCategory"]="viewCategory",e["LikeItem"]="likeItem",e["UnlikeItem"]="unlikeItem",e["WishListItem"]="wishlistItem",e["Purchase"]="orderPlaced",e["CartUpdate"]="cartUpdate",e["ShopifyAbandonedCart"]="shopifyAbandonedCart",e["SaveEvent"]="saveEvent",e["FlushEvents"]="flushEvents",e["SetUserDevice"]="setUserDevice",e["SetUserLocation"]="setUserLocation",e["SetVisitUrlPath"]="setVisitUrlPath",e["SetLastActivityDate"]="setLastActivityDate",e["SetIsNewVisitor"]="setIsNewVisitor",e["SetHasUserVisitPage"]="setHasUserVisitPage",e["SetRawEvent"]="setRawEvent",e["ImportScript"]="importScript",e["DelayScript"]="delayScript",e["InitScript"]="initScript",e))(Q||{}),ee=(e=>(e["UserEventSaved"]="userEventSaved",e["UserEventUpdated"]="userEventUpdated",e["UserECommerceEventMatchedByECommerceElement"]="userECommerceEventMatchedByElement",e["WebPushConsentAccepted"]="webPushConsentAccepted",e["WebPushCustomConsentRejected"]="webPushCustomConsentRejected",e["WebPushNativeConsentRejected"]="webPushNativeConsentRejected",e))(ee||{});const te=10;class ie{constructor(){this._cvar=[]}setTrackerUrl(e){this.trackerUrl=e}markAsEnabled(e){this.isEnabled=e}setUserId(e){this.uid=e}setCustomVariable(e,t,i){if(!this._cvar[e])this._cvar[e]=[];this._cvar[e].push(t),this._cvar[e].push(i)}setGenerationTime(){var e;if(this.gt_ms)return;const t=null==(e=performance.getEntriesByType("navigation")[0])?void 0:e.toJSON();if(t)this.gt_ms=Math.floor(t.responseEnd-t.requestStart)}trackEvent(e,t,i,r){this.trackPageView(Object.assign({e_c:e,e_a:t,e_n:i,...r&&{e_v:r}}))}getCustomVariable(){return JSON.stringify(Object.assign({},this._cvar))}static getScreenResolution(){return`${screen.width??te}x${screen.height??te}`}static encodeUrlParam(e){return`${encodeURIComponent(e[0])}=${encodeURIComponent(e[1])}`}getFullTrackerUrl(e){const t=new Date;return Object.entries({...e,...document.referrer&&{urlRef:document.referrer},url:window.location.href,uid:this.uid,_cvar:this.getCustomVariable(),h:t.getHours(),m:t.getMinutes(),s:t.getSeconds(),res:ie.getScreenResolution(),gt_ms:this.gt_ms}).reduce(((e,t)=>void 0===t[1]?e:`${e}&${ie.encodeUrlParam(t)}`),this.trackerUrl)}trackPageView(e){if(e||this.isEnabled)if(this.setGenerationTime(),window.fetch)fetch(this.getFullTrackerUrl(e),{method:"GET",mode:"no-cors"}).catch((e=>{H.error("Error while sending tracking data:",e)}));else new Image(1,1).src=this.getFullTrackerUrl(e)}}var re=(e=>(e["UuidHasBeenSet"]="grUuidHasBeenSet",e["PopupsRendererCustomUrl"]="grPopupsRendererCustomUrl",e))(re||{});class ne{constructor(){$(this,t,new Proxy({},{get(e,t){if(t in e)return e[t];else return e[t]=[],e[t]}}))}addEvent(e,i){R(this,t)[e].push(i)}drainEvents(e){const i=R(this,t)[e];return R(this,t)[e]=[],i}getEvents(e){return R(this,t)[e]}hasDelayedEvents(e){return R(this,t)[e].length>0}}t=new WeakMap,i=new WeakMap,r=new WeakMap;const se=new class{constructor(){$(this,i,{}),$(this,r,new ne)}publish(e,...t){var n;if(null==(n=R(this,i)[e])?void 0:n.length)R(this,i)[e].forEach((i=>{i(...t),H.log(`Event ${e} published with arguments'`,...t)}));else R(this,r).addEvent(e,t)}subscribe(e,t,n={}){const{preventEventDraining:s,ignoreQueuedEvents:o}=n;if(!R(this,i)[e])R(this,i)[e]=[];if(R(this,r).hasDelayedEvents(e)&&!o)if(s)R(this,r).getEvents(e).forEach((e=>t(...e)));else R(this,r).drainEvents(e).forEach((e=>t(...e)));if(n.signal)n.signal.addEventListener("abort",(()=>{this.unsubscribe(e,t)}),{once:true});R(this,i)[e].push(t)}unsubscribe(e,t){var r;const n=null==(r=R(this,i)[e])?void 0:r.indexOf(t);if(n>-1)R(this,i)[e].splice(n,1)}removeListeners(e){delete R(this,i)[e]}};var oe,ae,ce=(e=>(e["DeviceType"]="debug_device_type",e["Location"]="debug_location",e["VisitUrlPath"]="debug_visit_url_path",e["BrowserStorageLastActivityDate"]="debug_browser_storage_last_activity_date",e["NewVisitor"]="debug_new_visitor",e["HasUserVisitPage"]="debug_has_user_visit_page",e["Events"]="debug_events",e))(ce||{});function ue(){const e=e=>{const t=sessionStorage.getItem(e);if(t){if([ce.DeviceType,ce.VisitUrlPath,ce.Location].includes(e))return t;if(e===ce.BrowserStorageLastActivityDate){const e=new Date(t);return isNaN(e.getTime())?void 0:e}if([ce.NewVisitor,ce.HasUserVisitPage,ce.Events].includes(e))try{return JSON.parse(t)}catch(i){H.error(`Invalid debug data for: ${e}`)}}};return{enabled:true,data:{[ce.DeviceType]:e(ce.DeviceType),[ce.BrowserStorageLastActivityDate]:e(ce.BrowserStorageLastActivityDate),[ce.Location]:e(ce.Location),[ce.NewVisitor]:e(ce.NewVisitor),[ce.VisitUrlPath]:e(ce.VisitUrlPath),[ce.HasUserVisitPage]:e(ce.HasUserVisitPage),[ce.Events]:e(ce.Events)}}}function de(e,t,i){const r=Re.debugObject;Re.debugObject={...r,data:{...null==r?void 0:r.data,[e]:t}},sessionStorage.setItem(e,i||String(t))}function le(e){var t,i;return null==(i=null==(t=Re.debugObject)?void 0:t.data)?void 0:i[e]}function ge(e,t){return Re.isDebug?t:e}(ae=oe||(oe={}))["PageVisit"]="visit",ae["Popup"]="popup",ae["ViewItem"]="view_item",ae["ViewCategory"]="view_category",ae["WishlistItem"]="wishlist_item",ae["LikeItem"]="like_item",ae["UnlikeItem"]="unlike_item",ae["OrderPlaced"]="order_placed",ae["Cart"]="cart_update",void(ae["ShopifyAbandonedCart"]="shopify_webhook_abandoned_cart");let ve=class extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype),this.name=this.constructor.name}};class pe extends ve{constructor(e){super(e)}}const he={cartToken:"string",urlToken:"string",visitorEmail:"string"},we=["cartToken","urlToken"];var me,fe,ye,Se,be,Ee,Ie,Ce,Te,De,Pe,Ve,ke,_e;(_e=me||(me={}))["Inline"]="inline",void(_e["Popup"]="popup"),(ke=fe||(fe={}))["Hq"]="Hq",void(ke["Us"]="Us"),void((ye||(ye={}))["UserAid"]="X-Aid"),(Ve=Se||(Se={}))[Ve["OneSecond"]=1e3]="OneSecond",Ve[Ve["OneMinute"]=6e4]="OneMinute",Ve[Ve["OneHour"]=36e5]="OneHour",Ve[Ve["OneDay"]=864e5]="OneDay",void(Ve[Ve["OneWeek"]=6048e5]="OneWeek"),(Pe=be||(be={}))["Active"]="active",void(Pe["Inactive"]="inactive"),(De=Ee||(Ee={}))["EveryTime"]="everyTime",void(De["OnceEveryAmountTime"]="onceEveryAmountTime"),void((Ie||(Ie={}))["RemoveLastTransitionNodeEnter"]="removeLastTransitionNodeEnter"),(Te=Ce||(Ce={}))["ReactSendWebPush"]="react_web_webpush",Te["ReactCollectWebPushConsent"]="react_web_collect_webpush_subscription",Te["ReactShowPopup"]="react_web_popup",Te["FilterWebUrl"]="filter_web_url",Te["FilterWebSubscribers"]="filter_web_subscriber",Te["FilterLocation"]="filter_web_geolocation",Te["FilterDevice"]="filter_web_device",Te["FilterReturningVisitor"]="filter_web_returning_visitor",Te["ConditionProductViewed"]="await_web_view_item_event",Te["ConditionCategoryViewed"]="await_web_view_category_event",Te["ConditionWebPushConsent"]="await_web_webpush_subscribe",Te["ConditionProductLiked"]="await_web_like_item_event",Te["ConditionWebAction"]="await_web_action",Te["TransferToBackend"]="react_backend_transfer",Te["AwaitScroll"]="await_scroll",void(Te["ShowPopup"]="react_popup"),n=new WeakMap;const Ue=new class{constructor(){$(this,n,{[oe.LikeItem]:[],[oe.OrderPlaced]:[],[oe.UnlikeItem]:[],[oe.ViewCategory]:[],[oe.ViewItem]:[],[oe.WishlistItem]:[],[oe.PageVisit]:[],[oe.Popup]:[],[oe.Cart]:[]})}getEvents(e){return Promise.resolve(R(this,n)[e])}getAllEvents(){return Promise.resolve(Object.values(R(this,n)).flat(1))}getAllECommerceEvents(){return Promise.resolve([...R(this,n)[oe.ViewItem],...R(this,n)[oe.ViewCategory],...R(this,n)[oe.LikeItem],...R(this,n)[oe.UnlikeItem],...R(this,n)[oe.WishlistItem],...R(this,n)[oe.OrderPlaced],...R(this,n)[oe.Cart]])}getAllPopupEvents(){return Promise.resolve([...R(this,n)[oe.Popup]])}saveEvent(e){return R(this,n)[e.eventType].push(e),Promise.resolve()}};var Ae=(e=>(e["v2"]="v2",e["af"]="af",e["wp"]="wp",e["we"]="we",e["ec"]="ec",e))(Ae||{}),xe=(e=>(e["v2"]="GRV2",e["af"]="GRAF",e["wp"]="GRWP",e["we"]="GRWE",e["ec"]="GREC",e))(xe||{});const Le={[Ae.af]:"autoFunnel",[Ae.ec]:"ecommerce",[Ae.v2]:"tracking",[Ae.we]:"webEvents",[Ae.wp]:"webPush"};s=new WeakSet,o=e=>Le[e];const Oe=new class{constructor(){$(this,s)}setScriptInitialized(e){const t=M(this,s,o).call(this,e);window.__grIntegrationConfig[t].isModuleInitialized=true}isScriptInitialized(e){var t,i;const r=M(this,s,o).call(this,e);return(null==(i=null==(t=null==window?void 0:window.__grIntegrationConfig)?void 0:t[r])?void 0:i.isModuleInitialized)??false}};var Ne=(e=>(e["visitorUuid"]="gaVisitorUuid",e["visitorValuable"]="gaIsValuable",e["VisitorEmail"]="gaVisitorEId",e["VisitorResubscribed"]="gaVisitorResubscribed",e["NotificationConsentAcceptedFromPrompt"]="gaWpnConAcc",e["NotificationConsentCustomPromptRejectedDEPRECATED"]="gaWpnConRej-{promptId}",e["NotificationConsentCustomPromptRejected"]="gaWpnConRej-promptId",e))(Ne||{}),Be=(e=>(e[e["OneYear"]=31536e6]="OneYear",e[e["TwoWeeks"]=12096e5]="TwoWeeks",e[e["ThreeMonths"]=7776e6]="ThreeMonths",e))(Be||{});const Fe=new class{constructor(){this.timer=Date.now()}getCurrentVisitOnPageTime(){return Date.now()-this.timer}resetTimer(){this.timer=Date.now()}};a=new WeakMap,c=new WeakMap,u=new WeakMap,d=new WeakSet,l=function(){if(!R(this,a))window.history.pushState=new Proxy(window.history.pushState,{apply:(e,t,i)=>{const r=e.apply(t,i);for(const s of Array.from(R(this,c)))try{s.apply(t,i)}catch(n){H.error("Push state callback error",n)}return r}}),window.history.replaceState=new Proxy(window.history.replaceState,{apply:(e,t,i)=>{const r=e.apply(t,i);for(const s of Array.from(R(this,u)))try{s.apply(t,i)}catch(n){H.error("Replace state callback error",n)}return r}}),j(this,a,true)};const We=new class{constructor(){$(this,d),$(this,a,false),$(this,c,new Set),$(this,u,new Set)}init(){M(this,d,l).call(this)}onPushState(e,t={}){var i;if(!(null==(i=t.signal)?void 0:i.aborted))if(R(this,c).add(e),t.signal)t.signal.addEventListener("abort",(()=>{this.removePushStateListener(e)}),{once:true})}onReplaceState(e,t={}){var i;if(!(null==(i=t.signal)?void 0:i.aborted))if(R(this,u).add(e),t.signal)t.signal.addEventListener("abort",(()=>{this.removeReplaceStateListener(e)}),{once:true})}removePushStateListener(e){R(this,c).delete(e)}removeReplaceStateListener(e){R(this,u).delete(e)}};We.init();const Re=new class{constructor(){this.scriptModuleManager=Oe}initialize(e){const{xsid:t,grid:i,clientLatestGrid:r,domain:n,aid:s,useNOStorage:o,useBetterSubscriberIdentification:a,isServedFromCustomDomain:c,scriptsDomain:u,scriptsVersion:d,tracking:l,isDebugMode:g,uuuid:v}=e;if(g)G.startDebug();window.__grIntegrationConfig=window.__grIntegrationConfig||{cData:{aid:s,grid:i,domain:n,useNOStorage:o,useBetterSubscriberIdentification:a,isServedFromCustomDomain:c,clientLatestGrid:r,uuuid:v},visitor:{email:null,eComId:null,xsid:t},tracking:{isModuleInitialized:false,isEnabled:l},webEvents:{isModuleInitialized:false,visitorApplicationEndpoint:null,automationJourneyGraphs:{},webPushActivePromptGraph:null,popupGraphs:{}},webPush:{isModuleInitialized:false,customSwPath:null,wpid:null,pushDomain:null,promptEndpoint:null},analyticsData:{scriptsDomain:u,scriptsVersion:d},ecommerce:{isModuleInitialized:false},autoFunnel:{isModuleInitialized:false},eventBus:se,temporaryEventsStorage:Ue,vts:Fe,phs:We,debug:g?ue():void 0,delayedScripts:{},scriptTypesInitialized:new Set}}canUseBackendForSubscriberIdentification(){return window.__grIntegrationConfig.cData.useBetterSubscriberIdentification}getUserAid(){return window.__grIntegrationConfig.cData.aid}getClientLatestGrid(){return window.__grIntegrationConfig.cData.clientLatestGrid}getVisitorUuid(){return q(Ne.visitorUuid)}getUserAnalyticsDomain(){return window.__grIntegrationConfig.cData.domain}getUserUuid(){return window.__grIntegrationConfig.cData.uuuid}enablePopupDevMode(){window.__grIntegrationConfig.setCustomPopupRendererUrl=e=>{window.sessionStorage.setItem(re.PopupsRendererCustomUrl,e)}}getPopupRendererCustomUrl(){return window.sessionStorage.getItem(re.PopupsRendererCustomUrl)}setCustomSwPath(e){if("string"!=typeof e)throw new Error("Path type must be string");if(!e.match(/gr_sw_main.js|service-worker\/service-worker.js$/))throw new Error("Invalid sw file name");window.__grIntegrationConfig.webPush.customSwPath=e}getCustomSwPath(){var e;return null==(e=window.__grIntegrationConfig)?void 0:e.webPush.customSwPath}isTrackingEnabled(){return window.__grIntegrationConfig.tracking.isEnabled}isTrackingScriptServedFromCustomDomain(){return window.__grIntegrationConfig.cData.isServedFromCustomDomain}set visitorEmail(e){window.__grIntegrationConfig.visitor.email=e}get visitorEmail(){return window.__grIntegrationConfig.visitor.email}get pushWpid(){return window.__grIntegrationConfig.webPush.wpid}set pushWpid(e){window.__grIntegrationConfig.webPush.wpid=e}set pushDomain(e){window.__grIntegrationConfig.webPush.pushDomain=e}get pushDomain(){return window.__grIntegrationConfig.webPush.pushDomain}set pushPromptEndpoint(e){window.__grIntegrationConfig.webPush.promptEndpoint=e}get pushPromptEndpoint(){return window.__grIntegrationConfig.webPush.promptEndpoint}get eventBus(){return window.__grIntegrationConfig.eventBus}get canUseBackendStorageForEvents(){return window.__grIntegrationConfig.cData.useNOStorage}get webConnectScriptCdnUrl(){return window.__grIntegrationConfig.analyticsData.scriptsDomain}get webConnectCurrentScriptsVersion(){return window.__grIntegrationConfig.analyticsData.scriptsVersion}get isDebug(){var e,t;return!!(null==(t=null==(e=window.__grIntegrationConfig)?void 0:e.debug)?void 0:t.enabled)}set debugObject(e){window.__grIntegrationConfig.debug=e}get debugObject(){var e;return null==(e=window.__grIntegrationConfig)?void 0:e.debug}get delayedScripts(){var e;return(null==(e=window.__grIntegrationConfig)?void 0:e.delayedScripts)||{}}set delayedScripts(e){window.__grIntegrationConfig.delayedScripts=e}set visitorApplicationEndpoint(e){window.__grIntegrationConfig.webEvents.visitorApplicationEndpoint=e}get visitorApplicationEndpoint(){return window.__grIntegrationConfig.webEvents.visitorApplicationEndpoint}get userEventsStorageApplicationUrl(){return window.__grIntegrationConfig.ecommerce.webEventsSearchApplicationEndpoint}set userEventsStorageApplicationUrl(e){window.__grIntegrationConfig.ecommerce.webEventsSearchApplicationEndpoint=e}get temporaryEventsStorage(){return window.__grIntegrationConfig.temporaryEventsStorage}get automationJourneyGraphs(){return window.__grIntegrationConfig.webEvents.automationJourneyGraphs}get webPushActivePromptGraph(){return window.__grIntegrationConfig.webEvents.webPushActivePromptGraph}set webPushActivePromptGraph(e){window.__grIntegrationConfig.webEvents.webPushActivePromptGraph=e}get popupGraphs(){return window.__grIntegrationConfig.webEvents.popupGraphs}get visitorXsid(){return window.__grIntegrationConfig.visitor.xsid}get visitorTimeService(){return window.__grIntegrationConfig.vts}get pageHistoryService(){return window.__grIntegrationConfig.phs}},$e=204;function je(e,t){const i=e.isTextResponse??(null==t?void 0:t.isTextResponse);return fetch(e,{...t,headers:{...null==t?void 0:t.headers,...(null==t?void 0:t.omitAidHeader)?{}:{[ye.UserAid]:Re.getUserAid()}}}).then((async e=>{if(e.ok){if(e.status===$e)return;return i?e.text():e.json()}const t=await e.text();return Promise.reject({statusCode:e.status,message:t})}))}const Me=new class{retrieveXsid(){return je(new URL("retrieveXsid",Re.getUserAnalyticsDomain()).href,{isTextResponse:true,omitAidHeader:true,credentials:"include"})}},ze=Symbol("SessionService");class Je{constructor(e){if(new.target===Je&&e!==ze)throw new Error(`Invalid ${new.target.name} constructor`)}hasUserVisitedPage(){return this.getSessionVisitData().count>1}saveUserVisit(){const e=this.getSessionVisitData()||{count:0};sessionStorage.setItem("gaUserPageSessionVisit",JSON.stringify({...e,count:e.count+1}))}getSessionVisitData(){return JSON.parse(sessionStorage.getItem("gaUserPageSessionVisit"))}}const Ge=new Je(ze),He=Symbol("DebugSessionService");class qe extends Je{constructor(e){if(super(),new.target===qe&&e!==He)throw new Error(`Invalid ${new.target.name} constructor`)}hasUserVisitedPage(){const e=le(ce.HasUserVisitPage);if(void 0===e)return super.hasUserVisitedPage();else return e}setHasUserVisitedPage(e){de(ce.HasUserVisitPage,e)}}const Xe=new qe(He);function Ke(){return ge(Ge,Xe)}var Ye,Ze,Qe,et,tt,it,rt,nt,st,ot,at,ct,ut,dt,lt,gt,vt,pt,ht,wt,mt,ft,yt,St,bt,Et,It,Ct,Tt,Dt,Pt,Vt,kt,_t,Ut,At,xt,Lt,Ot,Nt;(Nt=Ye||(Ye={}))["ShowWhenCondition"]="showWhenCondition",Nt["VisitorsCondition"]="visitors",Nt["DeviceCondition"]="device",Nt["LocationCondition"]="location",Nt["ECommerceCondition"]="ecommerce",Nt["TriggerFrequency"]="frequency",Nt["PreventDisplay"]="preventDisplay",void(Nt["DateRange"]="dateRange"),(Ot=Ze||(Ze={}))["Mobile"]="mobile",Ot["Tablet"]="tablet",void(Ot["Desktop"]="desktop"),(Lt=Qe||(Qe={}))["All"]="all",Lt["New"]="new",void(Lt["Returning"]="returning"),void((et||(et={}))["All"]="all"),(xt=tt||(tt={}))["ConditionsLogicSeparator"]="conditionsLogicSeparator",void(xt["ECommerceConditions"]="ecommerceConditions"),(At=it||(it={}))["Amount"]="amount",void(At["Date"]="date"),(Ut=rt||(rt={}))["And"]="and",void(Ut["Or"]="or"),(_t=nt||(nt={}))["Exactly"]="exactly",_t["LessThan"]="lessThan",void(_t["MoreThan"]="moreThan"),(kt=st||(st={}))["LastDays"]="lastDays",void(kt["DateRange"]="dateRange"),(Vt=ot||(ot={}))["AnyProduct"]="any",Vt["AnyCategory"]="any",Vt["AnyProductLiked"]="any",Vt["AnyProductInPlacedOrder"]="any",Vt["AnyCategoryInPlacedOrder"]="any",Vt["AnyProductInUpdatedCart"]="any",void(Vt["AnyCategoryInUpdatedCart"]="any"),(Pt=at||(at={}))["PastEvents"]="filter",void(Pt["FutureEvents"]="await"),(Dt=ct||(ct={}))["Category"]="category",void(Dt["Product"]="product"),void((ut||(ut={}))["Product"]="product"),(Tt=dt||(dt={}))["ViewProductOrCategory"]="productOrCategoryView",Tt["LikeProduct"]="likeItem",Tt["OrderPlaced"]="orderPlaced",void(Tt["CartUpdated"]="cartUpdated"),(Ct=lt||(lt={}))["Percent"]="percent",void(Ct["Selector"]="selector"),(It=gt||(gt={}))["Instantly"]="instantly",It["Delay"]="delay",It["Exit"]="exit",It["Scroll"]="scroll",It["Inactivity"]="inactivity",void(It["Click"]="click"),(Et=vt||(vt={}))["AfterSubmit"]="submit",Et["AfterClose"]="close",void(Et["AfterTimes"]="timesAmount"),(bt=pt||(pt={}))["Always"]="always",bt["Session"]="session",void(bt["EveryDays"]="everyDays"),(St=ht||(ht={}))["Exactly"]="equal",St["LessThan"]="lessThan",void(St["MoreThan"]="moreThan"),(yt=wt||(wt={}))["Exactly"]="equal",yt["LessThan"]="lessThan",void(yt["MoreThan"]="moreThan"),(ft=mt||(mt={}))[ft["InvalidCssSelector"]=1]="InvalidCssSelector",ft[ft["EmptyCssSelector"]=2]="EmptyCssSelector",ft[ft["CssSelectorTooLong"]=3]="CssSelectorTooLong",ft[ft["CssInvalidType"]=4]="CssInvalidType",ft[ft["InvalidTimeoutProperty"]=5]="InvalidTimeoutProperty",ft[ft["ShowWhenScrollPercentInvalidValueType"]=6]="ShowWhenScrollPercentInvalidValueType",ft[ft["ShowWhenScrollPercentValueOutOfBound"]=7]="ShowWhenScrollPercentValueOutOfBound",ft[ft["VisitorTriggerEmpty"]=8]="VisitorTriggerEmpty",ft[ft["VisitorTriggerInvalidProperty"]=9]="VisitorTriggerInvalidProperty",ft[ft["DevicesTriggerEmpty"]=10]="DevicesTriggerEmpty",ft[ft["DevicesTriggerInvalidValue"]=11]="DevicesTriggerInvalidValue",ft[ft["FrequencyEmptyTrigger"]=12]="FrequencyEmptyTrigger",ft[ft["FrequencyTriggerInvalidName"]=13]="FrequencyTriggerInvalidName",ft[ft["FrequencyTriggerNDaysInvalidPropertyValue"]=14]="FrequencyTriggerNDaysInvalidPropertyValue",ft[ft["FrequencyTriggerNDaysEmptyValue"]=15]="FrequencyTriggerNDaysEmptyValue",ft[ft["PreventDisplayTriggerInvalidName"]=16]="PreventDisplayTriggerInvalidName",ft[ft["PreventDisplayTriggerAfterTimesNoValue"]=17]="PreventDisplayTriggerAfterTimesNoValue",ft[ft["PreventDisplayTriggerAfterTimesInvalidValue"]=18]="PreventDisplayTriggerAfterTimesInvalidValue",ft[ft["DateRangeInvalidFromDate"]=19]="DateRangeInvalidFromDate",ft[ft["DateRangeInvalidToDate"]=20]="DateRangeInvalidToDate",ft[ft["DateRangeDateFromAfterDateTo"]=21]="DateRangeDateFromAfterDateTo",ft[ft["LocationEmptyTrigger"]=22]="LocationEmptyTrigger",ft[ft["LocationInvalidType"]=23]="LocationInvalidType",ft[ft["LackOfLogicSeparator"]=24]="LackOfLogicSeparator",ft[ft["LackOfTriggerConditions"]=25]="LackOfTriggerConditions",ft[ft["InvalidTriggerConditions"]=26]="InvalidTriggerConditions",ft[ft["NoProductOrCategorySelected"]=27]="NoProductOrCategorySelected",ft[ft["ProductInvalidType"]=28]="ProductInvalidType",ft[ft["CategoryInvalidType"]=29]="CategoryInvalidType",ft[ft["AmountInvalidConditionName"]=30]="AmountInvalidConditionName",ft[ft["AmountInvalidConditionValueType"]=31]="AmountInvalidConditionValueType",ft[ft["DateInvalidConditionName"]=32]="DateInvalidConditionName",ft[ft["DateLastDaysInvalidConditionValue"]=33]="DateLastDaysInvalidConditionValue",ft[ft["DateDateRangeInvalidConditionValue"]=34]="DateDateRangeInvalidConditionValue",ft[ft["DateDateRangeFromInvalidValue"]=35]="DateDateRangeFromInvalidValue",ft[ft["DateDateRangeToInvalidValue"]=36]="DateDateRangeToInvalidValue",ft[ft["DateDateRangeDateFromAfterDateTo"]=37]="DateDateRangeDateFromAfterDateTo",ft[ft["PopupTriggerInvalidName"]=38]="PopupTriggerInvalidName",ft[ft["PopupTriggerLackOfValuesInLikeItemTrigger"]=39]="PopupTriggerLackOfValuesInLikeItemTrigger",ft[ft["PopupTriggerLikeItemInvalidValues"]=40]="PopupTriggerLikeItemInvalidValues",ft[ft["PopupTriggerOrderPlacedNoConditions"]=41]="PopupTriggerOrderPlacedNoConditions",ft[ft["PopupTriggerOrderPlacedInvalidProducts"]=42]="PopupTriggerOrderPlacedInvalidProducts",ft[ft["PopupTriggerOrderPlacedInvalidCategories"]=43]="PopupTriggerOrderPlacedInvalidCategories",ft[ft["PopupTriggerCartUpdatedNoConditions"]=44]="PopupTriggerCartUpdatedNoConditions",ft[ft["PopupTriggerCartUpdatedInvalidProducts"]=45]="PopupTriggerCartUpdatedInvalidProducts",ft[ft["PopupTriggerCartUpdatedInvalidCategories"]=46]="PopupTriggerCartUpdatedInvalidCategories",ft[ft["PopupTriggerPriceValueConditionInvalidComparator"]=47]="PopupTriggerPriceValueConditionInvalidComparator",ft[ft["PopupTriggerPriceValueConditionInvalidValue"]=48]="PopupTriggerPriceValueConditionInvalidValue",ft[ft["PopupTriggerProductsAmountValueConditionInvalidComparator"]=49]="PopupTriggerProductsAmountValueConditionInvalidComparator",ft[ft["PopupTriggerProductsAmountValueConditionInvalidValue"]=50]="PopupTriggerProductsAmountValueConditionInvalidValue",void(ft[ft["PopupTriggerInvalidTriggerType"]=51]="PopupTriggerInvalidTriggerType");var Bt=(e=>(e[e["Mobile"]=768]="Mobile",e[e["Tablet"]=1023]="Tablet",e))(Bt||{});const Ft=Symbol("DeviceService");g=new WeakSet,v=()=>window.matchMedia("(any-pointer: coarse)").matches&&navigator.maxTouchPoints>0,p=new WeakSet,h=()=>window.matchMedia("(pointer: coarse)").matches&&navigator.maxTouchPoints>0;let Wt=class e{constructor(t){if($(this,g),$(this,p),new.target===e&&t!==Ft)throw new Error(`Invalid ${new.target.name} constructor`)}detectDeviceTypeByScreenWidth(e){var t;const{availWidth:i,availHeight:r}=screen;let n=null==(t=screen.orientation)?void 0:t.type;if(!n)n=window.matchMedia("(orientation: landscape)").matches?"landscape":"portrait";const s=n.match(/landscape/)?r:i;if(Bt.Mobile>=s)return Ze.Mobile;else if(s>Bt.Mobile&&Bt.Tablet>=s)return Ze.Tablet;return e?Ze.Tablet:Ze.Desktop}isDesktopDevice(){return this.getDeviceType()===Ze.Desktop}getDeviceType(){var e,t;const{userAgentData:i}=window.navigator;if(i){if(i.mobile)return Ze.Mobile;else if((null==(e=i.platform)?void 0:e.toLowerCase().includes("android"))||(null==(t=i.platform)?void 0:t.toLowerCase().includes("ipad")))return Ze.Tablet;else if(R(this,p,h))return Ze.Tablet}else if(R(this,p,h))return this.detectDeviceTypeByScreenWidth(true);else if(R(this,g,v))return this.detectDeviceTypeByScreenWidth();return Ze.Desktop}getBrowserLanguage(){const{language:e}=window.navigator;if(e.match(/\w{2}-\w{2}/))return e.split("-")[0].toLowerCase();else return e.toLowerCase()}getUserOs(){const{userAgentData:e}=window.navigator;if(e)return e.platform.toLowerCase();else return this.getOsFromUserAgent()}getOsFromUserAgent(){let e="unknown";const{userAgent:t}=navigator,i=t.toLowerCase();if(i.includes("win"))e="windows";if(i.includes("mac"))e="macos";if(i.includes("x11"))e="unix";if(i.includes("linux"))e="Linux";if(i.includes("android"))e="android";if(/iphone|ipad|ipod/.test(i))e="ios";return e}};const Rt=new Wt(Ft),$t=Symbol("DebugDeviceService");class jt extends Wt{constructor(e){if(super(),new.target===jt&&e!==$t)throw new Error(`Invalid ${new.target.name} constructor`)}getDeviceType(){const e=le(ce.DeviceType);if(!e)return super.getDeviceType();if(!Object.values(Ze).includes(e))return H.error("Incorrect debug device type. Check if device is correct. Instead of that we will use normal values"),super.getDeviceType();else return e}setDeviceType(e){de(ce.DeviceType,e)}}const Mt=new jt($t),zt=Symbol("LocationService");class Jt{constructor(e){if(new.target===Jt&&e!==zt)throw new Error(`Invalid ${new.target.name} constructor`)}getVisitorCountryCode(){const{domain:e}=window.__grIntegrationConfig.cData;return fetch(`${e}web-user-data/country`).then((e=>e.text()))}}const Gt=new Jt(zt),Ht=Symbol("DebugLocationService");class qt extends Jt{constructor(e){if(super(),new.target===qt&&e!==Ht)throw new Error(`Invalid ${new.target.name} constructor`)}getVisitorCountryCode(){const e=le(ce.Location);if(!e)return super.getVisitorCountryCode();else return Promise.resolve(e)}setVisitorCountryCode(e){if("string"!=typeof e)return H.error("Incorrect debug country code value"),null;de(ce.Location,e)}}const Xt=new qt(Ht);class Kt{static sendJSON(e,t,i=true){const r=i?JSON.stringify({...JSON.parse(t),[ye.UserAid]:Re.getUserAid()}):t;navigator.sendBeacon(e,new Blob([r],{type:"application/json"}))}}var Yt=(e=>(e["Show"]="show",e["Close"]="close",e["Submit"]="submit",e))(Yt||{}),Zt=(e=>(e["One"]="1.0",e))(Zt||{}),Qt=(e=>(e["Web"]="web",e["Mobile"]="mobile",e))(Qt||{});const ei=[oe.OrderPlaced,oe.Cart,oe.LikeItem,oe.UnlikeItem,oe.WishlistItem,oe.ViewItem,oe.ViewCategory],ti=[oe.Cart,oe.LikeItem,oe.UnlikeItem,oe.OrderPlaced,oe.ViewCategory,oe.ViewItem];w=new WeakSet,m=()=>new URL(`u/${Re.getUserUuid()}/e/${Qt.Web}/handle/`,Re.userEventsStorageApplicationUrl).href;const ii=new class{constructor(){$(this,w)}async addPopupEventToStorage(e){throw new Error("Not implemented")}async getPopupActivityData(e){throw new Error("Not implemented")}async saveEventsToStorage(e){if(Re.userEventsStorageApplicationUrl&&Re.getUserUuid()){const t=e.filter((e=>ei.includes(e.event.name)));if(t.length>0)Kt.sendJSON(M(this,w,m).call(this),JSON.stringify(t),false)}else H.error("Attempt to send web events to search was made without search application endpoint or uuuid!")}async sendEventsToMetricsInc(e){const t=e.filter((e=>ti.includes(e.event.name)));if(t.length>0){const e=JSON.stringify({events:t.map((e=>({eventType:e.event.name}))),url:window.location.origin}),i=new URL("/a/ue",Re.getUserAnalyticsDomain()).href;Kt.sendJSON(i,e)}}},ri=new class{encodeEmail(e){return btoa(e)}decode(e){return atob(e)}isEncodedString(e){try{return atob(e),true}catch{return false}}validateEmail(e){return/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(e)}};class ni extends Error{constructor(e){super(e)}static create(...[e,t]){switch(e){case"email":return new ni(`Provided string ${t} is not valid email address`);default:void H.error(`Unsupported value: ${e}`)}}}class si{constructor({e}={}){if(e)this.e=ri.encodeEmail(e)}static createFromContextData(e){try{if(ri.isEncodedString(e.e))e.e=ri.decode(e.e);return si.validate(e),new si(e)}catch(t){if(t instanceof ni)return H.error(t),si.createBlank();throw t}}static createBlank(){return new si}static validate(e){if("e"in e&&!ri.validateEmail(e.e))throw ni.create("email",e.e)}toJSON(){return{...this}}}class oi{constructor(e){$(this,f,void 0),this.eventType=e,j(this,f,null),this.eventId=null,this.aid=Re.getUserAid(),this.grid=Re.getClientLatestGrid(),this.time=Re.visitorTimeService.getCurrentVisitOnPageTime(),this.context=si.createBlank(),this.uuid=Re.getVisitorUuid(),this.url=window.location.href,this.occurredOn=new Date,this.tags=[]}get externalUid(){return R(this,f)}toJSON(){return{eventId:this.eventId,aid:this.aid,grid:this.aid,uuid:this.uuid,externalUid:this.externalUid,context:this.context.toJSON(),time:this.time,url:this.url,tags:this.tags,eventType:this.eventType,occurredOn:this.occurredOn.toUTCString()}}toString({normalized:e}={}){if(e)return JSON.stringify(this.normalizeForExternalStorage());else return JSON.stringify(this.toJSON())}normalize(){const{eventId:e,...t}=this.toJSON();return t}getBaseNormalizedEvent(){return{version:Zt.One,user_uuid:Re.getUserUuid(),time:this.time,tags:this.tags,occurred_on:this.occurredOn.toISOString(),url:this.url,app:{lang:Rt.getBrowserLanguage(),device:Rt.getDeviceType(),os:Rt.getUserOs()},channel:Qt.Web,visitor:{uuid:this.uuid,external_id:this.externalUid,xsid:Re.visitorXsid}}}}f=new WeakMap;class ai extends oi{constructor(e,t,i=si.createBlank()){super(oe.Popup),this.popupEvent=e,this.popupId=t,this.context=i}toJSON(){return{...super.toJSON(),popupId:this.popupId,popupEvent:this.popupEvent}}normalizeForExternalStorage(){return{...this.getBaseNormalizedEvent(),event:{version:"1.0",name:oe.Popup}}}}class ci extends oi{toJSON(){return{...super.toJSON(),data:this.data}}normalizeForExternalStorage(){const e=this.getBaseNormalizedEvent();return{...e,event:{version:this.eventVersion,name:this.eventType,data:this.data},visitor:{uuid:e.visitor.uuid,external_id:e.visitor.external_id}}}}class ui extends oi{constructor(e){super(oe.ShopifyAbandonedCart),this.data=e}toJSON(){return{...super.toJSON(),data:this.data}}normalizeForExternalStorage(){return{...this.getBaseNormalizedEvent(),event:{version:"1.0",name:oe.ShopifyAbandonedCart,data:this.data}}}}const di=class e{constructor(e){$(this,y,void 0),j(this,y,e)}static create(t){return new e(t)}validate(e){return Object.entries(R(this,y)).reduce(((t,[i,r])=>{if(false===t)return t;if(null==e[i]&&r._isOptional)return t;else return r.call(e,e[i])}),true)}stringifySchemaShape(){var t;return M(t=e,S,b).call(t,R(this,y))}trim(e,t=R(this,y)){var i;const r={};for(const[n,s]of Object.entries(e))if("object"==typeof s&&null!==s){if(n in t){const e=null==(i=t[n])?void 0:i.valueShape;if(Array.isArray(s))if(e)r[n]=s.map((t=>this.trim(t,e)));else r[n]=s;else r[n]=this.trim(s,e)}}else if(n in t)r[n]=s;return r}static string(){return gi((e=>"string"==typeof e),(()=>"string"))}static number(){return gi((e=>"number"==typeof e),(()=>"number"))}static boolean(){return gi((e=>"boolean"==typeof e),(()=>"boolean"))}static dateString(){return gi((e=>{if("string"!=typeof e)return false;else return!Number.isNaN(new Date(e).getTime())}),(()=>"date string"))}static object(t){return gi((i=>{if(!t||"object"!=typeof t)return false;else return e.create(t).validate(i)}),(()=>M(this,S,b).call(this,t)),t)}static array(t){return gi((i=>{if(!Array.isArray(i))return false;if("function"==typeof t)return i.every((e=>t(e)));const r=e.create(t);return i.every((e=>r.validate(e)))}),(()=>`[${M(this,S,b).call(this,t)}]`),"function"==typeof t?void 0:t)}};y=new WeakMap,S=new WeakSet,b=e=>{const t={};if("function"==typeof e)return e.getValueType();else for(const[i,r]of Object.entries(e))t[i]=r.getValueType();try{return JSON.stringify(t).replaceAll('\\"','"')}catch{return"Failed to parse validation shape"}},$(di,S);let li=di;function gi(e,t,i){if(e.optional=()=>(e._isOptional=true,e),e.getValueType=t,i)e.valueShape=i;return e}const vi={id:li.string(),sku:li.string().optional(),name:li.string().optional(),vendor:li.string().optional(),price:li.string().optional(),currency:li.string().optional()},pi=li.array({id:li.string(),name:li.string().optional()}).optional(),hi={id:li.string()},wi={shop:li.object({...hi}).optional(),product:li.object({...vi}),categories:pi},mi={product:li.object({...vi}),categories:pi,quantity:li.number()},fi=li.create({...wi}),yi=li.create({shop:li.object({...hi}).optional(),id:li.string(),name:li.string().optional()}),Si=li.create({...wi}),bi=li.create({...wi}),Ei=li.create({...wi}),Ii=li.create({orderId:li.string(),cartId:li.string().optional(),price:li.number(),currency:li.string(),products:li.array(mi)}),Ci=li.create({price:li.number(),cartId:li.string(),cartUrl:li.string(),currency:li.string(),products:li.array(mi)});class Ti extends Error{constructor(e){super(`Data doesn't match required schema: ${e}`)}}class Di extends oi{constructor(e=si.createBlank()){super(oe.PageVisit),this.context=e}normalizeForExternalStorage(){return{...this.getBaseNormalizedEvent(),event:{version:"1.0",name:this.eventType}}}}const Pi={[oe.ViewItem]:fi,[oe.ViewCategory]:yi,[oe.WishlistItem]:Si,[oe.LikeItem]:bi,[oe.UnlikeItem]:Ei,[oe.OrderPlaced]:Ii,[oe.Cart]:Ci},Vi={[oe.ViewItem]:class extends ci{constructor(e,t){super(oe.ViewItem),this.data=e,this.context=t,this.eventVersion="1.0"}normalizeForExternalStorage(){const e=super.normalizeForExternalStorage();return e.event.data.product.price=parseFloat(e.event.data.product.price),e.time=Re.visitorTimeService.getCurrentVisitOnPageTime(),e}},[oe.ViewCategory]:class extends ci{constructor(e,t){super(oe.ViewCategory),this.data=e,this.context=t,this.eventVersion="1.0"}normalizeForExternalStorage(){const e=super.normalizeForExternalStorage();return e.time=Re.visitorTimeService.getCurrentVisitOnPageTime(),e}},[oe.WishlistItem]:class extends ci{constructor(e,t){super(oe.WishlistItem),this.data=e,this.context=t,this.eventVersion="1.0"}},[oe.LikeItem]:class extends ci{constructor(e,t){super(oe.LikeItem),this.data=e,this.context=t,this.eventVersion="1.0"}normalizeForExternalStorage(){const e=super.normalizeForExternalStorage();return e.event.data.product.price=parseFloat(e.event.data.product.price),e}},[oe.UnlikeItem]:class extends ci{constructor(e,t){super(oe.UnlikeItem),this.data=e,this.context=t,this.eventVersion="1.0"}normalizeForExternalStorage(){const e=super.normalizeForExternalStorage();return e.event.data.product.price=parseFloat(e.event.data.product.price),e}},[oe.OrderPlaced]:class extends ci{constructor(e,t){super(oe.OrderPlaced),this.data=e,this.context=t,this.eventVersion="1.0"}normalizeForExternalStorage(){const e=super.normalizeForExternalStorage();return e.event.data.products=e.event.data.products.map((e=>({...e,product:{...e.product,price:parseFloat(e.product.price)}}))),e}},[oe.Cart]:class extends ci{constructor(e,t){super(oe.Cart),this.data=e,this.context=t,this.eventVersion="1.0"}normalizeForExternalStorage(){const e=super.normalizeForExternalStorage();return e.event.data.products=e.event.data.products.map((e=>({...e,product:{...e.product,price:parseFloat(e.product.price)}}))),e}}},ki=class e{static getPageVisitEvent(){return new Di}static getPopupEvent({popupId:e,popupEventName:t}){return new ai(t,e)}static getPopupSubmitEvent(e){return new ai(Yt.Submit,e)}static getPopupShowEvent(e){return new ai(Yt.Show,e)}static getPopupCloseEvent(e){return new ai(Yt.Close,e)}static getViewItemEvent(t,i){var r;return M(r=e,E,I).call(r,oe.ViewItem,t,i)}static getWishlistItemEvent(t,i){var r;return M(r=e,E,I).call(r,oe.WishlistItem,t,i)}static getLikeItemEvent(t,i){var r;return M(r=e,E,I).call(r,oe.LikeItem,t,i)}static getUnlikeItemEvent(t,i){var r;return M(r=e,E,I).call(r,oe.UnlikeItem,t,i)}static getViewCategoryEvent(t,i){var r;return M(r=e,E,I).call(r,oe.ViewCategory,t,i)}static getOrderPlacedEvent(t,i){var r;return M(r=e,E,I).call(r,oe.OrderPlaced,t,i)}static getCartUpdateEvent(t,i){var r;return M(r=e,E,I).call(r,oe.Cart,t,i)}static getShopifyIntegrationAbandonedCartEvent(e){try{return(e=>{if("object"!=typeof e||null===e)throw new pe("Invalid data parameter type");else{const t=Object.entries(he),i=Object.keys(e);if(!we.every((e=>i.includes(e))))throw new pe("Lack of required parameters");if(!t.every((([t,i])=>!e[t]||typeof e[t]===i)))throw new pe("Properties have invalid type")}return true})(e),new ui((t=e,i=Object.keys(he),Object.entries(t).reduce(((e,[t,r])=>{if(i.includes(t))e[t]=r;return e}),{})))}catch(r){return H.error(r),null}var t,i}};E=new WeakSet,I=(e,t,i)=>{const r=Pi[e],n=Vi[e];if(!r||!n)throw new Error("Event type not supported in event factory");if(!r.validate(t))throw new Ti(r.stringifySchemaShape());return new n(r.trim(t),i)},$(ki,E);let _i=ki;var Ui=(e=>(e["Events"]="gr_webconnect",e["VisitorJourneys"]="gr_visitor_journeys",e["ServiceWorkerCallbacks"]="gr_sw_callbacks",e))(Ui||{});const Ai={gr_webconnect:1,gr_visitor_journeys:2,gr_sw_callbacks:1};var xi=(e=>(e["UserActivityEvents"]="user_activity_events",e))(xi||{}),Li=(e=>(e["EventType"]="eventType",e["VisitorUuid"]="visitorUuid",e["EventTypeWithVisitor"]="eventType, visitorUuid",e))(Li||{});let Oi,Ni;const Bi=new WeakMap,Fi=new WeakMap,Wi=new WeakMap,Ri=new WeakMap,$i=new WeakMap;let ji={get(e,t,i){if(e instanceof IDBTransaction){if("done"===t)return Fi.get(e);if("objectStoreNames"===t)return e.objectStoreNames||Wi.get(e);if("store"===t)return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return zi(e[t])},set:(e,t,i)=>(e[t]=i,true),has(e,t){if(e instanceof IDBTransaction&&("done"===t||"store"===t))return true;else return t in e}};function Mi(e){if("function"==typeof e)return function(e){if(e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype))return function(t,...i){const r=e.call(Ji(this),t,...i);return Wi.set(r,t.sort?t.sort():[t]),zi(r)};if((Ni||(Ni=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e))return function(...t){return e.apply(Ji(this),t),zi(Bi.get(this))};else return function(...t){return zi(e.apply(Ji(this),t))}}(e);if(e instanceof IDBTransaction)!(e=>{if(Fi.has(e))return;const t=new Promise(((t,i)=>{const r=()=>{e.removeEventListener("complete",n),e.removeEventListener("error",s),e.removeEventListener("abort",s)},n=()=>{t(),r()},s=()=>{i(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",n),e.addEventListener("error",s),e.addEventListener("abort",s)}));Fi.set(e,t)})(e);if(t=e,(Oi||(Oi=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>t instanceof e)))return new Proxy(e,ji);else return e;var t}function zi(e){if(e instanceof IDBRequest)return(e=>{const t=new Promise(((t,i)=>{const r=()=>{e.removeEventListener("success",n),e.removeEventListener("error",s)},n=()=>{t(zi(e.result)),r()},s=()=>{i(e.error),r()};e.addEventListener("success",n),e.addEventListener("error",s)}));return t.then((t=>{if(t instanceof IDBCursor)Bi.set(t,e)})).catch((()=>{})),$i.set(t,e),t})(e);if(Ri.has(e))return Ri.get(e);const t=Mi(e);if(t!==e)Ri.set(e,t),$i.set(t,e);return t}const Ji=e=>$i.get(e),Gi=["get","getKey","getAll","getAllKeys","count"],Hi=["put","add","delete","clear"],qi=new Map;function Xi(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(qi.get(t))return qi.get(t);const i=t.replace(/FromIndex$/,""),r=t!==i,n=Hi.includes(i);if(!(i in(r?IDBIndex:IDBObjectStore).prototype)||!(n||Gi.includes(i)))return;const s=async function(e,...t){const s=this.transaction(e,n?"readwrite":"readonly");let o=s.store;if(r)o=o.index(t.shift());return(await Promise.all([o[i](...t),n&&s.done]))[0]};return qi.set(t,s),s}var Ki;Ki=ji,void(ji={...Ki,get(e,t,i){return Xi(e,t)||Ki.get(e,t,i)},has(e,t){return!!Xi(e,t)||Ki.has(e,t)}});const Yi=new class{openEventsDatabaseConnection(e){return this.openConnection(Ui.Events,Ai[Ui.Events],e)}openAutomationJourneysDatabaseConnection(e){return this.openConnection(Ui.VisitorJourneys,Ai[Ui.VisitorJourneys],e)}openServiceWorkerCallbacksDatabaseConnection(e){return this.openConnection(Ui.ServiceWorkerCallbacks,Ai[Ui.ServiceWorkerCallbacks],e)}async openConnection(e,t,i){const r=await((e,t,{blocked:i,upgrade:r,blocking:n,terminated:s}={})=>{const o=indexedDB.open(e,t),a=zi(o);if(r)o.addEventListener("upgradeneeded",(e=>{r(zi(o.result),e.oldVersion,e.newVersion,zi(o.transaction),e)}));if(i)o.addEventListener("blocked",(e=>i(e.oldVersion,e.newVersion,e)));return a.then((e=>{if(s)e.addEventListener("close",(()=>s()));if(n)e.addEventListener("versionchange",(e=>n(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a})(e,t,{blocked(e,t,i){H.error(`Connection to old db version: ${t} not closed. Version ${e} not available`,i)},upgrade(e,t,r){H.log(`New db version ${r} detected, upgrading from ${t}`),i(t,r,e)},terminated(){H.log("Closing db connection")},blocking(e,t,i){H.log(`Current connection od db version ${e} is blocking connection to version ${t}.`,i),r.close()}});return r}};Yi.openServiceWorkerCallbacksDatabaseConnection.bind(Yi),Yi.openAutomationJourneysDatabaseConnection.bind(Yi);const Zi=Symbol("BrowserEventsStorageService");C=new WeakSet,T=(e,t,i)=>{!(e=>{if(!e.objectStoreNames.contains(xi.UserActivityEvents))try{const t=e.createObjectStore(xi.UserActivityEvents,{keyPath:"id",autoIncrement:true});t.createIndex(Li.EventType,"eventType",{unique:false}),t.createIndex(Li.VisitorUuid,"uuid",{unique:false}),t.createIndex(Li.EventTypeWithVisitor,["eventType","uuid"])}catch(t){H.error("Error while initializing/upgrading database",t)}})(i)};let Qi=class e{constructor(t){if($(this,C),new.target===e&&t!==Zi)throw new Error(`Invalid ${new.target.name} constructor`)}async saveEvent(e){const t=e instanceof oi?e.normalize():e;try{const e=(await Yi.openEventsDatabaseConnection(M(this,C,T))).transaction(xi.UserActivityEvents,"readwrite"),i=e.objectStore(xi.UserActivityEvents),r=await i.add(t);return await e.done,H.log(`Event with created id: ${r} saved to database`,t),r}catch(i){H.error("Error while saving event to database",i)}}async getEvents(e){const t=q(Ne.visitorUuid);try{const i=(await Yi.openEventsDatabaseConnection(M(this,C,T))).transaction(xi.UserActivityEvents,"readwrite"),r=i.objectStore(xi.UserActivityEvents).index(Li.EventTypeWithVisitor),n=await r.getAll([e,t]);return await i.done,n.map((e=>{const{id:t,...i}=e;return{...i,eventId:String(t)}}))}catch(i){H.error("Error while reading from database",i)}}async getEventById(e){const t=q(Ne.visitorUuid);try{const i=(await Yi.openEventsDatabaseConnection(M(this,C,T))).transaction(xi.UserActivityEvents,"readwrite"),r=i.objectStore(xi.UserActivityEvents),n=await r.get(e);if(await i.done,n&&n.uuid===t)return{...n,eventId:String(e)};else return null}catch(i){H.error("Error while reading from database",i)}}async updateEvent(e,t){const i=(await Yi.openEventsDatabaseConnection(M(this,C,T))).transaction(xi.UserActivityEvents,"readwrite").objectStore(xi.UserActivityEvents),r=await i.get(e);if(r){const e=Z(r,t);await i.put(e)}}async getPopupECommerceEvents(e){const t=q(Ne.visitorUuid),i=(await Yi.openEventsDatabaseConnection(M(this,C,T))).transaction(xi.UserActivityEvents,"readwrite").store.index(Li.VisitorUuid),r=[];let n=await i.openCursor(IDBKeyRange.only(t));for(;n;){const{value:t}=n;if(e(t)){const{id:e,...i}=t;r.push({eventId:String(e),...i})}n=await n.continue()}return r}};const er=new Qi(Zi),tr=Symbol("DebugBrowserEventsStorageService");class ir extends Qi{constructor(e){if(super(),new.target===ir&&e!==tr)throw new Error(`Invalid ${new.target.name} constructor`)}async getPopupECommerceEvents(e){const t=le(ce.Events)||[];if(!t.length)return super.getPopupECommerceEvents(e);else return t.filter(e)}async getEvents(e){const t=q(Ne.visitorUuid),i=le(ce.Events)||[];if(!i.length)return super.getEvents(e);else return i.filter((({eventType:i,uuid:r})=>i===e&&r===t))}async saveEvent(e){const t=e instanceof oi?e.toJSON():e,i=[...le(ce.Events)||[],t];try{const e=JSON.stringify(i);return de(ce.Events,i,e),Math.random()}catch(r){H.error(`Can't parse new debug events. Try again.`)}}}const rr=new ir(tr);function nr(){return ge(er,rr)}const sr={[oe.PageVisit]:_i.getPageVisitEvent,[oe.ViewItem]:_i.getViewItemEvent,[oe.WishlistItem]:_i.getWishlistItemEvent,[oe.LikeItem]:_i.getLikeItemEvent,[oe.UnlikeItem]:_i.getUnlikeItemEvent,[oe.ViewCategory]:_i.getViewCategoryEvent,[oe.OrderPlaced]:_i.getOrderPlacedEvent,[oe.Cart]:_i.getCartUpdateEvent,[oe.Popup]:_i.getPopupEvent},or=2e3;D=new WeakMap,P=new WeakSet,V=(e,t,i)=>{const r=sr[e];try{return"function"==typeof r?r(t,si.createFromContextData(i)):null}catch(n){H.error("Failed to create user event",n)}},k=new WeakSet,_=function(){R(this,D).forEach((([e,t])=>{if(e===oe.ViewCategory||e===oe.ViewItem)er.updateEvent(t,{time:Re.visitorTimeService.getCurrentVisitOnPageTime()}).then((()=>{Re.eventBus.publish(ee.UserEventUpdated,t)})).catch((e=>{H.error("Failed to update event data",e)}))}))};const ar=new class{constructor(){$(this,P),$(this,k),$(this,D,void 0),this.eventToSend=[],j(this,D,[])}async push(e,t,...[i,r]){if(void 0===e.saveToLocal||e.saveToLocal){const n=M(this,P,V).call(this,i,r,t);if(n){const t=await nr().saveEvent(n);if(n.eventId=String(t),R(this,D).push([i,t]),Ue.saveEvent(n),!e.preventRenotify)Re.eventBus.publish(ee.UserEventSaved,n)}else return H.warn(`Invalid event params`,i,r),void 0}if(e.sendToBackend)this.eventToSend.push([i,r,Re.visitorTimeService.getCurrentVisitOnPageTime(),t])}flush(){if(this.eventToSend.length){const e=this.eventToSend.map((([e,t,i,r])=>{const n=M(this,P,V).call(this,e,t,r);if(n)return n.time=i,n.normalizeForExternalStorage();else return null})).filter(Boolean);if(e.length){if(Re.canUseBackendStorageForEvents)ii.saveEventsToStorage(e);ii.sendEventsToMetricsInc(e)}}this.eventToSend=[]}startUpdatingStoredEvents(){setInterval((()=>{M(this,k,_).call(this)}),or)}resetEventsStoredInCurrentSession(){R(this,D).length=0}};class cr extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype),this.name=this.constructor.name}}class ur extends cr{constructor(){super("Failed to parse data from JSON string")}}const dr=Symbol("StorageService");class lr{constructor(e){if(new.target===lr&&e!==dr)throw new Error(`Invalid ${new.target.name} constructor`)}async isNewVisitor(){return!(await this.getLastActivityDate())}getLastActivityDate(){return this.getLastActivityDateFromBrowserStorage()}getUserActivityDataFromBrowserStorage(){const e=q(Ne.visitorUuid),t=localStorage.getItem("gaLocalStorageVisitKey");let i;try{i=JSON.parse(t)}catch{throw new ur}if(null==i?void 0:i[e])return i[e];else return{lastActivity:null,totalCount:1}}async getLastActivityDateFromBrowserStorage(){const{lastActivity:e}=await this.getUserActivityDataFromBrowserStorage();if(e)return Promise.resolve(new Date(e));else return null}saveUserActivity(){Re.eventBus.publish(Q.SaveEvent,{sendToBackend:true,saveToLocal:false},si.createBlank(),oe.PageVisit,null),this.saveUserActivityToBrowserStorage()}saveUserActivityToBrowserStorage(){const e=q(Ne.visitorUuid),{totalCount:t}=this.getUserActivityDataFromBrowserStorage(),i={[e]:{lastActivity:_i.getPageVisitEvent().occurredOn.toUTCString(),totalCount:t+1}};try{window.localStorage.setItem("gaLocalStorageVisitKey",JSON.stringify(i))}catch{throw new ur}}}const gr=new lr(dr),vr=Symbol("DebugStorageService");class pr extends lr{constructor(e){if(super(),new.target===pr&&e!==vr)throw new Error(`Invalid ${new.target.name} constructor`)}getLastActivityDate(){var e;const t=le(ce.BrowserStorageLastActivityDate);if(isNaN(null==(e=null==t?void 0:t.getTime)?void 0:e.call(t)))return super.getLastActivityDate();else return Promise.resolve(t)}setLastActivityDate(e){const t=new Date(e);if(isNaN(t.getTime()))return H.error("Incorrect dateString for last activity date. Try again with isoString."),null;de(ce.BrowserStorageLastActivityDate,t,t.toISOString())}isNewVisitor(){const e=le(ce.NewVisitor);if(void 0===e)return super.isNewVisitor();else return Promise.resolve(e)}setIsNewVisitor(e){de(ce.NewVisitor,e,String(e))}}const hr=new pr(vr);function wr(){return ge(gr,hr)}const mr=new class{isScriptDelayed(e){return Object.keys(Re.delayedScripts).includes(e)}delay(e){if(!this.isScriptDelayed(e))Re.delayedScripts={...Re.delayedScripts,[e]:void 0}}storeDelayedScriptParams(e,t){if(this.isScriptDelayed(e))Re.delayedScripts={...Re.delayedScripts,[e]:t}}initScript(e){var t;const i=Re.delayedScripts[e];if(i){Re.delayedScripts=Object.fromEntries(Object.entries(Re.delayedScripts).filter((([t])=>t!==e)));const r=xe[e];null==(t=null==window?void 0:window[r])?void 0:t.init(...i)}}},fr=new class{setCookie({expiresIn:e,domain:t="",value:i,name:r}){const n=this.getExpirationTimeString(e);document.cookie=`${r}=${i}; expires=${n}; path=/; ${t?`domain=${t}`:""}`}getExpirationTimeString(e){if(e instanceof Date)return e.toUTCString();const t=new Date;return t.setTime(t.getTime()+e),t.toUTCString()}getCookie(e){const t=document.cookie.match(new RegExp(`(^| )${e}=([^;]+)`));if(t)return t[2]}removeUuidCookieSessionInfo(){window.sessionStorage.removeItem(re.UuidHasBeenSet)}},yr=16,Sr="https://cdnjs.cloudflare.com/ajax/libs/js-sha256/0.11.0/sha256.min.js",br=new class{async sha256(e){try{const t=(new TextEncoder).encode(e),i=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(i)).map((e=>e.toString(yr).padStart(2,"0"))).join("")}catch(i){H.error("Failed to encrypt visitor e, using fallback lib",i);try{return await(t=Sr,new Promise(((e,i)=>{const r=Object.assign(document.createElement("script"),{src:t});document.head.append(r),r.addEventListener("load",(()=>{e()}),{once:true}),r.addEventListener("error",(e=>{i(e)}),{once:true})}))),window.sha256(e)}catch(r){return H.error("Failed to encrypt visitor e with fallback lib",r),atob(e)}}var t}},Er=new class{getVisitorData(){return je(new URL(`visitors/${Re.getUserAid()}/${q(Ne.visitorUuid)}`,Re.getUserAnalyticsDomain()).href)}};async function Ir(){let e="1"===q("gaIsValuable");if(Re.canUseBackendForSubscriberIdentification())try{e=(await Er.getVisitorData()).isConfirmedIdentifiedVisitor}catch(t){H.error("Failed to load subscriber data",t)}return e}const Cr=new Map,Tr=(e,t)=>{if(!Array.isArray(e))switch(typeof e){case"string":e=[e];break;case"undefined":e=[];break;default:throw new TypeError(`Expected '${t}' to be a string or an array, but got a type of '${typeof e}'`)}return e.filter((e=>{if("string"!=typeof e){if(void 0===e)return false;throw new TypeError(`Expected '${t}' to be an array of strings, but found a type of '${typeof e}' in the array`)}return true}))};function Dr(e,t,i){return((e,t,i,r)=>{if(e=Tr(e,"inputs"),0===(t=Tr(t,"patterns")).length)return[];t=t.map((e=>((e,t)=>{t={caseSensitive:false,...t};const i=e+JSON.stringify(t);if(Cr.has(i))return Cr.get(i);const r="!"===e[0];if(r)e=e.slice(1);e=(e=>{if("string"!=typeof e)throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")})(e).replace(/\\\*/g,"[\\s\\S]*");const n=new RegExp(`^${e}$`,t.caseSensitive?"":"i");return n.negated=r,Cr.set(i,n),n})(e,i)));const{allPatterns:n}=i||{},s=[];for(const o of e){let e;const i=[...t].fill(false);for(const[r,n]of t.entries())if(n.test(o))if(i[r]=true,e=!n.negated,!e)break;if(!(false===e||void 0===e&&t.some((e=>!e.negated))||n&&i.some(((e,i)=>!e&&!t[i].negated))))if(s.push(o),r)break}return s})(e,t,i,true).length>0}var Pr=(e=>(e["Always"]="always",e["OnceEveryDays"]="xDays",e["OncePerTimeAmount"]="xTimeAmount",e["Session"]="everySession",e["LessThanXTimes"]="lessThanXTimes",e["ExactlyXTimes"]="exactlyXTimes",e["MoreThanXTimes"]="moreThanXTimes",e))(Pr||{});const Vr=1e3*60*60*24;U=new WeakSet,A=async(e,t=0)=>{if(e===Pr.Session)return!Ke().hasUserVisitedPage();if(e===Pr.OnceEveryDays){const e=await wr().getLastActivityDate();if(e)return((e,t)=>{const i=new Date(e+t*Vr),r=new Date(i.getFullYear(),i.getMonth(),i.getDate(),0,0,0);return Date.now()>=Date.parse(r.toString())})(e.getTime(),t)}if(e===Pr.OncePerTimeAmount){const e=await wr().getLastActivityDate();if(e)return i=e.getTime(),r=t,Date.now()>=i+r}var i,r;const{totalCount:n}=wr().getUserActivityDataFromBrowserStorage();if(e===Pr.ExactlyXTimes)return t===n;if(e===Pr.LessThanXTimes)return t>n;if(e===Pr.MoreThanXTimes)return n>t;else return true},x=new WeakSet,L=async e=>{const t=await wr().isNewVisitor();switch(e){case Qe.New:return t;case Qe.Returning:return!t;default:return true}},O=new WeakSet,N=function(e="*"){const t=window.location.pathname;return M(this,B,F).call(this,e,t)},B=new WeakSet,F=(e,t)=>Dr(t,e);const kr=new class{constructor(){$(this,U),$(this,x),$(this,O),$(this,B)}async validateVisitorVisits({frequency:e,visitorType:t,frequencyDaysNumber:i,urlPath:r}){if(!M(this,O,N).call(this,r))return false;const[n,s]=await Promise.all([M(this,U,A).call(this,e,i),M(this,x,L).call(this,t)]);return n&&s}},_r=new class{async saveVisitorEmail(e){const t=await br.sha256(e);fr.setCookie({name:Ne.VisitorEmail,value:t,expiresIn:Be.OneYear})}async hasVisitorEmailBeenChanged(e){const t=await br.sha256(e),i=fr.getCookie(Ne.VisitorEmail);if(!i)return false;else return t!==i}async getVisitorData(){const e=Re.getVisitorUuid(),[t,i]=await Promise.all([Ir(),kr.validateVisitorVisits({frequency:Pr.Always,visitorType:Qe.Returning})]);return{isVisitorSubscriber:t,visitorUUID:e,isVisitorReturning:i}}},Ur=4;class Ar extends class{setDomain(e){if(!e||"auto"===e)this.cookieDomain=(()=>{const e=new Date,t=location.hostname.split(".").reverse(),i=[],r=`gaDomain-${z(6)}`,n=z(6);let s="";for(e.setTime(e.getTime()+60*1e3),i.push(t.shift());t.length>0;){if(s=i.reverse().join("."),document.cookie=`${r}=${n}; expires=${e.toUTCString()}; domain=.${s}; path=/`,q(r)===n)return s;i.push(t.shift())}return location.hostname})();else this.cookieDomain=e}setListToken(e){this.listToken=e}}{constructor(e,t,i,r){super(),this.cookieDomain="",this.listToken="",this.email="",this.uuid=document.cookie.replace(/(?:(?:^|.*;\s*)gaVisitorUuid\s*\=\s*([^;]*).*$)|^.*$/,"$1")||"",this.valuable=Number(document.cookie.replace(/(?:(?:^|.*;\s*)gaIsValuable\s*\=\s*([^;]*).*$)|^.*$/,"$1")||0),this.gr_x=K("gr_x")||"",this.gr_s=K("gr_s")||"",this.gr_m=K("gr_m")||"",this.gr_co=K("gr_co")||"",this.tracking=new ie,this.wasPageVisitEventSaved=false,this.onEventPush=(...[e,t,i,r])=>{ar.push(e,t,i,r)},this.onEventFlush=()=>{ar.resetEventsStoredInCurrentSession(),ar.flush()},this.onImportScript=async(e,...t)=>{if(Object.values(Ae).includes(e)){const{webConnectScriptCdnUrl:i,webConnectCurrentScriptsVersion:r}=Re,n=new URL(`${e}.${r}.umd.js`,i);import(n.href).then((()=>{window[xe[e]].init(...t)}))}else H.error(`Invalid script name ${e}`)},this.onDomainSet=e=>{this.setDomain(e)},this.onListTokenSet=e=>{this.setListToken(e)},this.onSetUserId=async(e,t)=>{if("string"!=typeof e)throw new Error(`User email should be a string`);this.assureDomainIsSet(),this.assureUuidIsSet(),await this.setUserId(e,t)},this.onSetEvent=(e,t)=>{this.assureDomainIsSet(),this.assureUuidIsSet(),this.tracking.setUserId(this.serialize()),this.setEvent(e,t)},this.onSetCookie=(e,t)=>{X(e,t,this.cookieDomain)},this.onPush=()=>{this.push()},this.onSetCustomServiceWorkerPath=e=>{Re.setCustomSwPath(e)},this.createDefaultEventsAndSave=()=>{if("hidden"===document.visibilityState){if(!this.wasPageVisitEventSaved)wr().saveUserActivity(),this.wasPageVisitEventSaved=true;Re.eventBus.publish(Q.FlushEvents)}},this.xsid=i||"",this.tracking.setCustomVariable(1,"grid",t),this.tracking.setCustomVariable(2,"aid",r),this.tracking.setTrackerUrl(`${e}index.php?ver=${Ur}`),this.tracking.markAsEnabled(Re.isTrackingEnabled()),this.tracking.setUserId(this.serialize())}async initialize(){if(!this.xsid&&!this.valuable&&Re.isTrackingScriptServedFromCustomDomain())this.xsid=await Me.retrieveXsid();this.attachListeners(),ar.startUpdatingStoredEvents()}attachListeners(){const{eventBus:e}=Re;e.subscribe(Q.SetDomain,this.onDomainSet),e.subscribe(Q.SetListToken,this.onListTokenSet),e.subscribe(Q.SetUserId,this.onSetUserId),e.subscribe(Q.SetEvent,this.onSetEvent),e.subscribe(Q.SetCookie,this.onSetCookie),e.subscribe(Q.Push,this.onPush),e.subscribe(Q.SetCustomServiceWorkerPath,this.onSetCustomServiceWorkerPath),e.subscribe(Q.ImportScript,this.onImportScript),e.subscribe(Q.SetLastActivityDate,this.onSetLastActivityDate),e.subscribe(Q.SetIsNewVisitor,this.onSetIsNewVisitor),e.subscribe(Q.SetHasUserVisitPage,this.onSetHasUserVisitPage),e.subscribe(Q.SetUserDevice,this.onSetDevice),e.subscribe(Q.SetUserLocation,this.onSetUserLocation),e.subscribe(Q.SetRawEvent,this.onSetRawEvent),e.subscribe(Q.SaveEvent,this.onEventPush),e.subscribe(Q.FlushEvents,this.onEventFlush),e.subscribe(Q.DelayScript,this.onScriptDelay),e.subscribe(Q.InitScript,this.onScriptInit)}assureDomainIsSet(){if(!this.cookieDomain)this.onDomainSet("auto")}assureUuidIsSet(e=false){if(!this.uuid||e){const t=this.generateUuid(e);window.sessionStorage.setItem(re.UuidHasBeenSet,"true"),this.uuid=t}}setValuability(){if(this.gr_x&&(this.gr_s||this.gr_co))this.setIsValuable();if(this.email||this.xsid)this.setIsValuable()}assureEventsAreCreatedAndSaved(){document.addEventListener("visibilitychange",this.createDefaultEventsAndSave)}generateUuid(e=false){let t=q("gaVisitorUuid");if(!t||e)t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),X("gaVisitorUuid",t,this.cookieDomain);return t}async setUserId(e,t){if(e&&Re.isTrackingEnabled()){if(Re.visitorEmail=e,await _r.hasVisitorEmailBeenChanged(e))this.assureUuidIsSet(true);this.email=e,this.listToken=t||this.listToken,this.setIsValuable(),this.push(),await _r.saveVisitorEmail(e)}}setEvent(e,t){if(void 0===t)this.tracking.trackEvent("custom","fire",e);else this.tracking.trackEvent("custom","fire",e,JSON.stringify(t))}push(){this.tracking.setUserId(this.serialize()),this.tracking.trackPageView()}setIsValuable(){if(Re.isTrackingEnabled())this.valuable=1,X("gaIsValuable","1",this.cookieDomain)}serialize(){return JSON.stringify({uuid:this.uuid,email:this.email,xsid:this.xsid,list_token:this.listToken,gr_x:this.gr_x,gr_s:this.gr_s,gr_co:this.gr_co,gr_m:this.gr_m,valuable:this.valuable,domain:this.cookieDomain})}onSetLastActivityDate(e){const t=wr();if(t instanceof pr)t.setLastActivityDate(e)}onSetIsNewVisitor(e){const t=wr();if(t instanceof pr)t.setIsNewVisitor(e)}onSetHasUserVisitPage(e){const t=Ke();if(t instanceof qe)t.setHasUserVisitedPage(e)}onSetDevice(e){const t=ge(Rt,Mt);if(t instanceof jt)t.setDeviceType(e)}onSetUserLocation(e){const t=ge(Gt,Xt);if(t instanceof qt)t.setVisitorCountryCode(e)}onSetRawEvent(e){const t=nr();if(t instanceof ir)t.saveEvent(e)}onScriptDelay(e){mr.delay(e)}onScriptInit(e){mr.initScript(e)}}var xr=(e=>(e["ExitIntend"]="exit-intend",e))(xr||{});e.init=e=>{const t=JSON.parse(e),{grid:i,clientLatestGrid:r,aid:n,uuuid:s,xsid:o,isServedFromCustomDomain:a,scriptVersion:c,scriptDomain:u,useBackendSubscriberIdentification:d,useBackendStorage:l,trackingUrl:g,tracking:v,isDebugMode:p}=t,h=window["__GetResponseAnalyticsObject"]||"GrTracking";if((()=>{if([Array.from,"".endsWith,"".startsWith,[].entries].some((e=>!e.toString().includes("[native code]"))))H.warn("Modification of native JavaScript object/methods detected, WebConnect might not work correctly!")})(),Re.initialize({xsid:o,aid:n,grid:i,uuuid:s,clientLatestGrid:r,domain:g,useNOStorage:"true"===l,useBetterSubscriberIdentification:"true"===d,isServedFromCustomDomain:"true"===a,scriptsDomain:u,scriptsVersion:c,tracking:"true"===v,isDebugMode:"true"===p}),Re.scriptModuleManager.isScriptInitialized(Ae.v2))return;Re.scriptModuleManager.setScriptInitialized(Ae.v2);const w=new Ar(g,i,o,n);function m(e,t){window[h](e,t)}Re.pageHistoryService.onPushState((e=>{if((null==e?void 0:e.gr)!==xr.ExitIntend)Re.eventBus.publish(Q.FlushEvents),Re.visitorTimeService.resetTimer()})),Re.pageHistoryService.onReplaceState((()=>{Re.eventBus.publish(Q.FlushEvents),Re.visitorTimeService.resetTimer()})),window.addEventListener("popstate",(e=>{var t;if((null==(t=e.state)?void 0:t.gr)!==xr.ExitIntend)Re.eventBus.publish(Q.FlushEvents),Re.visitorTimeService.resetTimer()})),w.initialize().then((()=>{var e;if(Array.isArray(null==(e=window[h])?void 0:e.q))window[h].q.forEach(((e,t)=>{if("push"!==e[0])Re.eventBus.publish(e[0],e[1],e[2]),delete window[h].q[t]}));window[h]=(e,t,i)=>{Re.eventBus.publish(e,t,i)},w.assureDomainIsSet(),w.assureUuidIsSet(),w.setValuability(),Re.eventBus.publish(Q.Push),w.assureEventsAreCreatedAndSaved(),window.dispatchEvent(new CustomEvent("GRV2Initialized"))})),window.gaSetUserId=e=>{m(Q.SetUserId,e)},window.gaPush=()=>{m(Q.Push)},window.getVisitorDetails=()=>_r.getVisitorData()},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}((e="undefined"!=typeof globalThis?globalThis:e||self).GRV2={})}(this);
